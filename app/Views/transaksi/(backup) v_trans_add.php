<!-- Content wrapper -->
<div class="content-wrapper">
    <div class="container-xxl flex-grow-1 container-p-y">
        <?php
        $session = \Config\Services::session();
        if($session->getFlashdata('warning')) {
        ?>
        <div class="alert alert-warning">
            <ul>
                <?php
                    foreach($session->getFlashdata('warning') as $val) {
                    ?>
                <li><?php echo $val ?></li>
                <?php
                    }
                    ?>
            </ul>
        </div>
        <?php
        }
        if($session->getFlashdata('success')) {
        ?>
        <div class="alert alert-success"><?php echo $session->getFlashdata('success')?></div>
        <?php
        }
        ?>
        <div class="row">
            <div class="col-lg-12 order-0">
                <div class="card">
                    <div class="d-flex align-items-center row">
                        <div class="col-sm-12">
                            <div class="card-body">
                                <h1>Transaksi</h1>
                                <a class="btn btn-secondary mb-3" href="trans" style="font-size:120%;"><i class="fa-solid fa-left-long"></i> Kembali</a>
                                <button id="add_item_btn" class="btn btn-success add_item_btn mb-3" style="font-size:120%;"><i class="fa-solid fa-plus"></i> Tambah Personil</button>
                                <button id="remove_item_btn" class="btn btn-danger mb-3" style="font-size:120%;"><i class="fa-solid fa-minus"></i> Hapus Personil</button>
                                <section id="features" class="features"  style="font-size:150%;">
                                    <ul class="nav nav-tabs row g-2 d-flex mb-3">
                                        <li class="nav-item col-3">
                                            <a class="nav-link active show" data-bs-toggle="tab"
                                                data-bs-target="#tab_start">
                                                <h3>Personil</h3>
                                            </a>
                                        </li>
                                        <!-- End tab nav item -->

                                        <li id="modal_tiket" style="display:none;" class="nav-item col-3">
                                            <a class="nav-link" data-bs-toggle="tab"
                                                data-bs-target="#tab_tiket">
                                                <h3>Tiket</h3>
                                            </a>
                                        </li>
                                        <!-- End tab nav item -->

                                        <li id="modal_hotel" style="display:none;" class="nav-item col-3">
                                            <a class="nav-link" data-bs-toggle="tab"
                                                data-bs-target="#tab_hotel">
                                                <h3>Hotel</h3>
                                            </a>
                                        </li>
                                        <!-- End tab nav item -->

                                        <li id="modal_mobil" style="display:none;" class="nav-item col-3">
                                            <a class="nav-link" data-bs-toggle="tab"
                                                data-bs-target="#tab_mobil">
                                                <h3>Mobil Antar</h3>
                                            </a>
                                        </li>
                                        <!-- End tab nav item -->

                                        <li id="modal_mobil_pulang" style="display:none;"
                                            class="nav-item col-3">
                                            <a class="nav-link" data-bs-toggle="tab"
                                                data-bs-target="#tab_mobil_pulang">
                                                <h3>Mobil Jemput</h3>
                                            </a>
                                        </li>
                                        <!-- End tab nav item -->

                                        <li id="modal_confirm" style="display:none;" class="nav-item col-3">
                                            <a class="nav-link" data-bs-toggle="tab"
                                                data-bs-target="#tab_confirm">
                                                <h3>Confirm</h3>
                                            </a>
                                        </li>
                                        <!-- End tab nav item -->
                                    </ul>
                                    <form action="" method="post" enctype="multipart/form-data">
                                        <div class="modal-body">
                                            <div class="tab-content">
                                                <div class="tab-pane active show" id="tab_start" style="font-size:120%">
                                                    <div class="mb-1">
                                                        Nama
                                                    </div>
                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_nama" name="nama[]" style="width: 100%;"></select>
                                                        </div>
                                                    </div>
                                                    <div id="show_nama">
                                                    </div>
                                                    
                                                    <script>
                                                        $(document).ready(function() {
                                                            var data_select = [
                                                                <?php foreach ($pengguna as $peng) : ?> "<?php echo $peng['nama_pengguna']?>",
                                                                <?php endforeach ?>
                                                            ]

                                                            $(".select_nama").select2({
                                                                data: data_select,
                                                                // tags: true,
                                                                // tags:["Semua"],
                                                                // tokenSeparators: [',', ' '],
                                                            });
                                                        });
                                                    </script>
                                                    
                                                    <div class="mb-1 mt-3">
                                                        Jabatan
                                                    </div>
                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_jabatan" name="jabatan[]" style="width: 100%;"></select>
                                                        </div>
                                                    </div>
                                                    
                                                    <div id="show_jabatan">
                                                    </div>
                                                    
                                                    <script>
                                                        $(document).ready(function() {
                                                            var data_select = [
                                                                //     <php foreach ($bag as $bag) : ?> "<php echo $bag['strorgnm']?>",
                                                                //     <php endforeach ?>
                                                                'Direksi', 'Manager', 'Officer', 'Supervisor', 'Pelaksanma'
                                                            ]

                                                            $(".select_jabatan").select2({
                                                                // tags:["Semua"],
                                                                data: data_select,
                                                                // tags: true,
                                                                // tokenSeparators: [',', ' '],
                                                            });
                                                        });
                                                    </script>

                                                    <!-- <input autocomplete="off" type="text" class="form-control" name="jabatan[]" id="jabatan" style="text-transform:uppercase" oninput="this.value = this.value.toUpperCase()"> -->

                                                    <div class="mb-1 mt-3">
                                                        Nama
                                                    </div>

                                                    <input autocomplete="off" type="text" class="form-control" name="nama[]" id="nama" style="text-transform:capitalize">

                                                    <div id="show_nama">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Jabatan
                                                    </div>

                                                    <input autocomplete="off" type="text" class="form-control" name="jabatan[]" id="jabatan" style="text-transform:capitalize">

                                                    <div id="show_jabatan">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Email Informasi
                                                    </div>
                                                    
                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_email_info" name="email_info[]" style="width: 100%;" data-select2-tags="false"></select>
                                                        </div>
                                                    </div>
                                                    
                                                    <div id="show_email_info">
                                                    </div>

                                                    <script>
                                                        $(document).ready(function() {
                                                            var data_select = [
                                                                <?php foreach ($pengguna as $peng) : ?> "<?php echo $peng['nama_pengguna']?>",
                                                                <?php endforeach ?>
                                                            ]

                                                            $(".select_email_info").select2({
                                                                // tags:["Semua"],
                                                                data: data_select,
                                                                // tags: true,
                                                                // tokenSeparators: [',', ' '],
                                                            });
                                                        });
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Email Evaluasi
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_email_eval" name="email_eval[]" style="width: 100%;"></select>
                                                        </div>
                                                    </div>
                                                    
                                                    <div id="show_email_eval">
                                                    </div>

                                                    <script>
                                                    $(document).ready(function() {
                                                        var data_select = [
                                                            <?php foreach ($pengguna as $peng) : ?> "<?php echo $peng['nama_pengguna']?>",
                                                            <?php endforeach ?>
                                                        ]

                                                        $(".select_email_eval").select2({
                                                            // tags:["Semua"],
                                                            data: data_select,
                                                            // tags: true,
                                                            // tokenSeparators: [',', ' '],
                                                        });
                                                    });
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Pembayaran
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_pembayaran" name="pembayaran[]" style="width: 100%;"></select>
                                                        </div>
                                                    </div>

                                                    <div id="show_pembayaran">
                                                    </div>

                                                    <script>
                                                    $(document).ready(function() {
                                                        var data_select = ['Company Acc', 'Personal Acc']

                                                        $(".select_pembayaran").select2({
                                                            data: data_select,
                                                            // tags: true,
                                                            // tokenSeparators: [',', ' '],
                                                        });
                                                    });
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Tamu/Non Tamu
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_tamu" name="tamu[]" style="width: 100%;"></select>
                                                        </div>
                                                    </div>

                                                    <div id="show_tamu">
                                                    </div>

                                                    <script>
                                                    $(document).ready(function() {
                                                        var data_select = ['Non Tamu', 'Tamu']

                                                        $(".select_tamu").select2({
                                                            data: data_select,
                                                            // tags: true,
                                                            // tokenSeparators: [',', ' '],
                                                        });

                                                        $('select:not(.normal)').each(function() {
                                                            $(this).select2({
                                                                // tags: true,
                                                                dropdownParent: $(this)
                                                                    .parent()
                                                            });
                                                        });
                                                    });
                                                    </script>

                                                    <!-- <div class="mb-1 mt-3">
                                                        PIC
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_pic" name="pic[]" style="width: 100%;"></select>
                                                        </div>
                                                    </div>

                                                    <div id="show_pic">
                                                    </div>

                                                    <script>
                                                    $(document).ready(function() {
                                                        var data_select = [
                                                            <php foreach ($pengguna as $peng) : ?> "<php echo $peng['nama_pengguna']?>",
                                                            <php endforeach ?>
                                                        ]

                                                        $(".select_pic").select2({
                                                            data: data_select,
                                                            // tags: true,
                                                            // tokenSeparators: [',', ' '],
                                                        });

                                                        $('select:not(.normal)').each(function() {
                                                            $(this).select2({
                                                                // tags: true,
                                                                dropdownParent: $(this)
                                                                    .parent()
                                                            });
                                                        });
                                                    });
                                                    </script> -->

                                                    <div class="mb-1 mt-3">
                                                        PIC
                                                    </div>

                                                    <input autocomplete="off" type="text" class="form-control" name="pic[]" id="pic" style="text-transform:capitalize">

                                                    <div id="show_pic">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Pemesanan
                                                    </div>
                                                    <select id="test" name="pemesanan" onchange="showDiv(this)"
                                                        style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                        <option value="pilih">-- pilih salah satu --</option>
                                                        <option value="0">Tiket</option>
                                                        <option value="1">Hotel</option>
                                                        <option value="2">Mobil</option>
                                                        <option value="3">Tiket + Hotel</option>
                                                        <option value="4">Tiket + Mobil</option>
                                                        <option value="5">Hotel + Mobil</option>
                                                        <option value="6">Tiket + Hotel + Mobil</option>
                                                    </select>
                                                    <script>
                                                        function showDiv(select) {
                                                            if (select.value == 'pilih') {
                                                                document.getElementById('modal_tiket').style
                                                                    .display = "none";
                                                                document.getElementById('modal_hotel').style
                                                                    .display = "none";
                                                                document.getElementById('modal_mobil').style
                                                                    .display = "none";
                                                                document.getElementById('modal_mobil_pulang').style
                                                                    .display = "none";
                                                                document.getElementById('modal_confirm').style
                                                                    .display = "none";
                                                            } else if (select.value == 0) {
                                                                document.getElementById('modal_tiket').style
                                                                    .display = "block";
                                                                document.getElementById('modal_hotel').style
                                                                    .display = "none";
                                                                document.getElementById('modal_mobil').style
                                                                    .display = "none";
                                                                document.getElementById('modal_mobil_pulang').style
                                                                    .display = "none";
                                                                document.getElementById('modal_confirm').style
                                                                    .display = "block";
                                                            } else if (select.value == 1) {
                                                                document.getElementById('modal_tiket').style
                                                                    .display = "none";
                                                                document.getElementById('modal_hotel').style
                                                                    .display = "block";
                                                                document.getElementById('modal_mobil').style
                                                                    .display = "none";
                                                                document.getElementById('modal_mobil_pulang').style
                                                                    .display = "none";
                                                                document.getElementById('modal_confirm').style
                                                                    .display = "block";
                                                            } else if (select.value == 2) {
                                                                document.getElementById('modal_tiket').style
                                                                    .display = "none";
                                                                document.getElementById('modal_hotel').style
                                                                    .display = "none";
                                                                document.getElementById('modal_mobil').style
                                                                    .display = "block";
                                                                document.getElementById('modal_mobil_pulang').style
                                                                    .display = "block";
                                                                document.getElementById('modal_confirm').style
                                                                    .display = "block";
                                                            } else if (select.value == 3) {
                                                                document.getElementById('modal_tiket').style
                                                                    .display = "block";
                                                                document.getElementById('modal_hotel').style
                                                                    .display = "block";
                                                                document.getElementById('modal_mobil').style
                                                                    .display = "none";
                                                                document.getElementById('modal_mobil_pulang').style
                                                                    .display = "none";
                                                                document.getElementById('modal_confirm').style
                                                                    .display = "block";
                                                            } else if (select.value == 4) {
                                                                document.getElementById('modal_tiket').style
                                                                    .display = "block";
                                                                document.getElementById('modal_hotel').style
                                                                    .display = "none";
                                                                document.getElementById('modal_mobil').style
                                                                    .display = "block";
                                                                document.getElementById('modal_mobil_pulang').style
                                                                    .display = "block";
                                                                document.getElementById('modal_confirm').style
                                                                    .display = "block";
                                                            } else if (select.value == 5) {
                                                                document.getElementById('modal_tiket').style
                                                                    .display = "none";
                                                                document.getElementById('modal_hotel').style
                                                                    .display = "block";
                                                                document.getElementById('modal_mobil').style
                                                                    .display = "block";
                                                                document.getElementById('modal_mobil_pulang').style
                                                                    .display = "block";
                                                                document.getElementById('modal_confirm').style
                                                                    .display = "block";
                                                            } else if (select.value == 6) {
                                                                document.getElementById('modal_tiket').style
                                                                    .display = "block";
                                                                document.getElementById('modal_hotel').style
                                                                    .display = "block";
                                                                document.getElementById('modal_mobil').style
                                                                    .display = "block";
                                                                document.getElementById('modal_mobil_pulang').style
                                                                    .display = "block";
                                                                document.getElementById('modal_confirm').style
                                                                    .display = "block";
                                                            }
                                                        }
                                                    </script>
                                                    <div class="modal-footer">
                                                    </div>
                                                </div>

                                                <div class="tab-pane" id="tab_tiket" style="font-size:120%">
                                                    <div class="mb-1">
                                                        GS
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_gs_tiket" name="gs_tiket[]" style="width: 100%;"></select>
                                                        </div>
                                                    </div>

                                                    <div id="show_gs_tiket">
                                                    </div>

                                                    <script>
                                                        $(document).ready(function() {
                                                            var data_select = [
                                                                <?php foreach ($pool as $poo) : ?> "<?php echo $poo['nama_pool']?>",
                                                                <?php endforeach ?>
                                                            ]

                                                            $(".select_gs_tiket").select2({
                                                                data: data_select,
                                                                // tags: true,
                                                                // tokenSeparators: [',', ' '],
                                                            });
                                                        });
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Tiket
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_tiket" name="tiket[]" style="width: 100%">
                                                                <optgroup label = "Bus">
                                                                    <?php foreach ($bus as $b => $bu) {?>
                                                                        <option>
                                                                            <?php echo $bu['nama_vendor']?>
                                                                        </option>
                                                                    <?php } ?>
                                                                </optgroup>
                                                                <optgroup label = "Kereta Api">
                                                                    <?php foreach ($kereta as $k => $ker) {?>
                                                                        <option>
                                                                            <?php echo $ker['nama_vendor']?>
                                                                        </option>
                                                                    <?php } ?>
                                                                </optgroup>
                                                                <optgroup label = "Pesawat">
                                                                    <?php foreach ($pesawat as $p => $pes) {?>
                                                                        <option>
                                                                            <?php echo $pes['nama_vendor']?>
                                                                        </option>
                                                                    <?php } ?>
                                                                </optgroup>
                                                                <optgroup label = "Travel">
                                                                    <?php foreach ($travel as $t => $tra) {?>
                                                                        <option>
                                                                            <?php echo $tra['nama_vendor']?>
                                                                        </option>
                                                                    <?php } ?>
                                                                </optgroup>
                                                                <optgroup label = "Kapal Laut">
                                                                    <?php foreach ($kapal_laut as $ka => $kap) {?>
                                                                        <option>
                                                                            <?php echo $kap['nama_vendor']?>
                                                                        </option>
                                                                    <?php } ?>
                                                                </optgroup>
                                                            </select>
                                                        </div>
                                                    </div>

                                                    <div id="show_tiket">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Pemberhentian
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_pemberhentian" name="pemberhentian[]" style="width: 100%">
                                                                <optgroup label = "Bandara">
                                                                    <?php foreach ($bandara as $b => $ba) {?>
                                                                        <option>
                                                                            <?php echo $ba['nama_pemberhentian']?> <?php echo "-" ?> <?php echo $ba['nama_kota']?>
                                                                        </option>
                                                                    <?php } ?>
                                                                </optgroup>
                                                                <optgroup label = "Pelabuhan">
                                                                    <?php foreach ($pelabuhan as $p => $pe) {?>
                                                                        <option>
                                                                            <?php echo $pe['nama_pemberhentian']?> <?php echo "-" ?> <?php echo $pe['nama_kota']?>
                                                                        </option>
                                                                    <?php } ?>
                                                                </optgroup>
                                                                <optgroup label = "Stasiun">
                                                                    <?php foreach ($stasiun as $s => $st) {?>
                                                                        <option>
                                                                            <?php echo $st['nama_pemberhentian']?> <?php echo "-" ?> <?php echo $st['nama_kota']?>
                                                                        </option>
                                                                    <?php } ?>
                                                                </optgroup>
                                                                <optgroup label = "Terminal">
                                                                    <?php foreach ($terminal as $t => $te) {?>
                                                                        <option>
                                                                            <?php echo $te['nama_pemberhentian']?> <?php echo "-" ?> <?php echo $te['nama_kota']?>
                                                                        </option>
                                                                    <?php } ?>
                                                                </optgroup>
                                                            </select>
                                                        </div>
                                                    </div>

                                                    <div id="show_pemberhentian">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Jumlah Tiket
                                                    </div>

                                                    <input autocomplete="off" type="number" min="0" class="form-control" name="jumlah_tiket[]" id="jumlah_tiket">

                                                    <div id="show_jumlah_tiket">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Tanggal dan Jam
                                                    </div>

                                                    <input autocomplete="off" id='tanggal_jam_tiket' class="form-control" name="tanggal_jam_tiket[]">
                                                    
                                                    <script>
                                                        $(function() {
                                                            $.datetimepicker.setLocale('id');
                                                            $('#tanggal_jam_tiket').datetimepicker({
                                                                format: 'Y-m-d H:i',
                                                                formatDate: 'Y-m-d',
                                                                formatTime: 'H:i',
                                                                minDate:'0',
                                                                step: 1,
                                                                closeOnTimeSelect : true,
                                                                scrollMonth : false,
                                                                scrollInput : false,
                                                            });
                                                        });
                                                    </script>

                                                    <div id="show_tanggal_jam_tiket">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Dari
                                                    </div>
                                                    
                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_dari" name="dari_tiket[]" style="width: 100%">
                                                                <?php foreach ($negara as $n => $neg) {?>
                                                                    <optgroup label=<?php echo $neg['nama_negara'] ?>>
                                                                        <?php foreach ($kota as $k => $kot) {?>
                                                                            <?php if ($neg['id_negara'] == $kot['id_negara']) { ?>
                                                                                <option><?php echo $kot['nama_kota'] ?></option>
                                                                            <?php } ?>
                                                                        <?php } ?>
                                                                    </optgroup>
                                                                <?php } ?>
                                                            </select>
                                                        </div>
                                                    </div>

                                                    <div id="show_dari_tiket">
                                                    </div>

                                                    <script>
                                                    $(document).ready(function() {
                                                        var options = {}
                                                        var $select2 = $('.select_dari').select2(
                                                            options);
                                                        $select2.on('select2:select', function(e) {
                                                            var data = e.params.data;

                                                            var text = data.text;
                                                        });
                                                    });
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Tujuan
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_tujuan" name="tujuan_tiket[]" style="width: 100%">
                                                                <?php foreach ($negara as $n => $neg) {?>
                                                                    <optgroup label=<?php echo $neg['nama_negara'] ?>>
                                                                        <?php foreach ($kota as $k => $kot) {?>
                                                                            <?php if ($neg['id_negara'] == $kot['id_negara']) { ?>
                                                                                <option><?php echo $kot['nama_kota'] ?></option>
                                                                            <?php } ?>
                                                                        <?php } ?>
                                                                    </optgroup>
                                                                <?php } ?>
                                                            </select>
                                                        </div>
                                                    </div>

                                                    <div id="show_tujuan_tiket">
                                                    </div>

                                                    <script>
                                                    $(document).ready(function() {
                                                        var options = {}
                                                        var $select2 = $('.select_tujuan').select2(
                                                            options);
                                                        $select2.on('select2:select', function(e) {
                                                            var data = e.params.data;

                                                            var text = data.text;
                                                        });
                                                    });
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Keterangan
                                                    </div>
                                                    
                                                    <textarea class="form-control" name="keterangan_tiket[]" rows="3" placeholder=""></textarea>

                                                    <div id="show_keterangan_tiket">
                                                    </div>
                                                </div>

                                                <div class="tab-pane" id="tab_hotel" style="font-size:120%">
                                                    <div class="mb-1">
                                                        GS
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_gs_hotel" name="gs_hotel[]" style="width: 100%;"></select>
                                                        </div>
                                                    </div>

                                                    <div id="show_gs_hotel">
                                                    </div>

                                                    <script>
                                                    $(document).ready(function() {
                                                        var data_select = [
                                                            <?php foreach ($pool as $poo) : ?> "<?php echo $poo['nama_pool']?>",
                                                            <?php endforeach ?>
                                                        ]

                                                        $(".select_gs_hotel").select2({
                                                            data: data_select,
                                                            // tags: true,
                                                            // tokenSeparators: [',', ' '],
                                                        });
                                                    });
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Kota
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_kota" name="kota[]" style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                                <option value="pilih">-- pilih kota --</option>
                                                                <?php foreach ($negara as $n => $neg) {?>
                                                                    <optgroup label=<?php echo $neg['nama_negara'] ?>>
                                                                        <?php foreach ($kota as $k => $kot) {?>
                                                                            <?php if ($neg['id_negara'] == $kot['id_negara']) { ?>
                                                                                <option><?php echo $kot['nama_kota'] ?></option>
                                                                            <?php } ?>
                                                                        <?php } ?>
                                                                    </optgroup>
                                                                <?php } ?>
                                                            </select>
                                                        </div>
                                                    </div>

                                                    <div id="show_kota">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Hotel/Kamar
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_hotel" name="hotel[]" style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                                <option value="pilih1">-- pilih kota terlebih dahulu --</option>
                                                            </select>
                                                        </div>
                                                    </div>

                                                    <div id="show_hotel">
                                                    </div>

                                                    <div id="show_script_hotel">
                                                    </div>

                                                    <script>
                                                        $(".select_kota").change(function() {
                                                            var val = $(this).val();

                                                            <?php foreach ($kota as $k => $kot) {?>
                                                                if (val == "<?php echo $kot['nama_kota'] ?>") {
                                                                    $(".select_hotel").html(
                                                                        "<option value=''>-- Daftar hotel --</option><?php foreach ($hotel as $h => $hote) {?><?php if ($kot['nama_kota'] == $hote['nama_kota']) { ?><option><?php echo $hote['nama_hotel'] ?><?php echo " - " ?><?php echo $hote['jenis_kamar'] ?></option><?php } ?><?php } ?>"
                                                                    );
                                                                } else if (val == "pilih") {
                                                                    $(".select_hotel").html(
                                                                        "<option value='pilih1'>-- pilih kota terlebih dahulu --</option>"
                                                                    );
                                                                }
                                                            <?php } ?>

                                                            // if (val == "Jakarta") {
                                                            //     $(".select_hotel").html(
                                                            //         "<option value=''>-- pilih hotel --</option><optgroup label='Mess Kx Jkt'><option value='Mess Kx Jkt - Standart'>Mess Kx Jkt - Standart - Sisa kamar : 4</option></optgroup>"
                                                            //     );
                                                            // } else if (val == "pilih") {
                                                            //     $(".select_hotel").html(
                                                            //         "<option value='pilih1'>-- pilih kota terlebih dahulu --</option>"
                                                            //         );
                                                            // } else {
                                                            //     $(".select_hotel").html(
                                                            //         "<option value='pilih2'>-- Data Hotel/Kamar tidak ditemukan --</option>"
                                                            //         );
                                                            // }
                                                        });
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Ketersediaan Kamar Mess
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_mess" name="mess[]" style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                                <option value="pilihmess">-- silahkan pilih Mess Kx Jkt terlebih dahulu --</option>
                                                            </select>
                                                        </div>
                                                    </div>

                                                    <div id="show_mess">
                                                    </div>

                                                    <div id="show_script_mess">
                                                    </div>

                                                    <script>
                                                        $(".select_hotel").change(function() {
                                                            var val = $(this).val();

                                                            if (val == "Mess Kx Jkt - Standar") {
                                                                $(".select_mess").html(
                                                                    "<option value='1'>Tersedia untuk : <?php foreach ($mess as $m => $mes) { $sisa_kamar = $mes['kapasitas_kamar'] - $mes['terpakai'];?><?php echo $sisa_kamar ?><?php } ?> orang</option>"
                                                                );
                                                            } else {
                                                                $(".select_mess").html(
                                                                    "<option value='pilihmess'>-- silahkan pilih Mess Kx Jkt terlebih dahulu --</option>"
                                                                );
                                                            }
                                                        });
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Type
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_type" name="type[]" style="width: 100%;"></select>
                                                        </div>
                                                    </div>

                                                    <div id="show_type">
                                                    </div>
                                                    
                                                    <script>
                                                    $(document).ready(function() {
                                                        var data_select = ['Single', 'Twin / Double']

                                                        $(".select_type").select2({
                                                            data: data_select,
                                                            // tags: true,
                                                            // tokenSeparators: [',', ' '],
                                                        });
                                                    });
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Jumlah Kamar
                                                    </div>
                                                    
                                                    <input autocomplete="off" type="number" min="0" class="form-control" name="jumlah_kamar[]" id="jumlah_kamar">

                                                    <div id="show_jumlah_kamar">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Tanggal Masuk dan Jam Masuk
                                                    </div>

                                                    <input autocomplete="off" id='tanggal_jam_masuk' class="form-control" name="tanggal_jam_masuk[]">

                                                    <script>
                                                        $(function() {
                                                            $.datetimepicker.setLocale('id');
                                                            $('#tanggal_jam_masuk').datetimepicker({
                                                                format: 'Y-m-d H:i',
                                                                formatDate: 'Y-m-d',
                                                                formatTime: 'H:i',
                                                                minDate:'0',
                                                                step: 1,
                                                                closeOnTimeSelect : true,
                                                                scrollMonth : false,
                                                                scrollInput : false,
                                                            });
                                                        });
                                                    </script>

                                                    <div id="show_tanggal_jam_masuk">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Tanggal Keluar dan Jam Keluar
                                                    </div>

                                                    <input autocomplete="off" id='tanggal_jam_keluar' class="form-control" name="tanggal_jam_keluar[]">
                                                    <script>
                                                        $(function() {
                                                            $.datetimepicker.setLocale('id');
                                                            $('#tanggal_jam_keluar').datetimepicker({
                                                                format: 'Y-m-d H:i',
                                                                formatDate: 'Y-m-d',
                                                                formatTime: 'H:i',
                                                                minDate:'0',
                                                                step: 1,
                                                                closeOnTimeSelect : true,
                                                                scrollMonth : false,
                                                                scrollInput : false,
                                                            });
                                                        });
                                                    </script>

                                                    <div id="show_tanggal_jam_keluar">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Keterangan
                                                    </div>

                                                    <textarea class="form-control" name="keterangan_akomodasi[]" rows="3" placeholder=""></textarea>

                                                    <div id="show_keterangan_akomodasi">
                                                    </div>
                                                </div>

                                                <div class="tab-pane" id="tab_mobil" style="font-size:120%">
                                                    <h2>Mobil Antar</h2>

                                                    <div class="mb-1">
                                                        GS
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_gs_mobil" name="gs_mobil[]" style="width: 100%;"></select>
                                                        </div>
                                                    </div>

                                                    <div id="show_gs_mobil">
                                                    </div>

                                                    <script>
                                                    $(document).ready(function() {
                                                        var data_select = [
                                                            <?php foreach ($pool as $poo) : ?> "<?php echo $poo['nama_pool']?>",
                                                            <?php endforeach ?>
                                                        ]

                                                        $(".select_gs_mobil").select2({
                                                            data: data_select,
                                                            // tags: true,
                                                            // tokenSeparators: [',', ' '],
                                                        });
                                                    });
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Jenis Kendaraan
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_jenis_kendaraan" name="jenis_kendaraan[]" style="width: 100%;"></select>
                                                        </div>
                                                    </div>

                                                    <div id="show_jenis_kendaraan">
                                                    </div>

                                                    <script>
                                                    $(document).ready(function() {
                                                        var data_select = [
                                                            'Sedan', 'Station', 'Pickup', 'Box', 'Truck'
                                                        ]

                                                        $(".select_jenis_kendaraan").select2({
                                                            data: data_select,
                                                            // tags: true,
                                                            // tokenSeparators: [',', ' '],
                                                        });
                                                    });
                                                    </script>
                                                    
                                                    <div class="mb-1 mt-3">
                                                        Butuh Tambahan Tenaga Angkut?
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_tenaga_angkut" name="tenaga_angkut[]" style="width: 100%;"></select>
                                                        </div>
                                                    </div>

                                                    <div id="show_tenaga_angkut">
                                                    </div>

                                                    <script>
                                                    $(document).ready(function() {
                                                        var data_select = [
                                                            //     <php foreach ($bag as $bag) : ?> "<php echo $bag['strorgnm']?>",
                                                            //     <php endforeach ?>
                                                            'Tidak', 'Iya'
                                                        ]

                                                        $(".select_tenaga_angkut").select2({
                                                            data: data_select,
                                                            // tags: true,
                                                            // tokenSeparators: [',', ' '],
                                                        });
                                                    });
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Dalam/Luar Kota
                                                    </div>

                                                    <div class="row">
                                                        <div class="col-md-12">
                                                            <select id="dalkot_lukot" name="dalkot_lukot[]" onchange="showD(this)" style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                                <option value="Dalam Kota">Dalam Kota</option>
                                                                <option value="Luar Kota">Luar Kota</option>
                                                            </select>
                                                        </div>
                                                    </div>

                                                    <div id="show_dalkot_lukot">
                                                    </div>

                                                    <div id="show_script_dalkot_lukot">
                                                    </div>

                                                    <script>
                                                        function showD(select) {
                                                            if (select.value == 'Dalam Kota') {
                                                                document.getElementById('menginap').style.display =
                                                                    "none";
                                                            } else if (select.value == 'Luar Kota') {
                                                                document.getElementById('menginap').style.display =
                                                                    "block";
                                                            }
                                                        }
                                                    </script>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <div class="mb-1 mt-3" id="menginap" style="display:none;">
                                                                <div class="mb-1">
                                                                    Menginap
                                                                </div>

                                                                <select class="select_menginap" name="menginap[]"
                                                                    style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                                    <option>Iya</option>
                                                                    <option>Tidak</option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div id="show_menginap">
                                                    </div>

                                                    <div class="mb-1">
                                                        Jumlah Mobil
                                                    </div>

                                                    <input autocomplete="off" type="number" min="0" class="form-control" name="jumlah_mobil[]" id="jumlah_mobil">

                                                    <div id="show_jumlah_mobil">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Kapasitas
                                                    </div>

                                                    <input autocomplete="off" type="number" min="0" class="form-control" name="kapasitas[]" id="kapasitas">

                                                    <div id="show_kapasitas">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Tujuan
                                                    </div>

                                                    <input autocomplete="off" type="text" class="form-control" name="tujuan_mobil[]" id="tujuan_mobil" style="text-transform:capitalize">

                                                    <div id="show_tujuan_mobil">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Siap Di
                                                    </div>

                                                    <input autocomplete="off" type="text" class="form-control" name="siap_di[]" id="siap_di" style="text-transform:capitalize">

                                                    <div id="show_siap_di">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Tanggal
                                                    </div>

                                                    <input autocomplete="off" id='tanggal_mobil' class="form-control" name="tanggal_mobil[]">

                                                    <script>
                                                        $(function() {
                                                            $.datetimepicker.setLocale('id');
                                                            $('#tanggal_mobil').datetimepicker({
                                                                format: 'Y-m-d',
                                                                formatDate: 'Y-m-d',
                                                                minDate:'0',
                                                                step: 1,
                                                                timepicker : false,
                                                                closeOnDateSelect : true,
                                                                scrollMonth : false,
                                                                scrollInput : false,
                                                            });
                                                        });
                                                    </script>

                                                    <div id="show_tanggal_mobil">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Jam Siap
                                                    </div>

                                                    <input autocomplete="off" id='jam_siap' class="form-control" name="jam_siap[]">

                                                    <div id="show_jam_siap">
                                                    </div>

                                                    <script>
                                                        $(function() {
                                                            $.datetimepicker.setLocale('id');
                                                            $('#jam_siap').datetimepicker({
                                                                format: 'H:i',
                                                                formatTime: 'H:i',
                                                                step: 1,
                                                                datepicker : false,
                                                            });
                                                        });
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Keterangan
                                                    </div>

                                                    <textarea class="form-control" name="keterangan_mobil[]" rows="3" placeholder=""></textarea>

                                                    <div id="show_keterangan_mobil">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Sewa mobil untuk penjemputan?
                                                    </div>
                                                    <select id="jemput" name="jemput" onchange="showjemput(this)"
                                                        style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                        <option value="pilih">--pilih salah satu--</option>
                                                        <option value="iya">Iya</option>
                                                        <option value="tidak">Tidak</option>
                                                    </select>

                                                    <script>
                                                        function showjemput(select) {
                                                            if (select.value == 'iya') {
                                                                document.getElementById('modal_mobil_pulang').style
                                                                    .display = "block";
                                                            } else if (select.value == 'tidak') {
                                                                document.getElementById('modal_mobil_pulang').style
                                                                    .display = "none";
                                                            } else if (select.value == 'pilih') {
                                                                document.getElementById('modal_mobil_pulang').style
                                                                    .display = "block";
                                                            }
                                                        }
                                                    </script>
                                                    <div class="mb-3"></div>
                                                </div>

                                                <div class="tab-pane" id="tab_mobil_pulang" style="font-size:120%">
                                                    <h2>Mobil Jemput</h2>

                                                    <div class="mb-1">
                                                        GS
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_gs_mobil_pulang" name="gs_mobil_pulang[]" style="width: 100%;"></select>
                                                        </div>
                                                    </div>

                                                    <div id="show_gs_mobil_pulang">
                                                    </div>

                                                    <script>
                                                    $(document).ready(function() {
                                                        var data_select = [
                                                            <?php foreach ($pool as $poo) : ?> "<?php echo $poo['nama_pool']?>",
                                                            <?php endforeach ?>
                                                        ]

                                                        $(".select_gs_mobil_pulang").select2({
                                                            data: data_select,
                                                            // tags: true,
                                                            // tokenSeparators: [',', ' '],
                                                        });
                                                    });
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Jenis Kendaraan
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_jenis_kendaraan_pulang" name="jenis_kendaraan_pulang[]" style="width: 100%;"></select>
                                                        </div>
                                                    </div>

                                                    <div id="show_jenis_kendaraan_pulang">
                                                    </div>

                                                    <script>
                                                    $(document).ready(function() {
                                                        var data_select = [
                                                            //     <php foreach ($bag as $bag) : ?> "<php echo $bag['strorgnm']?>",
                                                            //     <php endforeach ?>
                                                            'Sedan', 'Station', 'Pickup', 'Box',
                                                            'Truck'
                                                        ]

                                                        $(".select_jenis_kendaraan_pulang").select2({
                                                            data: data_select,
                                                            // tags: true,
                                                            // tokenSeparators: [',', ' '],
                                                        });
                                                    });
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Butuh Tambahan Tenaga Angkut?
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_tenaga_angkut_pulang" name="tenaga_angkut_pulang[]" style="width: 100%;"></select>
                                                        </div>
                                                    </div>

                                                    <div id="show_tenaga_angkut_pulang">
                                                    </div>

                                                    <script>
                                                    $(document).ready(function() {
                                                        var data_select = [
                                                            //     <php foreach ($bag as $bag) : ?> "<php echo $bag['strorgnm']?>",
                                                            //     <php endforeach ?>
                                                            'Tidak', 'Iya'
                                                        ]

                                                        $(".select_tenaga_angkut_pulang").select2({
                                                            data: data_select,
                                                            // tags: true,
                                                            // tokenSeparators: [',', ' '],
                                                        });
                                                    });
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Dalam/Luar Kota
                                                    </div>

                                                    <div class="row">
                                                        <div class="col-md-12">
                                                            <select id="dalkot_lukot_pulang" name="dalkot_lukot_pulang[]" onchange="showpulang(this)" style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                                <option value="Dalam Kota">Dalam Kota</option>
                                                                <option value="Luar Kota">Luar Kota</option>
                                                            </select>
                                                        </div>
                                                    </div>

                                                    <div id="show_dalkot_lukot_pulang">
                                                    </div>

                                                    <div id="show_script_dalkot_lukot_pulang">
                                                    </div>

                                                    <script>
                                                        function showpulang(select) {
                                                            if (select.value == 'Dalam Kota') {
                                                                document.getElementById('menginap_pulang').style.display =
                                                                    "none";
                                                            } else if (select.value == 'Luar Kota') {
                                                                document.getElementById('menginap_pulang').style.display =
                                                                    "block";
                                                            }
                                                        }
                                                    </script>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <div class="mb-1 mt-3" id="menginap_pulang" style="display:none;">
                                                                <div class="mb-1 mt-3">
                                                                    Menginap
                                                                </div>

                                                                <select class="select_menginap_pulang" name="menginap_pulang[]"
                                                                    style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                                    <option>Iya</option>
                                                                    <option>Tidak</option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div id="show_menginap_pulang">
                                                    </div>

                                                    <div class="mb-1">
                                                        Jumlah Mobil
                                                    </div>

                                                    <input autocomplete="off" type="number" min="0" class="form-control" name="jumlah_mobil_pulang[]" id="jumlah_mobil_pulang">

                                                    <div id="show_jumlah_mobil_pulang">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Kapasitas
                                                    </div>

                                                    <input autocomplete="off" type="number" min="0" class="form-control" name="kapasitas_pulang[]" id="kapasitas_pulang">

                                                    <div id="show_kapasitas_pulang">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Tujuan
                                                    </div>

                                                    <input autocomplete="off" type="text" class="form-control" name="tujuan_mobil_pulang[]" id="tujuan_mobil_pulang" style="text-transform:capitalize">

                                                    <div id="show_tujuan_mobil_pulang">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Siap Di
                                                    </div>

                                                    <input autocomplete="off" type="text" class="form-control" name="siap_di_pulang[]" id="siap_di_pulang" style="text-transform:capitalize">

                                                    <div id="show_siap_di_pulang">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Tanggal
                                                    </div>

                                                    <input autocomplete="off" id='tanggal_mobil_pulang' class="form-control" name="tanggal_mobil_pulang[]">
                                                    
                                                    <script>
                                                        $(function() {
                                                            $.datetimepicker.setLocale('id');
                                                            $('#tanggal_mobil_pulang').datetimepicker({
                                                                format: 'Y-m-d',
                                                                formatDate: 'Y-m-d',
                                                                minDate:'0',
                                                                step: 1,
                                                                timepicker : false,
                                                                closeOnDateSelect : true,
                                                                scrollMonth : false,
                                                                scrollInput : false,
                                                            });
                                                        });
                                                    </script>

                                                    <div id="show_tanggal_mobil_pulang">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Jam Siap
                                                    </div>

                                                    <input autocomplete="off" id='jam_siap_pulang' class="form-control" name="jam_siap_pulang[]">

                                                    <div id="show_jam_siap_pulang">
                                                    </div>

                                                    <script>
                                                        $(function() {
                                                            $.datetimepicker.setLocale('id');
                                                            $('#jam_siap_pulang').datetimepicker({
                                                                format: 'H:i',
                                                                formatTime: 'H:i',
                                                                step: 1,
                                                                datepicker : false,
                                                            });
                                                        });
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Keterangan
                                                    </div>

                                                    <textarea class="form-control" name="keterangan_mobil_pulang[]" rows="3" placeholder=""></textarea>

                                                    <div id="show_keterangan_mobil_pulang">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Sewa mobil untuk pengantaran?
                                                    </div>
                                                    <select id="antar" name="antar" onchange="showantar(this)"
                                                        style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                        <option value="pilih">--pilih salah satu--</option>
                                                        <option value="iya">Iya</option>
                                                        <option value="tidak">Tidak</option>
                                                    </select>

                                                    <script>
                                                        function showantar(select) {
                                                            if (select.value == 'iya') {
                                                                document.getElementById('modal_mobil').style
                                                                    .display = "block";
                                                            } else if (select.value == 'tidak') {
                                                                document.getElementById('modal_mobil').style
                                                                    .display = "none";
                                                            } else if (select.value == 'pilih') {
                                                                document.getElementById('modal_mobil').style
                                                                    .display = "block";
                                                            }
                                                        }
                                                    </script>
                                                </div>

                                                <div class="tab-pane" id="tab_confirm" style="font-size:100%">
                                                    <div class="modal-footer">
                                                        <!-- <button class="btn btn-success btn-lg" type="submit"
                                                            name="save" style="font-size:120%">Konfirmasi</button> -->
                                                        <a class="btn btn-success btn-lg" href="javascript:void(0)" style="font-size:85%" data-bs-toggle="modal" data-bs-target="#konfirm"><i class="fa-solid fa-check"></i> Konfirmasi</a>

                                                        <div class="modal" id="konfirm" tabindex="-1" aria-hidden="true">
                                                            <div class="modal-dialog">
                                                                <div class="modal-content">
                                                                    <div class="modal-header">
                                                                        <h2 class="modal-title" id="modalTopTitle">Konfirmasi?</h2>
                                                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                                    </div>
                                                                    <div class="modal-body">
                                                                        <div class="tab-content">
                                                                            <div class="tab-pane active show" style="font-size:120%; text-align: center;">
                                                                                <div class="mt-4 mb-1">
                                                                                    Mohon sebelum melakukan konfirmasi, pastikan sekali lagi apakah data yang diinput sudah benar dan tepat. Setelah melakukan konfirmasi, data tidak dapat diubah kembali.
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="modal-footer">
                                                                        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal" style="font-size:85%;">
                                                                            <i class="fa-solid fa-xmark"></i> Batalkan
                                                                        </button>
                                                                        <button id="add_btn" class="btn btn-success btn-lg" type="submit" name="save" style="font-size:85%">
                                                                            <i class="fa-solid fa-check"></i> Konfirmasi
                                                                        </button>
                                                                    </div>
                                                                </form>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <script>
                                                        var count=0;
                                                        $(document).ready(function() {
                                                            $("#add_item_btn").click(function (e) {
                                                                count++;
                                                                // e.preventDefault();
                                                                // $("#show_nama").append(`
                                                                //     <div class="row mb-3 remove">
                                                                //         <div class="col-md-12">
                                                                //             <select class="select_nama" name="nama[]" style="width: 100%;"></select>
                                                                //         </div>
                                                                //     </div>
                                                                // `);

                                                                // e.preventDefault();
                                                                // $("#show_jabatan").append(`
                                                                //     <div class="row mt-3 mb-3 remove">
                                                                //         <div class="col-md-12">
                                                                //             <select class="select_jabatan remove_item_btn" name="jabatan[]" style="width: 100%;"></select>
                                                                //         </div>
                                                                //     </div>
                                                                // `);

                                                                // e.preventDefault();
                                                                // $("#show_jabatan").append(`
                                                                //     <input autocomplete="off" type="text" class="form-control mt-3 mb-3 remove" name="jabatan[]" style="text-transform:uppercase" oninput="this.value = this.value.toUpperCase()">
                                                                // `);

                                                                e.preventDefault();
                                                                $("#show_nama").append(`
                                                                    <input autocomplete="off" type="text" class="form-control mt-3 mb-3 remove" name="nama[]" style="text-transform:capitalize">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_jabatan").append(`
                                                                    <input autocomplete="off" type="text" class="form-control mt-3 mb-3 remove" name="jabatan[]" id="jabatan" style="text-transform:capitalize">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_email_info").append(`
                                                                    <div class="row mt-3 mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select class="select_email_info" name="email_info[]" style="width: 100%;"></select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_email_eval").append(`
                                                                    <div class="row mt-3 mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select class="select_email_eval" name="email_eval[]" style="width: 100%;"></select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_pembayaran").append(`
                                                                    <div class="row mt-3 mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select class="select_pembayaran" name="pembayaran[]" style="width: 100%;"></select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_tamu").append(`
                                                                    <div class="row mt-3 mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select class="select_tamu" name="tamu[]" style="width: 100%;"></select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                // e.preventDefault();
                                                                // $("#show_pic").append(`
                                                                //     <div class="row mt-3 mb-3 remove">
                                                                //         <div class="col-md-12">
                                                                //             <select class="select_pic" name="pic[]" style="width: 100%;"></select>
                                                                //         </div>
                                                                //     </div>
                                                                // `);

                                                                e.preventDefault();
                                                                $("#show_pic").append(`
                                                                    <input autocomplete="off" type="text" class="form-control mt-3 mb-3 remove" name="pic[]" style="text-transform:capitalize">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_gs_tiket").append(`
                                                                    <div class="row mt-3 mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select class="select_gs_tiket" name="gs_tiket[]" style="width: 100%;"></select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_tiket").append(`
                                                                    <div class="row mt-3 mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select class="select_tiket" name="tiket[]" style="width: 100%">
                                                                                <optgroup label = "Bus">
                                                                                    <?php foreach ($bus as $b => $bu) {?>
                                                                                        <option>
                                                                                            <?php echo $bu['nama_vendor']?>
                                                                                        </option>
                                                                                    <?php } ?>
                                                                                </optgroup>
                                                                                <optgroup label = "Kereta Api">
                                                                                    <?php foreach ($kereta as $k => $ker) {?>
                                                                                        <option>
                                                                                            <?php echo $ker['nama_vendor']?>
                                                                                        </option>
                                                                                    <?php } ?>
                                                                                </optgroup>
                                                                                <optgroup label = "Pesawat">
                                                                                    <?php foreach ($pesawat as $p => $pes) {?>
                                                                                        <option>
                                                                                            <?php echo $pes['nama_vendor']?>
                                                                                        </option>
                                                                                    <?php } ?>
                                                                                </optgroup>
                                                                                <optgroup label = "Travel">
                                                                                    <?php foreach ($travel as $t => $tra) {?>
                                                                                        <option>
                                                                                            <?php echo $tra['nama_vendor']?>
                                                                                        </option>
                                                                                    <?php } ?>
                                                                                </optgroup>
                                                                                <optgroup label = "Kapal Laut">
                                                                                    <?php foreach ($kapal_laut as $ka => $kap) {?>
                                                                                        <option>
                                                                                            <?php echo $kap['nama_vendor']?>
                                                                                        </option>
                                                                                    <?php } ?>
                                                                                </optgroup>
                                                                            </select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_pemberhentian").append(`
                                                                    <div class="row mt-3 mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select class="select_pemberhentian" name="pemberhentian[]" style="width: 100%">
                                                                                <optgroup label = "Bandara">
                                                                                    <?php foreach ($bandara as $b => $ba) {?>
                                                                                        <option>
                                                                                            <?php echo $ba['nama_pemberhentian']?> <?php echo "-" ?> <?php echo $ba['nama_kota']?>
                                                                                        </option>
                                                                                    <?php } ?>
                                                                                </optgroup>
                                                                                <optgroup label = "Pelabuhan">
                                                                                    <?php foreach ($pelabuhan as $p => $pe) {?>
                                                                                        <option>
                                                                                            <?php echo $pe['nama_pemberhentian']?> <?php echo "-" ?> <?php echo $pe['nama_kota']?>
                                                                                        </option>
                                                                                    <?php } ?>
                                                                                </optgroup>
                                                                                <optgroup label = "Stasiun">
                                                                                    <?php foreach ($stasiun as $s => $st) {?>
                                                                                        <option>
                                                                                            <?php echo $st['nama_pemberhentian']?> <?php echo "-" ?> <?php echo $st['nama_kota']?>
                                                                                        </option>
                                                                                    <?php } ?>
                                                                                </optgroup>
                                                                                <optgroup label = "Terminal">
                                                                                    <?php foreach ($terminal as $t => $te) {?>
                                                                                        <option>
                                                                                            <?php echo $te['nama_pemberhentian']?> <?php echo "-" ?> <?php echo $te['nama_kota']?>
                                                                                        </option>
                                                                                    <?php } ?>
                                                                                </optgroup>
                                                                            </select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_jumlah_tiket").append(`
                                                                    <input autocomplete="off" type="number" min="0" class="form-control mt-3 mb-3 remove" name="jumlah_tiket[]">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_tanggal_jam_tiket").append(`
                                                                    <input autocomplete="off" id='tanggal_jam_tiket`+count+`' class="form-control mt-3 mb-3 remove" name="tanggal_jam_tiket[]">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_dari_tiket").append(`
                                                                    <div class="row mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select class="select_dari" name="dari_tiket[]" style="width: 100%">
                                                                                <?php foreach ($negara as $n => $neg) {?>
                                                                                    <optgroup label=<?php echo $neg['nama_negara'] ?>>
                                                                                        <?php foreach ($kota as $k => $kot) {?>
                                                                                            <?php if ($neg['id_negara'] == $kot['id_negara']) { ?>
                                                                                                <option><?php echo $kot['nama_kota'] ?></option>
                                                                                            <?php } ?>
                                                                                        <?php } ?>
                                                                                    </optgroup>
                                                                                <?php } ?>
                                                                            </select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_tujuan_tiket").append(`
                                                                    <div class="row mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select class="select_tujuan" name="tujuan_tiket[]" style="width: 100%">
                                                                                <?php foreach ($negara as $n => $neg) {?>
                                                                                    <optgroup label=<?php echo $neg['nama_negara'] ?>>
                                                                                        <?php foreach ($kota as $k => $kot) {?>
                                                                                            <?php if ($neg['id_negara'] == $kot['id_negara']) { ?>
                                                                                                <option><?php echo $kot['nama_kota'] ?></option>
                                                                                            <?php } ?>
                                                                                        <?php } ?>
                                                                                    </optgroup>
                                                                                <?php } ?>
                                                                            </select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_keterangan_tiket").append(`
                                                                    <textarea class="form-control mt-3 mb-3 remove" name="keterangan_tiket[]" rows="3" placeholder=""></textarea>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_gs_hotel").append(`
                                                                    <div class="row mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select class="select_gs_hotel" name="gs_hotel[]" style="width: 100%;"></select>
                                                                        </div>
                                                                    </div>
                                                                `);
                                                                
                                                                e.preventDefault();
                                                                $("#show_kota").append(`
                                                                    <div class="row mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select id="select_kota`+count+`" name="kota[]" style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                                                <option value="pilih">-- pilih kota --</option>
                                                                                <?php foreach ($negara as $n => $neg) {?>
                                                                                    <optgroup label=<?php echo $neg['nama_negara'] ?>>
                                                                                        <?php foreach ($kota as $k => $kot) {?>
                                                                                            <?php if ($neg['id_negara'] == $kot['id_negara']) { ?>
                                                                                                <option><?php echo $kot['nama_kota'] ?></option>
                                                                                            <?php } ?>
                                                                                        <?php } ?>
                                                                                    </optgroup>
                                                                                <?php } ?>
                                                                            </select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_hotel").append(`
                                                                    <div class="row mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select id="select_hotel`+count+`" name="hotel[]" style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                                                <option value="pilih1">-- pilih kota terlebih dahulu --</option>
                                                                            </select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                var s = document.createElement('script');
                                                                s.type = 'text/javascript';
                                                                s.className = 'remove';
                                                                var code = `
                                                                    $("#select_kota`+count+`").change(function() {
                                                                        var val = $(this).val();

                                                                        <?php foreach ($kota as $k => $kot) {?>
                                                                            if (val == "<?php echo $kot['nama_kota'] ?>") {
                                                                                $("#select_hotel`+count+`").html(
                                                                                    "<option value=''>-- Daftar hotel --</option><?php foreach ($hotel as $h => $hote) {?><?php if ($kot['nama_kota'] == $hote['nama_kota']) { ?><option><?php echo $hote['nama_hotel'] ?><?php echo " - " ?><?php echo $hote['jenis_kamar'] ?></option><?php } ?><?php } ?>"
                                                                                );
                                                                            } else if (val == "pilih") {
                                                                                $("#select_hotel`+count+`").html(
                                                                                    "<option value='pilih1'>-- pilih kota terlebih dahulu --</option>"
                                                                                );
                                                                            }
                                                                        <?php } ?>
                                                                    });
                                                                `;
                                                                try {
                                                                s.appendChild(document.createTextNode(code));
                                                                $("#show_script_hotel").append(s);
                                                                } catch (e) {
                                                                s.text = code;
                                                                $("#show_script_hotel").append(s);
                                                                }

                                                                e.preventDefault();
                                                                $("#show_mess").append(`
                                                                    <div class="row mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select id="select_mess`+count+`" name="mess[]" style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                                                <option value="pilihmess">-- silahkan pilih Mess Kx Jkt terlebih dahulu --</option>
                                                                            </select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                var s = document.createElement('script');
                                                                s.type = 'text/javascript';
                                                                s.className = 'remove';
                                                                var code = `
                                                                    $("#select_hotel`+count+`").change(function() {
                                                                        var val = $(this).val();

                                                                        if (val == "Mess Kx Jkt - Standar") {
                                                                            $("#select_mess`+count+`").html(
                                                                                "<option>Tersedia untuk : <?php foreach ($mess as $m => $mes) { $sisa_kamar = $mes['kapasitas_kamar'] - $mes['terpakai'];?><?php echo $sisa_kamar ?><?php } ?> orang</option>"
                                                                            );
                                                                        } else {
                                                                            $("#select_mess`+count+`").html(
                                                                                "<option value='pilihmess'>-- silahkan pilih Mess Kx Jkt terlebih dahulu --</option>"
                                                                            );
                                                                        }
                                                                    });
                                                                `;
                                                                try {
                                                                s.appendChild(document.createTextNode(code));
                                                                $("#show_script_mess").append(s);
                                                                } catch (e) {
                                                                s.text = code;
                                                                $("#show_script_mess").append(s);
                                                                }

                                                                e.preventDefault();
                                                                $("#show_type").append(`
                                                                    <div class="row mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select class="select_type" name="type[]" style="width: 100%;"></select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_jumlah_kamar").append(`
                                                                    <input autocomplete="off" type="number" min="0" class="form-control mt-3 mb-3 remove" name="jumlah_kamar[]" id="jumlah_kamar">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_tanggal_jam_masuk").append(`
                                                                    <input autocomplete="off" id='tanggal_jam_masuk`+count+`' class="form-control mt-3 mb-3 remove" name="tanggal_jam_masuk[]">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_tanggal_jam_keluar").append(`
                                                                    <input autocomplete="off" id='tanggal_jam_keluar`+count+`' class="form-control mt-3 mb-3 remove" name="tanggal_jam_keluar[]">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_keterangan_akomodasi").append(`
                                                                    <textarea class="form-control mt-3 mb-3 remove" name="keterangan_akomodasi[]" rows="3" placeholder=""></textarea>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_gs_mobil").append(`
                                                                    <div class="row mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select class="select_gs_mobil" name="gs_mobil[]" style="width: 100%;"></select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_jenis_kendaraan").append(`
                                                                    <div class="row mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select class="select_jenis_kendaraan" name="jenis_kendaraan[]" style="width: 100%;"></select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_tenaga_angkut").append(`
                                                                    <div class="row mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select class="select_tenaga_angkut" name="tenaga_angkut[]" style="width: 100%;"></select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_dalkot_lukot").append(`
                                                                    <div class="row mt-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select id="dalkot_lukot`+count+`" name="dalkot_lukot[]" onchange="showD`+count+`(this)" style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                                                <option value="Dalam Kota">Dalam Kota</option>
                                                                                <option value="Luar Kota">Luar Kota</option>
                                                                            </select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                var s = document.createElement('script');
                                                                s.type = 'text/javascript';
                                                                s.className = 'remove';
                                                                var code = `
                                                                    function showD`+count+`(select) {
                                                                        if (select.value == 'Dalam Kota') {
                                                                            document.getElementById('menginap`+count+`').style.display =
                                                                                "none";
                                                                        } else if (select.value == 'Luar Kota') {
                                                                            document.getElementById('menginap`+count+`').style.display =
                                                                                "block";
                                                                        }
                                                                    }
                                                                `;
                                                                try {
                                                                s.appendChild(document.createTextNode(code));
                                                                $("#show_script_dalkot_lukot").append(s);
                                                                } catch (e) {
                                                                s.text = code;
                                                                $("#show_script_dalkot_lukot").append(s);
                                                                }

                                                                e.preventDefault();
                                                                $("#show_menginap").append(`
                                                                    <div class="row mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <div id="menginap`+count+`" style="display:none;">
                                                                                <div class="mb-1">
                                                                                    Menginap
                                                                                </div>

                                                                                <select class="select_menginap" name="menginap[]"
                                                                                    style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                                                    <option>Iya</option>
                                                                                    <option>Tidak</option>
                                                                                </select>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_jumlah_mobil").append(`
                                                                    <input autocomplete="off" type="number" min="0" class="form-control mt-3 mb-3 remove" name="jumlah_mobil[]" id="jumlah_mobil">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_kapasitas").append(`
                                                                    <input autocomplete="off" type="number" min="0" class="form-control mt-3 mb-3 remove" name="kapasitas[]" id="kapasitas">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_tujuan_mobil").append(`
                                                                    <input autocomplete="off" type="text" class="form-control mt-3 mb-3 remove" name="tujuan_mobil[]" id="tujuan_mobil" style="text-transform:capitalize">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_siap_di").append(`
                                                                    <input autocomplete="off" type="text" class="form-control mt-3 mb-3 remove" name="siap_di[]" id="siap_di" style="text-transform:capitalize">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_tanggal_mobil").append(`
                                                                    <input autocomplete="off" id='tanggal_mobil`+count+`' class="form-control mt-3 mb-3 remove" name="tanggal_mobil[]">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_jam_siap").append(`
                                                                    <input autocomplete="off" id='jam_siap`+count+`' class="form-control mt-3 mb-3 remove" name="jam_siap[]">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_keterangan_mobil").append(`
                                                                    <textarea class="form-control mt-3 mb-3 remove" name="keterangan_mobil[]" rows="3" placeholder=""></textarea>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_gs_mobil_pulang").append(`
                                                                    <div class="row mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select class="select_gs_mobil_pulang" name="gs_mobil_pulang[]" style="width: 100%;"></select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_jenis_kendaraan_pulang").append(`
                                                                    <div class="row mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select class="select_jenis_kendaraan_pulang" name="jenis_kendaraan_pulang[]" style="width: 100%;"></select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_tenaga_angkut_pulang").append(`
                                                                    <div class="row mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select class="select_tenaga_angkut_pulang" name="tenaga_angkut_pulang[]" style="width: 100%;"></select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_dalkot_lukot_pulang").append(`
                                                                    <div class="row mt-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select id="dalkot_lukot_pulang`+count+`" name="dalkot_lukot_pulang[]" onchange="showpulang`+count+`(this)" style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                                                <option value="Dalam Kota">Dalam Kota</option>
                                                                                <option value="Luar Kota">Luar Kota</option>
                                                                            </select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                var s = document.createElement('script');
                                                                s.type = 'text/javascript';
                                                                s.className = 'remove';
                                                                var code = `
                                                                    function showpulang`+count+`(select) {
                                                                        if (select.value == 'Dalam Kota') {
                                                                            document.getElementById('menginap_pulang`+count+`').style.display =
                                                                                "none";
                                                                        } else if (select.value == 'Luar Kota') {
                                                                            document.getElementById('menginap_pulang`+count+`').style.display =
                                                                                "block";
                                                                        }
                                                                    }
                                                                `;
                                                                try {
                                                                s.appendChild(document.createTextNode(code));
                                                                $("#show_script_dalkot_lukot_pulang").append(s);
                                                                } catch (e) {
                                                                s.text = code;
                                                                $("#show_script_dalkot_lukot_pulang").append(s);
                                                                }

                                                                e.preventDefault();
                                                                $("#show_menginap_pulang").append(`
                                                                    <div class="row mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <div id="menginap_pulang`+count+`" style="display:none;">
                                                                                <div class="mb-1">
                                                                                    Menginap
                                                                                </div>

                                                                                <select class="select_menginap_pulang" name="menginap_pulang[]"
                                                                                    style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                                                    <option>Iya</option>
                                                                                    <option>Tidak</option>
                                                                                </select>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_jumlah_mobil_pulang").append(`
                                                                    <input autocomplete="off" type="number" min="0" class="form-control mt-3 mb-3 remove" name="jumlah_mobil_pulang[]" id="jumlah_mobil_pulang">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_kapasitas_pulang").append(`
                                                                    <input autocomplete="off" type="number" min="0" class="form-control mt-3 mb-3 remove" name="kapasitas_pulang[]" id="kapasitas_pulang">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_tujuan_mobil_pulang").append(`
                                                                    <input autocomplete="off" type="text" class="form-control mt-3 mb-3 remove" name="tujuan_mobil_pulang[]" id="tujuan_mobil_pulang" style="text-transform:capitalize">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_siap_di_pulang").append(`
                                                                    <input autocomplete="off" type="text" class="form-control mt-3 mb-3 remove" name="siap_di_pulang[]" id="siap_di_pulang" style="text-transform:capitalize">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_tanggal_mobil_pulang").append(`
                                                                    <input autocomplete="off" id='tanggal_mobil_pulang`+count+`' class="form-control mt-3 mb-3 remove" name="tanggal_mobil_pulang[]">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_jam_siap_pulang").append(`
                                                                    <input autocomplete="off" id='jam_siap_pulang`+count+`' class="form-control mt-3 mb-3 remove" name="jam_siap_pulang[]">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_keterangan_mobil_pulang").append(`
                                                                    <textarea class="form-control mt-3 mb-3 remove" name="keterangan_mobil_pulang[]" rows="3" placeholder=""></textarea>
                                                                `);

                                                                // var data_select = [
                                                                //     <php foreach ($pengguna as $peng) : ?> "<php echo $peng['nama_pengguna']?>",
                                                                //     <php endforeach ?>
                                                                // ]

                                                                // $(".select_nama").select2({
                                                                //     // tags:["Semua"],
                                                                //     data: data_select,
                                                                //     // tags: true,
                                                                //     // tokenSeparators: [',', ' '],
                                                                // });

                                                                // var data_select = [
                                                                //     //     <php foreach ($bag as $bag) : ?> "<php echo $bag['strorgnm']?>",
                                                                //     //     <php endforeach ?>
                                                                //     'SDO', 'NSO', 'SADO'
                                                                // ]

                                                                // $(".select_jabatan").select2({
                                                                //     // tags:["Semua"],
                                                                //     data: data_select,
                                                                //     // tags: true,
                                                                //     // tokenSeparators: [',', ' '],
                                                                // });

                                                                var data_select = [
                                                                    <?php foreach ($pengguna as $peng) : ?> "<?php echo $peng['nama_pengguna']?>",
                                                                    <?php endforeach ?>
                                                                ]

                                                                $(".select_email_info").select2({
                                                                    // tags:["Semua"],
                                                                    data: data_select,
                                                                    // tags: true,
                                                                    // tokenSeparators: [',', ' '],
                                                                });

                                                                var data_select = [
                                                                    <?php foreach ($pengguna as $peng) : ?> "<?php echo $peng['nama_pengguna']?>",
                                                                    <?php endforeach ?>
                                                                ]

                                                                $(".select_email_eval").select2({
                                                                    // tags:["Semua"],
                                                                    data: data_select,
                                                                    // tags: true,
                                                                    // tokenSeparators: [',', ' '],
                                                                });

                                                                var data_select = ['Company Acc', 'Personal Acc']

                                                                $(".select_pembayaran").select2({
                                                                    data: data_select,
                                                                    // tags: true,
                                                                    // tokenSeparators: [',', ' '],
                                                                });

                                                                var data_select = ['Non Tamu', 'Tamu']

                                                                $(".select_tamu").select2({
                                                                    data: data_select,
                                                                    // tags: true,
                                                                    // tokenSeparators: [',', ' '],
                                                                });

                                                                // var data_select = [
                                                                //     <php foreach ($pengguna as $peng) : ?> "<php echo $peng['nama_pengguna']?>",
                                                                //     <php endforeach ?>
                                                                // ]

                                                                // $(".select_pic").select2({
                                                                //     data: data_select,
                                                                //     // tags: true,
                                                                //     // tokenSeparators: [',', ' '],
                                                                // });

                                                                var data_select = [
                                                                    <?php foreach ($pool as $poo) : ?> "<?php echo $poo['nama_pool']?>",
                                                                    <?php endforeach ?>
                                                                ]

                                                                $(".select_gs_tiket").select2({
                                                                    data: data_select,
                                                                    // tags: true,
                                                                    // tokenSeparators: [',', ' '],
                                                                });

                                                                $.datetimepicker.setLocale('id');
                                                                $('#tanggal_jam_tiket'+count+'').datetimepicker({
                                                                    format: 'Y-m-d H:i',
                                                                    formatDate: 'Y-m-d',
                                                                    formatTime: 'H:i',
                                                                    minDate:'0',
                                                                    step: 1,
                                                                    closeOnTimeSelect : true,
                                                                    scrollMonth : false,
                                                                    scrollInput : false,
                                                                });

                                                                var data_select = [
                                                                    <?php foreach ($pool as $poo) : ?> "<?php echo $poo['nama_pool']?>",
                                                                    <?php endforeach ?>
                                                                ]

                                                                $(".select_gs_hotel").select2({
                                                                    data: data_select,
                                                                    // tags: true,
                                                                    // tokenSeparators: [',', ' '],
                                                                });

                                                                var data_select = ['Single', 'Twin / Double']

                                                                $(".select_type").select2({
                                                                    data: data_select,
                                                                    // tags: true,
                                                                    // tokenSeparators: [',', ' '],
                                                                });

                                                                $.datetimepicker.setLocale('id');
                                                                $('#tanggal_jam_masuk'+count+'').datetimepicker({
                                                                    format: 'Y-m-d H:i',
                                                                    formatDate: 'Y-m-d',
                                                                    formatTime: 'H:i',
                                                                    minDate:'0',
                                                                    step: 1,
                                                                    closeOnTimeSelect : true,
                                                                    scrollMonth : false,
                                                                    scrollInput : false,
                                                                });

                                                                $.datetimepicker.setLocale('id');
                                                                $('#tanggal_jam_keluar'+count+'').datetimepicker({
                                                                    format: 'Y-m-d H:i',
                                                                    formatDate: 'Y-m-d',
                                                                    formatTime: 'H:i',
                                                                    minDate:'0',
                                                                    step: 1,
                                                                    closeOnTimeSelect : true,
                                                                    scrollMonth : false,
                                                                    scrollInput : false,
                                                                });

                                                                var data_select = [
                                                                    <?php foreach ($pool as $poo) : ?> "<?php echo $poo['nama_pool']?>",
                                                                    <?php endforeach ?>
                                                                ]

                                                                $(".select_gs_mobil").select2({
                                                                    data: data_select,
                                                                    // tags: true,
                                                                    // tokenSeparators: [',', ' '],
                                                                });

                                                                var data_select = [
                                                                    'Sedan', 'Station', 'Pickup', 'Box', 'Truck'
                                                                ]

                                                                $(".select_jenis_kendaraan").select2({
                                                                    data: data_select,
                                                                    // tags: true,
                                                                    // tokenSeparators: [',', ' '],
                                                                });

                                                                var data_select = [
                                                                    //     <php foreach ($bag as $bag) : ?> "<php echo $bag['strorgnm']?>",
                                                                    //     <php endforeach ?>
                                                                    'Tidak', 'Butuh'
                                                                ]

                                                                $(".select_tenaga_angkut").select2({
                                                                    data: data_select,
                                                                    // tags: true,
                                                                    // tokenSeparators: [',', ' '],
                                                                });

                                                                $.datetimepicker.setLocale('id');
                                                                $('#tanggal_mobil'+count+'').datetimepicker({
                                                                    format: 'Y-m-d',
                                                                    formatDate: 'Y-m-d',
                                                                    minDate:'0',
                                                                    step: 1,
                                                                    timepicker : false,
                                                                    closeOnDateSelect : true,
                                                                    scrollMonth : false,
                                                                    scrollInput : false,
                                                                });

                                                                $.datetimepicker.setLocale('id');
                                                                $('#jam_siap'+count+'').datetimepicker({
                                                                    format: 'H:i',
                                                                    formatTime: 'H:i',
                                                                    step: 1,
                                                                    datepicker : false,
                                                                });

                                                                var data_select = [
                                                                    <?php foreach ($pool as $poo) : ?> "<?php echo $poo['nama_pool']?>",
                                                                    <?php endforeach ?>
                                                                ]

                                                                $(".select_gs_mobil_pulang").select2({
                                                                    data: data_select,
                                                                    // tags: true,
                                                                    // tokenSeparators: [',', ' '],
                                                                });

                                                                var data_select = [
                                                                    //     <php foreach ($bag as $bag) : ?> "<php echo $bag['strorgnm']?>",
                                                                    //     <php endforeach ?>
                                                                    'Sedan', 'Station', 'Pickup', 'Box',
                                                                    'Truck'
                                                                ]

                                                                $(".select_jenis_kendaraan_pulang").select2({
                                                                    data: data_select,
                                                                    // tags: true,
                                                                    // tokenSeparators: [',', ' '],
                                                                });

                                                                var data_select = [
                                                                    //     <php foreach ($bag as $bag) : ?> "<php echo $bag['strorgnm']?>",
                                                                    //     <php endforeach ?>
                                                                    'Tidak', 'Butuh'
                                                                ]

                                                                $(".select_tenaga_angkut_pulang").select2({
                                                                    data: data_select,
                                                                    // tags: true,
                                                                    // tokenSeparators: [',', ' '],
                                                                });

                                                                $.datetimepicker.setLocale('id');
                                                                $('#tanggal_mobil_pulang'+count+'').datetimepicker({
                                                                    format: 'Y-m-d',
                                                                    formatDate: 'Y-m-d',
                                                                    minDate:'0',
                                                                    step: 1,
                                                                    timepicker : false,
                                                                    closeOnDateSelect : true,
                                                                    scrollMonth : false,
                                                                    scrollInput : false,
                                                                });

                                                                $.datetimepicker.setLocale('id');
                                                                $('#jam_siap_pulang'+count+'').datetimepicker({
                                                                    format: 'H:i',
                                                                    formatTime: 'H:i',
                                                                    step: 1,
                                                                    datepicker : false,
                                                                });

                                                                $('select:not(.normal)').each(function() {
                                                                    $(this).select2({
                                                                        // tags: true,
                                                                        dropdownParent: $(this)
                                                                            .parent()
                                                                    });
                                                                });
                                                            });

                                                            $('#remove_item_btn').click(function () {
                                                                $('.remove').remove();
                                                            });
                                                        });
                                                    </script>
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </section>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="content-footer footer bg-footer-theme">
        <div class="container-xxl d-flex flex-wrap justify-content-center">
            <div class="mb-2 mb-md-0">
                Copyright &copy; <strong><span>MIS 2024</span></strong>.
            </div>
        </div>
    </footer>
    <!-- / Footer -->

    <div class="content-backdrop fade"></div>
</div>
<!-- Content wrapper -->

<!-- Content wrapper -->
<div class="content-wrapper">
    <div class="container-xxl flex-grow-1 container-p-y">
        <?php
        $session = \Config\Services::session();
        if($session->getFlashdata('warning')) {
        ?>
        <div class="alert alert-warning">
            <ul>
                <?php
                    foreach($session->getFlashdata('warning') as $val) {
                    ?>
                <li><?php echo $val ?></li>
                <?php
                    }
                    ?>
            </ul>
        </div>
        <?php
        }
        if($session->getFlashdata('success')) {
        ?>
        <div class="alert alert-success"><?php echo $session->getFlashdata('success')?></div>
        <?php
        }
        ?>
        <div class="row">
            <div class="col-lg-12 order-0">
                <div class="card">
                    <div class="d-flex align-items-center row">
                        <div class="col-sm-12">
                            <div class="card-body">
                                <h1>Transaksi</h1>
                                <a class="btn btn-secondary mb-3" href="trans" style="font-size:120%;"><i class="fa-solid fa-left-long"></i> Kembali</a>
                                <button id="add_item_btn" class="btn btn-success add_item_btn mb-3" style="font-size:120%;"><i class="fa-solid fa-plus"></i> Tambah Personil</button>
                                <button id="remove_item_btn" class="btn btn-danger mb-3" style="font-size:120%;"><i class="fa-solid fa-minus"></i> Hapus Personil</button>
                                <section id="features" class="features"  style="font-size:150%;">
                                    <ul class="nav nav-tabs row g-2 d-flex mb-3">
                                        <li class="nav-item col-3">
                                            <a class="nav-link active show" data-bs-toggle="tab"
                                                data-bs-target="#tab_start">
                                                <h3>Personil</h3>
                                            </a>
                                        </li>
                                        <!-- End tab nav item -->

                                        <li id="modal_tiket" style="display:none;" class="nav-item col-3">
                                            <a class="nav-link" data-bs-toggle="tab"
                                                data-bs-target="#tab_tiket">
                                                <h3>Tiket</h3>
                                            </a>
                                        </li>
                                        <!-- End tab nav item -->

                                        <li id="modal_hotel" style="display:none;" class="nav-item col-3">
                                            <a class="nav-link" data-bs-toggle="tab"
                                                data-bs-target="#tab_hotel">
                                                <h3>Hotel</h3>
                                            </a>
                                        </li>
                                        <!-- End tab nav item -->

                                        <li id="modal_mobil" style="display:none;" class="nav-item col-3">
                                            <a class="nav-link" data-bs-toggle="tab"
                                                data-bs-target="#tab_mobil">
                                                <h3>Mobil Antar</h3>
                                            </a>
                                        </li>
                                        <!-- End tab nav item -->

                                        <li id="modal_mobil_pulang" style="display:none;"
                                            class="nav-item col-3">
                                            <a class="nav-link" data-bs-toggle="tab"
                                                data-bs-target="#tab_mobil_pulang">
                                                <h3>Mobil Jemput</h3>
                                            </a>
                                        </li>
                                        <!-- End tab nav item -->

                                        <li id="modal_confirm" style="display:none;" class="nav-item col-3">
                                            <a class="nav-link" data-bs-toggle="tab"
                                                data-bs-target="#tab_confirm">
                                                <h3>Confirm</h3>
                                            </a>
                                        </li>
                                        <!-- End tab nav item -->
                                    </ul>
                                    <form action="" method="post" enctype="multipart/form-data">
                                        <div class="modal-body">
                                            <div class="tab-content">
                                                <div class="tab-pane active show" id="tab_start" style="font-size:120%">
                                                    <div class="mb-1">
                                                        Pemesanan
                                                    </div>
                                                    <select id="test" name="pemesanan" onchange="showDiv(this)"
                                                        style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                        <option value="pilih">-- pilih salah satu --</option>
                                                        <option value="0">Tiket</option>
                                                        <option value="1">Hotel</option>
                                                        <option value="2">Mobil</option>
                                                        <option value="3">Tiket + Hotel</option>
                                                        <option value="4">Tiket + Mobil</option>
                                                        <option value="5">Hotel + Mobil</option>
                                                        <option value="6">Tiket + Hotel + Mobil</option>
                                                    </select>
                                                    <script>
                                                        function showDiv(select) {
                                                            if (select.value == 'pilih') {
                                                                document.getElementById('modal_tiket').style
                                                                    .display = "none";
                                                                document.getElementById('modal_hotel').style
                                                                    .display = "none";
                                                                document.getElementById('modal_mobil').style
                                                                    .display = "none";
                                                                document.getElementById('modal_mobil_pulang').style
                                                                    .display = "none";
                                                                document.getElementById('modal_confirm').style
                                                                    .display = "none";
                                                            } else if (select.value == 0) {
                                                                document.getElementById('modal_tiket').style
                                                                    .display = "block";
                                                                document.getElementById('modal_hotel').style
                                                                    .display = "none";
                                                                document.getElementById('modal_mobil').style
                                                                    .display = "none";
                                                                document.getElementById('modal_mobil_pulang').style
                                                                    .display = "none";
                                                                document.getElementById('modal_confirm').style
                                                                    .display = "block";
                                                            } else if (select.value == 1) {
                                                                document.getElementById('modal_tiket').style
                                                                    .display = "none";
                                                                document.getElementById('modal_hotel').style
                                                                    .display = "block";
                                                                document.getElementById('modal_mobil').style
                                                                    .display = "none";
                                                                document.getElementById('modal_mobil_pulang').style
                                                                    .display = "none";
                                                                document.getElementById('modal_confirm').style
                                                                    .display = "block";
                                                            } else if (select.value == 2) {
                                                                document.getElementById('modal_tiket').style
                                                                    .display = "none";
                                                                document.getElementById('modal_hotel').style
                                                                    .display = "none";
                                                                document.getElementById('modal_mobil').style
                                                                    .display = "block";
                                                                document.getElementById('modal_mobil_pulang').style
                                                                    .display = "block";
                                                                document.getElementById('modal_confirm').style
                                                                    .display = "block";
                                                            } else if (select.value == 3) {
                                                                document.getElementById('modal_tiket').style
                                                                    .display = "block";
                                                                document.getElementById('modal_hotel').style
                                                                    .display = "block";
                                                                document.getElementById('modal_mobil').style
                                                                    .display = "none";
                                                                document.getElementById('modal_mobil_pulang').style
                                                                    .display = "none";
                                                                document.getElementById('modal_confirm').style
                                                                    .display = "block";
                                                            } else if (select.value == 4) {
                                                                document.getElementById('modal_tiket').style
                                                                    .display = "block";
                                                                document.getElementById('modal_hotel').style
                                                                    .display = "none";
                                                                document.getElementById('modal_mobil').style
                                                                    .display = "block";
                                                                document.getElementById('modal_mobil_pulang').style
                                                                    .display = "block";
                                                                document.getElementById('modal_confirm').style
                                                                    .display = "block";
                                                            } else if (select.value == 5) {
                                                                document.getElementById('modal_tiket').style
                                                                    .display = "none";
                                                                document.getElementById('modal_hotel').style
                                                                    .display = "block";
                                                                document.getElementById('modal_mobil').style
                                                                    .display = "block";
                                                                document.getElementById('modal_mobil_pulang').style
                                                                    .display = "block";
                                                                document.getElementById('modal_confirm').style
                                                                    .display = "block";
                                                            } else if (select.value == 6) {
                                                                document.getElementById('modal_tiket').style
                                                                    .display = "block";
                                                                document.getElementById('modal_hotel').style
                                                                    .display = "block";
                                                                document.getElementById('modal_mobil').style
                                                                    .display = "block";
                                                                document.getElementById('modal_mobil_pulang').style
                                                                    .display = "block";
                                                                document.getElementById('modal_confirm').style
                                                                    .display = "block";
                                                            }
                                                        }
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Tamu/Non Tamu
                                                    </div>

                                                    <div class="row">
                                                        <div class="col-md-12">
                                                            <select class="select_tamu" name="tamu[]" style="width: 100%;" onchange="showTamu(this)"></select>
                                                        </div>
                                                    </div>

                                                    <script>
                                                    $(document).ready(function() {
                                                        var data_select = ['Non Tamu', 'Tamu']

                                                        $(".select_tamu").select2({
                                                            data: data_select,
                                                            // tags: true,
                                                            // tokenSeparators: [',', ' '],
                                                        });

                                                        $('select:not(.normal)').each(function() {
                                                            $(this).select2({
                                                                // tags: true,
                                                                dropdownParent: $(this)
                                                                    .parent()
                                                            });
                                                        });
                                                    });
                                                    </script>

                                                    <div id="show_tamu">
                                                    </div>

                                                    <div id="show_script_tamu">
                                                    </div>

                                                    <script>
                                                        function showTamu(select) {
                                                            if (select.value == 'Non Tamu') {
                                                                document.getElementById('nama_jabatan_non_tamu').style.display =
                                                                    "block";
                                                                document.getElementById('nama_jabatan_tamu').style.display =
                                                                    "none";
                                                            } else if (select.value == 'Tamu') {
                                                                document.getElementById('nama_jabatan_non_tamu').style.display =
                                                                    "none";
                                                                document.getElementById('nama_jabatan_tamu').style.display =
                                                                    "block";
                                                            }
                                                        }
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Nama dan Jabatan
                                                    </div>

                                                    <div class="row">
                                                        <div class="col-md-12">
                                                            <div id="nama_jabatan_non_tamu" style="display:block;">
                                                                <div class="row">
                                                                    <div class="col-md-12">
                                                                        <select class="select_nama" name="nama[]" style="width: 100%;"></select>
                                                                    </div>
                                                                </div>
                                                                
                                                                <script>
                                                                    $(document).ready(function() {
                                                                        var data_select = [
                                                                            <?php foreach ($pengguna as $peng) : ?> "<?php echo $peng['nama_pengguna']?>",
                                                                            <?php endforeach ?>'tamu'
                                                                        ]

                                                                        $(".select_nama").select2({
                                                                            data: data_select,
                                                                            // tags: true,
                                                                            // tags:["Semua"],
                                                                            // tokenSeparators: [',', ' '],
                                                                        });
                                                                    });
                                                                </script>

                                                                <div class="row mt-3">
                                                                    <div class="col-md-12">
                                                                        <select class="select_jabatan" name="jabatan[]" style="width: 100%;"></select>
                                                                    </div>
                                                                </div>
                                                                
                                                                <script>
                                                                    $(document).ready(function() {
                                                                        var data_select = [
                                                                            //     <php foreach ($bag as $bag) : ?> "<php echo $bag['strorgnm']?>",
                                                                            //     <php endforeach ?>
                                                                            'Direksi', 'Manager', 'Officer', 'Supervisor', 'Pelaksana'
                                                                        ]

                                                                        $(".select_jabatan").select2({
                                                                            // tags:["Semua"],
                                                                            data: data_select,
                                                                            // tags: true,
                                                                            // tokenSeparators: [',', ' '],
                                                                        });
                                                                    });
                                                                </script>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="row">
                                                        <div class="col-md-12">
                                                            <div id="nama_jabatan_tamu" style="display:none;">
                                                                <input autocomplete="off" type="text" class="form-control" name="nama[]" id="nama" style="text-transform:capitalize" placeholder="Silahkan input nama Tamu">
                                                                <input autocomplete="off" type="text" class="form-control mt-3" name="jabatan[]" id="jabatan" style="text-transform:capitalize" placeholder="Silahkan input jabatan Tamu">
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div id="show_nama_jabatan_non_tamu">
                                                    </div>

                                                    <div id="show_nama_jabatan_tamu">
                                                    </div>

                                                    <!-- <input autocomplete="off" type="text" class="form-control" name="jabatan[]" id="jabatan" style="text-transform:uppercase" oninput="this.value = this.value.toUpperCase()"> -->

                                                    <div class="mb-1 mt-3">
                                                        Email Informasi
                                                    </div>
                                                    
                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_email_info" name="email_info[]" style="width: 100%;" data-select2-tags="false"></select>
                                                        </div>
                                                    </div>
                                                    
                                                    <div id="show_email_info">
                                                    </div>

                                                    <script>
                                                        $(document).ready(function() {
                                                            var data_select = [
                                                                <?php foreach ($pengguna as $peng) : ?> "<?php echo $peng['nama_pengguna']?>",
                                                                <?php endforeach ?>
                                                            ]

                                                            $(".select_email_info").select2({
                                                                // tags:["Semua"],
                                                                data: data_select,
                                                                // tags: true,
                                                                // tokenSeparators: [',', ' '],
                                                            });
                                                        });
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Email Evaluasi
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_email_eval" name="email_eval[]" style="width: 100%;"></select>
                                                        </div>
                                                    </div>
                                                    
                                                    <div id="show_email_eval">
                                                    </div>

                                                    <script>
                                                    $(document).ready(function() {
                                                        var data_select = [
                                                            <?php foreach ($pengguna as $peng) : ?> "<?php echo $peng['nama_pengguna']?>",
                                                            <?php endforeach ?>
                                                        ]

                                                        $(".select_email_eval").select2({
                                                            // tags:["Semua"],
                                                            data: data_select,
                                                            // tags: true,
                                                            // tokenSeparators: [',', ' '],
                                                        });
                                                    });
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Pembayaran
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_pembayaran" name="pembayaran[]" style="width: 100%;"></select>
                                                        </div>
                                                    </div>

                                                    <div id="show_pembayaran">
                                                    </div>

                                                    <script>
                                                    $(document).ready(function() {
                                                        var data_select = ['Company Acc', 'Personal Acc']

                                                        $(".select_pembayaran").select2({
                                                            data: data_select,
                                                            // tags: true,
                                                            // tokenSeparators: [',', ' '],
                                                        });
                                                    });
                                                    </script>

                                                    <!-- <div class="mb-1 mt-3">
                                                        PIC
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_pic" name="pic[]" style="width: 100%;"></select>
                                                        </div>
                                                    </div>

                                                    <div id="show_pic">
                                                    </div>

                                                    <script>
                                                    $(document).ready(function() {
                                                        var data_select = [
                                                            <php foreach ($pengguna as $peng) : ?> "<php echo $peng['nama_pengguna']?>",
                                                            <php endforeach ?>
                                                        ]

                                                        $(".select_pic").select2({
                                                            data: data_select,
                                                            // tags: true,
                                                            // tokenSeparators: [',', ' '],
                                                        });

                                                        $('select:not(.normal)').each(function() {
                                                            $(this).select2({
                                                                // tags: true,
                                                                dropdownParent: $(this)
                                                                    .parent()
                                                            });
                                                        });
                                                    });
                                                    </script> -->

                                                    <div class="mb-1 mt-3">
                                                        PIC
                                                    </div>

                                                    <input autocomplete="off" type="text" class="form-control" name="pic[]" id="pic" style="text-transform:capitalize">

                                                    <div id="show_pic">
                                                    </div>

                                                    <div class="modal-footer">
                                                    </div>
                                                </div>

                                                <div class="tab-pane" id="tab_tiket" style="font-size:120%">
                                                    <div class="mb-1">
                                                        GS
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_gs_tiket" name="gs_tiket[]" style="width: 100%;"></select>
                                                        </div>
                                                    </div>

                                                    <div id="show_gs_tiket">
                                                    </div>

                                                    <script>
                                                        $(document).ready(function() {
                                                            var data_select = [
                                                                <?php foreach ($pool as $poo) : ?> "<?php echo $poo['nama_pool']?>",
                                                                <?php endforeach ?>
                                                            ]

                                                            $(".select_gs_tiket").select2({
                                                                data: data_select,
                                                                // tags: true,
                                                                // tokenSeparators: [',', ' '],
                                                            });
                                                        });
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Tiket
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_tiket" name="tiket[]" style="width: 100%">
                                                                <optgroup label = "Bus">
                                                                    <?php foreach ($bus as $b => $bu) {?>
                                                                        <option>
                                                                            <?php echo $bu['nama_vendor']?>
                                                                        </option>
                                                                    <?php } ?>
                                                                </optgroup>
                                                                <optgroup label = "Kereta Api">
                                                                    <?php foreach ($kereta as $k => $ker) {?>
                                                                        <option>
                                                                            <?php echo $ker['nama_vendor']?>
                                                                        </option>
                                                                    <?php } ?>
                                                                </optgroup>
                                                                <optgroup label = "Pesawat">
                                                                    <?php foreach ($pesawat as $p => $pes) {?>
                                                                        <option>
                                                                            <?php echo $pes['nama_vendor']?>
                                                                        </option>
                                                                    <?php } ?>
                                                                </optgroup>
                                                                <optgroup label = "Travel">
                                                                    <?php foreach ($travel as $t => $tra) {?>
                                                                        <option>
                                                                            <?php echo $tra['nama_vendor']?>
                                                                        </option>
                                                                    <?php } ?>
                                                                </optgroup>
                                                                <optgroup label = "Kapal Laut">
                                                                    <?php foreach ($kapal_laut as $ka => $kap) {?>
                                                                        <option>
                                                                            <?php echo $kap['nama_vendor']?>
                                                                        </option>
                                                                    <?php } ?>
                                                                </optgroup>
                                                            </select>
                                                        </div>
                                                    </div>

                                                    <div id="show_tiket">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Pemberhentian
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_pemberhentian" name="pemberhentian[]" style="width: 100%">
                                                                <optgroup label = "Bandara">
                                                                    <?php foreach ($bandara as $b => $ba) {?>
                                                                        <option>
                                                                            <?php echo $ba['nama_pemberhentian']?> <?php echo "-" ?> <?php echo $ba['nama_kota']?>
                                                                        </option>
                                                                    <?php } ?>
                                                                </optgroup>
                                                                <optgroup label = "Pelabuhan">
                                                                    <?php foreach ($pelabuhan as $p => $pe) {?>
                                                                        <option>
                                                                            <?php echo $pe['nama_pemberhentian']?> <?php echo "-" ?> <?php echo $pe['nama_kota']?>
                                                                        </option>
                                                                    <?php } ?>
                                                                </optgroup>
                                                                <optgroup label = "Stasiun">
                                                                    <?php foreach ($stasiun as $s => $st) {?>
                                                                        <option>
                                                                            <?php echo $st['nama_pemberhentian']?> <?php echo "-" ?> <?php echo $st['nama_kota']?>
                                                                        </option>
                                                                    <?php } ?>
                                                                </optgroup>
                                                                <optgroup label = "Terminal">
                                                                    <?php foreach ($terminal as $t => $te) {?>
                                                                        <option>
                                                                            <?php echo $te['nama_pemberhentian']?> <?php echo "-" ?> <?php echo $te['nama_kota']?>
                                                                        </option>
                                                                    <?php } ?>
                                                                </optgroup>
                                                            </select>
                                                        </div>
                                                    </div>

                                                    <div id="show_pemberhentian">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Jumlah Tiket
                                                    </div>

                                                    <input autocomplete="off" type="number" min="0" class="form-control" name="jumlah_tiket[]" id="jumlah_tiket">

                                                    <div id="show_jumlah_tiket">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Tanggal dan Jam
                                                    </div>

                                                    <input autocomplete="off" id='tanggal_jam_tiket' class="form-control" name="tanggal_jam_tiket[]">
                                                    
                                                    <script>
                                                        $(function() {
                                                            $.datetimepicker.setLocale('id');
                                                            $('#tanggal_jam_tiket').datetimepicker({
                                                                format: 'Y-m-d H:i',
                                                                formatDate: 'Y-m-d',
                                                                formatTime: 'H:i',
                                                                minDate:'0',
                                                                step: 1,
                                                                closeOnTimeSelect : true,
                                                                scrollMonth : false,
                                                                scrollInput : false,
                                                            });
                                                        });
                                                    </script>

                                                    <div id="show_tanggal_jam_tiket">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Dari
                                                    </div>
                                                    
                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_dari" name="dari_tiket[]" style="width: 100%">
                                                                <?php foreach ($negara as $n => $neg) {?>
                                                                    <optgroup label=<?php echo $neg['nama_negara'] ?>>
                                                                        <?php foreach ($kota as $k => $kot) {?>
                                                                            <?php if ($neg['id_negara'] == $kot['id_negara']) { ?>
                                                                                <option><?php echo $kot['nama_kota'] ?></option>
                                                                            <?php } ?>
                                                                        <?php } ?>
                                                                    </optgroup>
                                                                <?php } ?>
                                                            </select>
                                                        </div>
                                                    </div>

                                                    <div id="show_dari_tiket">
                                                    </div>

                                                    <script>
                                                    $(document).ready(function() {
                                                        var options = {}
                                                        var $select2 = $('.select_dari').select2(
                                                            options);
                                                        $select2.on('select2:select', function(e) {
                                                            var data = e.params.data;

                                                            var text = data.text;
                                                        });
                                                    });
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Tujuan
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_tujuan" name="tujuan_tiket[]" style="width: 100%">
                                                                <?php foreach ($negara as $n => $neg) {?>
                                                                    <optgroup label=<?php echo $neg['nama_negara'] ?>>
                                                                        <?php foreach ($kota as $k => $kot) {?>
                                                                            <?php if ($neg['id_negara'] == $kot['id_negara']) { ?>
                                                                                <option><?php echo $kot['nama_kota'] ?></option>
                                                                            <?php } ?>
                                                                        <?php } ?>
                                                                    </optgroup>
                                                                <?php } ?>
                                                            </select>
                                                        </div>
                                                    </div>

                                                    <div id="show_tujuan_tiket">
                                                    </div>

                                                    <script>
                                                    $(document).ready(function() {
                                                        var options = {}
                                                        var $select2 = $('.select_tujuan').select2(
                                                            options);
                                                        $select2.on('select2:select', function(e) {
                                                            var data = e.params.data;

                                                            var text = data.text;
                                                        });
                                                    });
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Keterangan
                                                    </div>
                                                    
                                                    <textarea class="form-control" name="keterangan_tiket[]" rows="3" placeholder=""></textarea>

                                                    <div id="show_keterangan_tiket">
                                                    </div>
                                                </div>

                                                <div class="tab-pane" id="tab_hotel" style="font-size:120%">
                                                    <div class="mb-1">
                                                        GS
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_gs_hotel" name="gs_hotel[]" style="width: 100%;"></select>
                                                        </div>
                                                    </div>

                                                    <div id="show_gs_hotel">
                                                    </div>

                                                    <script>
                                                    $(document).ready(function() {
                                                        var data_select = [
                                                            <?php foreach ($pool as $poo) : ?> "<?php echo $poo['nama_pool']?>",
                                                            <?php endforeach ?>
                                                        ]

                                                        $(".select_gs_hotel").select2({
                                                            data: data_select,
                                                            // tags: true,
                                                            // tokenSeparators: [',', ' '],
                                                        });
                                                    });
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Kota
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_kota" name="kota[]" style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                                <option value="pilih">-- pilih kota --</option>
                                                                <?php foreach ($negara as $n => $neg) {?>
                                                                    <optgroup label=<?php echo $neg['nama_negara'] ?>>
                                                                        <?php foreach ($kota as $k => $kot) {?>
                                                                            <?php if ($neg['id_negara'] == $kot['id_negara']) { ?>
                                                                                <option><?php echo $kot['nama_kota'] ?></option>
                                                                            <?php } ?>
                                                                        <?php } ?>
                                                                    </optgroup>
                                                                <?php } ?>
                                                            </select>
                                                        </div>
                                                    </div>

                                                    <div id="show_kota">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Hotel/Kamar
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_hotel" name="hotel[]" style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                                <option value="pilih1">-- pilih kota terlebih dahulu --</option>
                                                            </select>
                                                        </div>
                                                    </div>

                                                    <div id="show_hotel">
                                                    </div>

                                                    <div id="show_script_hotel">
                                                    </div>

                                                    <script>
                                                        $(".select_kota").change(function() {
                                                            var val = $(this).val();

                                                            <?php foreach ($kota as $k => $kot) {?>
                                                                if (val == "<?php echo $kot['nama_kota'] ?>") {
                                                                    $(".select_hotel").html(
                                                                        "<option value=''>-- Daftar hotel --</option><?php foreach ($hotel as $h => $hote) {?><?php if ($kot['nama_kota'] == $hote['nama_kota']) { ?><option><?php echo $hote['nama_hotel'] ?><?php echo " - " ?><?php echo $hote['jenis_kamar'] ?></option><?php } ?><?php } ?>"
                                                                    );
                                                                } else if (val == "pilih") {
                                                                    $(".select_hotel").html(
                                                                        "<option value='pilih1'>-- pilih kota terlebih dahulu --</option>"
                                                                    );
                                                                }
                                                            <?php } ?>

                                                            // if (val == "Jakarta") {
                                                            //     $(".select_hotel").html(
                                                            //         "<option value=''>-- pilih hotel --</option><optgroup label='Mess Kx Jkt'><option value='Mess Kx Jkt - Standart'>Mess Kx Jkt - Standart - Sisa kamar : 4</option></optgroup>"
                                                            //     );
                                                            // } else if (val == "pilih") {
                                                            //     $(".select_hotel").html(
                                                            //         "<option value='pilih1'>-- pilih kota terlebih dahulu --</option>"
                                                            //         );
                                                            // } else {
                                                            //     $(".select_hotel").html(
                                                            //         "<option value='pilih2'>-- Data Hotel/Kamar tidak ditemukan --</option>"
                                                            //         );
                                                            // }
                                                        });
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Ketersediaan Kamar Mess
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_mess" name="mess[]" style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                                <option value="pilihmess">-- silahkan pilih Mess Kx Jkt terlebih dahulu --</option>
                                                            </select>
                                                        </div>
                                                    </div>

                                                    <div id="show_mess">
                                                    </div>

                                                    <div id="show_script_mess">
                                                    </div>

                                                    <script>
                                                        $(".select_hotel").change(function() {
                                                            var val = $(this).val();

                                                            if (val == "Mess Kx Jkt - Standar") {
                                                                $(".select_mess").html(
                                                                    "<option value='1'>Tersedia untuk : <?php foreach ($mess as $m => $mes) { $sisa_kamar = $mes['kapasitas_kamar'] - $mes['terpakai'];?><?php echo $sisa_kamar ?><?php } ?> orang</option>"
                                                                );
                                                            } else {
                                                                $(".select_mess").html(
                                                                    "<option value='pilihmess'>-- silahkan pilih Mess Kx Jkt terlebih dahulu --</option>"
                                                                );
                                                            }
                                                        });
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Type
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_type" name="type[]" style="width: 100%;"></select>
                                                        </div>
                                                    </div>

                                                    <div id="show_type">
                                                    </div>
                                                    
                                                    <script>
                                                    $(document).ready(function() {
                                                        var data_select = ['Single', 'Twin / Double']

                                                        $(".select_type").select2({
                                                            data: data_select,
                                                            // tags: true,
                                                            // tokenSeparators: [',', ' '],
                                                        });
                                                    });
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Jumlah Kamar
                                                    </div>
                                                    
                                                    <input autocomplete="off" type="number" min="0" class="form-control" name="jumlah_kamar[]" id="jumlah_kamar">

                                                    <div id="show_jumlah_kamar">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Tanggal Masuk dan Jam Masuk
                                                    </div>

                                                    <input autocomplete="off" id='tanggal_jam_masuk' class="form-control" name="tanggal_jam_masuk[]">

                                                    <script>
                                                        $(function() {
                                                            $.datetimepicker.setLocale('id');
                                                            $('#tanggal_jam_masuk').datetimepicker({
                                                                format: 'Y-m-d H:i',
                                                                formatDate: 'Y-m-d',
                                                                formatTime: 'H:i',
                                                                minDate:'0',
                                                                step: 1,
                                                                closeOnTimeSelect : true,
                                                                scrollMonth : false,
                                                                scrollInput : false,
                                                            });
                                                        });
                                                    </script>

                                                    <div id="show_tanggal_jam_masuk">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Tanggal Keluar dan Jam Keluar
                                                    </div>

                                                    <input autocomplete="off" id='tanggal_jam_keluar' class="form-control" name="tanggal_jam_keluar[]">
                                                    <script>
                                                        $(function() {
                                                            $.datetimepicker.setLocale('id');
                                                            $('#tanggal_jam_keluar').datetimepicker({
                                                                format: 'Y-m-d H:i',
                                                                formatDate: 'Y-m-d',
                                                                formatTime: 'H:i',
                                                                minDate:'0',
                                                                step: 1,
                                                                closeOnTimeSelect : true,
                                                                scrollMonth : false,
                                                                scrollInput : false,
                                                            });
                                                        });
                                                    </script>

                                                    <div id="show_tanggal_jam_keluar">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Keterangan
                                                    </div>

                                                    <textarea class="form-control" name="keterangan_akomodasi[]" rows="3" placeholder=""></textarea>

                                                    <div id="show_keterangan_akomodasi">
                                                    </div>
                                                </div>

                                                <div class="tab-pane" id="tab_mobil" style="font-size:120%">
                                                    <h2>Mobil Antar</h2>

                                                    <div class="mb-1">
                                                        GS
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_gs_mobil" name="gs_mobil[]" style="width: 100%;"></select>
                                                        </div>
                                                    </div>

                                                    <div id="show_gs_mobil">
                                                    </div>

                                                    <script>
                                                    $(document).ready(function() {
                                                        var data_select = [
                                                            <?php foreach ($pool as $poo) : ?> "<?php echo $poo['nama_pool']?>",
                                                            <?php endforeach ?>
                                                        ]

                                                        $(".select_gs_mobil").select2({
                                                            data: data_select,
                                                            // tags: true,
                                                            // tokenSeparators: [',', ' '],
                                                        });
                                                    });
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Jenis Kendaraan
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_jenis_kendaraan" name="jenis_kendaraan[]" style="width: 100%;"></select>
                                                        </div>
                                                    </div>

                                                    <div id="show_jenis_kendaraan">
                                                    </div>

                                                    <script>
                                                    $(document).ready(function() {
                                                        var data_select = [
                                                            'Sedan', 'Station', 'Pickup', 'Box', 'Truck'
                                                        ]

                                                        $(".select_jenis_kendaraan").select2({
                                                            data: data_select,
                                                            // tags: true,
                                                            // tokenSeparators: [',', ' '],
                                                        });
                                                    });
                                                    </script>
                                                    
                                                    <div class="mb-1 mt-3">
                                                        Butuh Tambahan Tenaga Angkut?
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_tenaga_angkut" name="tenaga_angkut[]" style="width: 100%;"></select>
                                                        </div>
                                                    </div>

                                                    <div id="show_tenaga_angkut">
                                                    </div>

                                                    <script>
                                                    $(document).ready(function() {
                                                        var data_select = [
                                                            //     <php foreach ($bag as $bag) : ?> "<php echo $bag['strorgnm']?>",
                                                            //     <php endforeach ?>
                                                            'Tidak', 'Iya'
                                                        ]

                                                        $(".select_tenaga_angkut").select2({
                                                            data: data_select,
                                                            // tags: true,
                                                            // tokenSeparators: [',', ' '],
                                                        });
                                                    });
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Dalam/Luar Kota
                                                    </div>

                                                    <div class="row">
                                                        <div class="col-md-12">
                                                            <select id="dalkot_lukot" name="dalkot_lukot[]" onchange="showD(this)" style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                                <option value="Dalam Kota">Dalam Kota</option>
                                                                <option value="Luar Kota">Luar Kota</option>
                                                            </select>
                                                        </div>
                                                    </div>

                                                    <div id="show_dalkot_lukot">
                                                    </div>

                                                    <div id="show_script_dalkot_lukot">
                                                    </div>

                                                    <script>
                                                        function showD(select) {
                                                            if (select.value == 'Dalam Kota') {
                                                                document.getElementById('menginap').style.display =
                                                                    "none";
                                                            } else if (select.value == 'Luar Kota') {
                                                                document.getElementById('menginap').style.display =
                                                                    "block";
                                                            }
                                                        }
                                                    </script>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <div class="mb-1 mt-3" id="menginap" style="display:none;">
                                                                <div class="mb-1">
                                                                    Menginap
                                                                </div>

                                                                <select class="select_menginap" name="menginap[]"
                                                                    style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                                    <option>Iya</option>
                                                                    <option>Tidak</option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div id="show_menginap">
                                                    </div>

                                                    <div class="mb-1">
                                                        Jumlah Mobil
                                                    </div>

                                                    <input autocomplete="off" type="number" min="0" class="form-control" name="jumlah_mobil[]" id="jumlah_mobil">

                                                    <div id="show_jumlah_mobil">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Kapasitas
                                                    </div>

                                                    <input autocomplete="off" type="number" min="0" class="form-control" name="kapasitas[]" id="kapasitas">

                                                    <div id="show_kapasitas">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Tujuan
                                                    </div>

                                                    <input autocomplete="off" type="text" class="form-control" name="tujuan_mobil[]" id="tujuan_mobil" style="text-transform:capitalize">

                                                    <div id="show_tujuan_mobil">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Siap Di
                                                    </div>

                                                    <input autocomplete="off" type="text" class="form-control" name="siap_di[]" id="siap_di" style="text-transform:capitalize">

                                                    <div id="show_siap_di">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Tanggal
                                                    </div>

                                                    <input autocomplete="off" id='tanggal_mobil' class="form-control" name="tanggal_mobil[]">

                                                    <script>
                                                        $(function() {
                                                            $.datetimepicker.setLocale('id');
                                                            $('#tanggal_mobil').datetimepicker({
                                                                format: 'Y-m-d',
                                                                formatDate: 'Y-m-d',
                                                                minDate:'0',
                                                                step: 1,
                                                                timepicker : false,
                                                                closeOnDateSelect : true,
                                                                scrollMonth : false,
                                                                scrollInput : false,
                                                            });
                                                        });
                                                    </script>

                                                    <div id="show_tanggal_mobil">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Jam Siap
                                                    </div>

                                                    <input autocomplete="off" id='jam_siap' class="form-control" name="jam_siap[]">

                                                    <div id="show_jam_siap">
                                                    </div>

                                                    <script>
                                                        $(function() {
                                                            $.datetimepicker.setLocale('id');
                                                            $('#jam_siap').datetimepicker({
                                                                format: 'H:i',
                                                                formatTime: 'H:i',
                                                                step: 1,
                                                                datepicker : false,
                                                            });
                                                        });
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Keterangan
                                                    </div>

                                                    <textarea class="form-control" name="keterangan_mobil[]" rows="3" placeholder=""></textarea>

                                                    <div id="show_keterangan_mobil">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Sewa mobil untuk penjemputan?
                                                    </div>
                                                    <select id="jemput" name="jemput" onchange="showjemput(this)"
                                                        style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                        <option value="pilih">--pilih salah satu--</option>
                                                        <option value="iya">Iya</option>
                                                        <option value="tidak">Tidak</option>
                                                    </select>

                                                    <script>
                                                        function showjemput(select) {
                                                            if (select.value == 'iya') {
                                                                document.getElementById('modal_mobil_pulang').style
                                                                    .display = "block";
                                                            } else if (select.value == 'tidak') {
                                                                document.getElementById('modal_mobil_pulang').style
                                                                    .display = "none";
                                                            } else if (select.value == 'pilih') {
                                                                document.getElementById('modal_mobil_pulang').style
                                                                    .display = "block";
                                                            }
                                                        }
                                                    </script>
                                                    <div class="mb-3"></div>
                                                </div>

                                                <div class="tab-pane" id="tab_mobil_pulang" style="font-size:120%">
                                                    <h2>Mobil Jemput</h2>

                                                    <div class="mb-1">
                                                        GS
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_gs_mobil_pulang" name="gs_mobil_pulang[]" style="width: 100%;"></select>
                                                        </div>
                                                    </div>

                                                    <div id="show_gs_mobil_pulang">
                                                    </div>

                                                    <script>
                                                    $(document).ready(function() {
                                                        var data_select = [
                                                            <?php foreach ($pool as $poo) : ?> "<?php echo $poo['nama_pool']?>",
                                                            <?php endforeach ?>
                                                        ]

                                                        $(".select_gs_mobil_pulang").select2({
                                                            data: data_select,
                                                            // tags: true,
                                                            // tokenSeparators: [',', ' '],
                                                        });
                                                    });
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Jenis Kendaraan
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_jenis_kendaraan_pulang" name="jenis_kendaraan_pulang[]" style="width: 100%;"></select>
                                                        </div>
                                                    </div>

                                                    <div id="show_jenis_kendaraan_pulang">
                                                    </div>

                                                    <script>
                                                    $(document).ready(function() {
                                                        var data_select = [
                                                            //     <php foreach ($bag as $bag) : ?> "<php echo $bag['strorgnm']?>",
                                                            //     <php endforeach ?>
                                                            'Sedan', 'Station', 'Pickup', 'Box',
                                                            'Truck'
                                                        ]

                                                        $(".select_jenis_kendaraan_pulang").select2({
                                                            data: data_select,
                                                            // tags: true,
                                                            // tokenSeparators: [',', ' '],
                                                        });
                                                    });
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Butuh Tambahan Tenaga Angkut?
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_tenaga_angkut_pulang" name="tenaga_angkut_pulang[]" style="width: 100%;"></select>
                                                        </div>
                                                    </div>

                                                    <div id="show_tenaga_angkut_pulang">
                                                    </div>

                                                    <script>
                                                    $(document).ready(function() {
                                                        var data_select = [
                                                            //     <php foreach ($bag as $bag) : ?> "<php echo $bag['strorgnm']?>",
                                                            //     <php endforeach ?>
                                                            'Tidak', 'Iya'
                                                        ]

                                                        $(".select_tenaga_angkut_pulang").select2({
                                                            data: data_select,
                                                            // tags: true,
                                                            // tokenSeparators: [',', ' '],
                                                        });
                                                    });
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Dalam/Luar Kota
                                                    </div>

                                                    <div class="row">
                                                        <div class="col-md-12">
                                                            <select id="dalkot_lukot_pulang" name="dalkot_lukot_pulang[]" onchange="showpulang(this)" style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                                <option value="Dalam Kota">Dalam Kota</option>
                                                                <option value="Luar Kota">Luar Kota</option>
                                                            </select>
                                                        </div>
                                                    </div>

                                                    <div id="show_dalkot_lukot_pulang">
                                                    </div>

                                                    <div id="show_script_dalkot_lukot_pulang">
                                                    </div>

                                                    <script>
                                                        function showpulang(select) {
                                                            if (select.value == 'Dalam Kota') {
                                                                document.getElementById('menginap_pulang').style.display =
                                                                    "none";
                                                            } else if (select.value == 'Luar Kota') {
                                                                document.getElementById('menginap_pulang').style.display =
                                                                    "block";
                                                            }
                                                        }
                                                    </script>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <div class="mb-1 mt-3" id="menginap_pulang" style="display:none;">
                                                                <div class="mb-1 mt-3">
                                                                    Menginap
                                                                </div>

                                                                <select class="select_menginap_pulang" name="menginap_pulang[]"
                                                                    style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                                    <option>Iya</option>
                                                                    <option>Tidak</option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div id="show_menginap_pulang">
                                                    </div>

                                                    <div class="mb-1">
                                                        Jumlah Mobil
                                                    </div>

                                                    <input autocomplete="off" type="number" min="0" class="form-control" name="jumlah_mobil_pulang[]" id="jumlah_mobil_pulang">

                                                    <div id="show_jumlah_mobil_pulang">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Kapasitas
                                                    </div>

                                                    <input autocomplete="off" type="number" min="0" class="form-control" name="kapasitas_pulang[]" id="kapasitas_pulang">

                                                    <div id="show_kapasitas_pulang">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Tujuan
                                                    </div>

                                                    <input autocomplete="off" type="text" class="form-control" name="tujuan_mobil_pulang[]" id="tujuan_mobil_pulang" style="text-transform:capitalize">

                                                    <div id="show_tujuan_mobil_pulang">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Siap Di
                                                    </div>

                                                    <input autocomplete="off" type="text" class="form-control" name="siap_di_pulang[]" id="siap_di_pulang" style="text-transform:capitalize">

                                                    <div id="show_siap_di_pulang">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Tanggal
                                                    </div>

                                                    <input autocomplete="off" id='tanggal_mobil_pulang' class="form-control" name="tanggal_mobil_pulang[]">
                                                    
                                                    <script>
                                                        $(function() {
                                                            $.datetimepicker.setLocale('id');
                                                            $('#tanggal_mobil_pulang').datetimepicker({
                                                                format: 'Y-m-d',
                                                                formatDate: 'Y-m-d',
                                                                minDate:'0',
                                                                step: 1,
                                                                timepicker : false,
                                                                closeOnDateSelect : true,
                                                                scrollMonth : false,
                                                                scrollInput : false,
                                                            });
                                                        });
                                                    </script>

                                                    <div id="show_tanggal_mobil_pulang">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Jam Siap
                                                    </div>

                                                    <input autocomplete="off" id='jam_siap_pulang' class="form-control" name="jam_siap_pulang[]">

                                                    <div id="show_jam_siap_pulang">
                                                    </div>

                                                    <script>
                                                        $(function() {
                                                            $.datetimepicker.setLocale('id');
                                                            $('#jam_siap_pulang').datetimepicker({
                                                                format: 'H:i',
                                                                formatTime: 'H:i',
                                                                step: 1,
                                                                datepicker : false,
                                                            });
                                                        });
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Keterangan
                                                    </div>

                                                    <textarea class="form-control" name="keterangan_mobil_pulang[]" rows="3" placeholder=""></textarea>

                                                    <div id="show_keterangan_mobil_pulang">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Sewa mobil untuk pengantaran?
                                                    </div>
                                                    <select id="antar" name="antar" onchange="showantar(this)"
                                                        style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                        <option value="pilih">--pilih salah satu--</option>
                                                        <option value="iya">Iya</option>
                                                        <option value="tidak">Tidak</option>
                                                    </select>

                                                    <script>
                                                        function showantar(select) {
                                                            if (select.value == 'iya') {
                                                                document.getElementById('modal_mobil').style
                                                                    .display = "block";
                                                            } else if (select.value == 'tidak') {
                                                                document.getElementById('modal_mobil').style
                                                                    .display = "none";
                                                            } else if (select.value == 'pilih') {
                                                                document.getElementById('modal_mobil').style
                                                                    .display = "block";
                                                            }
                                                        }
                                                    </script>
                                                </div>

                                                <div class="tab-pane" id="tab_confirm" style="font-size:100%">
                                                    <div class="modal-footer">
                                                        <!-- <button class="btn btn-success btn-lg" type="submit"
                                                            name="save" style="font-size:120%">Konfirmasi</button> -->
                                                        <a class="btn btn-success btn-lg" href="javascript:void(0)" style="font-size:85%" data-bs-toggle="modal" data-bs-target="#konfirm"><i class="fa-solid fa-check"></i> Konfirmasi</a>

                                                        <div class="modal" id="konfirm" tabindex="-1" aria-hidden="true">
                                                            <div class="modal-dialog">
                                                                <div class="modal-content">
                                                                    <div class="modal-header">
                                                                        <h2 class="modal-title" id="modalTopTitle">Konfirmasi?</h2>
                                                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                                    </div>
                                                                    <div class="modal-body">
                                                                        <div class="tab-content">
                                                                            <div class="tab-pane active show" style="font-size:120%; text-align: center;">
                                                                                <div class="mt-4 mb-1">
                                                                                    Mohon sebelum melakukan konfirmasi, pastikan sekali lagi apakah data yang diinput sudah benar dan tepat. Setelah melakukan konfirmasi, data tidak dapat diubah kembali.
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="modal-footer">
                                                                        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal" style="font-size:85%;">
                                                                            <i class="fa-solid fa-xmark"></i> Batalkan
                                                                        </button>
                                                                        <button id="add_btn" class="btn btn-success btn-lg" type="submit" name="save" style="font-size:85%">
                                                                            <i class="fa-solid fa-check"></i> Konfirmasi
                                                                        </button>
                                                                    </div>
                                                                </form>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <script>
                                                        var count=0;
                                                        $(document).ready(function() {
                                                            $("#add_item_btn").click(function (e) {
                                                                count++;
                                                                e.preventDefault();
                                                                $("#show_tamu").append(`
                                                                    <div class="row mt-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select class="select_tamu" name="tamu[]" style="width: 100%;" onchange="showTamu`+count+`(this)"></select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                var s = document.createElement('script');
                                                                s.type = 'text/javascript';
                                                                s.className = 'remove';
                                                                var code = `
                                                                    function showTamu`+count+`(select) {
                                                                        if (select.value == 'Non Tamu') {
                                                                            document.getElementById('nama_jabatan_non_tamu`+count+`').style.display =
                                                                                "block";
                                                                            document.getElementById('nama_jabatan_tamu`+count+`').style.display =
                                                                                "none";
                                                                        } else if (select.value == 'Tamu') {
                                                                            document.getElementById('nama_jabatan_non_tamu`+count+`').style.display =
                                                                                "none";
                                                                            document.getElementById('nama_jabatan_tamu`+count+`').style.display =
                                                                                "block";
                                                                        }
                                                                    }
                                                                `;
                                                                try {
                                                                s.appendChild(document.createTextNode(code));
                                                                $("#show_script_tamu").append(s);
                                                                } catch (e) {
                                                                s.text = code;
                                                                $("#show_script_tamu").append(s);
                                                                }

                                                                e.preventDefault();
                                                                $("#show_nama_jabatan_non_tamu").append(`
                                                                    <div class="row mt-3 remove">
                                                                        <div class="col-md-12">
                                                                            <div id="nama_jabatan_non_tamu`+count+`" style="display:block;">
                                                                                <div class="row mt-1">
                                                                                    <div class="col-md-12">
                                                                                        <select class="select_nama" name="nama[]" style="width: 100%;"></select>
                                                                                    </div>
                                                                                </div>
                                                                                
                                                                                <div class="row mt-3">
                                                                                    <div class="col-md-12">
                                                                                        <select class="select_jabatan" name="jabatan[]" style="width: 100%;"></select>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_nama_jabatan_tamu").append(`
                                                                    <div class="row remove">
                                                                        <div class="col-md-12">
                                                                            <div id="nama_jabatan_tamu`+count+`" style="display:none;">
                                                                                <input autocomplete="off" type="text" class="form-control mt-1" name="nama[]" id="nama+" style="text-transform:capitalize" placeholder="Silahkan input nama Tamu">
                                                                                <input autocomplete="off" type="text" class="form-control mt-3" name="jabatan[]" id="jabatan+" style="text-transform:capitalize" placeholder="Silahkan input jabatan Tamu">
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                // e.preventDefault();
                                                                // $("#show_nama").append(`
                                                                //     <div class="row mb-3 remove">
                                                                //         <div class="col-md-12">
                                                                //             <select class="select_nama" name="nama[]" style="width: 100%;"></select>
                                                                //         </div>
                                                                //     </div>
                                                                // `);

                                                                // e.preventDefault();
                                                                // $("#show_jabatan").append(`
                                                                //     <div class="row mt-3 mb-3 remove">
                                                                //         <div class="col-md-12">
                                                                //             <select class="select_jabatan remove_item_btn" name="jabatan[]" style="width: 100%;"></select>
                                                                //         </div>
                                                                //     </div>
                                                                // `);

                                                                // e.preventDefault();
                                                                // $("#show_jabatan").append(`
                                                                //     <input autocomplete="off" type="text" class="form-control mt-3 mb-3 remove" name="jabatan[]" style="text-transform:uppercase" oninput="this.value = this.value.toUpperCase()">
                                                                // `);

                                                                // e.preventDefault();
                                                                // $("#show_nama").append(`
                                                                //     <input autocomplete="off" type="text" class="form-control mt-3 mb-3 remove" name="nama[]" style="text-transform:capitalize">
                                                                // `);

                                                                // e.preventDefault();
                                                                // $("#show_jabatan").append(`
                                                                //     <input autocomplete="off" type="text" class="form-control mt-3 mb-3 remove" name="jabatan[]" id="jabatan" style="text-transform:capitalize">
                                                                // `);

                                                                e.preventDefault();
                                                                $("#show_email_info").append(`
                                                                    <div class="row mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select class="select_email_info" name="email_info[]" style="width: 100%;"></select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_email_eval").append(`
                                                                    <div class="row mt-3 mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select class="select_email_eval" name="email_eval[]" style="width: 100%;"></select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_pembayaran").append(`
                                                                    <div class="row mt-3 mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select class="select_pembayaran" name="pembayaran[]" style="width: 100%;"></select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                // e.preventDefault();
                                                                // $("#show_tamu").append(`
                                                                //     <div class="row mt-3 mb-3 remove">
                                                                //         <div class="col-md-12">
                                                                //             <select class="select_tamu" name="tamu[]" style="width: 100%;"></select>
                                                                //         </div>
                                                                //     </div>
                                                                // `);

                                                                // e.preventDefault();
                                                                // $("#show_pic").append(`
                                                                //     <div class="row mt-3 mb-3 remove">
                                                                //         <div class="col-md-12">
                                                                //             <select class="select_pic" name="pic[]" style="width: 100%;"></select>
                                                                //         </div>
                                                                //     </div>
                                                                // `);

                                                                e.preventDefault();
                                                                $("#show_pic").append(`
                                                                    <input autocomplete="off" type="text" class="form-control mt-3 mb-3 remove" name="pic[]" style="text-transform:capitalize">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_gs_tiket").append(`
                                                                    <div class="row mt-3 mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select class="select_gs_tiket" name="gs_tiket[]" style="width: 100%;"></select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_tiket").append(`
                                                                    <div class="row mt-3 mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select class="select_tiket" name="tiket[]" style="width: 100%">
                                                                                <optgroup label = "Bus">
                                                                                    <?php foreach ($bus as $b => $bu) {?>
                                                                                        <option>
                                                                                            <?php echo $bu['nama_vendor']?>
                                                                                        </option>
                                                                                    <?php } ?>
                                                                                </optgroup>
                                                                                <optgroup label = "Kereta Api">
                                                                                    <?php foreach ($kereta as $k => $ker) {?>
                                                                                        <option>
                                                                                            <?php echo $ker['nama_vendor']?>
                                                                                        </option>
                                                                                    <?php } ?>
                                                                                </optgroup>
                                                                                <optgroup label = "Pesawat">
                                                                                    <?php foreach ($pesawat as $p => $pes) {?>
                                                                                        <option>
                                                                                            <?php echo $pes['nama_vendor']?>
                                                                                        </option>
                                                                                    <?php } ?>
                                                                                </optgroup>
                                                                                <optgroup label = "Travel">
                                                                                    <?php foreach ($travel as $t => $tra) {?>
                                                                                        <option>
                                                                                            <?php echo $tra['nama_vendor']?>
                                                                                        </option>
                                                                                    <?php } ?>
                                                                                </optgroup>
                                                                                <optgroup label = "Kapal Laut">
                                                                                    <?php foreach ($kapal_laut as $ka => $kap) {?>
                                                                                        <option>
                                                                                            <?php echo $kap['nama_vendor']?>
                                                                                        </option>
                                                                                    <?php } ?>
                                                                                </optgroup>
                                                                            </select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_pemberhentian").append(`
                                                                    <div class="row mt-3 mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select class="select_pemberhentian" name="pemberhentian[]" style="width: 100%">
                                                                                <optgroup label = "Bandara">
                                                                                    <?php foreach ($bandara as $b => $ba) {?>
                                                                                        <option>
                                                                                            <?php echo $ba['nama_pemberhentian']?> <?php echo "-" ?> <?php echo $ba['nama_kota']?>
                                                                                        </option>
                                                                                    <?php } ?>
                                                                                </optgroup>
                                                                                <optgroup label = "Pelabuhan">
                                                                                    <?php foreach ($pelabuhan as $p => $pe) {?>
                                                                                        <option>
                                                                                            <?php echo $pe['nama_pemberhentian']?> <?php echo "-" ?> <?php echo $pe['nama_kota']?>
                                                                                        </option>
                                                                                    <?php } ?>
                                                                                </optgroup>
                                                                                <optgroup label = "Stasiun">
                                                                                    <?php foreach ($stasiun as $s => $st) {?>
                                                                                        <option>
                                                                                            <?php echo $st['nama_pemberhentian']?> <?php echo "-" ?> <?php echo $st['nama_kota']?>
                                                                                        </option>
                                                                                    <?php } ?>
                                                                                </optgroup>
                                                                                <optgroup label = "Terminal">
                                                                                    <?php foreach ($terminal as $t => $te) {?>
                                                                                        <option>
                                                                                            <?php echo $te['nama_pemberhentian']?> <?php echo "-" ?> <?php echo $te['nama_kota']?>
                                                                                        </option>
                                                                                    <?php } ?>
                                                                                </optgroup>
                                                                            </select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_jumlah_tiket").append(`
                                                                    <input autocomplete="off" type="number" min="0" class="form-control mt-3 mb-3 remove" name="jumlah_tiket[]">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_tanggal_jam_tiket").append(`
                                                                    <input autocomplete="off" id='tanggal_jam_tiket`+count+`' class="form-control mt-3 mb-3 remove" name="tanggal_jam_tiket[]">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_dari_tiket").append(`
                                                                    <div class="row mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select class="select_dari" name="dari_tiket[]" style="width: 100%">
                                                                                <?php foreach ($negara as $n => $neg) {?>
                                                                                    <optgroup label=<?php echo $neg['nama_negara'] ?>>
                                                                                        <?php foreach ($kota as $k => $kot) {?>
                                                                                            <?php if ($neg['id_negara'] == $kot['id_negara']) { ?>
                                                                                                <option><?php echo $kot['nama_kota'] ?></option>
                                                                                            <?php } ?>
                                                                                        <?php } ?>
                                                                                    </optgroup>
                                                                                <?php } ?>
                                                                            </select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_tujuan_tiket").append(`
                                                                    <div class="row mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select class="select_tujuan" name="tujuan_tiket[]" style="width: 100%">
                                                                                <?php foreach ($negara as $n => $neg) {?>
                                                                                    <optgroup label=<?php echo $neg['nama_negara'] ?>>
                                                                                        <?php foreach ($kota as $k => $kot) {?>
                                                                                            <?php if ($neg['id_negara'] == $kot['id_negara']) { ?>
                                                                                                <option><?php echo $kot['nama_kota'] ?></option>
                                                                                            <?php } ?>
                                                                                        <?php } ?>
                                                                                    </optgroup>
                                                                                <?php } ?>
                                                                            </select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_keterangan_tiket").append(`
                                                                    <textarea class="form-control mt-3 mb-3 remove" name="keterangan_tiket[]" rows="3" placeholder=""></textarea>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_gs_hotel").append(`
                                                                    <div class="row mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select class="select_gs_hotel" name="gs_hotel[]" style="width: 100%;"></select>
                                                                        </div>
                                                                    </div>
                                                                `);
                                                                
                                                                e.preventDefault();
                                                                $("#show_kota").append(`
                                                                    <div class="row mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select id="select_kota`+count+`" name="kota[]" style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                                                <option value="pilih">-- pilih kota --</option>
                                                                                <?php foreach ($negara as $n => $neg) {?>
                                                                                    <optgroup label=<?php echo $neg['nama_negara'] ?>>
                                                                                        <?php foreach ($kota as $k => $kot) {?>
                                                                                            <?php if ($neg['id_negara'] == $kot['id_negara']) { ?>
                                                                                                <option><?php echo $kot['nama_kota'] ?></option>
                                                                                            <?php } ?>
                                                                                        <?php } ?>
                                                                                    </optgroup>
                                                                                <?php } ?>
                                                                            </select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_hotel").append(`
                                                                    <div class="row mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select id="select_hotel`+count+`" name="hotel[]" style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                                                <option value="pilih1">-- pilih kota terlebih dahulu --</option>
                                                                            </select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                var s = document.createElement('script');
                                                                s.type = 'text/javascript';
                                                                s.className = 'remove';
                                                                var code = `
                                                                    $("#select_kota`+count+`").change(function() {
                                                                        var val = $(this).val();

                                                                        <?php foreach ($kota as $k => $kot) {?>
                                                                            if (val == "<?php echo $kot['nama_kota'] ?>") {
                                                                                $("#select_hotel`+count+`").html(
                                                                                    "<option value=''>-- Daftar hotel --</option><?php foreach ($hotel as $h => $hote) {?><?php if ($kot['nama_kota'] == $hote['nama_kota']) { ?><option><?php echo $hote['nama_hotel'] ?><?php echo " - " ?><?php echo $hote['jenis_kamar'] ?></option><?php } ?><?php } ?>"
                                                                                );
                                                                            } else if (val == "pilih") {
                                                                                $("#select_hotel`+count+`").html(
                                                                                    "<option value='pilih1'>-- pilih kota terlebih dahulu --</option>"
                                                                                );
                                                                            }
                                                                        <?php } ?>
                                                                    });
                                                                `;
                                                                try {
                                                                s.appendChild(document.createTextNode(code));
                                                                $("#show_script_hotel").append(s);
                                                                } catch (e) {
                                                                s.text = code;
                                                                $("#show_script_hotel").append(s);
                                                                }

                                                                e.preventDefault();
                                                                $("#show_mess").append(`
                                                                    <div class="row mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select id="select_mess`+count+`" name="mess[]" style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                                                <option value="pilihmess">-- silahkan pilih Mess Kx Jkt terlebih dahulu --</option>
                                                                            </select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                var s = document.createElement('script');
                                                                s.type = 'text/javascript';
                                                                s.className = 'remove';
                                                                var code = `
                                                                    $("#select_hotel`+count+`").change(function() {
                                                                        var val = $(this).val();

                                                                        if (val == "Mess Kx Jkt - Standar") {
                                                                            $("#select_mess`+count+`").html(
                                                                                "<option>Tersedia untuk : <?php foreach ($mess as $m => $mes) { $sisa_kamar = $mes['kapasitas_kamar'] - $mes['terpakai'];?><?php echo $sisa_kamar ?><?php } ?> orang</option>"
                                                                            );
                                                                        } else {
                                                                            $("#select_mess`+count+`").html(
                                                                                "<option value='pilihmess'>-- silahkan pilih Mess Kx Jkt terlebih dahulu --</option>"
                                                                            );
                                                                        }
                                                                    });
                                                                `;
                                                                try {
                                                                s.appendChild(document.createTextNode(code));
                                                                $("#show_script_mess").append(s);
                                                                } catch (e) {
                                                                s.text = code;
                                                                $("#show_script_mess").append(s);
                                                                }

                                                                e.preventDefault();
                                                                $("#show_type").append(`
                                                                    <div class="row mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select class="select_type" name="type[]" style="width: 100%;"></select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_jumlah_kamar").append(`
                                                                    <input autocomplete="off" type="number" min="0" class="form-control mt-3 mb-3 remove" name="jumlah_kamar[]" id="jumlah_kamar`+count+`">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_tanggal_jam_masuk").append(`
                                                                    <input autocomplete="off" id='tanggal_jam_masuk`+count+`' class="form-control mt-3 mb-3 remove" name="tanggal_jam_masuk[]">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_tanggal_jam_keluar").append(`
                                                                    <input autocomplete="off" id='tanggal_jam_keluar`+count+`' class="form-control mt-3 mb-3 remove" name="tanggal_jam_keluar[]">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_keterangan_akomodasi").append(`
                                                                    <textarea class="form-control mt-3 mb-3 remove" name="keterangan_akomodasi[]" rows="3" placeholder=""></textarea>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_gs_mobil").append(`
                                                                    <div class="row mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select class="select_gs_mobil" name="gs_mobil[]" style="width: 100%;"></select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_jenis_kendaraan").append(`
                                                                    <div class="row mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select class="select_jenis_kendaraan" name="jenis_kendaraan[]" style="width: 100%;"></select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_tenaga_angkut").append(`
                                                                    <div class="row mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select class="select_tenaga_angkut" name="tenaga_angkut[]" style="width: 100%;"></select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_dalkot_lukot").append(`
                                                                    <div class="row mt-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select id="dalkot_lukot`+count+`" name="dalkot_lukot[]" onchange="showD`+count+`(this)" style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                                                <option value="Dalam Kota">Dalam Kota</option>
                                                                                <option value="Luar Kota">Luar Kota</option>
                                                                            </select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                var s = document.createElement('script');
                                                                s.type = 'text/javascript';
                                                                s.className = 'remove';
                                                                var code = `
                                                                    function showD`+count+`(select) {
                                                                        if (select.value == 'Dalam Kota') {
                                                                            document.getElementById('menginap`+count+`').style.display =
                                                                                "none";
                                                                        } else if (select.value == 'Luar Kota') {
                                                                            document.getElementById('menginap`+count+`').style.display =
                                                                                "block";
                                                                        }
                                                                    }
                                                                `;
                                                                try {
                                                                s.appendChild(document.createTextNode(code));
                                                                $("#show_script_dalkot_lukot").append(s);
                                                                } catch (e) {
                                                                s.text = code;
                                                                $("#show_script_dalkot_lukot").append(s);
                                                                }

                                                                e.preventDefault();
                                                                $("#show_menginap").append(`
                                                                    <div class="row mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <div id="menginap`+count+`" style="display:none;">
                                                                                <div class="mb-1">
                                                                                    Menginap
                                                                                </div>

                                                                                <select class="select_menginap" name="menginap[]"
                                                                                    style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                                                    <option>Iya</option>
                                                                                    <option>Tidak</option>
                                                                                </select>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_jumlah_mobil").append(`
                                                                    <input autocomplete="off" type="number" min="0" class="form-control mt-3 mb-3 remove" name="jumlah_mobil[]" id="jumlah_mobil`+count+`">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_kapasitas").append(`
                                                                    <input autocomplete="off" type="number" min="0" class="form-control mt-3 mb-3 remove" name="kapasitas[]" id="kapasitas`+count+`">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_tujuan_mobil").append(`
                                                                    <input autocomplete="off" type="text" class="form-control mt-3 mb-3 remove" name="tujuan_mobil[]" id="tujuan_mobil`+count+`" style="text-transform:capitalize">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_siap_di").append(`
                                                                    <input autocomplete="off" type="text" class="form-control mt-3 mb-3 remove" name="siap_di[]" id="siap_di`+count+`" style="text-transform:capitalize">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_tanggal_mobil").append(`
                                                                    <input autocomplete="off" id='tanggal_mobil`+count+`' class="form-control mt-3 mb-3 remove" name="tanggal_mobil[]">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_jam_siap").append(`
                                                                    <input autocomplete="off" id='jam_siap`+count+`' class="form-control mt-3 mb-3 remove" name="jam_siap[]">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_keterangan_mobil").append(`
                                                                    <textarea class="form-control mt-3 mb-3 remove" name="keterangan_mobil[]" rows="3" placeholder=""></textarea>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_gs_mobil_pulang").append(`
                                                                    <div class="row mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select class="select_gs_mobil_pulang" name="gs_mobil_pulang[]" style="width: 100%;"></select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_jenis_kendaraan_pulang").append(`
                                                                    <div class="row mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select class="select_jenis_kendaraan_pulang" name="jenis_kendaraan_pulang[]" style="width: 100%;"></select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_tenaga_angkut_pulang").append(`
                                                                    <div class="row mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select class="select_tenaga_angkut_pulang" name="tenaga_angkut_pulang[]" style="width: 100%;"></select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_dalkot_lukot_pulang").append(`
                                                                    <div class="row mt-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select id="dalkot_lukot_pulang`+count+`" name="dalkot_lukot_pulang[]" onchange="showpulang`+count+`(this)" style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                                                <option value="Dalam Kota">Dalam Kota</option>
                                                                                <option value="Luar Kota">Luar Kota</option>
                                                                            </select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                var s = document.createElement('script');
                                                                s.type = 'text/javascript';
                                                                s.className = 'remove';
                                                                var code = `
                                                                    function showpulang`+count+`(select) {
                                                                        if (select.value == 'Dalam Kota') {
                                                                            document.getElementById('menginap_pulang`+count+`').style.display =
                                                                                "none";
                                                                        } else if (select.value == 'Luar Kota') {
                                                                            document.getElementById('menginap_pulang`+count+`').style.display =
                                                                                "block";
                                                                        }
                                                                    }
                                                                `;
                                                                try {
                                                                s.appendChild(document.createTextNode(code));
                                                                $("#show_script_dalkot_lukot_pulang").append(s);
                                                                } catch (e) {
                                                                s.text = code;
                                                                $("#show_script_dalkot_lukot_pulang").append(s);
                                                                }

                                                                e.preventDefault();
                                                                $("#show_menginap_pulang").append(`
                                                                    <div class="row mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <div id="menginap_pulang`+count+`" style="display:none;">
                                                                                <div class="mb-1">
                                                                                    Menginap
                                                                                </div>

                                                                                <select class="select_menginap_pulang" name="menginap_pulang[]"
                                                                                    style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                                                    <option>Iya</option>
                                                                                    <option>Tidak</option>
                                                                                </select>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_jumlah_mobil_pulang").append(`
                                                                    <input autocomplete="off" type="number" min="0" class="form-control mt-3 mb-3 remove" name="jumlah_mobil_pulang[]" id="jumlah_mobil_pulang`+count+`">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_kapasitas_pulang").append(`
                                                                    <input autocomplete="off" type="number" min="0" class="form-control mt-3 mb-3 remove" name="kapasitas_pulang[]" id="kapasitas_pulang`+count+`">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_tujuan_mobil_pulang").append(`
                                                                    <input autocomplete="off" type="text" class="form-control mt-3 mb-3 remove" name="tujuan_mobil_pulang[]" id="tujuan_mobil_pulang`+count+`" style="text-transform:capitalize">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_siap_di_pulang").append(`
                                                                    <input autocomplete="off" type="text" class="form-control mt-3 mb-3 remove" name="siap_di_pulang[]" id="siap_di_pulang`+count+`" style="text-transform:capitalize">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_tanggal_mobil_pulang").append(`
                                                                    <input autocomplete="off" id='tanggal_mobil_pulang`+count+`' class="form-control mt-3 mb-3 remove" name="tanggal_mobil_pulang[]">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_jam_siap_pulang").append(`
                                                                    <input autocomplete="off" id='jam_siap_pulang`+count+`' class="form-control mt-3 mb-3 remove" name="jam_siap_pulang[]">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_keterangan_mobil_pulang").append(`
                                                                    <textarea class="form-control mt-3 mb-3 remove" name="keterangan_mobil_pulang[]" rows="3" placeholder=""></textarea>
                                                                `);

                                                                var data_select = ['Non Tamu', 'Tamu']

                                                                $(".select_tamu").select2({
                                                                    data: data_select,
                                                                    // tags: true,
                                                                    // tokenSeparators: [',', ' '],
                                                                });

                                                                var data_select = [
                                                                    <?php foreach ($pengguna as $peng) : ?> "<?php echo $peng['nama_pengguna']?>",
                                                                    <?php endforeach ?>
                                                                ]

                                                                $(".select_nama").select2({
                                                                    // tags:["Semua"],
                                                                    data: data_select,
                                                                    // tags: true,
                                                                    // tokenSeparators: [',', ' '],
                                                                });

                                                                var data_select = [
                                                                    //     <php foreach ($bag as $bag) : ?> "<php echo $bag['strorgnm']?>",
                                                                    //     <php endforeach ?>
                                                                    'Direksi', 'Manager', 'Officer', 'Supervisor', 'Pelaksana'
                                                                ]

                                                                $(".select_jabatan").select2({
                                                                    // tags:["Semua"],
                                                                    data: data_select,
                                                                    // tags: true,
                                                                    // tokenSeparators: [',', ' '],
                                                                });

                                                                var data_select = [
                                                                    <?php foreach ($pengguna as $peng) : ?> "<?php echo $peng['nama_pengguna']?>",
                                                                    <?php endforeach ?>
                                                                ]

                                                                $(".select_email_info").select2({
                                                                    // tags:["Semua"],
                                                                    data: data_select,
                                                                    // tags: true,
                                                                    // tokenSeparators: [',', ' '],
                                                                });

                                                                var data_select = [
                                                                    <?php foreach ($pengguna as $peng) : ?> "<?php echo $peng['nama_pengguna']?>",
                                                                    <?php endforeach ?>
                                                                ]

                                                                $(".select_email_eval").select2({
                                                                    // tags:["Semua"],
                                                                    data: data_select,
                                                                    // tags: true,
                                                                    // tokenSeparators: [',', ' '],
                                                                });

                                                                var data_select = ['Company Acc', 'Personal Acc']

                                                                $(".select_pembayaran").select2({
                                                                    data: data_select,
                                                                    // tags: true,
                                                                    // tokenSeparators: [',', ' '],
                                                                });

                                                                // var data_select = [
                                                                //     <php foreach ($pengguna as $peng) : ?> "<php echo $peng['nama_pengguna']?>",
                                                                //     <php endforeach ?>
                                                                // ]

                                                                // $(".select_pic").select2({
                                                                //     data: data_select,
                                                                //     // tags: true,
                                                                //     // tokenSeparators: [',', ' '],
                                                                // });

                                                                var data_select = [
                                                                    <?php foreach ($pool as $poo) : ?> "<?php echo $poo['nama_pool']?>",
                                                                    <?php endforeach ?>
                                                                ]

                                                                $(".select_gs_tiket").select2({
                                                                    data: data_select,
                                                                    // tags: true,
                                                                    // tokenSeparators: [',', ' '],
                                                                });

                                                                $.datetimepicker.setLocale('id');
                                                                $('#tanggal_jam_tiket'+count+'').datetimepicker({
                                                                    format: 'Y-m-d H:i',
                                                                    formatDate: 'Y-m-d',
                                                                    formatTime: 'H:i',
                                                                    minDate:'0',
                                                                    step: 1,
                                                                    closeOnTimeSelect : true,
                                                                    scrollMonth : false,
                                                                    scrollInput : false,
                                                                });

                                                                var data_select = [
                                                                    <?php foreach ($pool as $poo) : ?> "<?php echo $poo['nama_pool']?>",
                                                                    <?php endforeach ?>
                                                                ]

                                                                $(".select_gs_hotel").select2({
                                                                    data: data_select,
                                                                    // tags: true,
                                                                    // tokenSeparators: [',', ' '],
                                                                });

                                                                var data_select = ['Single', 'Twin / Double']

                                                                $(".select_type").select2({
                                                                    data: data_select,
                                                                    // tags: true,
                                                                    // tokenSeparators: [',', ' '],
                                                                });

                                                                $.datetimepicker.setLocale('id');
                                                                $('#tanggal_jam_masuk'+count+'').datetimepicker({
                                                                    format: 'Y-m-d H:i',
                                                                    formatDate: 'Y-m-d',
                                                                    formatTime: 'H:i',
                                                                    minDate:'0',
                                                                    step: 1,
                                                                    closeOnTimeSelect : true,
                                                                    scrollMonth : false,
                                                                    scrollInput : false,
                                                                });

                                                                $.datetimepicker.setLocale('id');
                                                                $('#tanggal_jam_keluar'+count+'').datetimepicker({
                                                                    format: 'Y-m-d H:i',
                                                                    formatDate: 'Y-m-d',
                                                                    formatTime: 'H:i',
                                                                    minDate:'0',
                                                                    step: 1,
                                                                    closeOnTimeSelect : true,
                                                                    scrollMonth : false,
                                                                    scrollInput : false,
                                                                });

                                                                var data_select = [
                                                                    <?php foreach ($pool as $poo) : ?> "<?php echo $poo['nama_pool']?>",
                                                                    <?php endforeach ?>
                                                                ]

                                                                $(".select_gs_mobil").select2({
                                                                    data: data_select,
                                                                    // tags: true,
                                                                    // tokenSeparators: [',', ' '],
                                                                });

                                                                var data_select = [
                                                                    'Sedan', 'Station', 'Pickup', 'Box', 'Truck'
                                                                ]

                                                                $(".select_jenis_kendaraan").select2({
                                                                    data: data_select,
                                                                    // tags: true,
                                                                    // tokenSeparators: [',', ' '],
                                                                });

                                                                var data_select = [
                                                                    //     <php foreach ($bag as $bag) : ?> "<php echo $bag['strorgnm']?>",
                                                                    //     <php endforeach ?>
                                                                    'Tidak', 'Butuh'
                                                                ]

                                                                $(".select_tenaga_angkut").select2({
                                                                    data: data_select,
                                                                    // tags: true,
                                                                    // tokenSeparators: [',', ' '],
                                                                });

                                                                $.datetimepicker.setLocale('id');
                                                                $('#tanggal_mobil'+count+'').datetimepicker({
                                                                    format: 'Y-m-d',
                                                                    formatDate: 'Y-m-d',
                                                                    minDate:'0',
                                                                    step: 1,
                                                                    timepicker : false,
                                                                    closeOnDateSelect : true,
                                                                    scrollMonth : false,
                                                                    scrollInput : false,
                                                                });

                                                                $.datetimepicker.setLocale('id');
                                                                $('#jam_siap'+count+'').datetimepicker({
                                                                    format: 'H:i',
                                                                    formatTime: 'H:i',
                                                                    step: 1,
                                                                    datepicker : false,
                                                                });

                                                                var data_select = [
                                                                    <?php foreach ($pool as $poo) : ?> "<?php echo $poo['nama_pool']?>",
                                                                    <?php endforeach ?>
                                                                ]

                                                                $(".select_gs_mobil_pulang").select2({
                                                                    data: data_select,
                                                                    // tags: true,
                                                                    // tokenSeparators: [',', ' '],
                                                                });

                                                                var data_select = [
                                                                    //     <php foreach ($bag as $bag) : ?> "<php echo $bag['strorgnm']?>",
                                                                    //     <php endforeach ?>
                                                                    'Sedan', 'Station', 'Pickup', 'Box',
                                                                    'Truck'
                                                                ]

                                                                $(".select_jenis_kendaraan_pulang").select2({
                                                                    data: data_select,
                                                                    // tags: true,
                                                                    // tokenSeparators: [',', ' '],
                                                                });

                                                                var data_select = [
                                                                    //     <php foreach ($bag as $bag) : ?> "<php echo $bag['strorgnm']?>",
                                                                    //     <php endforeach ?>
                                                                    'Tidak', 'Butuh'
                                                                ]

                                                                $(".select_tenaga_angkut_pulang").select2({
                                                                    data: data_select,
                                                                    // tags: true,
                                                                    // tokenSeparators: [',', ' '],
                                                                });

                                                                $.datetimepicker.setLocale('id');
                                                                $('#tanggal_mobil_pulang'+count+'').datetimepicker({
                                                                    format: 'Y-m-d',
                                                                    formatDate: 'Y-m-d',
                                                                    minDate:'0',
                                                                    step: 1,
                                                                    timepicker : false,
                                                                    closeOnDateSelect : true,
                                                                    scrollMonth : false,
                                                                    scrollInput : false,
                                                                });

                                                                $.datetimepicker.setLocale('id');
                                                                $('#jam_siap_pulang'+count+'').datetimepicker({
                                                                    format: 'H:i',
                                                                    formatTime: 'H:i',
                                                                    step: 1,
                                                                    datepicker : false,
                                                                });

                                                                $('select:not(.normal)').each(function() {
                                                                    $(this).select2({
                                                                        // tags: true,
                                                                        dropdownParent: $(this)
                                                                            .parent()
                                                                    });
                                                                });
                                                            });

                                                            $('#remove_item_btn').click(function () {
                                                                $('.remove').remove();
                                                            });
                                                        });
                                                    </script>
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </section>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="content-footer footer bg-footer-theme">
        <div class="container-xxl d-flex flex-wrap justify-content-center">
            <div class="mb-2 mb-md-0">
                Copyright &copy; <strong><span>MIS 2024</span></strong>.
            </div>
        </div>
    </footer>
    <!-- / Footer -->

    <div class="content-backdrop fade"></div>
</div>
<!-- Content wrapper -->

<!-- trans -->
<!-- Content wrapper -->
<div class="content-wrapper">
        <div class="container-xxl flex-grow-1 container-p-y">
            <?php
            $session = \Config\Services::session();
            if($session->getFlashdata('warning')) {
            ?>
            <div class="alert alert-warning">
                <ul>
                    <?php
                        foreach($session->getFlashdata('warning') as $val) {
                        ?>
                    <li><?php echo $val ?></li>
                    <?php
                        }
                        ?>
                </ul>
            </div>
            <?php
            }
            if($session->getFlashdata('success')) {
            ?>
            <div class="alert alert-success"><?php echo $session->getFlashdata('success')?></div>
            <?php
            }
            ?>
            <div class="row">
                <div class="col-lg-12 mb-4 order-0">
                    <div class="card">
                        <div class="d-flex align-items-end row">
                            <div class="col-sm-12">
                                <div class="card-body">
                                    <h1>Transaksi</h1>
                                    <a class="btn btn-primary mb-3" href="trans_add" style="font-size:120%;"><i class="fa-solid fa-plus"></i> Tambah Data</a>
                                    <div class="table-responsive text-nowrap">
                                        <table id="myTable" class="display nowrap cell-border" style="width=100%">
                                            <thead>
                                                <tr class="align-text-center">
                                                    <th class="text-center" style="color: #5a5c69;">No</th>
                                                    <th class="text-center" style="color: #5a5c69;">Tanggal Transaksi
                                                    </th>
                                                    <th class="text-center" style="color: #5a5c69;">Tiket
                                                    </th>
                                                    <th class="text-center" style="color: #5a5c69;">Hotel
                                                    </th>
                                                    <th class="text-center" style="color: #5a5c69;">Transport
                                                    </th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <?php $i=1;?>
                                                <?php foreach ($trans as $t => $tra) {
                                                    $id_trans = $tra['id_trans'];
                                                ?>
                                                    <tr>
                                                        <td class="text-center col-1" style="color: #5a5c69;"><?php echo $i++ ?></td>
                                                        <td class="text-center" style="color: #5a5c69;"><?php echo tanggal_transaksi_kendaraan($tra['created_at']) ?></td>
                                                        <td class="text-left" style="color: #5a5c69;">
                                                                <?php foreach ($tiket as $ti => $tik) {
                                                                    $id_tiket = $tik['id_tiket'];
                                                                    $batal_tiket = site_url("trans/?aksi=permintaan_batal_tiket&id_trans=$id_trans&id_tiket=$id_tiket");
                                                                ?>
                                                                    <?php if ($tik['id_trans'] == $tra['id_trans']) { ?>
                                                                        <?php foreach ($pemberhentian as $pem => $ber) { ?>
                                                                            <?php if ($tik['id_keberangkatan'] == $ber['id_pemberhentian']) { ?>
    <abbr title="PIC : <?php echo $tik['pic'] ?>
                                                                            
    Pool : <?php echo $tik['nama_pool'] ?>

    Tiket : <?php echo $tik['nama_vendor'] ?>

    Keberangkatan : <?php echo $ber['nama_pemberhentian'] ?>

    Pemberhentian : <?php echo $tik['nama_pemberhentian'] ?>

    Dari/Tujuan : <?php echo $tik['dari_tiket'] ?><?php echo "/" ?><?php echo $tik['tujuan_tiket'] ?>

    Jumlah Tiket : <?php echo $tik['jumlah_tiket'] ?>

    Atas Nama : <?php echo $tik['atas_nama'] ?>

    Jabatan : <?php echo $tik['jabatan'] ?>

    Tanggal Tiket : <?php echo tanggal_jam_transaksi_kendaraan($tik['tanggal_jam_tiket']) ?>
    <?php 
        if($tik['pembayaran'] == 'k'){
            $pembayaran = 'Kantor';
        } else if($tik['pembayaran'] == 'p'){
            $pembayaran = 'Personal';
        }
    ?>

    Pembayaran : <?php echo $pembayaran ?>
    <?php 
        if($tik['keterangan_tiket'] == null){
            $keterangan_tiket = '-';
        } else if($tik['keterangan_tiket'] != null){
            $keterangan_tiket = $tik['keterangan_tiket'];
        }
    ?>

    Keterangan : <?php echo $keterangan_tiket ?>
    <?php 
        if($tik['status_tiket'] == '0' && $tik['batal_tiket'] == '0'){
            $status_tiket = 'Belum Disetujui GS';
        } else if($tik['status_tiket'] == '0' && $tik['batal_tiket'] == '1'){
            $status_tiket = 'Belum Disetujui GS';
        } else if($tik['status_tiket'] == '0' && $tik['batal_tiket'] == '2'){
            $status_tiket = 'Transaksi dibatalkan';
        } else if($tik['status_tiket'] == '1' && $tik['batal_tiket'] == '0'){
            $status_tiket = 'Disetujui GS';
        } else if($tik['status_tiket'] == '1' && $tik['batal_tiket'] == '1'){
            $status_tiket = 'Disetujui GS';
        } else if($tik['status_tiket'] == '1' && $tik['batal_tiket'] == '3'){
            $status_tiket = 'Transaksi dibatalkan';
        }
    ?>

    Status Tiket : <?php echo $status_tiket ?>
    <?php if($tik['batal_tiket'] == '1'){ ?>

    Permintaan Batal Tiket : Belum Disetujui GS
    <?php } else if($tik['batal_tiket'] > '1'){ ?>

    <?php } else { ?>

    <?php } ?>" style="text-decoration:none;-webkit-text-decoration:none;text-decoration:none;cursor:pointer;border-bottom:0;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none">
                                                                                        PIC : <?php echo $tik['pic'] ?><br>
                                                                                        Pool : <?php echo $tik['nama_pool'] ?><br>
                                                                                        Tiket : <?php echo $tik['nama_vendor'] ?><br>
                                                                                        Keberangkatan : <?php echo $ber['nama_pemberhentian'] ?><br>
                                                                                        Pemberhentian : <?php echo $tik['nama_pemberhentian'] ?><br>
                                                                                        Dari/Tujuan : <?php echo $tik['dari_tiket'] ?><?php echo "/" ?><?php echo $tik['tujuan_tiket'] ?><br>
                                                                                        Jumlah Tiket : <?php echo $tik['jumlah_tiket'] ?><br>
                                                                                        Atas Nama : <?php echo $tik['atas_nama'] ?><br>
                                                                                        Jabatan : <?php echo $tik['jabatan'] ?><br>
                                                                                        Tanggal Tiket : <?php echo tanggal_jam_transaksi_kendaraan($tik['tanggal_jam_tiket']) ?><br>
                                                                                        <?php 
                                                                                            if($tik['pembayaran'] == 'k'){
                                                                                                $pembayaran = 'Kantor';
                                                                                            } else if($tik['pembayaran'] == 'p'){
                                                                                                $pembayaran = 'Personal';
                                                                                            }
                                                                                        ?>
                                                                                        Pembayaran : <?php echo $pembayaran ?><br>
                                                                                        <?php 
                                                                                            if($tik['keterangan_tiket'] == null){
                                                                                                $keterangan_tiket = '-';
                                                                                            } else if($tik['keterangan_tiket'] != null){
                                                                                                $keterangan_tiket = $tik['keterangan_tiket'];
                                                                                            }
                                                                                        ?>
                                                                                        Keterangan : <?php echo $keterangan_tiket ?><br>
                                                                                        <?php 
                                                                                            if($tik['status_tiket'] == '0' && $tik['batal_tiket'] == '0'){
                                                                                                $status_tiket = 'Belum Disetujui GS';
                                                                                            } else if($tik['status_tiket'] == '0' && $tik['batal_tiket'] == '1'){
                                                                                                $status_tiket = 'Belum Disetujui GS';
                                                                                            } else if($tik['status_tiket'] == '0' && $tik['batal_tiket'] == '2'){
                                                                                                $status_tiket = 'Transaksi dibatalkan';
                                                                                            } else if($tik['status_tiket'] == '1' && $tik['batal_tiket'] == '0'){
                                                                                                $status_tiket = 'Disetujui GS';
                                                                                            } else if($tik['status_tiket'] == '1' && $tik['batal_tiket'] == '1'){
                                                                                                $status_tiket = 'Disetujui GS';
                                                                                            } else if($tik['status_tiket'] == '1' && $tik['batal_tiket'] == '3'){
                                                                                                $status_tiket = 'Transaksi dibatalkan';
                                                                                            }
                                                                                        ?>
                                                                                        Status Tiket : <?php echo $status_tiket ?><br>
                                                                                        <?php if($tik['batal_tiket'] == '1'){ ?>
                                                                                            Permintaan Batal Tiket : Belum Disetujui GS <br>
                                                                                        <?php } else if($tik['batal_tiket'] > '1'){ ?>
                                                                                            
                                                                                        <?php } else { ?>

                                                                                        <?php } ?>
                                                                                    </abbr>
                                                                                    <?php if($tik['batal_tiket'] == '0'){ ?>
                                                                                        <a class="btn btn-danger btn-lg mt-3 mb-3" href="<?php echo $batal_tiket?>" onclick="return confirm('Yakin akan mengajukan permintaan batal untuk transaksi ini?')" style="font-size:80%;">Ajukan Permintaan Batal</a>
                                                                                    <?php } else { ?>
                                                                                
                                                                                    <?php } ?>

                                                                                <?php } ?>
                                                                            <?php } ?>
                                                                            
                                                                        <?php } else { ?>
                                                                            
                                                                        <?php } ?>
                                                                    <?php } ?>
                                                            </td>
                                                            <td class="text-left" style="color: #5a5c69;">
                                                                <?php foreach ($akomodasi as $ak => $ako) {
                                                                    $id_akomodasi = $ako['id_akomodasi'];
                                                                    $batal_akomodasi = site_url("trans/?aksi=permintaan_batal_akomodasi&id_trans=$id_trans&id_akomodasi=$id_akomodasi");
                                                                ?>
                                                                    <?php if ($ako['id_trans'] == $tra['id_trans']) { ?>
    <abbr title="PIC : <?php echo $ako['pic'] ?>

    Pool : <?php echo $ako['nama_pool'] ?>

    Hotel : <?php echo $ako['nama_hotel'] ?>

    Kamar : <?php echo $ako['jenis_kamar'] ?>

    Kota : <?php echo $ako['nama_kota'] ?>

    Periode : <?php echo tanggal_jam_transaksi_kendaraan($ako['tanggal_jam_masuk']) ?><?php echo " - " ?><?php echo tanggal_jam_transaksi_kendaraan($ako['tanggal_jam_keluar']) ?>

    Jumlah kamar : <?php echo $ako['jumlah_kamar'] ?>

    Atas Nama : <?php echo $ako['atas_nama'] ?>

    Jabatan : <?php echo $ako['jabatan'] ?>

    <?php 
        if($ako['pembayaran'] == 'k'){
            $pembayaran = 'Kantor';
        } else if($ako['pembayaran'] == 'p'){
            $pembayaran = 'Personal';
        }
    ?>
    Pembayaran : <?php echo $pembayaran ?>

    <?php 
        if($ako['keterangan_akomodasi'] == null){
            $keterangan_akomodasi = '-';
        } else if($ako['keterangan_akomodasi'] != null){
            $keterangan_akomodasi = $ako['keterangan_akomodasi'];
        }
    ?>
    Keterangan : <?php echo $keterangan_akomodasi ?>

    <?php if ($ako['nama_hotel'] == 'Mess Kx Jkt') { ?>
    <?php
        if($ako['status_mess'] == '0' && $ako['batal_akomodasi'] == '0'){
            $status_mess = 'Sudah Checkout';
        } else if($ako['status_mess'] == '0' && $ako['batal_akomodasi'] == '1'){
            $status_mess = 'Sudah Checkout';
        } else if($ako['status_mess'] == '0' && $ako['batal_akomodasi'] == '2'){
            $status_mess = 'Transaksi dibatalkan';
        } else if($ako['status_mess'] == '0' && $ako['batal_akomodasi'] == '3'){
            $status_mess = 'Transaksi dibatalkan';
        } else if($ako['status_mess'] == '1' && $ako['batal_akomodasi'] == '0'){
            $status_mess = 'Sudah Booking';
        } else if($ako['status_mess'] == '1' && $ako['batal_akomodasi'] == '1'){
            $status_mess = 'Sudah Booking';
        } else if($ako['status_mess'] == '1' && $ako['batal_akomodasi'] == '2'){
            $status_mess = 'Transaksi dibatalkan';
        } else if($ako['status_mess'] == '1' && $ako['batal_akomodasi'] == '3'){
            $status_mess = 'Transaksi dibatalkan';
        }

        if($ako['status_akomodasi'] == '0' && $ako['batal_akomodasi'] == '0'){
            $status_akomodasi = 'Belum Disetujui GS';
        } else if($ako['status_akomodasi'] == '0' && $ako['batal_akomodasi'] == '1'){
            $status_akomodasi = 'Belum Disetujui GS';
        } else if($ako['status_akomodasi'] == '0' && $ako['batal_akomodasi'] == '2'){
            $status_akomodasi = 'Transaksi dibatalkan';
        } else if($ako['status_akomodasi'] == '1' && $ako['batal_akomodasi'] == '0'){
            $status_akomodasi = 'Disetujui GS';
        } else if($ako['status_akomodasi'] == '1' && $ako['batal_akomodasi'] == '1'){
            $status_akomodasi = 'Disetujui GS';
        } else if($ako['status_akomodasi'] == '1' && $ako['batal_akomodasi'] == '3'){
            $status_akomodasi = 'Transaksi dibatalkan';
        }
    ?>
    <?php if ($status_mess == 'Transaksi dibatalkan') { ?>
    Status Mess : <?php echo $status_mess ?>
    <?php } else { ?>
    Status Mess : <?php echo $status_mess ?>, <?php echo $status_akomodasi ?>
    <?php } ?>
    <?php } else { ?>
    <?php
        if($ako['status_akomodasi'] == '0' && $ako['batal_akomodasi'] == '0'){
            $status_akomodasi = 'Belum Disetujui GS';
        } else if($ako['status_akomodasi'] == '0' && $ako['batal_akomodasi'] == '1'){
            $status_akomodasi = 'Belum Disetujui GS';
        } else if($ako['status_akomodasi'] == '0' && $ako['batal_akomodasi'] == '2'){
            $status_akomodasi = 'Transaksi dibatalkan';
        } else if($ako['status_akomodasi'] == '1' && $ako['batal_akomodasi'] == '0'){
            $status_akomodasi = 'Disetujui GS';
        } else if($ako['status_akomodasi'] == '1' && $ako['batal_akomodasi'] == '1'){
            $status_akomodasi = 'Disetujui GS';
        } else if($ako['status_akomodasi'] == '1' && $ako['batal_akomodasi'] == '3'){
            $status_akomodasi = 'Transaksi dibatalkan';
        }
    ?>
    Status Hotel : <?php echo $status_akomodasi ?>
    <?php } ?>
    <?php if($ako['batal_akomodasi'] == '1'){ ?>

    Permintaan Batal Akomodasi : Belum Disetujui GS
    <?php } else if($ako['batal_akomodasi'] > '1'){ ?>

    <?php } else { ?>

    <?php } ?>" style="text-decoration:none;-webkit-text-decoration:none;text-decoration:none;cursor:pointer;border-bottom:0;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none">
                                                                        PIC : <?php echo $ako['pic'] ?><br>
                                                                        Pool : <?php echo $ako['nama_pool'] ?><br>
                                                                        Hotel : <?php echo $ako['nama_hotel'] ?><br>
                                                                        Kamar : <?php echo $ako['jenis_kamar'] ?><br>
                                                                        Kota : <?php echo $ako['nama_kota'] ?><br>
                                                                        Periode : <?php echo tanggal_jam_transaksi_kendaraan($ako['tanggal_jam_masuk']) ?><?php echo " - " ?><?php echo tanggal_jam_transaksi_kendaraan($ako['tanggal_jam_keluar']) ?><br>
                                                                        Jumlah kamar : <?php echo $ako['jumlah_kamar'] ?><br>
                                                                        Atas Nama : <?php echo $ako['atas_nama'] ?><br>
                                                                        Jabatan : <?php echo $ako['jabatan'] ?><br>
                                                                        <?php 
                                                                            if($ako['pembayaran'] == 'k'){
                                                                                $pembayaran = 'Kantor';
                                                                            } else if($ako['pembayaran'] == 'p'){
                                                                                $pembayaran = 'Personal';
                                                                            }
                                                                        ?>
                                                                        Pembayaran : <?php echo $pembayaran ?><br>
                                                                        <?php 
                                                                            if($ako['keterangan_akomodasi'] == null){
                                                                                $keterangan_akomodasi = '-';
                                                                            } else if($ako['keterangan_akomodasi'] != null){
                                                                                $keterangan_akomodasi = $ako['keterangan_akomodasi'];
                                                                            }
                                                                        ?>
                                                                        Keterangan : <?php echo $keterangan_akomodasi ?><br>
                                                                        <?php if ($ako['nama_hotel'] == 'Mess Kx Jkt') { ?>
                                                                            <?php
                                                                                if($ako['status_mess'] == '0' && $ako['batal_akomodasi'] == '0'){
                                                                                    $status_mess = 'Sudah Checkout';
                                                                                } else if($ako['status_mess'] == '0' && $ako['batal_akomodasi'] == '1'){
                                                                                    $status_mess = 'Sudah Checkout';
                                                                                } else if($ako['status_mess'] == '0' && $ako['batal_akomodasi'] == '2'){
                                                                                    $status_mess = 'Transaksi dibatalkan';
                                                                                } else if($ako['status_mess'] == '0' && $ako['batal_akomodasi'] == '3'){
                                                                                    $status_mess = 'Transaksi dibatalkan';
                                                                                } else if($ako['status_mess'] == '1' && $ako['batal_akomodasi'] == '0'){
                                                                                    $status_mess = 'Sudah Booking';
                                                                                } else if($ako['status_mess'] == '1' && $ako['batal_akomodasi'] == '1'){
                                                                                    $status_mess = 'Sudah Booking';
                                                                                } else if($ako['status_mess'] == '1' && $ako['batal_akomodasi'] == '2'){
                                                                                    $status_mess = 'Transaksi dibatalkan';
                                                                                } else if($ako['status_mess'] == '1' && $ako['batal_akomodasi'] == '3'){
                                                                                    $status_mess = 'Transaksi dibatalkan';
                                                                                }

                                                                                if($ako['status_akomodasi'] == '0' && $ako['batal_akomodasi'] == '0'){
                                                                                    $status_akomodasi = 'Belum Disetujui GS';
                                                                                } else if($ako['status_akomodasi'] == '0' && $ako['batal_akomodasi'] == '1'){
                                                                                    $status_akomodasi = 'Belum Disetujui GS';
                                                                                } else if($ako['status_akomodasi'] == '0' && $ako['batal_akomodasi'] == '2'){
                                                                                    $status_akomodasi = 'Transaksi dibatalkan';
                                                                                } else if($ako['status_akomodasi'] == '1' && $ako['batal_akomodasi'] == '0'){
                                                                                    $status_akomodasi = 'Disetujui GS';
                                                                                } else if($ako['status_akomodasi'] == '1' && $ako['batal_akomodasi'] == '1'){
                                                                                    $status_akomodasi = 'Disetujui GS';
                                                                                } else if($ako['status_akomodasi'] == '1' && $ako['batal_akomodasi'] == '3'){
                                                                                    $status_akomodasi = 'Transaksi dibatalkan';
                                                                                }
                                                                            ?>
                                                                            <?php if ($status_mess == 'Transaksi dibatalkan') { ?>
                                                                            Status Mess : <?php echo $status_mess ?><br>
                                                                            <?php } else { ?>
                                                                            Status Mess : <?php echo $status_mess ?>, <?php echo $status_akomodasi ?><br>
                                                                            <?php } ?>
                                                                        <?php } else { ?>
                                                                            <?php
                                                                                if($ako['status_akomodasi'] == '0' && $ako['batal_akomodasi'] == '0'){
                                                                                    $status_akomodasi = 'Belum Disetujui GS';
                                                                                } else if($ako['status_akomodasi'] == '0' && $ako['batal_akomodasi'] == '1'){
                                                                                    $status_akomodasi = 'Belum Disetujui GS';
                                                                                } else if($ako['status_akomodasi'] == '0' && $ako['batal_akomodasi'] == '2'){
                                                                                    $status_akomodasi = 'Transaksi dibatalkan';
                                                                                } else if($ako['status_akomodasi'] == '1' && $ako['batal_akomodasi'] == '0'){
                                                                                    $status_akomodasi = 'Disetujui GS';
                                                                                } else if($ako['status_akomodasi'] == '1' && $ako['batal_akomodasi'] == '1'){
                                                                                    $status_akomodasi = 'Disetujui GS';
                                                                                } else if($ako['status_akomodasi'] == '1' && $ako['batal_akomodasi'] == '3'){
                                                                                    $status_akomodasi = 'Transaksi dibatalkan';
                                                                                }
                                                                            ?>
                                                                            Status Hotel : <?php echo $status_akomodasi ?><br>
                                                                        <?php } ?>
                                                                        <?php if($ako['batal_akomodasi'] == '1'){ ?>
                                                                            Permintaan Batal Akomodasi : Belum Disetujui GS <br>
                                                                        <?php } else if($ako['batal_akomodasi'] > '1'){ ?>
                                                                            
                                                                        <?php } else { ?>

                                                                        <?php } ?>
                                                                        </abbr>
                                                                        <?php if($ako['batal_akomodasi'] == '0'){ ?>
                                                                            <a class="btn btn-danger btn-lg mt-3 mb-3" href="<?php echo $batal_akomodasi?>" onclick="return confirm('Yakin akan mengajukan permintaan batal untuk transaksi ini?')" style="font-size:80%;">Ajukan Permintaan Batal</a>
                                                                        <?php } else { ?>
                                                                    
                                                                        <?php } ?>
                                                                    <?php } else { ?>
                                                                        
                                                                    <?php } ?>
                                                                <?php } ?>
                                                            </td>
                                                            <td class="text-left" style="color: #5a5c69;">
                                                            <?php foreach ($transportasi as $tr => $transpo) {
                                                                $id_transportasi = $transpo['id_transportasi'];
                                                                $batal_transportasi_antar = site_url("trans/?aksi=permintaan_batal_transportasi_antar&id_trans=$id_trans&id_transportasi=$id_transportasi");
                                                            ?>
                                                                    <?php if ($transpo['id_trans'] == $tra['id_trans']) { ?>
    <abbr title="<?php if ($transpo['jemput'] == 0) { ?>
    Antar    
    PIC : <?php echo $transpo['pic'] ?>

    Pool : <?php echo $transpo['nama_pool'] ?>

    <?php 
        if($transpo['jenis_kendaraan'] == 's'){
            $jenis_kendaraan = 'Sedan';
        } else if($transpo['jenis_kendaraan'] == 'a'){
            $jenis_kendaraan = 'Station';
        } else if($transpo['jenis_kendaraan'] == 'p'){
            $jenis_kendaraan = 'Pick Up';
        } else if($transpo['jenis_kendaraan'] == 'b'){
            $jenis_kendaraan = 'Box';
        } else if($transpo['jenis_kendaraan'] == 't'){
            $jenis_kendaraan = 'Truck';
        }
    ?>
    Jenis Mobil : <?php echo $jenis_kendaraan ?>

    <?php 
        if($transpo['dalkot_lukot'] == 'd'){
            $dalkot_lukot = 'Dalam Kota';
        } else if($transpo['dalkot_lukot'] == 'l'){
            $dalkot_lukot = 'Luar Kota';
        }
    ?>
    Dalam/Luar Kota : <?php echo $dalkot_lukot ?>

    <?php 
        if($transpo['tenaga_angkut'] == '1'){
            $tenaga_angkut = 'Iya';
        } else {
            $tenaga_angkut = 'Tidak';
        }
    ?>
    Butuh Tenaga Angkut? : <?php echo $tenaga_angkut ?>

    <?php 
        if($transpo['menginap'] == '0'){
            $menginap = 'Tidak';
        } else if($transpo['menginap'] == '1'){
            $menginap = 'Iya';
        }
    ?>
    Menginap : <?php echo $menginap ?>

    Kapasitas : <?php echo $transpo['kapasitas'] ?>

    Jumlah : <?php echo $transpo['jumlah_mobil'] ?><?php echo ' buah' ?>

    Tanggal : <?php echo date_transaksi_kendaraan($transpo['tanggal_mobil']) ?>

    Tujuan : <?php echo $transpo['tujuan_mobil'] ?>

    Siap di : <?php echo $transpo['siap_di'] ?>

    Jam : <?php echo $transpo['jam_siap'] ?>

    Untuk : <?php echo $transpo['atas_nama'] ?>

    Jabatan : <?php echo $transpo['jabatan'] ?>

    <?php 
        if($transpo['keterangan_mobil'] == null){
            $keterangan_mobil = '-';
        } else if($transpo['keterangan_mobil'] != null){
            $keterangan_mobil = $transpo['keterangan_mobil'];
        }
    ?>
    Keterangan : <?php echo $keterangan_mobil ?>

    <?php 
        if($transpo['status_mobil'] == '0' && $transpo['batal_transportasi'] == '0'){
            $status_mobil = 'Belum Disetujui GS';
        } else if($transpo['status_mobil'] == '0' && $transpo['batal_transportasi'] == '1'){
            $status_mobil = 'Belum Disetujui GS';
        } else if($transpo['status_mobil'] == '0' && $transpo['batal_transportasi'] == '2'){
            $status_mobil = 'Transaksi dibatalkan';
        } else if($transpo['status_mobil'] == '1' && $transpo['batal_transportasi'] == '0'){
            $status_mobil = 'Disetujui GS';
        } else if($transpo['status_mobil'] == '1' && $transpo['batal_transportasi'] == '1'){
            $status_mobil = 'Disetujui GS';
        } else if($transpo['status_mobil'] == '1' && $transpo['batal_transportasi'] == '3'){
            $status_mobil = 'Transaksi dibatalkan';
        }
    ?>
    Status : <?php echo $status_mobil ?>
    <?php if($transpo['batal_transportasi'] == '1'){ ?>

    Permintaan Batal Transport : Belum Disetujui GS
    <?php } else if($transpo['batal_transportasi'] > '1'){ ?>

    <?php } else { ?>

    <?php } ?>
    <?php } else if ($transpo['jemput'] == 1) { ?>
    <?php foreach ($transportasi_jemput as $traj => $transpoaj) {?>
    <?php if ($transpoaj['id_trans'] == $transpo['id_trans']) { ?>
    Jemput
    PIC : <?php echo $transpo['pic'] ?>

    Pool : <?php echo $transpoaj['nama_pool'] ?>

    <?php 
        if($transpoaj['jenis_kendaraan'] == 's'){
            $jenis_kendaraan = 'Sedan';
        } else if($transpoaj['jenis_kendaraan'] == 'a'){
            $jenis_kendaraan = 'Station';
        } else if($transpoaj['jenis_kendaraan'] == 'p'){
            $jenis_kendaraan = 'Pick Up';
        } else if($transpoaj['jenis_kendaraan'] == 'b'){
            $jenis_kendaraan = 'Box';
        } else if($transpoaj['jenis_kendaraan'] == 't'){
            $jenis_kendaraan = 'Truck';
        }
    ?>
    Jenis Mobil : <?php echo $jenis_kendaraan ?>

    <?php 
        if($transpoaj['tenaga_angkut'] == '1'){
            $tenaga_angkut = 'Iya';
        } else {
            $tenaga_angkut = 'Tidak';
        }
    ?>
    Butuh Tenaga Angkut? : <?php echo $tenaga_angkut ?>

    <?php 
        if($transpoaj['dalkot_lukot'] == 'd'){
            $dalkot_lukot = 'Dalam Kota';
        } else if($transpoaj['dalkot_lukot'] == 'l'){
            $dalkot_lukot = 'Luar Kota';
        }
    ?>
    Dalam/Luar Kota : <?php echo $dalkot_lukot ?>

    <?php 
        if($transpoaj['menginap'] == '0'){
            $menginap = 'Tidak';
        } else if($transpoaj['menginap'] == '1'){
            $menginap = 'Iya';
        }
    ?>
    Menginap : <?php echo $menginap ?>

    Kapasitas : <?php echo $transpoaj['kapasitas'] ?>

    Jumlah : <?php echo $transpoaj['jumlah_mobil'] ?><?php echo ' buah' ?>

    Tanggal : <?php echo date_transaksi_kendaraan($transpoaj['tanggal_mobil']) ?>

    Tujuan : <?php echo $transpoaj['tujuan_mobil'] ?>

    Siap di : <?php echo $transpoaj['siap_di'] ?>

    Jam : <?php echo $transpoaj['jam_siap'] ?>

    Untuk : <?php echo $transpoaj['atas_nama'] ?>

    Jabatan : <?php echo $transpoaj['jabatan'] ?>

    <?php 
        if($transpoaj['keterangan_mobil'] == null){
            $keterangan_mobil = '-';
        } else if($transpoaj['keterangan_mobil'] != null){
            $keterangan_mobil = $transpoaj['keterangan_mobil'];
        }
    ?>
    Keterangan : <?php echo $keterangan_mobil ?>

    <?php 
        if($transpoaj['status_mobil'] == '0' && $transpoaj['batal_transportasi_jemput'] == '0'){
            $status_mobil = 'Belum Disetujui GS';
        } else if($transpoaj['status_mobil'] == '0' && $transpoaj['batal_transportasi_jemput'] == '1'){
            $status_mobil = 'Belum Disetujui GS';
        } else if($transpoaj['status_mobil'] == '0' && $transpoaj['batal_transportasi_jemput'] == '2'){
            $status_mobil = 'Transaksi dibatalkan';
        } else if($transpoaj['status_mobil'] == '1' && $transpoaj['batal_transportasi_jemput'] == '0'){
            $status_mobil = 'Disetujui GS';
        } else if($transpoaj['status_mobil'] == '1' && $transpoaj['batal_transportasi_jemput'] == '1'){
            $status_mobil = 'Disetujui GS';
        } else if($transpoaj['status_mobil'] == '1' && $transpoaj['batal_transportasi_jemput'] == '3'){
            $status_mobil = 'Transaksi dibatalkan';
        }
    ?>
    Status : <?php echo $status_mobil ?>
    <?php if($transpoaj['batal_transportasi_jemput'] == '1'){ ?>

    Permintaan Batal Transport : Belum Disetujui GS
    <?php } else if($transpoaj['batal_transportasi_jemput'] > '1'){ ?>

    <?php } else { ?>

    <?php } ?>
    <?php } ?>
    <?php } ?>
    <?php } else if ($transpo['jemput'] == 2) { ?>
    <?php foreach ($transportasi_antar_jemput as $trj => $transpoj) {?>
    <?php if ($transpoj['id_trans'] == $transpo['id_trans']) { ?>
    Antar
    PIC : <?php echo $transpo['pic'] ?>

    Pool : <?php echo $transpo['nama_pool'] ?>

    <?php 
        if($transpo['jenis_kendaraan'] == 's'){
            $jenis_kendaraan = 'Sedan';
        } else if($transpo['jenis_kendaraan'] == 'a'){
            $jenis_kendaraan = 'Station';
        } else if($transpo['jenis_kendaraan'] == 'p'){
            $jenis_kendaraan = 'Pick Up';
        } else if($transpo['jenis_kendaraan'] == 'b'){
            $jenis_kendaraan = 'Box';
        } else if($transpo['jenis_kendaraan'] == 't'){
            $jenis_kendaraan = 'Truck';
        }
    ?>
    Jenis Mobil : <?php echo $jenis_kendaraan ?>

    <?php 
        if($transpo['tenaga_angkut'] == '1'){
            $tenaga_angkut = 'Iya';
        } else {
            $tenaga_angkut = 'Tidak';
        }
    ?>
    Butuh Tenaga Angkut? : <?php echo $tenaga_angkut ?>

    <?php 
        if($transpo['dalkot_lukot'] == 'd'){
            $dalkot_lukot = 'Dalam Kota';
        } else if($transpo['dalkot_lukot'] == 'l'){
            $dalkot_lukot = 'Luar Kota';
        }
    ?>
    Dalam/Luar Kota : <?php echo $dalkot_lukot ?>

    <?php 
        if($transpo['menginap'] == '0'){
            $menginap = 'Tidak';
        } else if($transpo['menginap'] == '1'){
            $menginap = 'Iya';
        }
    ?>
    Menginap : <?php echo $menginap ?>

    Kapasitas : <?php echo $transpo['kapasitas'] ?>

    Jumlah : <?php echo $transpo['jumlah_mobil'] ?><?php echo ' buah' ?>

    Tanggal : <?php echo date_transaksi_kendaraan($transpo['tanggal_mobil']) ?>

    Tujuan : <?php echo $transpo['tujuan_mobil'] ?>

    Siap di : <?php echo $transpo['siap_di'] ?>

    Jam : <?php echo $transpo['jam_siap'] ?>

    Untuk : <?php echo $transpo['atas_nama'] ?>

    Jabatan : <?php echo $transpo['jabatan'] ?>

    <?php 
        if($transpo['keterangan_mobil'] == null){
            $keterangan_mobil = '-';
        } else if($transpo['keterangan_mobil'] != null){
            $keterangan_mobil = $transpo['keterangan_mobil'];
        }
    ?>
    Keterangan : <?php echo $keterangan_mobil ?>

    <?php 
        if($transpo['status_mobil'] == '0' && $transpo['batal_transportasi'] == '0'){
            $status_mobil = 'Belum Disetujui GS';
        } else if($transpo['status_mobil'] == '0' && $transpo['batal_transportasi'] == '1'){
            $status_mobil = 'Belum Disetujui GS';
        } else if($transpo['status_mobil'] == '0' && $transpo['batal_transportasi'] == '2'){
            $status_mobil = 'Transaksi dibatalkan';
        } else if($transpo['status_mobil'] == '1' && $transpo['batal_transportasi'] == '0'){
            $status_mobil = 'Disetujui GS';
        } else if($transpo['status_mobil'] == '1' && $transpo['batal_transportasi'] == '1'){
            $status_mobil = 'Disetujui GS';
        } else if($transpo['status_mobil'] == '1' && $transpo['batal_transportasi'] == '3'){
            $status_mobil = 'Transaksi dibatalkan';
        }
    ?>
    Status : <?php echo $status_mobil ?>
    <?php if($transpo['batal_transportasi'] == '1'){ ?>

    Permintaan Batal Transport : Belum Disetujui GS
    <?php } else if($transpo['batal_transportasi'] > '1'){ ?>

    <?php } else { ?>

    <?php } ?>

    Jemput
    PIC : <?php echo $transpo['pic'] ?>

    Pool : <?php echo $transpoj['nama_pool'] ?>

    <?php 
        if($transpoj['jenis_kendaraan'] == 's'){
            $jenis_kendaraan = 'Sedan';
        } else if($transpoj['jenis_kendaraan'] == 'a'){
            $jenis_kendaraan = 'Station';
        } else if($transpoj['jenis_kendaraan'] == 'p'){
            $jenis_kendaraan = 'Pick Up';
        } else if($transpoj['jenis_kendaraan'] == 'b'){
            $jenis_kendaraan = 'Box';
        } else if($transpoj['jenis_kendaraan'] == 't'){
            $jenis_kendaraan = 'Truck';
        }
    ?>
    Jenis Mobil : <?php echo $jenis_kendaraan ?>

    <?php 
        if($transpoj['tenaga_angkut'] == '1'){
            $tenaga_angkut = 'Iya';
        } else {
            $tenaga_angkut = 'Tidak';
        }
    ?>
    Butuh Tenaga Angkut? : <?php echo $tenaga_angkut ?>

    <?php 
        if($transpoj['dalkot_lukot'] == 'd'){
            $dalkot_lukot = 'Dalam Kota';
        } else if($transpoj['dalkot_lukot'] == 'l'){
            $dalkot_lukot = 'Luar Kota';
        }
    ?>
    Dalam/Luar Kota : <?php echo $dalkot_lukot ?>

    <?php 
        if($transpoj['menginap'] == '0'){
            $menginap = 'Tidak';
        } else if($transpoj['menginap'] == '1'){
            $menginap = 'Iya';
        }
    ?>
    Menginap : <?php echo $menginap ?>

    Kapasitas : <?php echo $transpoj['kapasitas'] ?>

    Jumlah : <?php echo $transpoj['jumlah_mobil'] ?><?php echo ' buah' ?>

    Tanggal : <?php echo date_transaksi_kendaraan($transpoj['tanggal_mobil']) ?>

    Tujuan : <?php echo $transpoj['tujuan_mobil'] ?>

    Siap di : <?php echo $transpoj['siap_di'] ?>

    Jam : <?php echo $transpoj['jam_siap'] ?>

    Untuk : <?php echo $transpoj['atas_nama'] ?>

    Jabatan : <?php echo $transpoj['jabatan'] ?>

    <?php 
        if($transpoj['keterangan_mobil'] == null){
            $keterangan_mobil = '-';
        } else if($transpoj['keterangan_mobil'] != null){
            $keterangan_mobil = $transpoj['keterangan_mobil'];
        }
    ?>
    Keterangan : <?php echo $keterangan_mobil ?>

    <?php 
        if($transpoj['status_mobil'] == '0' && $transpoj['batal_transportasi_jemput'] == '0'){
            $status_mobil = 'Belum Disetujui GS';
        } else if($transpoj['status_mobil'] == '0' && $transpoj['batal_transportasi_jemput'] == '1'){
            $status_mobil = 'Belum Disetujui GS';
        } else if($transpoj['status_mobil'] == '0' && $transpoj['batal_transportasi_jemput'] == '2'){
            $status_mobil = 'Transaksi dibatalkan';
        } else if($transpoj['status_mobil'] == '1' && $transpoj['batal_transportasi_jemput'] == '0'){
            $status_mobil = 'Disetujui GS';
        } else if($transpoj['status_mobil'] == '1' && $transpoj['batal_transportasi_jemput'] == '1'){
            $status_mobil = 'Disetujui GS';
        } else if($transpoj['status_mobil'] == '1' && $transpoj['batal_transportasi_jemput'] == '3'){
            $status_mobil = 'Transaksi dibatalkan';
        }
    ?>
    Status : <?php echo $status_mobil ?>
    <?php if($transpoj['batal_transportasi_jemput'] == '1'){ ?>

    Permintaan Batal Transport : Belum Disetujui GS
    <?php } else if($transpoj['batal_transportasi_jemput'] > '1'){ ?>

    <?php } else { ?>

    <?php } ?>
    <?php } ?>
    <?php } ?>
    <?php } ?>
    " style="text-decoration:none;-webkit-text-decoration:none;text-decoration:none;cursor:pointer;border-bottom:0;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none">
                                                                    <?php if ($transpo['jemput'] == 0) { ?>
                                                                        Antar<br>
                                                                        PIC : <?php echo $transpo['pic'] ?><br>
                                                                        Pool : <?php echo $transpo['nama_pool'] ?><br>
                                                                        <?php 
                                                                            if($transpo['jenis_kendaraan'] == 's'){
                                                                                $jenis_kendaraan = 'Sedan';
                                                                            } else if($transpo['jenis_kendaraan'] == 'a'){
                                                                                $jenis_kendaraan = 'Station';
                                                                            } else if($transpo['jenis_kendaraan'] == 'p'){
                                                                                $jenis_kendaraan = 'Pick Up';
                                                                            } else if($transpo['jenis_kendaraan'] == 'b'){
                                                                                $jenis_kendaraan = 'Box';
                                                                            } else if($transpo['jenis_kendaraan'] == 't'){
                                                                                $jenis_kendaraan = 'Truck';
                                                                            }
                                                                        ?>
                                                                        Jenis Mobil : <?php echo $jenis_kendaraan ?><br>
                                                                        <?php 
                                                                            if($transpo['tenaga_angkut'] == '1'){
                                                                                $tenaga_angkut = 'Iya';
                                                                            } else {
                                                                                $tenaga_angkut = 'Tidak';
                                                                            }
                                                                        ?>
                                                                        Butuh Tenaga Angkut? : <?php echo $tenaga_angkut ?><br>
                                                                        <?php 
                                                                            if($transpo['dalkot_lukot'] == 'd'){
                                                                                $dalkot_lukot = 'Dalam Kota';
                                                                            } else if($transpo['dalkot_lukot'] == 'l'){
                                                                                $dalkot_lukot = 'Luar Kota';
                                                                            }
                                                                        ?>
                                                                        Dalam/Luar Kota : <?php echo $dalkot_lukot ?><br>
                                                                        <?php 
                                                                            if($transpo['menginap'] == '0'){
                                                                                $menginap = 'Tidak';
                                                                            } else if($transpo['menginap'] == '1'){
                                                                                $menginap = 'Iya';
                                                                            }
                                                                        ?>
                                                                        Menginap : <?php echo $menginap ?><br>
                                                                        Kapasitas : <?php echo $transpo['kapasitas'] ?><br>
                                                                        Jumlah : <?php echo $transpo['jumlah_mobil'] ?><?php echo ' buah' ?><br>
                                                                        Tanggal : <?php echo date_transaksi_kendaraan($transpo['tanggal_mobil']) ?><br>
                                                                        Tujuan : <?php echo $transpo['tujuan_mobil'] ?><br>
                                                                        Siap di : <?php echo $transpo['siap_di'] ?><br>
                                                                        Jam : <?php echo $transpo['jam_siap'] ?><br>
                                                                        Untuk : <?php echo $transpo['atas_nama'] ?><br>
                                                                        Jabatan : <?php echo $transpo['jabatan'] ?><br>
                                                                        <?php 
                                                                            if($transpo['keterangan_mobil'] == null){
                                                                                $keterangan_mobil = '-';
                                                                            } else if($transpo['keterangan_mobil'] != null){
                                                                                $keterangan_mobil = $transpo['keterangan_mobil'];
                                                                            }
                                                                        ?>
                                                                        Keterangan : <?php echo $keterangan_mobil ?><br>
                                                                        <?php 
                                                                            if($transpo['status_mobil'] == '0' && $transpo['batal_transportasi'] == '0'){
                                                                                $status_mobil = 'Belum Disetujui GS';
                                                                            } else if($transpo['status_mobil'] == '0' && $transpo['batal_transportasi'] == '1'){
                                                                                $status_mobil = 'Belum Disetujui GS';
                                                                            } else if($transpo['status_mobil'] == '0' && $transpo['batal_transportasi'] == '2'){
                                                                                $status_mobil = 'Transaksi dibatalkan';
                                                                            } else if($transpo['status_mobil'] == '1' && $transpo['batal_transportasi'] == '0'){
                                                                                $status_mobil = 'Disetujui GS';
                                                                            } else if($transpo['status_mobil'] == '1' && $transpo['batal_transportasi'] == '1'){
                                                                                $status_mobil = 'Disetujui GS';
                                                                            } else if($transpo['status_mobil'] == '1' && $transpo['batal_transportasi'] == '3'){
                                                                                $status_mobil = 'Transaksi dibatalkan';
                                                                            }
                                                                        ?>
                                                                        Status : <?php echo $status_mobil ?><br>
                                                                        <?php if($transpo['batal_transportasi'] == '1'){ ?>
                                                                            Permintaan Batal Transport : Belum Disetujui GS<br>
                                                                        <?php } else if($transpo['batal_transportasi'] > '1'){ ?>

                                                                        <?php } else { ?>

                                                                        <?php } ?>
                                                                        </abbr>
                                                                        <?php if($transpo['batal_transportasi'] == '0'){ ?>
                                                                            <a class="btn btn-danger btn-lg mt-3 mb-3" href="<?php echo $batal_transportasi_antar?>" onclick="return confirm('Yakin akan mengajukan permintaan batal untuk transaksi ini?')" style="font-size:80%;">Ajukan Permintaan Batal</a>
                                                                        <?php } else { ?>
                                                                    
                                                                        <?php } ?>
                                                                    <?php } else if ($transpo['jemput'] == 1) { ?>
                                                                        <?php foreach ($transportasi_jemput as $trj => $transpoaj) {
                                                                            $id_transportasi_jemput = $transpoaj['id_transportasi_jemput'];
                                                                            $batal_transportasi_jemput = site_url("trans/?aksi=permintaan_batal_transportasi_jemput&id_trans=$id_trans&id_transportasi_jemput=$id_transportasi_jemput");
                                                                        ?>
                                                                            <?php if ($transpoaj['id_trans'] == $transpo['id_trans']) { ?>
                                                                                Jemput<br>
                                                                                PIC : <?php echo $transpo['pic'] ?><br>
                                                                                Pool : <?php echo $transpoaj['nama_pool'] ?><br>
                                                                                <?php 
                                                                                    if($transpoaj['jenis_kendaraan'] == 's'){
                                                                                        $jenis_kendaraan = 'Sedan';
                                                                                    } else if($transpoaj['jenis_kendaraan'] == 'a'){
                                                                                        $jenis_kendaraan = 'Station';
                                                                                    } else if($transpoaj['jenis_kendaraan'] == 'p'){
                                                                                        $jenis_kendaraan = 'Pick Up';
                                                                                    } else if($transpoaj['jenis_kendaraan'] == 'b'){
                                                                                        $jenis_kendaraan = 'Box';
                                                                                    } else if($transpoaj['jenis_kendaraan'] == 't'){
                                                                                        $jenis_kendaraan = 'Truck';
                                                                                    }
                                                                                ?>
                                                                                Jenis Mobil : <?php echo $jenis_kendaraan ?><br>
                                                                                <?php 
                                                                                    if($transpoaj['tenaga_angkut'] == '1'){
                                                                                        $tenaga_angkut = 'Iya';
                                                                                    } else {
                                                                                        $tenaga_angkut = 'Tidak';
                                                                                    }
                                                                                ?>
                                                                                Butuh Tenaga Angkut? : <?php echo $tenaga_angkut ?><br>
                                                                                <?php 
                                                                                    if($transpoaj['dalkot_lukot'] == 'd'){
                                                                                        $dalkot_lukot = 'Dalam Kota';
                                                                                    } else if($transpoaj['dalkot_lukot'] == 'l'){
                                                                                        $dalkot_lukot = 'Luar Kota';
                                                                                    }
                                                                                ?>
                                                                                Dalam/Luar Kota : <?php echo $dalkot_lukot ?><br>
                                                                                <?php 
                                                                                    if($transpoaj['menginap'] == '0'){
                                                                                        $menginap = 'Tidak';
                                                                                    } else if($transpoaj['menginap'] == '1'){
                                                                                        $menginap = 'Iya';
                                                                                    }
                                                                                ?>
                                                                                Menginap : <?php echo $menginap ?><br>
                                                                                Kapasitas : <?php echo $transpoaj['kapasitas'] ?><br>
                                                                                Jumlah : <?php echo $transpoaj['jumlah_mobil'] ?><?php echo ' buah' ?><br>
                                                                                Tanggal : <?php echo date_transaksi_kendaraan($transpoaj['tanggal_mobil']) ?><br>
                                                                                Tujuan : <?php echo $transpoaj['tujuan_mobil'] ?><br>
                                                                                Siap di : <?php echo $transpoaj['siap_di'] ?><br>
                                                                                Jam : <?php echo $transpoaj['jam_siap'] ?><br>
                                                                                Untuk : <?php echo $transpoaj['atas_nama'] ?><br>
                                                                                Jabatan : <?php echo $transpoaj['jabatan'] ?><br>
                                                                                <?php 
                                                                                    if($transpoaj['keterangan_mobil'] == null){
                                                                                        $keterangan_mobil = '-';
                                                                                    } else if($transpoaj['keterangan_mobil'] != null){
                                                                                        $keterangan_mobil = $transpoaj['keterangan_mobil'];
                                                                                    }
                                                                                ?>
                                                                                Keterangan : <?php echo $keterangan_mobil ?><br>
                                                                                <?php 
                                                                                    if($transpoaj['status_mobil'] == '0' && $transpoaj['batal_transportasi_jemput'] == '0'){
                                                                                        $status_mobil = 'Belum Disetujui GS';
                                                                                    } else if($transpoaj['status_mobil'] == '0' && $transpoaj['batal_transportasi_jemput'] == '1'){
                                                                                        $status_mobil = 'Belum Disetujui GS';
                                                                                    } else if($transpoaj['status_mobil'] == '0' && $transpoaj['batal_transportasi_jemput'] == '2'){
                                                                                        $status_mobil = 'Transaksi dibatalkan';
                                                                                    } else if($transpoaj['status_mobil'] == '1' && $transpoaj['batal_transportasi_jemput'] == '0'){
                                                                                        $status_mobil = 'Disetujui GS';
                                                                                    } else if($transpoaj['status_mobil'] == '1' && $transpoaj['batal_transportasi_jemput'] == '1'){
                                                                                        $status_mobil = 'Disetujui GS';
                                                                                    } else if($transpoaj['status_mobil'] == '1' && $transpoaj['batal_transportasi_jemput'] == '3'){
                                                                                        $status_mobil = 'Transaksi dibatalkan';
                                                                                    }
                                                                                ?>
                                                                                Status : <?php echo $status_mobil ?><br>
                                                                                <?php if($transpoaj['batal_transportasi_jemput'] == '1'){ ?>
                                                                                    Permintaan Batal Transport : Belum Disetujui GS<br>
                                                                                <?php } else if($transpoaj['batal_transportasi_jemput'] > '1'){ ?>

                                                                                <?php } else { ?>

                                                                                <?php } ?>
                                                                                </abbr>
                                                                                <?php if($transpoaj['batal_transportasi_jemput'] == '0'){ ?>
                                                                                    <a class="btn btn-danger btn-lg mt-3 mb-3" href="<?php echo $batal_transportasi_jemput?>" onclick="return confirm('Yakin akan mengajukan permintaan batal untuk transaksi ini?')" style="font-size:80%;">Ajukan Permintaan Batal</a>
                                                                                <?php } else { ?>
                                                                            
                                                                                <?php } ?>
                                                                            <?php } ?>
                                                                        <?php } ?>
                                                                    <?php } else if ($transpo['jemput'] == 2) { ?>
                                                                        <?php foreach ($transportasi_antar_jemput as $traj => $transpoj) {
                                                                            $id_transportasi = $transpoj['id_transportasi'];
                                                                            $id_transportasi_jemput = $transpoj['id_transportasi_jemput'];
                                                                            $batal_transportasi_antar_jemput = site_url("trans/?aksi=permintaan_batal_transportasi_antar_jemput&id_trans=$id_trans&id_transportasi=$id_transportasi&id_transportasi_jemput=$id_transportasi_jemput");
                                                                        ?>
                                                                            <?php if ($transpoj['id_trans'] == $transpo['id_trans']) { ?>
                                                                                Antar<br>
                                                                                PIC : <?php echo $transpo['pic'] ?><br>
                                                                                Pool : <?php echo $transpo['nama_pool'] ?><br>
                                                                                <?php 
                                                                                    if($transpo['jenis_kendaraan'] == 's'){
                                                                                        $jenis_kendaraan = 'Sedan';
                                                                                    } else if($transpo['jenis_kendaraan'] == 'a'){
                                                                                        $jenis_kendaraan = 'Station';
                                                                                    } else if($transpo['jenis_kendaraan'] == 'p'){
                                                                                        $jenis_kendaraan = 'Pick Up';
                                                                                    } else if($transpo['jenis_kendaraan'] == 'b'){
                                                                                        $jenis_kendaraan = 'Box';
                                                                                    } else if($transpo['jenis_kendaraan'] == 't'){
                                                                                        $jenis_kendaraan = 'Truck';
                                                                                    }
                                                                                ?>
                                                                                Jenis Mobil : <?php echo $jenis_kendaraan ?><br>
                                                                                <?php 
                                                                                    if($transpo['tenaga_angkut'] == '1'){
                                                                                        $tenaga_angkut = 'Iya';
                                                                                    } else {
                                                                                        $tenaga_angkut = 'Tidak';
                                                                                    }
                                                                                ?>
                                                                                Butuh Tenaga Angkut? : <?php echo $tenaga_angkut ?><br>
                                                                                <?php 
                                                                                    if($transpo['dalkot_lukot'] == 'd'){
                                                                                        $dalkot_lukot = 'Dalam Kota';
                                                                                    } else if($transpo['dalkot_lukot'] == 'l'){
                                                                                        $dalkot_lukot = 'Luar Kota';
                                                                                    }
                                                                                ?>
                                                                                Dalam/Luar Kota : <?php echo $dalkot_lukot ?><br>
                                                                                <?php 
                                                                                    if($transpo['menginap'] == '0'){
                                                                                        $menginap = 'Tidak';
                                                                                    } else if($transpo['menginap'] == '1'){
                                                                                        $menginap = 'Iya';
                                                                                    }
                                                                                ?>
                                                                                Menginap : <?php echo $menginap ?><br>
                                                                                Kapasitas : <?php echo $transpo['kapasitas'] ?><br>
                                                                                Jumlah : <?php echo $transpo['jumlah_mobil'] ?><?php echo ' buah' ?><br>
                                                                                Tanggal : <?php echo date_transaksi_kendaraan($transpo['tanggal_mobil']) ?><br>
                                                                                Tujuan : <?php echo $transpo['tujuan_mobil'] ?><br>
                                                                                Siap di : <?php echo $transpo['siap_di'] ?><br>
                                                                                Jam : <?php echo $transpo['jam_siap'] ?><br>
                                                                                Untuk : <?php echo $transpo['atas_nama'] ?><br>
                                                                                Jabatan : <?php echo $transpo['jabatan'] ?><br>
                                                                                <?php 
                                                                                    if($transpo['keterangan_mobil'] == null){
                                                                                        $keterangan_mobil = '-';
                                                                                    } else if($transpo['keterangan_mobil'] != null){
                                                                                        $keterangan_mobil = $transpo['keterangan_mobil'];
                                                                                    }
                                                                                ?>
                                                                                Keterangan : <?php echo $keterangan_mobil ?><br>
                                                                                <?php
                                                                                    if($transpo['status_mobil'] == '0'){
                                                                                        $status_mobil = 'Belum Disetujui GS';
                                                                                    } else if($transpo['status_mobil'] == '1'){
                                                                                        $status_mobil = 'Disetujui GS';
                                                                                    }
                                                                                ?>

                                                                                Status : <?php echo $status_mobil ?><br><br>

                                                                                Jemput<br>
                                                                                PIC : <?php echo $transpo['pic'] ?><br>
                                                                                Pool : <?php echo $transpoj['nama_pool'] ?><br>
                                                                                <?php 
                                                                                    if($transpoj['jenis_kendaraan'] == 's'){
                                                                                        $jenis_kendaraan = 'Sedan';
                                                                                    } else if($transpoj['jenis_kendaraan'] == 'a'){
                                                                                        $jenis_kendaraan = 'Station';
                                                                                    } else if($transpoj['jenis_kendaraan'] == 'p'){
                                                                                        $jenis_kendaraan = 'Pick Up';
                                                                                    } else if($transpoj['jenis_kendaraan'] == 'b'){
                                                                                        $jenis_kendaraan = 'Box';
                                                                                    } else if($transpoj['jenis_kendaraan'] == 't'){
                                                                                        $jenis_kendaraan = 'Truck';
                                                                                    }
                                                                                ?>
                                                                                Jenis Mobil : <?php echo $jenis_kendaraan ?><br>
                                                                                <?php 
                                                                                    if($transpoj['tenaga_angkut'] == '1'){
                                                                                        $tenaga_angkut = 'Iya';
                                                                                    } else {
                                                                                        $tenaga_angkut = 'Tidak';
                                                                                    }
                                                                                ?>
                                                                                Butuh Tenaga Angkut? : <?php echo $tenaga_angkut ?><br>
                                                                                <?php 
                                                                                    if($transpoj['dalkot_lukot'] == 'd'){
                                                                                        $dalkot_lukot = 'Dalam Kota';
                                                                                    } else if($transpoj['dalkot_lukot'] == 'l'){
                                                                                        $dalkot_lukot = 'Luar Kota';
                                                                                    }
                                                                                ?>
                                                                                Dalam/Luar Kota : <?php echo $dalkot_lukot ?><br>
                                                                                <?php 
                                                                                    if($transpoj['menginap'] == '0'){
                                                                                        $menginap = 'Tidak';
                                                                                    } else if($transpoj['menginap'] == '1'){
                                                                                        $menginap = 'Iya';
                                                                                    }
                                                                                ?>
                                                                                Menginap : <?php echo $menginap ?><br>
                                                                                Kapasitas : <?php echo $transpoj['kapasitas'] ?><br>
                                                                                Jumlah : <?php echo $transpoj['jumlah_mobil'] ?><?php echo ' buah' ?><br>
                                                                                Tanggal : <?php echo date_transaksi_kendaraan($transpoj['tanggal_mobil']) ?><br>
                                                                                Tujuan : <?php echo $transpoj['tujuan_mobil'] ?><br>
                                                                                Siap di : <?php echo $transpoj['siap_di'] ?><br>
                                                                                Jam : <?php echo $transpoj['jam_siap'] ?><br>
                                                                                Untuk : <?php echo $transpoj['atas_nama'] ?><br>
                                                                                Jabatan : <?php echo $transpoj['jabatan'] ?><br>
                                                                                <?php 
                                                                                    if($transpoj['keterangan_mobil'] == null){
                                                                                        $keterangan_mobil = '-';
                                                                                    } else if($transpoj['keterangan_mobil'] != null){
                                                                                        $keterangan_mobil = $transpoj['keterangan_mobil'];
                                                                                    }
                                                                                ?>
                                                                                Keterangan : <?php echo $keterangan_mobil ?><br>
                                                                                <?php 
                                                                                    if($transpoj['status_mobil'] == '0' && $transpoj['batal_transportasi_jemput'] == '0'){
                                                                                        $status_mobil = 'Belum Disetujui GS';
                                                                                    } else if($transpoj['status_mobil'] == '0' && $transpoj['batal_transportasi_jemput'] == '1'){
                                                                                        $status_mobil = 'Belum Disetujui GS';
                                                                                    } else if($transpoj['status_mobil'] == '0' && $transpoj['batal_transportasi_jemput'] == '2'){
                                                                                        $status_mobil = 'Transaksi dibatalkan';
                                                                                    } else if($transpoj['status_mobil'] == '1' && $transpoj['batal_transportasi_jemput'] == '0'){
                                                                                        $status_mobil = 'Disetujui GS';
                                                                                    } else if($transpoj['status_mobil'] == '1' && $transpoj['batal_transportasi_jemput'] == '1'){
                                                                                        $status_mobil = 'Disetujui GS';
                                                                                    } else if($transpoj['status_mobil'] == '1' && $transpoj['batal_transportasi_jemput'] == '3'){
                                                                                        $status_mobil = 'Transaksi dibatalkan';
                                                                                    }
                                                                                ?>
                                                                                Status : <?php echo $status_mobil ?><br>
                                                                                <?php if($transpoj['batal_transportasi_jemput'] == '1'){ ?>
                                                                                    Permintaan Batal Transport : Belum Disetujui GS<br>
                                                                                <?php } else if($transpoj['batal_transportasi_jemput'] > '1'){ ?>

                                                                                <?php } else { ?>

                                                                                <?php } ?>
                                                                                </abbr>
                                                                                <?php if($transpoj['batal_transportasi_jemput'] == '0'){ ?>
                                                                                    <a class="btn btn-danger btn-lg mt-3 mb-3" href="<?php echo $batal_transportasi_antar_jemput?>" onclick="return confirm('Yakin akan mengajukan permintaan batal untuk transaksi ini?')" style="font-size:80%;">Ajukan Permintaan Batal</a>
                                                                                <?php } else { ?>
                                                                            
                                                                                <?php } ?>
                                                                            <?php } ?>
                                                                        <?php } ?>
                                                                    <?php } ?>
                                                                <?php } else { ?>
                                                                    
                                                                <?php } ?>
                                                            <?php } ?>
                                                        </td>
                                                    </tr>
                                                <?php } ?>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="content-footer footer bg-footer-theme">
            <div class="container-xxl d-flex flex-wrap justify-content-center">
                <div class="mb-2 mb-md-0">
                    Copyright &copy; <strong><span>MIS 2024</span></strong>.
                </div>
            </div>
        </footer>
        <!-- / Footer -->

        <div class="content-backdrop fade"></div>
</div>
<!-- Content wrapper -->

<!-- Content wrapper -->
<div class="content-wrapper">
    <div class="container-xxl flex-grow-1 container-p-y">
        <?php
        $session = \Config\Services::session();
        if($session->getFlashdata('warning')) {
        ?>
        <div class="alert alert-warning">
            <ul>
                <?php
                    foreach($session->getFlashdata('warning') as $val) {
                    ?>
                <li><?php echo $val ?></li>
                <?php
                    }
                    ?>
            </ul>
        </div>
        <?php
        }
        if($session->getFlashdata('success')) {
        ?>
        <div class="alert alert-success"><?php echo $session->getFlashdata('success')?></div>
        <?php
        }
        ?>
        <div class="row">
            <div class="col-lg-12 order-0">
                <div class="card">
                    <div class="d-flex align-items-center row">
                        <div class="col-sm-12">
                            <div class="card-body">
                                <h1>Transaksi</h1>
                                <a class="btn btn-secondary mb-3" href="trans" style="font-size:120%;"><i class="fa-solid fa-left-long"></i> Kembali</a>
                                <button id="add_item_btn" class="btn btn-success add_item_btn mb-3" style="font-size:120%;"><i class="fa-solid fa-plus"></i> Tambah Personil</button>
                                <button id="remove_item_btn" class="btn btn-danger mb-3" style="font-size:120%;"><i class="fa-solid fa-minus"></i> Hapus Personil</button>
                                <section id="features" class="features"  style="font-size:150%;">
                                    <ul class="nav nav-tabs row g-2 d-flex mb-3">
                                        <li class="nav-item col-3">
                                            <a class="nav-link active show" data-bs-toggle="tab"
                                                data-bs-target="#tab_start">
                                                <h3>Personil</h3>
                                            </a>
                                        </li>
                                        <!-- End tab nav item -->

                                        <li id="modal_tiket" style="display:none;" class="nav-item col-3">
                                            <a class="nav-link" data-bs-toggle="tab"
                                                data-bs-target="#tab_tiket">
                                                <h3>Tiket</h3>
                                            </a>
                                        </li>
                                        <!-- End tab nav item -->

                                        <li id="modal_hotel" style="display:none;" class="nav-item col-3">
                                            <a class="nav-link" data-bs-toggle="tab"
                                                data-bs-target="#tab_hotel">
                                                <h3>Hotel</h3>
                                            </a>
                                        </li>
                                        <!-- End tab nav item -->

                                        <li id="modal_mobil" style="display:none;" class="nav-item col-3">
                                            <a class="nav-link" data-bs-toggle="tab"
                                                data-bs-target="#tab_mobil">
                                                <h3>Mobil</h3>
                                            </a>
                                        </li>
                                        <!-- End tab nav item -->

                                        <li id="modal_confirm" style="display:none;" class="nav-item col-3">
                                            <a class="nav-link" data-bs-toggle="tab"
                                                data-bs-target="#tab_confirm">
                                                <h3>Confirm</h3>
                                            </a>
                                        </li>
                                        <!-- End tab nav item -->
                                    </ul>
                                    <form action="" method="post" enctype="multipart/form-data">
                                        <div class="modal-body">
                                            <div class="tab-content">
                                                <div class="tab-pane active show" id="tab_start" style="font-size:120%">
                                                    <!-- <input autocomplete="off" type="text" class="form-control" name="jabatan[]" id="jabatan" style="text-transform:uppercase" oninput="this.value = this.value.toUpperCase()"> -->

                                                    <!-- <div class="mb-1 mt-3">
                                                        PIC
                                                    </div>

                                                    <input autocomplete="off" type="text" class="form-control" name="pic[]" id="pic" style="text-transform:capitalize"> -->

                                                    <!-- <div id="show_pic">
                                                    </div> -->
                                                    <div class="mb-1">
                                                        Pemesanan
                                                    </div>
                                                    <select id="test" name="pemesanan" onchange="showDiv(this)"
                                                        style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                        <option value="pilih">-- pilih salah satu --</option>
                                                        <option value="0">Tiket</option>
                                                        <option value="1">Hotel</option>
                                                        <option value="2">Mobil</option>
                                                        <option value="3">Tiket + Hotel</option>
                                                        <option value="4">Tiket + Mobil</option>
                                                        <option value="5">Hotel + Mobil</option>
                                                        <option value="6">Tiket + Hotel + Mobil</option>
                                                    </select>
                                                    <script>
                                                        function showDiv(select) {
                                                            if (select.value == 'pilih') {
                                                                document.getElementById('modal_tiket').style
                                                                    .display = "none";
                                                                document.getElementById('modal_hotel').style
                                                                    .display = "none";
                                                                document.getElementById('modal_mobil').style
                                                                    .display = "none"
                                                                document.getElementById('modal_confirm').style
                                                                    .display = "none";
                                                            } else if (select.value == 0) {
                                                                document.getElementById('modal_tiket').style
                                                                    .display = "block";
                                                                document.getElementById('modal_hotel').style
                                                                    .display = "none";
                                                                document.getElementById('modal_mobil').style
                                                                    .display = "none"
                                                                document.getElementById('modal_confirm').style
                                                                    .display = "block";
                                                            } else if (select.value == 1) {
                                                                document.getElementById('modal_tiket').style
                                                                    .display = "none";
                                                                document.getElementById('modal_hotel').style
                                                                    .display = "block";
                                                                document.getElementById('modal_mobil').style
                                                                    .display = "none"
                                                                document.getElementById('modal_confirm').style
                                                                    .display = "block";
                                                            } else if (select.value == 2) {
                                                                document.getElementById('modal_tiket').style
                                                                    .display = "none";
                                                                document.getElementById('modal_hotel').style
                                                                    .display = "none";
                                                                document.getElementById('modal_mobil').style
                                                                    .display = "block";
                                                                document.getElementById('modal_confirm').style
                                                                    .display = "block";
                                                            } else if (select.value == 3) {
                                                                document.getElementById('modal_tiket').style
                                                                    .display = "block";
                                                                document.getElementById('modal_hotel').style
                                                                    .display = "block";
                                                                document.getElementById('modal_mobil').style
                                                                    .display = "none"
                                                                document.getElementById('modal_confirm').style
                                                                    .display = "block";
                                                            } else if (select.value == 4) {
                                                                document.getElementById('modal_tiket').style
                                                                    .display = "block";
                                                                document.getElementById('modal_hotel').style
                                                                    .display = "none";
                                                                document.getElementById('modal_mobil').style
                                                                    .display = "block";
                                                                document.getElementById('modal_confirm').style
                                                                    .display = "block";
                                                            } else if (select.value == 5) {
                                                                document.getElementById('modal_tiket').style
                                                                    .display = "none";
                                                                document.getElementById('modal_hotel').style
                                                                    .display = "block";
                                                                document.getElementById('modal_mobil').style
                                                                    .display = "block";
                                                                document.getElementById('modal_confirm').style
                                                                    .display = "block";
                                                            } else if (select.value == 6) {
                                                                document.getElementById('modal_tiket').style
                                                                    .display = "block";
                                                                document.getElementById('modal_hotel').style
                                                                    .display = "block";
                                                                document.getElementById('modal_mobil').style
                                                                    .display = "block";
                                                                document.getElementById('modal_confirm').style
                                                                    .display = "block";
                                                            }
                                                        }
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Tamu/Non Tamu
                                                    </div>

                                                    <div class="row">
                                                        <div class="col-md-12">
                                                            <select class="select_tamu" id="tamu" name="tamu[]" style="width: 100%;" onchange="showTamu(this)"></select>
                                                        </div>
                                                    </div>

                                                    <script>
                                                    $(document).ready(function() {
                                                        var data_select = ['Non Tamu', 'Tamu']

                                                        $(".select_tamu").select2({
                                                            data: data_select,
                                                            // tags: true,
                                                            // tokenSeparators: [',', ' '],
                                                        });

                                                        $('select:not(.normal)').each(function() {
                                                            $(this).select2({
                                                                // tags: true,
                                                                dropdownParent: $(this)
                                                                    .parent()
                                                            });
                                                        });
                                                    });
                                                    </script>

                                                    <div id="show_tamu">
                                                    </div>

                                                    <div id="show_script_tamu">
                                                    </div>

                                                    <script>
                                                        function showTamu(select) {
                                                            if (select.value == 'Non Tamu') {
                                                                document.getElementById('nama').style.display =
                                                                    "block";
                                                                document.getElementById('jabatan').style.display =
                                                                    "block";
                                                            } else if (select.value == 'Tamu') {
                                                                document.getElementById('nama').style.display =
                                                                    "none";
                                                                document.getElementById('jabatan').style.display =
                                                                    "none";
                                                            }
                                                        }
                                                    </script>

                                                    <div class="row">
                                                        <div class="col-md-12">
                                                            <div class="mt-3" id="nama" style="display:block;">
                                                                <div>
                                                                    Nama
                                                                </div>
                                                                
                                                                <div class="row">
                                                                    <div class="col-md-12">
                                                                        <select class="select_nama" id="nama" name="nama[]" style="width: 100%;"></select>
                                                                    </div>
                                                                </div>
                                                                
                                                                <script>
                                                                    $(document).ready(function() {
                                                                        var data_select = [
                                                                            <?php foreach ($pengguna as $peng) : ?> "<?php echo $peng['nama_pengguna']?>",
                                                                            <?php endforeach ?>
                                                                        ]

                                                                        $(".select_nama").select2({
                                                                            data: data_select,
                                                                            // tags: true,
                                                                            // tags:["Semua"],
                                                                            // tokenSeparators: [',', ' '],
                                                                        });
                                                                    });
                                                                </script>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div id="show_nama">
                                                    </div>

                                                    <div class="row">
                                                        <div class="col-md-12">
                                                            <div class="mt-3" id="jabatan" style="display:block;">
                                                                <div>
                                                                    Jabatan
                                                                </div>
                                                                <div class="row">
                                                                    <div class="col-md-12">
                                                                        <select class="select_jabatan" id="jabatan" name="jabatan[]" style="width: 100%;"></select>
                                                                    </div>
                                                                </div>
                                                                
                                                                <script>
                                                                    $(document).ready(function() {
                                                                        var data_select = [
                                                                            //     <php foreach ($bag as $bag) : ?> "<php echo $bag['strorgnm']?>",
                                                                            //     <php endforeach ?>
                                                                            'Direksi', 'Manager', 'Officer', 'Supervisor', 'Pelaksana'
                                                                        ]

                                                                        $(".select_jabatan").select2({
                                                                            // tags:["Semua"],
                                                                            data: data_select,
                                                                            // tags: true,
                                                                            // tokenSeparators: [',', ' '],
                                                                        });
                                                                    });
                                                                </script>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div id="show_jabatan">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Email Informasi
                                                    </div>
                                                    
                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_email_info" id="email_info" name="email_info[]" style="width: 100%;" data-select2-tags="false"></select>
                                                        </div>
                                                    </div>
                                                    
                                                    <div id="show_email_info">
                                                    </div>

                                                    <script>
                                                        $(document).ready(function() {
                                                            var data_select = [
                                                                <?php foreach ($pengguna as $peng) : ?> "<?php echo $peng['nama_pengguna']?>",
                                                                <?php endforeach ?>
                                                            ]

                                                            $(".select_email_info").select2({
                                                                // tags:["Semua"],
                                                                data: data_select,
                                                                // tags: true,
                                                                // tokenSeparators: [',', ' '],
                                                            });
                                                        });
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Email Evaluasi
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_email_eval" id="email_eval" name="email_eval[]" style="width: 100%;"></select>
                                                        </div>
                                                    </div>
                                                    
                                                    <div id="show_email_eval">
                                                    </div>

                                                    <script>
                                                    $(document).ready(function() {
                                                        var data_select = [
                                                            <?php foreach ($pengguna as $peng) : ?> "<?php echo $peng['nama_pengguna']?>",
                                                            <?php endforeach ?>
                                                        ]

                                                        $(".select_email_eval").select2({
                                                            // tags:["Semua"],
                                                            data: data_select,
                                                            // tags: true,
                                                            // tokenSeparators: [',', ' '],
                                                        });
                                                    });
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Pembayaran
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_pembayaran" id="pembayaran" name="pembayaran[]" style="width: 100%;"></select>
                                                        </div>
                                                    </div>

                                                    <div id="show_pembayaran">
                                                    </div>

                                                    <script>
                                                    $(document).ready(function() {
                                                        var data_select = ['Company Acc', 'Personal Acc']

                                                        $(".select_pembayaran").select2({
                                                            data: data_select,
                                                            // tags: true,
                                                            // tokenSeparators: [',', ' '],
                                                        });
                                                    });
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        PIC
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_pic" id="pic" name="pic[]" style="width: 100%;"></select>
                                                        </div>
                                                    </div>

                                                    <div id="show_pic">
                                                    </div>

                                                    <script>
                                                    $(document).ready(function() {
                                                        var data_select = [
                                                            <?php foreach ($pengguna as $peng) : ?> "<?php echo $peng['nama_pengguna']?>",
                                                            <?php endforeach ?>'Tamu'
                                                        ]

                                                        $(".select_pic").select2({
                                                            data: data_select,
                                                            // tags: true,
                                                            // tokenSeparators: [',', ' '],
                                                        });

                                                        $('select:not(.normal)').each(function() {
                                                            $(this).select2({
                                                                // tags: true,
                                                                dropdownParent: $(this)
                                                                    .parent()
                                                            });
                                                        });
                                                    });
                                                    </script>

                                                    <script>
                                                        $(document).keypress(function(event){
                                                            if (event.which == '13') {
                                                            event.preventDefault();
                                                            }
                                                        });
                                                    </script>

                                                    <div class="modal-footer">
                                                    </div>
                                                </div>

                                                <div class="tab-pane" id="tab_tiket" style="font-size:120%">
                                                    <!-- <div class="mb-1 mt-3">
                                                        Tiket
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_tiket" name="tiket[]" style="width: 100%">
                                                                <optgroup label = "Bus">
                                                                    <php foreach ($bus as $b => $bu) {?>
                                                                        <option>
                                                                            <php echo $bu['nama_vendor']?>
                                                                        </option>
                                                                    <php } ?>
                                                                </optgroup>
                                                                <optgroup label = "Kereta Api">
                                                                    <php foreach ($kereta as $k => $ker) {?>
                                                                        <option>
                                                                            <php echo $ker['nama_vendor']?>
                                                                        </option>
                                                                    <php } ?>
                                                                </optgroup>
                                                                <optgroup label = "Pesawat">
                                                                    <php foreach ($pesawat as $p => $pes) {?>
                                                                        <option>
                                                                            <php echo $pes['nama_vendor']?>
                                                                        </option>
                                                                    <php } ?>
                                                                </optgroup>
                                                                <optgroup label = "Travel">
                                                                    <php foreach ($travel as $t => $tra) {?>
                                                                        <option>
                                                                            <php echo $tra['nama_vendor']?>
                                                                        </option>
                                                                    <php } ?>
                                                                </optgroup>
                                                                <optgroup label = "Kapal Laut">
                                                                    <php foreach ($kapal_laut as $ka => $kap) {?>
                                                                        <option>
                                                                            <php echo $kap['nama_vendor']?>
                                                                        </option>
                                                                    <php } ?>
                                                                </optgroup>
                                                            </select>
                                                        </div>
                                                    </div>

                                                    <div id="show_tiket">
                                                    </div> -->

                                                    <!-- <div class="mb-1 mt-3">
                                                        Pemberhentian
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_pemberhentian" id="pemberhentian" name="pemberhentian[]" style="width: 100%">
                                                                <optgroup label = "Bandara">
                                                                    <php foreach ($bandara as $b => $ba) {?>
                                                                        <option>
                                                                            <php echo $ba['nama_pemberhentian']?> <php echo "-" ?> <php echo $ba['nama_kota']?>
                                                                        </option>
                                                                    <php } ?>
                                                                </optgroup>
                                                                <optgroup label = "Pelabuhan">
                                                                    <php foreach ($pelabuhan as $p => $pe) {?>
                                                                        <option>
                                                                            <php echo $pe['nama_pemberhentian']?> <php echo "-" ?> <php echo $pe['nama_kota']?>
                                                                        </option>
                                                                    <php } ?>
                                                                </optgroup>
                                                                <optgroup label = "Stasiun">
                                                                    <php foreach ($stasiun as $s => $st) {?>
                                                                        <option>
                                                                            <php echo $st['nama_pemberhentian']?> <php echo "-" ?> <php echo $st['nama_kota']?>
                                                                        </option>
                                                                    <php } ?>
                                                                </optgroup>
                                                                <optgroup label = "Terminal">
                                                                    <php foreach ($terminal as $t => $te) {?>
                                                                        <option>
                                                                            <php echo $te['nama_pemberhentian']?> <php echo "-" ?> <php echo $te['nama_kota']?>
                                                                        </option>
                                                                    <php } ?>
                                                                </optgroup>
                                                            </select>
                                                        </div>
                                                    </div>

                                                    <div id="show_pemberhentian">
                                                    </div> -->

                                                    <!-- <div class="mb-1 mt-3">
                                                        Dari
                                                    </div>
                                                    
                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_dari" id="dari_tiket" name="dari_tiket[]" style="width: 100%">
                                                                <php foreach ($negara as $n => $neg) {?>
                                                                    <optgroup label=<php echo $neg['nama_negara'] ?>>
                                                                        <php foreach ($kota as $k => $kot) {?>
                                                                            <php if ($neg['id_negara'] == $kot['id_negara']) { ?>
                                                                                <option><php echo $kot['nama_kota'] ?></option>
                                                                            <php } ?>
                                                                        <php } ?>
                                                                    </optgroup>
                                                                <php } ?>
                                                            </select>
                                                        </div>
                                                    </div>

                                                    <div id="show_dari_tiket">
                                                    </div>

                                                    <script>
                                                    $(document).ready(function() {
                                                        var options = {}
                                                        var $select2 = $('.select_dari').select2(
                                                            options);
                                                        $select2.on('select2:select', function(e) {
                                                            var data = e.params.data;

                                                            var text = data.text;
                                                        });
                                                    });
                                                    </script> -->

                                                    <!-- <div class="mb-1 mt-3">
                                                        Tujuan
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_tujuan" id="tujuan_tiket" name="tujuan_tiket[]" style="width: 100%">
                                                                <php foreach ($negara as $n => $neg) {?>
                                                                    <optgroup label=<php echo $neg['nama_negara'] ?>>
                                                                        <php foreach ($kota as $k => $kot) {?>
                                                                            <php if ($neg['id_negara'] == $kot['id_negara']) { ?>
                                                                                <option><php echo $kot['nama_kota'] ?></option>
                                                                            <php } ?>
                                                                        <php } ?>
                                                                    </optgroup>
                                                                <php } ?>
                                                            </select>
                                                        </div>
                                                    </div>

                                                    <div id="show_tujuan_tiket">
                                                    </div>

                                                    <script>
                                                    $(document).ready(function() {
                                                        var options = {}
                                                        var $select2 = $('.select_tujuan').select2(
                                                            options);
                                                        $select2.on('select2:select', function(e) {
                                                            var data = e.params.data;

                                                            var text = data.text;
                                                        });
                                                    });
                                                    </script> -->

                                                    <!-- <div class="mb-1 mt-3">
                                                        Pilihan Bandara/Pelabuhan/Stasiun/Terminal
                                                    </div>

                                                    <div class="row">
                                                        <div class="col-md-12">
                                                            <select class="select_tempat" id="tempat" name="tempat[]" style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                                <option value="0">-- pilih salah satu --</option>
                                                                <option>Bandara</option>
                                                                <option>Pelabuhan</option>
                                                                <option>Stasiun</option>
                                                                <option>Terminal</option>
                                                            </select>
                                                        </div>
                                                    </div>

                                                    <div id="show_select_tempat">
                                                    </div> -->
                                                    
                                                    <div class="mb-1">
                                                        GS
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_gs_tiket" id="gs_tiket" name="gs_tiket[]" style="width: 100%;"></select>
                                                        </div>
                                                    </div>

                                                    <div id="show_gs_tiket">
                                                    </div>

                                                    <script>
                                                        $(document).ready(function() {
                                                            var data_select = [
                                                                <?php foreach ($pool as $poo) : ?> "<?php echo $poo['nama_pool']?>",
                                                                <?php endforeach ?>
                                                            ]

                                                            $(".select_gs_tiket").select2({
                                                                data: data_select,
                                                                // tags: true,
                                                                // tokenSeparators: [',', ' '],
                                                            });
                                                        });
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Pilihan Armada Transportasi
                                                    </div>

                                                    <div class="row">
                                                        <div class="col-md-12">
                                                            <select class="select_pilihan_tiket" id="pilihan_tiket" name="pilihan_tiket[]" style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                                <option value="0">-- pilih salah satu --</option>
                                                                <option>Bis</option>
                                                                <option>Kereta Api</option>
                                                                <option>Pesawat</option>
                                                                <option>Travel</option>
                                                                <option>Kapal Laut</option>
                                                            </select>
                                                        </div>
                                                    </div>

                                                    <div id="show_pilihan_tiket">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Tiket
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_tiket" id="tiket" name="tiket[]" style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                                <option>-- pilih armada transportasi terlebih dahulu --</option>
                                                            </select>
                                                        </div>
                                                    </div>

                                                    <div id="show_tiket">
                                                    </div>

                                                    <div id="show_script_tiket">
                                                    </div>

                                                    <script>
                                                        $(".select_pilihan_tiket").change(function() {
                                                            var val = $(this).val();

                                                            if (val == "Bis") {
                                                                $(".select_tiket").html(
                                                                    <?php if (empty($bus)) {?>
                                                                        "<option>Tidak ada data</option>"
                                                                    <?php } else { ?>
                                                                        "<?php foreach ($bus as $b => $bu) {?><option><?php echo $bu['nama_vendor']?></option><?php } ?>"
                                                                    <?php } ?>
                                                                );
                                                            } else if (val == "Kereta Api") {
                                                                $(".select_tiket").html(
                                                                    <?php if (empty($kereta)) {?>
                                                                        "<option>Tidak ada data</option>"
                                                                    <?php } else { ?>
                                                                        "<?php foreach ($kereta as $k => $ker) {?><option><?php echo $ker['nama_vendor']?></option><?php } ?>"
                                                                    <?php } ?>
                                                                );
                                                            } else if (val == "Pesawat") {
                                                                $(".select_tiket").html(
                                                                    <?php if (empty($pesawat)) {?>
                                                                        "<option>Tidak ada data</option>"
                                                                    <?php } else { ?>
                                                                        "<?php foreach ($pesawat as $p => $pes) {?><option><?php echo $pes['nama_vendor']?></option><?php } ?>"
                                                                    <?php } ?>
                                                                );
                                                            } else if (val == "Travel") {
                                                                $(".select_tiket").html(
                                                                    <?php if (empty($travel)) {?>
                                                                        "<option>Tidak ada data</option>"
                                                                    <?php } else { ?>
                                                                        "<?php foreach ($travel as $t => $tra) {?><option><?php echo $tra['nama_vendor']?></option><?php } ?>"
                                                                    <?php } ?>
                                                                );
                                                            } else if (val == "Kapal Laut") {
                                                                $(".select_tiket").html(
                                                                    <?php if (empty($kapal_laut)) {?>
                                                                        "<option>Tidak ada data</option>"
                                                                    <?php } else { ?>
                                                                        "<?php foreach ($kapal_laut as $ka => $kap) {?><option><?php echo $kap['nama_vendor']?></option><?php } ?>"
                                                                    <?php } ?>
                                                                );
                                                            } else if (val == "0") {
                                                                $(".select_tiket").html(
                                                                    "<option>-- pilih armada transportasi terlebih dahulu --</option>"
                                                                );
                                                            }
                                                        });
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Keberangkatan
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_keberangkatan" id="keberangkatan" name="keberangkatan[]" style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                                <option>-- pilih armada transportasi terlebih dahulu --</option>
                                                            </select>
                                                        </div>
                                                    </div>

                                                    <div id="show_keberangkatan">
                                                    </div>

                                                    <div id="show_script_keberangkatan">
                                                    </div>

                                                    <script>
                                                        $(".select_pilihan_tiket").change(function() {
                                                            var val = $(this).val();

                                                            if (val == "Pesawat") {
                                                                $(".select_keberangkatan").html(
                                                                    <?php if (empty($bandara)) {?>
                                                                        "<option>Tidak ada data</option>"
                                                                    <?php } else { ?>
                                                                        "<?php foreach ($bandara as $b => $ba) {?><option><?php echo $ba['nama_pemberhentian']?> <?php echo "-" ?> <?php echo $ba['nama_kota']?></option><?php } ?>"
                                                                    <?php } ?>
                                                                );
                                                            } else if (val == "Kapal Laut") {
                                                                $(".select_keberangkatan").html(
                                                                    <?php if (empty($pelabuhan)) {?>
                                                                        "<option>Tidak ada data</option>"
                                                                    <?php } else { ?>
                                                                        "<?php foreach ($pelabuhan as $p => $pe) {?><option><?php echo $pe['nama_pemberhentian']?> <?php echo "-" ?> <?php echo $pe['nama_kota']?></option><?php } ?>"
                                                                    <?php } ?>
                                                                );
                                                            } else if (val == "Kereta Api") {
                                                                $(".select_keberangkatan").html(
                                                                    <?php if (empty($stasiun)) {?>
                                                                        "<option>Tidak ada data</option>"
                                                                    <?php } else { ?>
                                                                        "<?php foreach ($stasiun as $s => $st) {?><option><?php echo $st['nama_pemberhentian']?> <?php echo "-" ?> <?php echo $st['nama_kota']?></option><?php } ?>"
                                                                    <?php } ?>
                                                                );
                                                            } else if (val == "Bis") {
                                                                $(".select_keberangkatan").html(
                                                                    <?php if (empty($terminal)) {?>
                                                                        "<option>Tidak ada data</option>"
                                                                    <?php } else { ?>
                                                                        "<?php foreach ($terminal as $t => $te) {?><option><?php echo $te['nama_pemberhentian']?> <?php echo "-" ?> <?php echo $te['nama_kota']?></option><?php } ?>"
                                                                    <?php } ?>
                                                                );
                                                            } else if (val == "Travel") {
                                                                $(".select_keberangkatan").html(
                                                                    "<?php foreach ($kota as $ko => $kot) {?><option><?php echo $kot['nama_kota']?></option><?php } ?>"
                                                                );
                                                            } else if (val == "0") {
                                                                $(".select_keberangkatan").html(
                                                                    "<option>-- pilih armada transportasi terlebih dahulu --</option>"
                                                                );
                                                            }
                                                        });
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Pemberhentian
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_pemberhentian" id="pemberhentian" name="pemberhentian[]" style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                                <option>-- pilih armada transportasi terlebih dahulu --</option>
                                                            </select>
                                                        </div>
                                                    </div>

                                                    <div id="show_pemberhentian">
                                                    </div>

                                                    <div id="show_script_pemberhentian">
                                                    </div>

                                                    <script>
                                                        $(".select_pilihan_tiket").change(function() {
                                                            var val = $(this).val();

                                                            if (val == "Pesawat") {
                                                                $(".select_pemberhentian").html(
                                                                    <?php if (empty($bandara)) {?>
                                                                        "<option>Tidak ada data</option>"
                                                                    <?php } else { ?>
                                                                        "<?php foreach ($bandara as $b => $ba) {?><option><?php echo $ba['nama_pemberhentian']?> <?php echo "-" ?> <?php echo $ba['nama_kota']?></option><?php } ?>"
                                                                    <?php } ?>
                                                                );
                                                            } else if (val == "Kapal Laut") {
                                                                $(".select_pemberhentian").html(
                                                                    <?php if (empty($pelabuhan)) {?>
                                                                        "<option>Tidak ada data</option>"
                                                                    <?php } else { ?>
                                                                        "<?php foreach ($pelabuhan as $p => $pe) {?><option><?php echo $pe['nama_pemberhentian']?> <?php echo "-" ?> <?php echo $pe['nama_kota']?></option><?php } ?>"
                                                                    <?php } ?>
                                                                );
                                                            } else if (val == "Kereta Api") {
                                                                $(".select_pemberhentian").html(
                                                                    <?php if (empty($stasiun)) {?>
                                                                        "<option>Tidak ada data</option>"
                                                                    <?php } else { ?>
                                                                        "<?php foreach ($stasiun as $s => $st) {?><option><?php echo $st['nama_pemberhentian']?> <?php echo "-" ?> <?php echo $st['nama_kota']?></option><?php } ?>"
                                                                    <?php } ?>
                                                                );
                                                            } else if (val == "Bis") {
                                                                $(".select_pemberhentian").html(
                                                                    <?php if (empty($terminal)) {?>
                                                                        "<option>Tidak ada data</option>"
                                                                    <?php } else { ?>
                                                                        "<?php foreach ($terminal as $t => $te) {?><option><?php echo $te['nama_pemberhentian']?> <?php echo "-" ?> <?php echo $te['nama_kota']?></option><?php } ?>"
                                                                    <?php } ?>
                                                                );
                                                            } else if (val == "Travel") {
                                                                $(".select_pemberhentian").html(
                                                                    "<?php foreach ($kota as $ko => $kot) {?><option><?php echo $kot['nama_kota']?></option><?php } ?>"
                                                                );
                                                            } else if (val == "0") {
                                                                $(".select_pemberhentian").html(
                                                                    "<option>-- pilih armada transportasi terlebih dahulu --</option>"
                                                                );
                                                            }
                                                        });
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Jumlah Tiket
                                                    </div>

                                                    <input autocomplete="off" type="number" min="0" class="form-control" name="jumlah_tiket[]" id="jumlah_tiket">

                                                    <div id="show_jumlah_tiket">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Harga Total Tiket<a style="color: #e74a3b">*</a>
                                                    </div>

                                                    <input required type="text" autocomplete="off" class="form-control mb-3" name="harga_tiket[]" placeholder="Rp" id="currency-field_tiket" data-type="currency" value="<?php echo "0"; ?>">
                                                    
                                                    <div id="show_harga_tiket">
                                                    </div>

                                                    <script>
                                                        $("input[data-type='currency']").on({
                                                            keyup: function() {
                                                            formatCurrency($(this));
                                                            },
                                                            blur: function() { 
                                                            formatCurrency($(this), "blur");
                                                            }
                                                        });

                                                        function formatNumber(n) {
                                                        // format number 1000000 to 1,234,567
                                                        return n.replace(/\D/g, "").replace(/\B(?=(\d{3})+(?!\d))/g, ".")
                                                        }

                                                        function formatCurrency(input, blur) {
                                                        // appends $ to value, validates decimal side
                                                        // and puts cursor back in right position.
                                                        
                                                        // get input value
                                                        var input_val = input.val();
                                                        
                                                        // don't validate empty input
                                                        if (input_val === "") { return; }
                                                        
                                                        // original length
                                                        var original_len = input_val.length;

                                                        // initial caret position 
                                                        var caret_pos = input.prop("selectionStart");
                                                            
                                                        // check for decimal
                                                        if (input_val.indexOf(",") >= 0) {

                                                            // get position of first decimal
                                                            // this prevents multiple decimals from
                                                            // being entered
                                                            var decimal_pos = input_val.indexOf(",");

                                                            // split number by decimal point
                                                            var left_side = input_val.substring(0, decimal_pos);
                                                            var right_side = input_val.substring(decimal_pos);

                                                            // add commas to left side of number
                                                            left_side = formatNumber(left_side);

                                                            // validate right side
                                                            right_side = formatNumber(right_side);
                                                            
                                                            // On blur make sure 2 numbers after decimal
                                                            if (blur === "blur") {
                                                            right_side += "00";
                                                            }
                                                            
                                                            // Limit decimal to only 2 digits
                                                            right_side = right_side.substring(0, 2);

                                                            // join number by .
                                                            input_val = "Rp" + left_side + "," + right_side;

                                                        } 
                                                        else {
                                                            // no decimal entered
                                                            // add commas to number
                                                            // remove all non-digits
                                                            input_val = formatNumber(input_val);
                                                            input_val = "Rp" + input_val;
                                                            
                                                            // final formatting
                                                            if (blur === "blur") {
                                                            input_val += "";
                                                            }
                                                        }
                                                        
                                                        // send updated string to input
                                                        input.val(input_val);

                                                        // put caret back in the right position
                                                        var updated_len = input_val.length;
                                                        caret_pos = updated_len - original_len + caret_pos;
                                                        input[0].setSelectionRange(caret_pos, caret_pos);
                                                        }
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Tanggal dan Jam
                                                    </div>

                                                    <input autocomplete="off" id='tanggal_jam_tiket' class="form-control" name="tanggal_jam_tiket[]">
                                                    
                                                    <script>
                                                        $(function() {
                                                            $.datetimepicker.setLocale('id');
                                                            $('#tanggal_jam_tiket').datetimepicker({
                                                                format: 'Y-m-d H:i',
                                                                formatDate: 'Y-m-d',
                                                                formatTime: 'H:i',
                                                                minDate:'0',
                                                                step: 1,
                                                                closeOnTimeSelect : true,
                                                                scrollMonth : false,
                                                                scrollInput : false,
                                                            });
                                                        });
                                                    </script>

                                                    <div id="show_tanggal_jam_tiket">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Keterangan
                                                    </div>
                                                    
                                                    <textarea class="form-control" id="keterangan_tiket" name="keterangan_tiket[]" rows="3" placeholder=""></textarea>

                                                    <div id="show_keterangan_tiket">
                                                    </div>

                                                    <script>
                                                        $(document).keypress(function(event){
                                                            if (event.which == '13') {
                                                            event.preventDefault();
                                                            }
                                                        });
                                                    </script>
                                                    <div class="modal-footer">
                                                        <div class="col-xl-12 col-lg-12 mb-3">
                                                            <a style="color: #e74a3b">&nbsp;*Note: Masukkan nilai 0 jika belum mengetahui harga tiket</a>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="tab-pane" id="tab_hotel" style="font-size:120%">
                                                    <div class="mb-1">
                                                        GS
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_gs_hotel" id="gs_hotel" name="gs_hotel[]" style="width: 100%;"></select>
                                                        </div>
                                                    </div>

                                                    <div id="show_gs_hotel">
                                                    </div>

                                                    <script>
                                                    $(document).ready(function() {
                                                        var data_select = [
                                                            <?php foreach ($pool as $poo) : ?> "<?php echo $poo['nama_pool']?>",
                                                            <?php endforeach ?>
                                                        ]

                                                        $(".select_gs_hotel").select2({
                                                            data: data_select,
                                                            // tags: true,
                                                            // tokenSeparators: [',', ' '],
                                                        });
                                                    });
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Kota
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_kota" id="kota" name="kota[]" style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                                <option value="pilih">-- pilih kota --</option>
                                                                <?php foreach ($negara as $n => $neg) {?>
                                                                    <optgroup label=<?php echo $neg['nama_negara'] ?>>
                                                                        <?php foreach ($kota as $k => $kot) {?>
                                                                            <?php if ($neg['id_negara'] == $kot['id_negara']) { ?>
                                                                                <option><?php echo $kot['nama_kota'] ?></option>
                                                                            <?php } ?>
                                                                        <?php } ?>
                                                                    </optgroup>
                                                                <?php } ?>
                                                            </select>
                                                        </div>
                                                    </div>

                                                    <div id="show_kota">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Hotel/Kamar
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_hotel" id="hotel" name="hotel[]" style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                                <option value="pilih1">-- pilih kota terlebih dahulu --</option>
                                                            </select>
                                                        </div>
                                                    </div>

                                                    <div id="show_hotel">
                                                    </div>

                                                    <div id="show_script_hotel">
                                                    </div>

                                                    <script>
                                                        $(".select_kota").change(function() {
                                                            var val = $(this).val();

                                                            <?php foreach ($kota as $k => $kot) {?>
                                                                if (val == "<?php echo $kot['nama_kota'] ?>") {
                                                                    $(".select_hotel").html(
                                                                        "<option value=''>-- Daftar hotel --</option><?php foreach ($hotel as $h => $hote) {?><?php if ($kot['nama_kota'] == $hote['nama_kota']) { ?><option><?php echo $hote['nama_hotel'] ?><?php echo " - " ?><?php echo $hote['jenis_kamar'] ?></option><?php } ?><?php } ?>"
                                                                    );
                                                                } else if (val == "pilih") {
                                                                    $(".select_hotel").html(
                                                                        "<option value='pilih1'>-- pilih kota terlebih dahulu --</option>"
                                                                    );
                                                                }
                                                            <?php } ?>

                                                            // if (val == "Jakarta") {
                                                            //     $(".select_hotel").html(
                                                            //         "<option value=''>-- pilih hotel --</option><optgroup label='Mess Kx Jkt'><option value='Mess Kx Jkt - Standart'>Mess Kx Jkt - Standart - Sisa kamar : 4</option></optgroup>"
                                                            //     );
                                                            // } else if (val == "pilih") {
                                                            //     $(".select_hotel").html(
                                                            //         "<option value='pilih1'>-- pilih kota terlebih dahulu --</option>"
                                                            //         );
                                                            // } else {
                                                            //     $(".select_hotel").html(
                                                            //         "<option value='pilih2'>-- Data Hotel/Kamar tidak ditemukan --</option>"
                                                            //         );
                                                            // }
                                                        });
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Ketersediaan Kamar Mess
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_mess" id="mess" name="mess[]" style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                                <option value="pilihmess">-- silahkan pilih Mess Kx Jkt terlebih dahulu --</option>
                                                            </select>
                                                        </div>
                                                    </div>

                                                    <div id="show_mess">
                                                    </div>

                                                    <div id="show_script_mess">
                                                    </div>

                                                    <script>
                                                        $(".select_hotel").change(function() {
                                                            var val = $(this).val();

                                                            if (val == "Mess Kx Jkt - Standar") {
                                                                $(".select_mess").html(
                                                                    "<option value='1'>Tersedia untuk : <?php foreach ($mess as $m => $mes) { $sisa_kamar = $mes['kapasitas_kamar'] - $mes['terpakai'];?><?php echo $sisa_kamar ?><?php } ?> orang</option>"
                                                                );
                                                            } else {
                                                                $(".select_mess").html(
                                                                    "<option value='pilihmess'>-- silahkan pilih Mess Kx Jkt terlebih dahulu --</option>"
                                                                );
                                                            }
                                                        });
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Type
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_type" id="type" name="type[]" style="width: 100%;"></select>
                                                        </div>
                                                    </div>

                                                    <div id="show_type">
                                                    </div>
                                                    
                                                    <script>
                                                    $(document).ready(function() {
                                                        var data_select = ['Single', 'Twin / Double']

                                                        $(".select_type").select2({
                                                            data: data_select,
                                                            // tags: true,
                                                            // tokenSeparators: [',', ' '],
                                                        });
                                                    });
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Jumlah Kamar
                                                    </div>
                                                    
                                                    <input autocomplete="off" type="number" min="0" class="form-control" name="jumlah_kamar[]" id="jumlah_kamar">

                                                    <div id="show_jumlah_kamar">
                                                    </div>

                                                    <div class="row">
                                                        <div class="col-md-12">
                                                            <div class="mt-3" id="harga_hotel" style="display:block;">
                                                                <div>
                                                                    Harga Total Hotel<a style="color: #e74a3b">*</a>
                                                                </div>

                                                                <input required type="text" autocomplete="off" class="form-control" name="harga_hotel[]" style="display:block;" placeholder="Rp" id="currency-field_hotel" data-type="currency" value="<?php echo "0"; ?>">
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    <div id="show_harga_hotel">
                                                    </div>
                                                    
                                                    <div id="show_script_harga_hotel">
                                                    </div>

                                                    <script>
                                                        $(".select_hotel").change(function() {
                                                            var val = $(this).val();

                                                            if (val == "Mess Kx Jkt - Standar") {
                                                                document.getElementById('harga_hotel').style.display = "none";
                                                            } else {
                                                                document.getElementById('harga_hotel').style.display = "block";
                                                            }
                                                        });

                                                        $("input[data-type='currency']").on({
                                                            keyup: function() {
                                                            formatCurrency($(this));
                                                            },
                                                            blur: function() { 
                                                            formatCurrency($(this), "blur");
                                                            }
                                                        });

                                                        function formatNumber(n) {
                                                        // format number 1000000 to 1,234,567
                                                        return n.replace(/\D/g, "").replace(/\B(?=(\d{3})+(?!\d))/g, ".")
                                                        }

                                                        function formatCurrency(input, blur) {
                                                        // appends $ to value, validates decimal side
                                                        // and puts cursor back in right position.
                                                        
                                                        // get input value
                                                        var input_val = input.val();
                                                        
                                                        // don't validate empty input
                                                        if (input_val === "") { return; }
                                                        
                                                        // original length
                                                        var original_len = input_val.length;

                                                        // initial caret position 
                                                        var caret_pos = input.prop("selectionStart");
                                                            
                                                        // check for decimal
                                                        if (input_val.indexOf(",") >= 0) {

                                                            // get position of first decimal
                                                            // this prevents multiple decimals from
                                                            // being entered
                                                            var decimal_pos = input_val.indexOf(",");

                                                            // split number by decimal point
                                                            var left_side = input_val.substring(0, decimal_pos);
                                                            var right_side = input_val.substring(decimal_pos);

                                                            // add commas to left side of number
                                                            left_side = formatNumber(left_side);

                                                            // validate right side
                                                            right_side = formatNumber(right_side);
                                                            
                                                            // On blur make sure 2 numbers after decimal
                                                            if (blur === "blur") {
                                                            right_side += "00";
                                                            }
                                                            
                                                            // Limit decimal to only 2 digits
                                                            right_side = right_side.substring(0, 2);

                                                            // join number by .
                                                            input_val = "Rp" + left_side + "," + right_side;

                                                        } 
                                                        else {
                                                            // no decimal entered
                                                            // add commas to number
                                                            // remove all non-digits
                                                            input_val = formatNumber(input_val);
                                                            input_val = "Rp" + input_val;
                                                            
                                                            // final formatting
                                                            if (blur === "blur") {
                                                            input_val += "";
                                                            }
                                                        }
                                                        
                                                        // send updated string to input
                                                        input.val(input_val);

                                                        // put caret back in the right position
                                                        var updated_len = input_val.length;
                                                        caret_pos = updated_len - original_len + caret_pos;
                                                        input[0].setSelectionRange(caret_pos, caret_pos);
                                                        }
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Tanggal Masuk dan Jam Masuk
                                                    </div>

                                                    <input autocomplete="off" id='tanggal_jam_masuk' class="form-control" name="tanggal_jam_masuk[]">

                                                    <script>
                                                        $(function() {
                                                            $.datetimepicker.setLocale('id');
                                                            $('#tanggal_jam_masuk').datetimepicker({
                                                                format: 'Y-m-d H:i',
                                                                formatDate: 'Y-m-d',
                                                                formatTime: 'H:i',
                                                                minDate:'0',
                                                                step: 1,
                                                                closeOnTimeSelect : true,
                                                                scrollMonth : false,
                                                                scrollInput : false,
                                                            });
                                                        });
                                                    </script>

                                                    <div id="show_tanggal_jam_masuk">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Tanggal Keluar dan Jam Keluar
                                                    </div>

                                                    <input autocomplete="off" id='tanggal_jam_keluar' class="form-control" name="tanggal_jam_keluar[]">
                                                    <script>
                                                        $(function() {
                                                            $.datetimepicker.setLocale('id');
                                                            $('#tanggal_jam_keluar').datetimepicker({
                                                                format: 'Y-m-d H:i',
                                                                formatDate: 'Y-m-d',
                                                                formatTime: 'H:i',
                                                                minDate:'0',
                                                                step: 1,
                                                                closeOnTimeSelect : true,
                                                                scrollMonth : false,
                                                                scrollInput : false,
                                                            });
                                                        });
                                                    </script>

                                                    <div id="show_tanggal_jam_keluar">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Keterangan
                                                    </div>

                                                    <textarea class="form-control" id="keterangan_akomodasi" name="keterangan_akomodasi[]" rows="3" placeholder=""></textarea>

                                                    <div id="show_keterangan_akomodasi">
                                                    </div>

                                                    <script>
                                                        $(document).keypress(function(event){
                                                            if (event.which == '13') {
                                                            event.preventDefault();
                                                            }
                                                        });
                                                    </script>
                                                    <div class="modal-footer">
                                                        <div class="col-xl-12 col-lg-12 mb-3">
                                                            <a style="color: #e74a3b">&nbsp;*Note: Masukkan nilai 0 jika belum mengetahui harga hotel</a>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="tab-pane" id="tab_mobil" style="font-size:120%">
                                                    <h2>Mobil</h2>

                                                    <div class="mb-1">
                                                        GS
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_gs_mobil" id="gs_mobil" name="gs_mobil[]" style="width: 100%;"></select>
                                                        </div>
                                                    </div>

                                                    <div id="show_gs_mobil">
                                                    </div>

                                                    <script>
                                                    $(document).ready(function() {
                                                        var data_select = [
                                                            <?php foreach ($pool as $poo) : ?> "<?php echo $poo['nama_pool']?>",
                                                            <?php endforeach ?>
                                                        ]

                                                        $(".select_gs_mobil").select2({
                                                            data: data_select,
                                                            // tags: true,
                                                            // tokenSeparators: [',', ' '],
                                                        });
                                                    });
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Jenis Kendaraan
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-12">
                                                            <select class="select_jenis_kendaraan" id="jenis_kendaraan" name="jenis_kendaraan[]" style="width: 100%;"></select>
                                                        </div>
                                                    </div>

                                                    <div id="show_jenis_kendaraan">
                                                    </div>

                                                    <script>
                                                    $(document).ready(function() {
                                                        var data_select = [
                                                            'Sedan', 'Station', 'Pickup', 'Box', 'Truck'
                                                        ]

                                                        $(".select_jenis_kendaraan").select2({
                                                            data: data_select,
                                                            // tags: true,
                                                            // tokenSeparators: [',', ' '],
                                                        });
                                                    });
                                                    </script>
                                                    
                                                    <div class="mb-1 mt-3">
                                                        Dalam/Luar Kota
                                                    </div>

                                                    <div class="row">
                                                        <div class="col-md-12">
                                                            <select id="dalkot_lukot" name="dalkot_lukot[]" onchange="showD(this)" style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                                <option value="Dalam Kota">Dalam Kota</option>
                                                                <option value="Luar Kota">Luar Kota</option>
                                                            </select>
                                                        </div>
                                                    </div>

                                                    <div id="show_dalkot_lukot">
                                                    </div>

                                                    <div id="show_script_dalkot_lukot">
                                                    </div>

                                                    <script>
                                                        function showD(select) {
                                                            if (select.value == 'Dalam Kota') {
                                                                document.getElementById('menginap').style.display =
                                                                    "none";
                                                            } else if (select.value == 'Luar Kota') {
                                                                document.getElementById('menginap').style.display =
                                                                    "block";
                                                            }
                                                        }
                                                    </script>

                                                    <div class="row">
                                                        <div class="col-md-12">
                                                            <div class="mt-3" id="menginap" style="display:none;">
                                                                <div>
                                                                    Menginap
                                                                </div>

                                                                <select class="select_menginap" id="menginap_transport" name="menginap[]"
                                                                    style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                                    <option>Iya</option>
                                                                    <option>Tidak</option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div id="show_menginap">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Jumlah Mobil
                                                    </div>

                                                    <input autocomplete="off" type="number" min="0" class="form-control" name="jumlah_mobil[]" id="jumlah_mobil">

                                                    <div id="show_jumlah_mobil">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Kapasitas
                                                    </div>

                                                    <input autocomplete="off" type="number" min="0" class="form-control" name="kapasitas[]" id="kapasitas">

                                                    <div id="show_kapasitas">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Tujuan
                                                    </div>

                                                    <input autocomplete="off" type="text" class="form-control" name="tujuan_mobil[]" id="tujuan_mobil" style="text-transform:capitalize">

                                                    <div id="show_tujuan_mobil">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Siap Di
                                                    </div>

                                                    <input autocomplete="off" type="text" class="form-control" name="siap_di[]" id="siap_di" style="text-transform:capitalize">

                                                    <div id="show_siap_di">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Tanggal
                                                    </div>

                                                    <input autocomplete="off" id='tanggal_mobil' class="form-control" name="tanggal_mobil[]">

                                                    <script>
                                                        $(function() {
                                                            $.datetimepicker.setLocale('id');
                                                            $('#tanggal_mobil').datetimepicker({
                                                                format: 'Y-m-d',
                                                                formatDate: 'Y-m-d',
                                                                minDate:'0',
                                                                step: 1,
                                                                timepicker : false,
                                                                closeOnDateSelect : true,
                                                                scrollMonth : false,
                                                                scrollInput : false,
                                                            });
                                                        });
                                                    </script>

                                                    <div id="show_tanggal_mobil">
                                                    </div>

                                                    <div class="mb-1 mt-3">
                                                        Jam Siap
                                                    </div>

                                                    <input autocomplete="off" id='jam_siap' class="form-control" name="jam_siap[]">

                                                    <div id="show_jam_siap">
                                                    </div>

                                                    <script>
                                                        $(function() {
                                                            $.datetimepicker.setLocale('id');
                                                            $('#jam_siap').datetimepicker({
                                                                format: 'H:i',
                                                                formatTime: 'H:i',
                                                                step: 1,
                                                                datepicker : false,
                                                            });
                                                        });
                                                    </script>

                                                    <div class="mb-1 mt-3">
                                                        Keterangan
                                                    </div>

                                                    <textarea class="form-control" id="keterangan_mobil" name="keterangan_mobil[]" rows="3" placeholder=""></textarea>

                                                    <div id="show_keterangan_mobil">
                                                    </div>

                                                    <script>
                                                        $(document).keypress(function(event){
                                                            if (event.which == '13') {
                                                            event.preventDefault();
                                                            }
                                                        });
                                                    </script>

                                                    <div class="mb-3"></div>
                                                </div>

                                                <div class="tab-pane" id="tab_confirm" style="font-size:100%">
                                                    <div class="modal-footer">
                                                        <!-- <button class="btn btn-success btn-lg" type="submit"
                                                            name="save" style="font-size:120%">Konfirmasi</button> -->
                                                        <a class="btn btn-success btn-lg" href="javascript:void(0)" style="font-size:85%" data-bs-toggle="modal" data-bs-target="#konfirm"><i class="fa-solid fa-check"></i> Konfirmasi</a>

                                                        <div class="modal" id="konfirm" tabindex="-1" aria-hidden="true">
                                                            <div class="modal-dialog">
                                                                <div class="modal-content">
                                                                    <div class="modal-header">
                                                                        <h2 class="modal-title" id="modalTopTitle">Konfirmasi?</h2>
                                                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                                    </div>
                                                                    <div class="modal-body">
                                                                        <div class="tab-content">
                                                                            <div class="tab-pane active show" style="font-size:120%; text-align: center;">
                                                                                <div class="mt-4 mb-1">
                                                                                    Mohon sebelum melakukan konfirmasi, pastikan sekali lagi apakah data yang diinput sudah benar dan tepat. Setelah melakukan konfirmasi, data tidak dapat diubah kembali.
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="modal-footer">
                                                                        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal" style="font-size:85%;">
                                                                            <i class="fa-solid fa-xmark"></i> Batalkan
                                                                        </button>
                                                                        <button id="add_btn" class="btn btn-success btn-lg" type="submit" name="save" style="font-size:85%">
                                                                            <i class="fa-solid fa-check"></i> Konfirmasi
                                                                        </button>
                                                                    </div>
                                                                </form>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <script>
                                                        var count=0;
                                                        $(document).ready(function() {
                                                            $("#add_item_btn").click(function (e) {
                                                                count++;
                                                                // e.preventDefault();
                                                                // $("#show_nama").append(`
                                                                //     <div class="row mb-3 remove">
                                                                //         <div class="col-md-12">
                                                                //             <select class="select_nama" name="nama[]" style="width: 100%;"></select>
                                                                //         </div>
                                                                //     </div>
                                                                // `);

                                                                // e.preventDefault();
                                                                // $("#show_jabatan").append(`
                                                                //     <div class="row mt-3 mb-3 remove">
                                                                //         <div class="col-md-12">
                                                                //             <select class="select_jabatan remove_item_btn" name="jabatan[]" style="width: 100%;"></select>
                                                                //         </div>
                                                                //     </div>
                                                                // `);

                                                                // e.preventDefault();
                                                                // $("#show_nama").append(`
                                                                //     <input autocomplete="off" type="text" class="form-control mt-3 mb-3 remove" name="nama[]" style="text-transform:capitalize">
                                                                // `);

                                                                // e.preventDefault();
                                                                // $("#show_jabatan").append(`
                                                                //     <input autocomplete="off" type="text" class="form-control mt-3 mb-3 remove" name="jabatan[]" id="jabatan" style="text-transform:capitalize">
                                                                // `);

                                                                // e.preventDefault();
                                                                // $("#show_jabatan").append(`
                                                                //     <input autocomplete="off" type="text" class="form-control mt-3 mb-3 remove" name="jabatan[]" style="text-transform:uppercase" oninput="this.value = this.value.toUpperCase()">
                                                                // `);

                                                                // e.preventDefault();
                                                                // $("#show_pic").append(`
                                                                //     <input autocomplete="off" type="text" class="form-control mt-3 mb-3 remove" name="pic[]" style="text-transform:capitalize">
                                                                // `);

                                                                e.preventDefault();
                                                                $("#show_tamu").append(`
                                                                    <div class="row mt-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select class="select_tamu" name="tamu[]" style="width: 100%;" onchange="showTamu`+count+`(this)"></select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                var s = document.createElement('script');
                                                                s.type = 'text/javascript';
                                                                s.className = 'remove';
                                                                var code = `
                                                                    function showTamu`+count+`(select) {
                                                                        if (select.value == 'Non Tamu') {
                                                                            document.getElementById('nama`+count+`').style.display =
                                                                                "block";
                                                                            document.getElementById('jabatan`+count+`').style.display =
                                                                                "block";
                                                                        } else if (select.value == 'Tamu') {
                                                                            document.getElementById('nama`+count+`').style.display =
                                                                                "none";
                                                                            document.getElementById('jabatan`+count+`').style.display =
                                                                                "none";
                                                                        }
                                                                    }
                                                                `;
                                                                try {
                                                                s.appendChild(document.createTextNode(code));
                                                                $("#show_script_tamu").append(s);
                                                                } catch (e) {
                                                                s.text = code;
                                                                $("#show_script_tamu").append(s);
                                                                }

                                                                e.preventDefault();
                                                                $("#show_nama").append(`
                                                                    <div class="row remove">
                                                                        <div class="col-md-12">
                                                                            <div id="nama`+count+`" style="display:block;">
                                                                                <div class="row mt-3">
                                                                                    <div>
                                                                                        Nama
                                                                                    </div>
                                                                                    <div class="col-md-12">
                                                                                        <select class="select_nama" name="nama[]" style="width: 100%;"></select>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_jabatan").append(`
                                                                    <div class="row remove">
                                                                        <div class="col-md-12">
                                                                            <div id="jabatan`+count+`" style="display:block;">
                                                                                <div class="row mt-3">
                                                                                    <div>
                                                                                        Jabatan
                                                                                    </div>
                                                                                    <div class="col-md-12">
                                                                                        <select class="select_jabatan" name="jabatan[]" style="width: 100%;"></select>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_email_info").append(`
                                                                    <div class="row mt-3 mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select class="select_email_info" name="email_info[]" style="width: 100%;"></select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_email_eval").append(`
                                                                    <div class="row mt-3 mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select class="select_email_eval" name="email_eval[]" style="width: 100%;"></select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_pembayaran").append(`
                                                                    <div class="row mt-3 mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select class="select_pembayaran" name="pembayaran[]" style="width: 100%;"></select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_pic").append(`
                                                                    <div class="row mt-3 mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select class="select_pic" name="pic[]" style="width: 100%;"></select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                // e.preventDefault();
                                                                // $("#show_tiket").append(`
                                                                //     <div class="row mt-3 mb-3 remove">
                                                                //         <div class="col-md-12">
                                                                //             <select class="select_tiket" name="tiket[]" style="width: 100%">
                                                                //                 <optgroup label = "Bus">
                                                                //                     <php foreach ($bus as $b => $bu) {?>
                                                                //                         <option>
                                                                //                             <php echo $bu['nama_vendor']?>
                                                                //                         </option>
                                                                //                     <php } ?>
                                                                //                 </optgroup>
                                                                //                 <optgroup label = "Kereta Api">
                                                                //                     <php foreach ($kereta as $k => $ker) {?>
                                                                //                         <option>
                                                                //                             <php echo $ker['nama_vendor']?>
                                                                //                         </option>
                                                                //                     <php } ?>
                                                                //                 </optgroup>
                                                                //                 <optgroup label = "Pesawat">
                                                                //                     <php foreach ($pesawat as $p => $pes) {?>
                                                                //                         <option>
                                                                //                             <php echo $pes['nama_vendor']?>
                                                                //                         </option>
                                                                //                     <php } ?>
                                                                //                 </optgroup>
                                                                //                 <optgroup label = "Travel">
                                                                //                     <php foreach ($travel as $t => $tra) {?>
                                                                //                         <option>
                                                                //                             <php echo $tra['nama_vendor']?>
                                                                //                         </option>
                                                                //                     <php } ?>
                                                                //                 </optgroup>
                                                                //                 <optgroup label = "Kapal Laut">
                                                                //                     <php foreach ($kapal_laut as $ka => $kap) {?>
                                                                //                         <option>
                                                                //                             <php echo $kap['nama_vendor']?>
                                                                //                         </option>
                                                                //                     <php } ?>
                                                                //                 </optgroup>
                                                                //             </select>
                                                                //         </div>
                                                                //     </div>
                                                                // `);

                                                                // e.preventDefault();
                                                                // $("#show_pemberhentian").append(`
                                                                //     <div class="row mt-3 mb-3 remove">
                                                                //         <div class="col-md-12">
                                                                //             <select class="select_pemberhentian" name="pemberhentian[]" style="width: 100%">
                                                                //                 <optgroup label = "Bandara">
                                                                //                     <php foreach ($bandara as $b => $ba) {?>
                                                                //                         <option>
                                                                //                             <php echo $ba['nama_pemberhentian']?> <php echo "-" ?> <php echo $ba['nama_kota']?>
                                                                //                         </option>
                                                                //                     <php } ?>
                                                                //                 </optgroup>
                                                                //                 <optgroup label = "Pelabuhan">
                                                                //                     <php foreach ($pelabuhan as $p => $pe) {?>
                                                                //                         <option>
                                                                //                             <php echo $pe['nama_pemberhentian']?> <php echo "-" ?> <php echo $pe['nama_kota']?>
                                                                //                         </option>
                                                                //                     <php } ?>
                                                                //                 </optgroup>
                                                                //                 <optgroup label = "Stasiun">
                                                                //                     <php foreach ($stasiun as $s => $st) {?>
                                                                //                         <option>
                                                                //                             <php echo $st['nama_pemberhentian']?> <php echo "-" ?> <php echo $st['nama_kota']?>
                                                                //                         </option>
                                                                //                     <php } ?>
                                                                //                 </optgroup>
                                                                //                 <optgroup label = "Terminal">
                                                                //                     <php foreach ($terminal as $t => $te) {?>
                                                                //                         <option>
                                                                //                             <php echo $te['nama_pemberhentian']?> <php echo "-" ?> <php echo $te['nama_kota']?>
                                                                //                         </option>
                                                                //                     <php } ?>
                                                                //                 </optgroup>
                                                                //             </select>
                                                                //         </div>
                                                                //     </div>
                                                                // `);

                                                                // e.preventDefault();
                                                                // $("#show_dari_tiket").append(`
                                                                //     <div class="row mb-3 remove">
                                                                //         <div class="col-md-12">
                                                                //             <select class="select_dari" name="dari_tiket[]" style="width: 100%">
                                                                //                 <php foreach ($negara as $n => $neg) {?>
                                                                //                     <optgroup label=<php echo $neg['nama_negara'] ?>>
                                                                //                         <php foreach ($kota as $k => $kot) {?>
                                                                //                             <php if ($neg['id_negara'] == $kot['id_negara']) { ?>
                                                                //                                 <option><php echo $kot['nama_kota'] ?></option>
                                                                //                             <php } ?>
                                                                //                         <php } ?>
                                                                //                     </optgroup>
                                                                //                 <php } ?>
                                                                //             </select>
                                                                //         </div>
                                                                //     </div>
                                                                // `);

                                                                // e.preventDefault();
                                                                // $("#show_tujuan_tiket").append(`
                                                                //     <div class="row mb-3 remove">
                                                                //         <div class="col-md-12">
                                                                //             <select class="select_tujuan" name="tujuan_tiket[]" style="width: 100%">
                                                                //                 <php foreach ($negara as $n => $neg) {?>
                                                                //                     <optgroup label=<php echo $neg['nama_negara'] ?>>
                                                                //                         <php foreach ($kota as $k => $kot) {?>
                                                                //                             <php if ($neg['id_negara'] == $kot['id_negara']) { ?>
                                                                //                                 <option><php echo $kot['nama_kota'] ?></option>
                                                                //                             <php } ?>
                                                                //                         <php } ?>
                                                                //                     </optgroup>
                                                                //                 <php } ?>
                                                                //             </select>
                                                                //         </div>
                                                                //     </div>
                                                                // `);

                                                                // e.preventDefault();
                                                                // $("#show_select_tempat").append(`
                                                                //     <div class="row mt-3 remove">
                                                                //         <div class="col-md-12">
                                                                //             <select id="select_tempat`+count+`" name="tempat[]" style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                                //                 <option value="0">-- pilih salah satu --</option>
                                                                //                 <option>Bandara</option>
                                                                //                 <option>Pelabuhan</option>
                                                                //                 <option>Stasiun</option>
                                                                //                 <option>Terminal</option>
                                                                //             </select>
                                                                //         </div>
                                                                //     </div>
                                                                // `);

                                                                e.preventDefault();
                                                                $("#show_gs_tiket").append(`
                                                                    <div class="row mt-3 mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select class="select_gs_tiket" name="gs_tiket[]" style="width: 100%;"></select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_pilihan_tiket").append(`
                                                                    <div class="row mt-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select id="select_pilihan_tiket`+count+`" name="pilihan_tiket[]" style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                                                <option value="0">-- pilih salah satu --</option>
                                                                                <option>Bis</option>
                                                                                <option>Kereta Api</option>
                                                                                <option>Pesawat</option>
                                                                                <option>Travel</option>
                                                                                <option>Kapal Laut</option>
                                                                            </select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_tiket").append(`
                                                                    <div class="row mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select id="select_tiket`+count+`" name="tiket[]" style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                                                <option>-- pilih armada transportasi terlebih dahulu --</option>
                                                                            </select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                var s = document.createElement('script');
                                                                s.type = 'text/javascript';
                                                                s.className = 'remove';
                                                                var code = `
                                                                    $("#select_pilihan_tiket`+count+`").change(function() {
                                                                        var val = $(this).val();

                                                                        if (val == "Bis") {
                                                                            $("#select_tiket`+count+`").html(
                                                                                <?php if (empty($bus)) {?>
                                                                                    "<option>Tidak ada data</option>"
                                                                                <?php } else { ?>
                                                                                    "<?php foreach ($bus as $b => $bu) {?><option><?php echo $bu['nama_vendor']?></option><?php } ?>"
                                                                                <?php } ?>
                                                                            );
                                                                        } else if (val == "Kereta Api") {
                                                                            $("#select_tiket`+count+`").html(
                                                                                <?php if (empty($kereta)) {?>
                                                                                    "<option>Tidak ada data</option>"
                                                                                <?php } else { ?>
                                                                                    "<?php foreach ($kereta as $k => $ker) {?><option><?php echo $ker['nama_vendor']?></option><?php } ?>"
                                                                                <?php } ?>
                                                                            );
                                                                        } else if (val == "Pesawat") {
                                                                            $("#select_tiket`+count+`").html(
                                                                                <?php if (empty($pesawat)) {?>
                                                                                    "<option>Tidak ada data</option>"
                                                                                <?php } else { ?>
                                                                                    "<?php foreach ($pesawat as $p => $pes) {?><option><?php echo $pes['nama_vendor']?></option><?php } ?>"
                                                                                <?php } ?>
                                                                            );
                                                                        } else if (val == "Travel") {
                                                                            $("#select_tiket`+count+`").html(
                                                                                <?php if (empty($travel)) {?>
                                                                                    "<option>Tidak ada data</option>"
                                                                                <?php } else { ?>
                                                                                    "<?php foreach ($travel as $t => $tra) {?><option><?php echo $tra['nama_vendor']?></option><?php } ?>"
                                                                                <?php } ?>
                                                                            );
                                                                        } else if (val == "Kapal Laut") {
                                                                            $("#select_tiket`+count+`").html(
                                                                                <?php if (empty($kapal_laut)) {?>
                                                                                    "<option>Tidak ada data</option>"
                                                                                <?php } else { ?>
                                                                                    "<?php foreach ($kapal_laut as $ka => $kap) {?><option><?php echo $kap['nama_vendor']?></option><?php } ?>"
                                                                                <?php } ?>
                                                                            );
                                                                        } else if (val == "0") {
                                                                            $("#select_tiket`+count+`").html(
                                                                                "<option>-- pilih armada transportasi terlebih dahulu --</option>"
                                                                            );
                                                                        }
                                                                    });
                                                                `;
                                                                try {
                                                                s.appendChild(document.createTextNode(code));
                                                                $("#show_script_tiket").append(s);
                                                                } catch (e) {
                                                                s.text = code;
                                                                $("#show_script_tiket").append(s);
                                                                }

                                                                e.preventDefault();
                                                                $("#show_keberangkatan").append(`
                                                                    <div class="row mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select id="select_keberangkatan`+count+`" name="keberangkatan[]" style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                                                <option>-- pilih armada transportasi terlebih dahulu --</option>
                                                                            </select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                var s = document.createElement('script');
                                                                s.type = 'text/javascript';
                                                                s.className = 'remove';
                                                                var code = `
                                                                    $("#select_pilihan_tiket`+count+`").change(function() {
                                                                        var val = $(this).val();

                                                                        if (val == "Pesawat") {
                                                                            $("#select_keberangkatan`+count+`").html(
                                                                                <?php if (empty($bandara)) {?>
                                                                                    "<option>Tidak ada data</option>"
                                                                                <?php } else { ?>
                                                                                    "<?php foreach ($bandara as $b => $ba) {?><option><?php echo $ba['nama_pemberhentian']?> <?php echo "-" ?> <?php echo $ba['nama_kota']?></option><?php } ?>"
                                                                                <?php } ?>
                                                                            );
                                                                        } else if (val == "Kapal Laut") {
                                                                            $("#select_keberangkatan`+count+`").html(
                                                                                <?php if (empty($pelabuhan)) {?>
                                                                                    "<option>Tidak ada data</option>"
                                                                                <?php } else { ?>
                                                                                    "<?php foreach ($pelabuhan as $p => $pe) {?><option><?php echo $pe['nama_pemberhentian']?> <?php echo "-" ?> <?php echo $pe['nama_kota']?></option><?php } ?>"
                                                                                <?php } ?>
                                                                            );
                                                                        } else if (val == "Kereta Api") {
                                                                            $("#select_keberangkatan`+count+`").html(
                                                                                <?php if (empty($stasiun)) {?>
                                                                                    "<option>Tidak ada data</option>"
                                                                                <?php } else { ?>
                                                                                    "<?php foreach ($stasiun as $s => $st) {?><option><?php echo $st['nama_pemberhentian']?> <?php echo "-" ?> <?php echo $st['nama_kota']?></option><?php } ?>"
                                                                                <?php } ?>
                                                                            );
                                                                        } else if (val == "Bis") {
                                                                            $("#select_keberangkatan`+count+`").html(
                                                                                <?php if (empty($terminal)) {?>
                                                                                    "<option>Tidak ada data</option>"
                                                                                <?php } else { ?>
                                                                                    "<?php foreach ($terminal as $t => $te) {?><option><?php echo $te['nama_pemberhentian']?> <?php echo "-" ?> <?php echo $te['nama_kota']?></option><?php } ?>"
                                                                                <?php } ?>
                                                                            );
                                                                        } else if (val == "Travel") {
                                                                            $("#select_keberangkatan`+count+`").html(
                                                                                "<?php foreach ($kota as $ko => $kot) {?><option><?php echo $kot['nama_kota']?></option><?php } ?>"
                                                                            );
                                                                        } else if (val == "0") {
                                                                            $("#select_keberangkatan`+count+`").html(
                                                                                "<option>-- pilih armada transportasi terlebih dahulu --</option>"
                                                                            );
                                                                        }
                                                                    });
                                                                `;
                                                                try {
                                                                s.appendChild(document.createTextNode(code));
                                                                $("#show_script_keberangkatan").append(s);
                                                                } catch (e) {
                                                                s.text = code;
                                                                $("#show_script_keberangkatan").append(s);
                                                                }

                                                                e.preventDefault();
                                                                $("#show_pemberhentian").append(`
                                                                    <div class="row mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select id="select_pemberhentian`+count+`" name="pemberhentian[]" style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                                                <option>-- pilih armada transportasi terlebih dahulu --</option>
                                                                            </select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                var s = document.createElement('script');
                                                                s.type = 'text/javascript';
                                                                s.className = 'remove';
                                                                var code = `
                                                                    $("#select_pilihan_tiket`+count+`").change(function() {
                                                                        var val = $(this).val();

                                                                        if (val == "Pesawat") {
                                                                            $("#select_pemberhentian`+count+`").html(
                                                                                <?php if (empty($bandara)) {?>
                                                                                    "<option>Tidak ada data</option>"
                                                                                <?php } else { ?>
                                                                                    "<?php foreach ($bandara as $b => $ba) {?><option><?php echo $ba['nama_pemberhentian']?> <?php echo "-" ?> <?php echo $ba['nama_kota']?></option><?php } ?>"
                                                                                <?php } ?>
                                                                            );
                                                                        } else if (val == "Kapal Laut") {
                                                                            $("#select_pemberhentian`+count+`").html(
                                                                                <?php if (empty($pelabuhan)) {?>
                                                                                    "<option>Tidak ada data</option>"
                                                                                <?php } else { ?>
                                                                                    "<?php foreach ($pelabuhan as $p => $pe) {?><option><?php echo $pe['nama_pemberhentian']?> <?php echo "-" ?> <?php echo $pe['nama_kota']?></option><?php } ?>"
                                                                                <?php } ?>
                                                                            );
                                                                        } else if (val == "Kereta Api") {
                                                                            $("#select_pemberhentian`+count+`").html(
                                                                                <?php if (empty($stasiun)) {?>
                                                                                    "<option>Tidak ada data</option>"
                                                                                <?php } else { ?>
                                                                                    "<?php foreach ($stasiun as $s => $st) {?><option><?php echo $st['nama_pemberhentian']?> <?php echo "-" ?> <?php echo $st['nama_kota']?></option><?php } ?>"
                                                                                <?php } ?>
                                                                            );
                                                                        } else if (val == "Bis") {
                                                                            $("#select_pemberhentian`+count+`").html(
                                                                                <?php if (empty($terminal)) {?>
                                                                                    "<option>Tidak ada data</option>"
                                                                                <?php } else { ?>
                                                                                    "<?php foreach ($terminal as $t => $te) {?><option><?php echo $te['nama_pemberhentian']?> <?php echo "-" ?> <?php echo $te['nama_kota']?></option><?php } ?>"
                                                                                <?php } ?>
                                                                            );
                                                                        } else if (val == "Travel") {
                                                                            $("#select_pemberhentian`+count+`").html(
                                                                                "<?php foreach ($kota as $ko => $kot) {?><option><?php echo $kot['nama_kota']?></option><?php } ?>"
                                                                            );
                                                                        } else if (val == "0") {
                                                                            $("#select_pemberhentian`+count+`").html(
                                                                                "<option>-- pilih armada transportasi terlebih dahulu --</option>"
                                                                            );
                                                                        }
                                                                    });
                                                                `;
                                                                try {
                                                                s.appendChild(document.createTextNode(code));
                                                                $("#show_script_pemberhentian").append(s);
                                                                } catch (e) {
                                                                s.text = code;
                                                                $("#show_script_pemberhentian").append(s);
                                                                }

                                                                e.preventDefault();
                                                                $("#show_jumlah_tiket").append(`
                                                                    <input autocomplete="off" type="number" min="0" class="form-control mt-3 mb-3 remove" name="jumlah_tiket[]">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_harga_tiket").append(`
                                                                    <input required type="text" autocomplete="off" class="form-control mb-3 remove" name="harga_tiket[]" placeholder="Rp" id="currency-field_tiket`+count+`" data-type="currency" value="<?php echo "0"; ?>">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_tanggal_jam_tiket").append(`
                                                                    <input autocomplete="off" class="form-control mt-3 mb-3 remove" id="tanggal_jam_tiket`+count+`" name="tanggal_jam_tiket[]">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_keterangan_tiket").append(`
                                                                    <textarea class="form-control mt-3 mb-3 remove" name="keterangan_tiket[]" rows="3" placeholder=""></textarea>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_gs_hotel").append(`
                                                                    <div class="row mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select class="select_gs_hotel" name="gs_hotel[]" style="width: 100%;"></select>
                                                                        </div>
                                                                    </div>
                                                                `);
                                                                
                                                                e.preventDefault();
                                                                $("#show_kota").append(`
                                                                    <div class="row mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select id="select_kota`+count+`" name="kota[]" style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                                                <option value="pilih">-- pilih kota --</option>
                                                                                <?php foreach ($negara as $n => $neg) {?>
                                                                                    <optgroup label=<?php echo $neg['nama_negara'] ?>>
                                                                                        <?php foreach ($kota as $k => $kot) {?>
                                                                                            <?php if ($neg['id_negara'] == $kot['id_negara']) { ?>
                                                                                                <option><?php echo $kot['nama_kota'] ?></option>
                                                                                            <?php } ?>
                                                                                        <?php } ?>
                                                                                    </optgroup>
                                                                                <?php } ?>
                                                                            </select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_hotel").append(`
                                                                    <div class="row mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select id="select_hotel`+count+`" name="hotel[]" style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                                                <option value="pilih1">-- pilih kota terlebih dahulu --</option>
                                                                            </select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                var s = document.createElement('script');
                                                                s.type = 'text/javascript';
                                                                s.className = 'remove';
                                                                var code = `
                                                                    $("#select_kota`+count+`").change(function() {
                                                                        var val = $(this).val();

                                                                        <?php foreach ($kota as $k => $kot) {?>
                                                                            if (val == "<?php echo $kot['nama_kota'] ?>") {
                                                                                $("#select_hotel`+count+`").html(
                                                                                    "<option value=''>-- Daftar hotel --</option><?php foreach ($hotel as $h => $hote) {?><?php if ($kot['nama_kota'] == $hote['nama_kota']) { ?><option><?php echo $hote['nama_hotel'] ?><?php echo " - " ?><?php echo $hote['jenis_kamar'] ?></option><?php } ?><?php } ?>"
                                                                                );
                                                                            } else if (val == "pilih") {
                                                                                $("#select_hotel`+count+`").html(
                                                                                    "<option value='pilih1'>-- pilih kota terlebih dahulu --</option>"
                                                                                );
                                                                            }
                                                                        <?php } ?>
                                                                    });
                                                                `;
                                                                try {
                                                                s.appendChild(document.createTextNode(code));
                                                                $("#show_script_hotel").append(s);
                                                                } catch (e) {
                                                                s.text = code;
                                                                $("#show_script_hotel").append(s);
                                                                }

                                                                e.preventDefault();
                                                                $("#show_mess").append(`
                                                                    <div class="row mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select id="select_mess`+count+`" name="mess[]" style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                                                <option value="pilihmess">-- silahkan pilih Mess Kx Jkt terlebih dahulu --</option>
                                                                            </select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                var s = document.createElement('script');
                                                                s.type = 'text/javascript';
                                                                s.className = 'remove';
                                                                var code = `
                                                                    $("#select_hotel`+count+`").change(function() {
                                                                        var val = $(this).val();

                                                                        if (val == "Mess Kx Jkt - Standar") {
                                                                            $("#select_mess`+count+`").html(
                                                                                "<option>Tersedia untuk : <?php foreach ($mess as $m => $mes) { $sisa_kamar = $mes['kapasitas_kamar'] - $mes['terpakai'];?><?php echo $sisa_kamar ?><?php } ?> orang</option>"
                                                                            );
                                                                        } else {
                                                                            $("#select_mess`+count+`").html(
                                                                                "<option value='pilihmess'>-- silahkan pilih Mess Kx Jkt terlebih dahulu --</option>"
                                                                            );
                                                                        }
                                                                    });
                                                                `;
                                                                try {
                                                                s.appendChild(document.createTextNode(code));
                                                                $("#show_script_mess").append(s);
                                                                } catch (e) {
                                                                s.text = code;
                                                                $("#show_script_mess").append(s);
                                                                }

                                                                e.preventDefault();
                                                                $("#show_type").append(`
                                                                    <div class="row mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select class="select_type" name="type[]" style="width: 100%;"></select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_jumlah_kamar").append(`
                                                                    <input autocomplete="off" type="number" min="0" class="form-control mt-3 remove" name="jumlah_kamar[]">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_harga_hotel").append(`
                                                                    <div class="row remove">
                                                                        <div class="col-md-12">
                                                                            <div id="harga_hotel`+count+`" style="display:block;">
                                                                                <div class="row mt-3">
                                                                                    <div>
                                                                                        Harga Total Hotel<a style="color: #e74a3b">*</a>
                                                                                    </div>
                                                                                </div>
                                                                                <input required type="text" autocomplete="off" class="form-control mt-1 remove" name="harga_hotel[]" style="display:block;" placeholder="Rp" id="currency-field_hotel`+count+`" data-type="currency" value="<?php echo "0"; ?>">
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                var s = document.createElement('script');
                                                                s.type = 'text/javascript';
                                                                s.className = 'remove';
                                                                var code = `
                                                                    $("#select_hotel`+count+`").change(function() {
                                                                        var val = $(this).val();

                                                                        if (val == "Mess Kx Jkt - Standar") {
                                                                            document.getElementById('harga_hotel`+count+`').style.display = "none";
                                                                        } else {
                                                                            document.getElementById('harga_hotel`+count+`').style.display = "block";
                                                                        }
                                                                    });
                                                                `;
                                                                try {
                                                                s.appendChild(document.createTextNode(code));
                                                                $("#show_script_harga_hotel").append(s);
                                                                } catch (e) {
                                                                s.text = code;
                                                                $("#show_script_harga_hotel").append(s);
                                                                }

                                                                e.preventDefault();
                                                                $("#show_tanggal_jam_masuk").append(`
                                                                    <input autocomplete="off" class="form-control mt-3 mb-3 remove" id="tanggal_jam_masuk`+count+`" name="tanggal_jam_masuk[]">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_tanggal_jam_keluar").append(`
                                                                    <input autocomplete="off" class="form-control mt-3 mb-3 remove" id="tanggal_jam_keluar`+count+`" name="tanggal_jam_keluar[]">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_keterangan_akomodasi").append(`
                                                                    <textarea class="form-control mt-3 mb-3 remove" name="keterangan_akomodasi[]" rows="3" placeholder=""></textarea>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_gs_mobil").append(`
                                                                    <div class="row mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select class="select_gs_mobil" name="gs_mobil[]" style="width: 100%;"></select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_jenis_kendaraan").append(`
                                                                    <div class="row mb-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select class="select_jenis_kendaraan" name="jenis_kendaraan[]" style="width: 100%;"></select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_dalkot_lukot").append(`
                                                                    <div class="row mt-3 remove">
                                                                        <div class="col-md-12">
                                                                            <select id="dalkot_lukot`+count+`" name="dalkot_lukot[]" onchange="showD`+count+`(this)" style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                                                <option value="Dalam Kota">Dalam Kota</option>
                                                                                <option value="Luar Kota">Luar Kota</option>
                                                                            </select>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                var s = document.createElement('script');
                                                                s.type = 'text/javascript';
                                                                s.className = 'remove';
                                                                var code = `
                                                                    function showD`+count+`(select) {
                                                                        if (select.value == 'Dalam Kota') {
                                                                            document.getElementById('menginap`+count+`').style.display =
                                                                                "none";
                                                                        } else if (select.value == 'Luar Kota') {
                                                                            document.getElementById('menginap`+count+`').style.display =
                                                                                "block";
                                                                        }
                                                                    }
                                                                `;
                                                                try {
                                                                s.appendChild(document.createTextNode(code));
                                                                $("#show_script_dalkot_lukot").append(s);
                                                                } catch (e) {
                                                                s.text = code;
                                                                $("#show_script_dalkot_lukot").append(s);
                                                                }

                                                                e.preventDefault();
                                                                $("#show_menginap").append(`
                                                                    <div class="row remove">
                                                                        <div class="col-md-12">
                                                                            <div class="mt-3" id="menginap`+count+`" style="display:none;">
                                                                                <div>
                                                                                    Menginap
                                                                                </div>

                                                                                <select class="select_menginap" name="menginap[]"
                                                                                    style="width: 100%; padding-left: 3.5px; font-size: 25px;">
                                                                                    <option>Iya</option>
                                                                                    <option>Tidak</option>
                                                                                </select>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_jumlah_mobil").append(`
                                                                    <input autocomplete="off" type="number" min="0" class="form-control mt-3 mb-3 remove" name="jumlah_mobil[]">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_kapasitas").append(`
                                                                    <input autocomplete="off" type="number" min="0" class="form-control mt-3 mb-3 remove" name="kapasitas[]">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_tujuan_mobil").append(`
                                                                    <input autocomplete="off" type="text" class="form-control mt-3 mb-3 remove" name="tujuan_mobil[]" style="text-transform:capitalize">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_siap_di").append(`
                                                                    <input autocomplete="off" type="text" class="form-control mt-3 mb-3 remove" name="siap_di[]" style="text-transform:capitalize">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_tanggal_mobil").append(`
                                                                    <input autocomplete="off" class="form-control mt-3 mb-3 remove" id="tanggal_mobil`+count+`" name="tanggal_mobil[]">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_jam_siap").append(`
                                                                    <input autocomplete="off" class="form-control mt-3 mb-3 remove" id="jam_siap`+count+`" name="jam_siap[]">
                                                                `);

                                                                e.preventDefault();
                                                                $("#show_keterangan_mobil").append(`
                                                                    <textarea class="form-control mt-3 mb-3 remove" id="keterangan_mobil`+count+`" name="keterangan_mobil[]" rows="3" placeholder=""></textarea>
                                                                `);

                                                                var data_select = [
                                                                    <?php foreach ($pengguna as $peng) : ?> "<?php echo $peng['nama_pengguna']?>",
                                                                    <?php endforeach ?>
                                                                ]

                                                                $(".select_nama").select2({
                                                                    // tags:["Semua"],
                                                                    data: data_select,
                                                                    // tags: true,
                                                                    // tokenSeparators: [',', ' '],
                                                                });

                                                                var data_select = [
                                                                    //     <php foreach ($bag as $bag) : ?> "<php echo $bag['strorgnm']?>",
                                                                    //     <php endforeach ?>
                                                                    'Direksi', 'Manager', 'Officer', 'Supervisor', 'Pelaksana'
                                                                ]

                                                                $(".select_jabatan").select2({
                                                                    // tags:["Semua"],
                                                                    data: data_select,
                                                                    // tags: true,
                                                                    // tokenSeparators: [',', ' '],
                                                                });

                                                                var data_select = [
                                                                    <?php foreach ($pengguna as $peng) : ?> "<?php echo $peng['nama_pengguna']?>",
                                                                    <?php endforeach ?>
                                                                ]

                                                                $(".select_email_info").select2({
                                                                    // tags:["Semua"],
                                                                    data: data_select,
                                                                    // tags: true,
                                                                    // tokenSeparators: [',', ' '],
                                                                });

                                                                var data_select = [
                                                                    <?php foreach ($pengguna as $peng) : ?> "<?php echo $peng['nama_pengguna']?>",
                                                                    <?php endforeach ?>
                                                                ]

                                                                $(".select_email_eval").select2({
                                                                    // tags:["Semua"],
                                                                    data: data_select,
                                                                    // tags: true,
                                                                    // tokenSeparators: [',', ' '],
                                                                });

                                                                var data_select = ['Company Acc', 'Personal Acc']

                                                                $(".select_pembayaran").select2({
                                                                    data: data_select,
                                                                    // tags: true,
                                                                    // tokenSeparators: [',', ' '],
                                                                });

                                                                var data_select = ['Non Tamu', 'Tamu']

                                                                $(".select_tamu").select2({
                                                                    data: data_select,
                                                                    // tags: true,
                                                                    // tokenSeparators: [',', ' '],
                                                                });

                                                                var data_select = [
                                                                    <?php foreach ($pengguna as $peng) : ?> "<?php echo $peng['nama_pengguna']?>",
                                                                    <?php endforeach ?>'Tamu'
                                                                ]

                                                                $(".select_pic").select2({
                                                                    data: data_select,
                                                                    // tags: true,
                                                                    // tokenSeparators: [',', ' '],
                                                                });

                                                                var data_select = [
                                                                    <?php foreach ($pool as $poo) : ?> "<?php echo $poo['nama_pool']?>",
                                                                    <?php endforeach ?>
                                                                ]

                                                                $(".select_gs_tiket").select2({
                                                                    data: data_select,
                                                                    // tags: true,
                                                                    // tokenSeparators: [',', ' '],
                                                                });

                                                                $("input[data-type='currency']").on({
                                                                    keyup: function() {
                                                                    formatCurrency($(this));
                                                                    },
                                                                    blur: function() { 
                                                                    formatCurrency($(this), "blur");
                                                                    }
                                                                });

                                                                function formatNumber(n) {
                                                                // format number 1000000 to 1,234,567
                                                                return n.replace(/\D/g, "").replace(/\B(?=(\d{3})+(?!\d))/g, ".")
                                                                }

                                                                function formatCurrency(input, blur) {
                                                                // appends $ to value, validates decimal side
                                                                // and puts cursor back in right position.
                                                                
                                                                // get input value
                                                                var input_val = input.val();
                                                                
                                                                // don't validate empty input
                                                                if (input_val === "") { return; }
                                                                
                                                                // original length
                                                                var original_len = input_val.length;

                                                                // initial caret position 
                                                                var caret_pos = input.prop("selectionStart");
                                                                    
                                                                // check for decimal
                                                                if (input_val.indexOf(",") >= 0) {

                                                                    // get position of first decimal
                                                                    // this prevents multiple decimals from
                                                                    // being entered
                                                                    var decimal_pos = input_val.indexOf(",");

                                                                    // split number by decimal point
                                                                    var left_side = input_val.substring(0, decimal_pos);
                                                                    var right_side = input_val.substring(decimal_pos);

                                                                    // add commas to left side of number
                                                                    left_side = formatNumber(left_side);

                                                                    // validate right side
                                                                    right_side = formatNumber(right_side);
                                                                    
                                                                    // On blur make sure 2 numbers after decimal
                                                                    if (blur === "blur") {
                                                                    right_side += "00";
                                                                    }
                                                                    
                                                                    // Limit decimal to only 2 digits
                                                                    right_side = right_side.substring(0, 2);

                                                                    // join number by .
                                                                    input_val = "Rp" + left_side + "," + right_side;

                                                                } 
                                                                else {
                                                                    // no decimal entered
                                                                    // add commas to number
                                                                    // remove all non-digits
                                                                    input_val = formatNumber(input_val);
                                                                    input_val = "Rp" + input_val;
                                                                    
                                                                    // final formatting
                                                                    if (blur === "blur") {
                                                                    input_val += "";
                                                                    }
                                                                }
                                                                
                                                                // send updated string to input
                                                                input.val(input_val);

                                                                // put caret back in the right position
                                                                var updated_len = input_val.length;
                                                                caret_pos = updated_len - original_len + caret_pos;
                                                                input[0].setSelectionRange(caret_pos, caret_pos);
                                                                }

                                                                $.datetimepicker.setLocale('id');
                                                                $('#tanggal_jam_tiket'+count+'').datetimepicker({
                                                                    format: 'Y-m-d H:i',
                                                                    formatDate: 'Y-m-d',
                                                                    formatTime: 'H:i',
                                                                    minDate:'0',
                                                                    step: 1,
                                                                    closeOnTimeSelect : true,
                                                                    scrollMonth : false,
                                                                    scrollInput : false,
                                                                });

                                                                var data_select = [
                                                                    <?php foreach ($pool as $poo) : ?> "<?php echo $poo['nama_pool']?>",
                                                                    <?php endforeach ?>
                                                                ]

                                                                $(".select_gs_hotel").select2({
                                                                    data: data_select,
                                                                    // tags: true,
                                                                    // tokenSeparators: [',', ' '],
                                                                });

                                                                var data_select = ['Single', 'Twin / Double']

                                                                $(".select_type").select2({
                                                                    data: data_select,
                                                                    // tags: true,
                                                                    // tokenSeparators: [',', ' '],
                                                                });

                                                                $.datetimepicker.setLocale('id');
                                                                $('#tanggal_jam_masuk'+count+'').datetimepicker({
                                                                    format: 'Y-m-d H:i',
                                                                    formatDate: 'Y-m-d',
                                                                    formatTime: 'H:i',
                                                                    minDate:'0',
                                                                    step: 1,
                                                                    closeOnTimeSelect : true,
                                                                    scrollMonth : false,
                                                                    scrollInput : false,
                                                                });

                                                                $.datetimepicker.setLocale('id');
                                                                $('#tanggal_jam_keluar'+count+'').datetimepicker({
                                                                    format: 'Y-m-d H:i',
                                                                    formatDate: 'Y-m-d',
                                                                    formatTime: 'H:i',
                                                                    minDate:'0',
                                                                    step: 1,
                                                                    closeOnTimeSelect : true,
                                                                    scrollMonth : false,
                                                                    scrollInput : false,
                                                                });

                                                                var data_select = [
                                                                    <?php foreach ($pool as $poo) : ?> "<?php echo $poo['nama_pool']?>",
                                                                    <?php endforeach ?>
                                                                ]

                                                                $(".select_gs_mobil").select2({
                                                                    data: data_select,
                                                                    // tags: true,
                                                                    // tokenSeparators: [',', ' '],
                                                                });

                                                                var data_select = [
                                                                    'Sedan', 'Station', 'Pickup', 'Box', 'Truck'
                                                                ]

                                                                $(".select_jenis_kendaraan").select2({
                                                                    data: data_select,
                                                                    // tags: true,
                                                                    // tokenSeparators: [',', ' '],
                                                                });

                                                                $.datetimepicker.setLocale('id');
                                                                $('#tanggal_mobil'+count+'').datetimepicker({
                                                                    format: 'Y-m-d',
                                                                    formatDate: 'Y-m-d',
                                                                    minDate:'0',
                                                                    step: 1,
                                                                    timepicker : false,
                                                                    closeOnDateSelect : true,
                                                                    scrollMonth : false,
                                                                    scrollInput : false,
                                                                });

                                                                $.datetimepicker.setLocale('id');
                                                                $('#jam_siap'+count+'').datetimepicker({
                                                                    format: 'H:i',
                                                                    formatTime: 'H:i',
                                                                    step: 1,
                                                                    datepicker : false,
                                                                });

                                                                var data_select = [
                                                                    <?php foreach ($pool as $poo) : ?> "<?php echo $poo['nama_pool']?>",
                                                                    <?php endforeach ?>
                                                                ]

                                                                $('select:not(.normal)').each(function() {
                                                                    $(this).select2({
                                                                        // tags: true,
                                                                        dropdownParent: $(this)
                                                                            .parent()
                                                                    });
                                                                });
                                                            });

                                                            $('#remove_item_btn').click(function () {
                                                                $('.remove').remove();
                                                            });
                                                        });
                                                    </script>
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </section>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="content-footer footer bg-footer-theme">
        <div class="container-xxl d-flex flex-wrap justify-content-center">
            <div class="mb-2 mb-md-0">
                Copyright &copy; <strong><span>MIS 2024</span></strong>.
            </div>
        </div>
    </footer>
    <!-- / Footer -->

    <div class="content-backdrop fade"></div>
</div>
<!-- Content wrapper -->

            //Tiket
            if($pemesanan == '0') {
                //Trans
                $pic = $_POST['pic'];

                $id_trans = $this->m_trans->select('id_trans')->orderBy('id_trans', 'desc')->first();
                if (empty($id_trans)) {
                    $id_trans1 = 1;
                    $id_trans2 = 1;
                } else {
                    $id_trans1 = (int)$id_trans['id_trans'] + 1;
                    $id_trans2 = (int)$id_trans['id_trans'] + 1;
                }

                //Tiket
                $nama = $_POST['nama'];
                $jabatan = $_POST['jabatan'];
                $email_info = $_POST['email_info'];
                $email_eval = $_POST['email_eval'];
                $jumlah_tiket = $_POST['jumlah_tiket'];
                $tanggal_jam_tiket = $_POST['tanggal_jam_tiket'];

                $email_pengguna = $this->m_pengguna->whereIn('nama_pengguna', $email_info)->select('email_pengguna')->findAll();

                // try {
                //     //Server settings
                //     // $mail->SMTPDebug = SMTP::DEBUG_SERVER;
                //     $mail->isSMTP();
                //     $mail->Host       = 'mail.konimex.com';
                //     $mail->SMTPAuth   = true;
                //     $mail->Username   = PDLN_EMAIL;
                //     $mail->Password   = PDLN_PASS;
                //     $mail->SMTPSecure = PHPMailer::ENCRYPTION_STARTTLS;
                //     $mail->Port       = 587;
                
                //     //Recipients
                //     $mail->setFrom('noreply@konimex.com');

                //     foreach ($email_pengguna_info as $e => $ema) {
                //         $mail->addAddress($ema['email_pengguna']);//Add a recipient
                //     }
                
                //     //Content
                //     // $link='https://konimex.com:447/pdln/listpb/pb/'.$id_transaksi;
                //     $mail->Subject = 'Tes Program TABS (Bimo)';
                //     $mail->Body    = nl2br("Tes kirim email harap diabaikan saja terima kasih.");
                //     // $mail->Body    = nl2br("User bagian (").$niknmuser['niknm']."/".$nikuser['nik']."/".$nikuser['strorgnm'].(") telah selesai mengisi data PB, silahkan periksa data PB dengan cara klik link: $link");
                
                //     $mail->send();
                //     // echo 'Message has been sent';
                // } catch (Exception $e) {
                //     echo "Message could not be sent. Mailer Error: {$mail->ErrorInfo}";
                // }

                if(!empty($nama)) {
                    for($a = 0; $a < count($nama); $a++) {
                        // $pemberhentian = $_POST['pemberhentian'];

                        // $nama_pemberhentian = substr($pemberhentian[$a], 0, strpos($pemberhentian[$a], " - "));
                        // $id_pemberhentian = $this->m_pemberhentian->where('nama_pemberhentian', $nama_pemberhentian)->select('id_pemberhentian')->findAll();

                        // $dari_tiket = $_POST['dari_tiket'][$a];
                        // $tujuan_tiket = $_POST['tujuan_tiket'][$a];

                        // if ($dari_tiket == $tujuan_tiket) {
                        //     session()->setFlashdata('warning', ['Dari dan Tujuan Tiket tidak boleh sama']);
                        //     return redirect()->to('trans_add');
                        // }

                        //Trans
                        $pic = $_POST['pic'][$a];
                        $pic = ucwords($pic);
                        
                        //Tiket
                        $nama_tiket = $_POST['tiket'];
                        $nama_pool = $_POST['gs_tiket'];
                        $keberangkatan = $_POST['keberangkatan'];
                        $pemberhentian = $_POST['pemberhentian'];

                        if ($_POST['pilihan_tiket'][$a] == 0) {
                            session()->setFlashdata('warning', ['Pilih armada transportasi terlebih dahulu']);
                            return redirect()->to('trans_add');
                        } else if ($_POST['pilihan_tiket'][$a] == "Travel") {
                            $id_keberangkatan = null;
                            $id_pemberhentian = null;
                            $dari_tiket = $_POST['keberangkatan'][$a];
                            $tujuan_tiket = $_POST['pemberhentian'][$a];
                        } else {
                            $nama_keberangkatan = substr($keberangkatan[$a], 0, strpos($keberangkatan[$a], " - "));
                            $dari_tiket = substr($keberangkatan[$a], strpos($keberangkatan[$a], " - ")+3);
                            $id_berangkat = $this->m_pemberhentian->where('nama_pemberhentian', $nama_keberangkatan)->select('id_pemberhentian')->findAll();
                            $id_keberangkatan = $id_berangkat[0]['id_pemberhentian'];
                            
                            $nama_pemberhentian = substr($pemberhentian[$a], 0, strpos($pemberhentian[$a], " - "));
                            $tujuan_tiket = substr($pemberhentian[$a], strpos($pemberhentian[$a], " - ")+3);
                            $id_berhenti = $this->m_pemberhentian->where('nama_pemberhentian', $nama_pemberhentian)->select('id_pemberhentian')->findAll();
                            $id_pemberhentian = $id_berhenti[0]['id_pemberhentian'];
                        }

                        if ($_POST['keberangkatan'][$a] == $_POST['pemberhentian'][$a]) {
                            session()->setFlashdata('warning', ['Keberangkatan dan Pemberhentian Tiket tidak boleh sama']);
                            return redirect()->to('trans_add');
                        }
                        
                        $vendor = $this->m_vendor->where('nama_vendor', $nama_tiket[$a])->select('id_vendor')->findAll();
                        $pool_tiket = $this->m_pool->where('nama_pool', $nama_pool[$a])->select('id_pool')->findAll();

                        if ($_POST['tamu'][$a] == 'Tamu') {
                            $atas_nama = 'Tamu';
                            $jabatan = 'Tamu';
                        } else {
                            $atas_nama = $_POST['nama'][$a];
                            $atas_nama = ucwords($atas_nama);

                            $jabatan = $_POST['jabatan'][$a];
                            $jabatan = ucwords($jabatan);
                        }

                        $pembayaran = $_POST['pembayaran'][$a];
                        if($pembayaran == 'Company Acc'){
                            $pembayaran = 'k';
                        } else if($pembayaran == 'Personal Acc'){
                            $pembayaran = 'p';
                        }

                        $keterangan_tiket = $_POST['keterangan_tiket'][$a];
                        if(empty($keterangan_tiket)){
                            $keterangan_tiket = null;
                        }

                        if(!empty($_POST['nama'][$a]) && !empty($_POST['jabatan'][$a]) && !empty($_POST['pic'][$a]) && !empty($_POST['email_eval'][$a]) && !empty($_POST['jumlah_tiket'][$a]) && !empty($_POST['tanggal_jam_tiket'][$a])) {
                            $trans[] = array(
                                'id_trans' => $id_trans1++,
                                'id_detail_pengguna' => session()->get('id_detail_pengguna'),
                                'id_bagian' => session()->get('id_bagian'),
                                'pemesanan' => $this->request->getVar('pemesanan'),
                                'pic' => $pic,
                                'tamu' => $_POST['tamu'][$a],
                                'tgl_input' => date('Ymd'),
                            );

                            $tiket[] = array(
                                'id_trans' => $id_trans2++,
                                'id_vendor' => $vendor[0]['id_vendor'],
                                'id_keberangkatan' => $id_keberangkatan,
                                'id_pemberhentian' => $id_pemberhentian,
                                'id_pool' => $pool_tiket[0]['id_pool'],
                                'peminta' => session()->get('nama_pengguna'),
                                'atas_nama' => $atas_nama,
                                'jabatan' => $jabatan,
                                'jumlah_tiket' => $_POST['jumlah_tiket'][$a],
                                'pembayaran' => $pembayaran,
                                'harga_tiket' => null,
                                'tanggal_jam_tiket' => $_POST['tanggal_jam_tiket'][$a],
                                'dari_tiket' => $dari_tiket,
                                'tujuan_tiket' => $tujuan_tiket,
                                'email_info' => $_POST['email_info'][$a],
                                'email_eval' => $_POST['email_eval'][$a],
                                'kirim_eval' => 0,
                                'keterangan_tiket' => $keterangan_tiket,
                                'tgl_input' => date('Ymd'),
                            );
                        } else {
                            if(empty($_POST['nama'][$a])) {
                                session()->setFlashdata('warning', ['Nama harus diisi']);
                                return redirect()->to("trans_add");
                            } else if(empty($_POST['jabatan'][$a])) {
                                session()->setFlashdata('warning', ['Jabatan harus diisi']);
                                return redirect()->to("trans_add");
                            } else if(empty($_POST['pic'][$a])) {
                                session()->setFlashdata('warning', ['PIC harus diisi']);
                                return redirect()->to("trans_add");
                            } else if(empty($_POST['email_eval'][$a])) {
                                session()->setFlashdata('warning', ['Email Evaluasi harus diisi']);
                                return redirect()->to("trans_add");
                            } else if(empty($_POST['jumlah_tiket'][$a])) {
                                session()->setFlashdata('warning', ['Jumlah tiket harus diisi']);
                                return redirect()->to("trans_add");
                            } else if(empty($_POST['tanggal_jam_tiket'][$a])) {
                                session()->setFlashdata('warning', ['Tanggal dan Jam tiket harus diisi']);
                                return redirect()->to("trans_add");
                            }
                        }
                    }
                }
                
                $this->m_trans->insertBatch($trans);
                $this->m_tiket->insertBatch($tiket);
                session()->setFlashdata('success', ('Data berhasil ditambahkan'));
                return redirect()->to("trans");

                // $this->m_id->updateBatch($record);//edit data
            } 
            //Hotel
            else if ($pemesanan == '1') {
                //Trans
                $pic = $_POST['pic'];

                $id_trans = $this->m_trans->select('id_trans')->orderBy('id_trans', 'desc')->first();
                if (empty($id_trans)) {
                    $id_trans1 = 1;
                    $id_trans2 = 1;
                } else {
                    $id_trans1 = (int)$id_trans['id_trans'] + 1;
                    $id_trans2 = (int)$id_trans['id_trans'] + 1;
                }

                //Hotel
                $nama = $_POST['nama'];
                $email_info = $_POST['email_info'];
                $email_eval = $_POST['email_eval'];
                $jumlah_kamar = $_POST['jumlah_kamar'];
                $tanggal_jam_masuk = $_POST['tanggal_jam_masuk'];
                $tanggal_jam_keluar = $_POST['tanggal_jam_keluar'];

                $email_pengguna_info = $this->m_pengguna->whereIn('nama_pengguna', $email_info)->select('email_pengguna')->findAll();

                // try {
                //     //Server settings
                //     // $mail->SMTPDebug = SMTP::DEBUG_SERVER;
                //     $mail->isSMTP();
                //     $mail->Host       = 'mail.konimex.com';
                //     $mail->SMTPAuth   = true;
                //     $mail->Username   = PDLN_EMAIL;
                //     $mail->Password   = PDLN_PASS;
                //     $mail->SMTPSecure = PHPMailer::ENCRYPTION_STARTTLS;
                //     $mail->Port       = 587;
                
                //     //Recipients
                //     $mail->setFrom('noreply@konimex.com');

                //     foreach ($email_pengguna_info as $e => $ema) {
                //         $mail->addAddress($ema['email_pengguna']);//Add a recipient
                //     }
                
                //     //Content
                //     // $link='https://konimex.com:447/pdln/listpb/pb/'.$id_transaksi;
                //     $mail->Subject = 'Tes Program TABS (Bimo)';
                //     $mail->Body    = nl2br("Tes kirim email harap diabaikan saja terima kasih.");
                //     // $mail->Body    = nl2br("User bagian (").$niknmuser['niknm']."/".$nikuser['nik']."/".$nikuser['strorgnm'].(") telah selesai mengisi data PB, silahkan periksa data PB dengan cara klik link: $link");
                
                //     $mail->send();
                //     // echo 'Message has been sent';
                // } catch (Exception $e) {
                //     echo "Message could not be sent. Mailer Error: {$mail->ErrorInfo}";
                // }

                if(!empty($nama)) {
                    for($a = 0; $a < count($nama); $a++) {
                        //Trans
                        $pic = $_POST['pic'][$a];
                        $pic = ucwords($pic);
                        
                        //Hotel
                        $nama_pool = $_POST['gs_hotel'];
                        $nama_kota = $_POST['kota'];
                        $nama_akomodasi = $_POST['hotel'];

                        $nama_hotel = substr($nama_akomodasi[$a], 0, strpos($nama_akomodasi[$a], " - "));
                        $jenis_kamar = substr($nama_akomodasi[$a], strpos($nama_akomodasi[$a], ' - ') + 3);

                        $pool_hotel = $this->m_pool->where('nama_pool', $nama_pool[$a])->select('id_pool')->findAll();
                        $kota_hotel = $this->m_kota->where('nama_kota', $nama_kota[$a])->select('id_kota')->findAll();
                        $id_hotel = $this->m_hotel->where('nama_hotel', $nama_hotel)->select('id_hotel')->findAll();
                        if (empty($id_hotel)) {
                            session()->setFlashdata('warning', ['Tidak ada data Hotel']);
                            return redirect()->to("trans_add");
                        }
                        $id_detail_hotel = $this->m_detail_hotel->where('id_hotel', $id_hotel[0]['id_hotel'])->where('jenis_kamar', $jenis_kamar)->select('id_detail_hotel')->findAll();

                        if ($nama_hotel == "Mess Kx Jkt") {
                            $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                            $status_mess = 1;
                            
                            foreach ($mess as $m => $mes) {
                                if ($mes['terpakai'] == 18) {
                                    session()->setFlashdata('warning', ['Mess Kx Jkt sudah penuh']);
                                    return redirect()->to("trans_add");
                                } else {
                                    $terpakai = [
                                        'id_mess' => 8,
                                        'terpakai' => $mes['terpakai'] + $jumlah_kamar[$a],
                                        'edited_at' => $timestamp,
                                    ];
                                    $this->m_mess->save($terpakai);
                                }
                            }
                        } else {
                            $status_mess = 0;
                        }

                        if ($_POST['tamu'][$a] == 'Tamu') {
                            $atas_nama = 'Tamu';
                            $jabatan = 'Tamu';
                        } else {
                            $atas_nama = $_POST['nama'][$a];
                            $atas_nama = ucwords($atas_nama);

                            $jabatan = $_POST['jabatan'][$a];
                            $jabatan = ucwords($jabatan);
                        }

                        $pembayaran = $_POST['pembayaran'][$a];
                        if($pembayaran == 'Company Acc'){
                            $pembayaran = 'k';
                        } else if($pembayaran == 'Personal Acc'){
                            $pembayaran = 'p';
                        }

                        $keterangan_akomodasi = $_POST['keterangan_akomodasi'][$a];
                        if(empty($keterangan_akomodasi)){
                            $keterangan_akomodasi = null;
                        }

                        if(!empty($_POST['nama'][$a]) && !empty($_POST['jabatan'][$a]) && !empty($_POST['pic'][$a]) && !empty($_POST['email_eval'][$a]) && !empty($_POST['jumlah_kamar'][$a]) && !empty($_POST['tanggal_jam_masuk'][$a]) && !empty($_POST['tanggal_jam_keluar'][$a])) {
                            $trans[] = array(
                                'id_trans' => $id_trans1++,
                                'id_detail_pengguna' => session()->get('id_detail_pengguna'),
                                'id_bagian' => session()->get('id_bagian'),
                                'pemesanan' => $this->request->getVar('pemesanan'),
                                'tamu' => $_POST['tamu'][$a],
                                'pic' => $pic,
                                'tgl_input' => date('Ymd'),
                            );

                            $akomodasi[] = array(
                                'id_trans' => $id_trans2++,
                                'id_hotel' => $id_hotel[0]['id_hotel'],
                                'id_detail_hotel' => $id_detail_hotel[0]['id_detail_hotel'],
                                'id_pool' => $pool_hotel[0]['id_pool'],
                                'id_kota' => $kota_hotel[0]['id_kota'],
                                'peminta' => session()->get('nama_pengguna'),
                                'atas_nama' => $atas_nama,
                                'jabatan' => $jabatan,
                                'type' => $_POST['type'][$a],
                                'jumlah_kamar' => $_POST['jumlah_kamar'][$a],
                                'pembayaran' => $pembayaran,
                                'harga_akomodasi' => null,
                                'email_info' => $_POST['email_info'][$a],
                                'email_eval' => $_POST['email_eval'][$a],
                                'tanggal_jam_masuk' => $tanggal_jam_masuk[$a],
                                'tanggal_jam_keluar' => $tanggal_jam_keluar[$a],
                                'kirim_eval' => 0,
                                'status_mess' => $status_mess,
                                'status_akomodasi' => 0,
                                'keterangan_akomodasi' => $keterangan_akomodasi,
                                'tgl_input' => date('Ymd'),
                            );
                        } else {
                            if(empty($_POST['nama'][$a])) {
                                if ($nama_hotel == "Mess Kx Jkt") {
                                    $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                    
                                    foreach ($mess as $m => $mes) {
                                        if ($mes['terpakai'] == 0) {
                                            
                                        } else {
                                            $terpakai = [
                                                'id_mess' => 8,
                                                'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                'edited_at' => $timestamp,
                                            ];
                                            $this->m_mess->save($terpakai);
                                        }
                                    }
                                }
                                session()->setFlashdata('warning', ['Nama harus diisi']);
                                return redirect()->to("trans_add");
                            } else if(empty($_POST['jabatan'][$a])) {
                                if ($nama_hotel == "Mess Kx Jkt") {
                                    $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                    
                                    foreach ($mess as $m => $mes) {
                                        if ($mes['terpakai'] == 0) {
                                            
                                        } else {
                                            $terpakai = [
                                                'id_mess' => 8,
                                                'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                'edited_at' => $timestamp,
                                            ];
                                            $this->m_mess->save($terpakai);
                                        }
                                    }
                                }
                                session()->setFlashdata('warning', ['Jabatan harus diisi']);
                                return redirect()->to("trans_add");
                            } else if(empty($_POST['pic'][$a])) {
                                if ($nama_hotel == "Mess Kx Jkt") {
                                    $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                    
                                    foreach ($mess as $m => $mes) {
                                        if ($mes['terpakai'] == 0) {
                                            
                                        } else {
                                            $terpakai = [
                                                'id_mess' => 8,
                                                'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                'edited_at' => $timestamp,
                                            ];
                                            $this->m_mess->save($terpakai);
                                        }
                                    }
                                }
                                session()->setFlashdata('warning', ['PIC harus diisi']);
                                return redirect()->to("trans_add");
                            } else if(empty($_POST['email_eval'][$a])) {
                                if ($nama_hotel == "Mess Kx Jkt") {
                                    $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                    
                                    foreach ($mess as $m => $mes) {
                                        if ($mes['terpakai'] == 0) {
                                            
                                        } else {
                                            $terpakai = [
                                                'id_mess' => 8,
                                                'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                'edited_at' => $timestamp,
                                            ];
                                            $this->m_mess->save($terpakai);
                                        }
                                    }
                                }
                                session()->setFlashdata('warning', ['Email Evaluasi harus diisi']);
                                return redirect()->to("trans_add");
                            } else if(empty($_POST['jumlah_kamar'][$a])) {
                                if ($nama_hotel == "Mess Kx Jkt") {
                                    $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                    
                                    foreach ($mess as $m => $mes) {
                                        if ($mes['terpakai'] == 0) {
                                            
                                        } else {
                                            $terpakai = [
                                                'id_mess' => 8,
                                                'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                'edited_at' => $timestamp,
                                            ];
                                            $this->m_mess->save($terpakai);
                                        }
                                    }
                                }
                                session()->setFlashdata('warning', ['Jumlah Kamar harus diisi']);
                                return redirect()->to("trans_add");
                            } else if(empty($_POST['tanggal_jam_masuk'][$a])) {
                                if ($nama_hotel == "Mess Kx Jkt") {
                                    $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                    
                                    foreach ($mess as $m => $mes) {
                                        if ($mes['terpakai'] == 0) {
                                            
                                        } else {
                                            $terpakai = [
                                                'id_mess' => 8,
                                                'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                'edited_at' => $timestamp,
                                            ];
                                            $this->m_mess->save($terpakai);
                                        }
                                    }
                                }
                                session()->setFlashdata('warning', ['Tanggal dan Jam Masuk harus diisi']);
                                return redirect()->to("trans_add");
                            } else if(empty($_POST['tanggal_jam_keluar'][$a])) {
                                if ($nama_hotel == "Mess Kx Jkt") {
                                    $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                    
                                    foreach ($mess as $m => $mes) {
                                        if ($mes['terpakai'] == 0) {
                                            
                                        } else {
                                            $terpakai = [
                                                'id_mess' => 8,
                                                'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                'edited_at' => $timestamp,
                                            ];
                                            $this->m_mess->save($terpakai);
                                        }
                                    }
                                }
                                session()->setFlashdata('warning', ['Tanggal dan Jam Keluar harus diisi']);
                                return redirect()->to("trans_add");
                            }
                        }
                    }
                }
                
                $this->m_trans->insertBatch($trans);
                $this->m_akomodasi->insertBatch($akomodasi);
                session()->setFlashdata('success', ('Data berhasil ditambahkan'));
                return redirect()->to("trans");

                // $this->m_id->updateBatch($record);
            } 
            //Mobil
            else if ($pemesanan == '2') {
                $jemput = $_POST['jemput'];
                $antar = $_POST['antar'];

                if ($jemput == 'tidak') {
                    //Trans
                    $pic = $_POST['pic'];

                    $id_trans = $this->m_trans->select('id_trans')->orderBy('id_trans', 'desc')->first();
                    if (empty($id_trans)) {
                        $id_trans1 = 1;
                        $id_trans2 = 1;
                    } else {
                        $id_trans1 = (int)$id_trans['id_trans'] + 1;
                        $id_trans2 = (int)$id_trans['id_trans'] + 1;
                    }

                    //Mobil
                    $nama = $_POST['nama'];
                    $email_info = $_POST['email_info'];
                    $email_eval = $_POST['email_eval'];
                    $jumlah_mobil = $_POST['jumlah_mobil'];
                    $tanggal_mobil = $_POST['tanggal_mobil'];
                    $jam_siap = $_POST['jam_siap'];
                    // strtotime($jam_siap);

                    $email_pengguna_info = $this->m_pengguna->whereIn('nama_pengguna', $email_info)->select('email_pengguna')->findAll();

                    // try {
                    //     //Server settings
                    //     // $mail->SMTPDebug = SMTP::DEBUG_SERVER;
                    //     $mail->isSMTP();
                    //     $mail->Host       = 'mail.konimex.com';
                    //     $mail->SMTPAuth   = true;
                    //     $mail->Username   = PDLN_EMAIL;
                    //     $mail->Password   = PDLN_PASS;
                    //     $mail->SMTPSecure = PHPMailer::ENCRYPTION_STARTTLS;
                    //     $mail->Port       = 587;
                    
                    //     //Recipients
                    //     $mail->setFrom('noreply@konimex.com');

                    //     foreach ($email_pengguna_info as $e => $ema) {
                    //         $mail->addAddress($ema['email_pengguna']);//Add a recipient
                    //     }
                    
                    //     //Content
                    //     // $link='https://konimex.com:447/pdln/listpb/pb/'.$id_transaksi;
                    //     $mail->Subject = 'Tes Program TABS (Bimo)';
                    //     $mail->Body    = nl2br("Tes kirim email harap diabaikan saja terima kasih.");
                    //     // $mail->Body    = nl2br("User bagian (").$niknmuser['niknm']."/".$nikuser['nik']."/".$nikuser['strorgnm'].(") telah selesai mengisi data PB, silahkan periksa data PB dengan cara klik link: $link");
                    
                    //     $mail->send();
                    //     // echo 'Message has been sent';
                    // } catch (Exception $e) {
                    //     echo "Message could not be sent. Mailer Error: {$mail->ErrorInfo}";
                    // }

                    if(!empty($nama)) {
                        for($a = 0; $a < count($nama); $a++) {
                            //Trans
                            $pic = $_POST['pic'][$a];
                            $pic = ucwords($pic);
                            
                            //Mobil
                            $nama_pool = $_POST['gs_mobil'];

                            $pool_mobil = $this->m_pool->where('nama_pool', $nama_pool[$a])->select('id_pool')->findAll();

                            if ($_POST['tamu'][$a] == 'Tamu') {
                                $atas_nama = 'Tamu';
                                $jabatan = 'Tamu';
                            } else {
                                $atas_nama = $_POST['nama'][$a];
                                $atas_nama = ucwords($atas_nama);
    
                                $jabatan = $_POST['jabatan'][$a];
                                $jabatan = ucwords($jabatan);
                            }

                            $tujuan_mobil = $_POST['tujuan_mobil'][$a];
                            $tujuan_mobil = ucwords($tujuan_mobil);

                            $siap_di = $_POST['siap_di'][$a];
                            $siap_di = ucwords($siap_di);

                            $pembayaran = $_POST['pembayaran'][$a];
                            if($pembayaran == 'Company Acc'){
                                $pembayaran = 'k';
                            } else if($pembayaran == 'Personal Acc'){
                                $pembayaran = 'p';
                            }

                            $jenis_kendaraan = $_POST['jenis_kendaraan'][$a];
                            if($jenis_kendaraan == 'Sedan'){
                                $jenis_kendaraan = 's';
                            } else if($jenis_kendaraan == 'Station'){
                                $jenis_kendaraan = 'a';
                            } else if($jenis_kendaraan == 'Pick Up'){
                                $jenis_kendaraan = 'p';
                            } else if($jenis_kendaraan == 'Box'){
                                $jenis_kendaraan = 'b';
                            } else if($jenis_kendaraan == 'Truck'){
                                $jenis_kendaraan = 't';
                            }

                            $tenaga_angkut = $_POST['tenaga_angkut'][$a];
                            if($tenaga_angkut == 'Iya'){
                                $tenaga_angkut = '1';
                            } else {
                                $tenaga_angkut = '0';
                            }
                            
                            $dalkot_lukot = $_POST['dalkot_lukot'][$a];

                            if($dalkot_lukot == 'Dalam Kota'){
                                $dalkot_lukot = 'd';
                                $menginap = 0;
                            } else {
                                $dalkot_lukot = 'l';
                                $menginap = $_POST['menginap'][$a];
                                if($menginap == 'Iya'){
                                    $menginap = '1';
                                } else {
                                    $menginap = '0';
                                }
                            }

                            $keterangan_mobil = $_POST['keterangan_mobil'][$a];
                            if(empty($keterangan_mobil)){
                                $keterangan_mobil = null;
                            }
                            
                            if(!empty($_POST['nama'][$a]) && !empty($_POST['jabatan'][$a]) && !empty($_POST['pic'][$a]) && !empty($_POST['email_eval'][$a]) && !empty($_POST['jumlah_mobil'][$a]) && !empty($_POST['tujuan_mobil'][$a]) && !empty($_POST['siap_di'][$a]) && !empty($_POST['tanggal_mobil'][$a]) && !empty($_POST['jam_siap'][$a])) {
                                $trans[] = array(
                                    'id_trans' => $id_trans1++,
                                    'id_detail_pengguna' => session()->get('id_detail_pengguna'),
                                    'id_bagian' => session()->get('id_bagian'),
                                    'pemesanan' => $this->request->getVar('pemesanan'),
                                    'tamu' => $_POST['tamu'][$a],
                                    'pic' => $pic,
                                    'tgl_input' => date('Ymd'),
                                );

                                $transportasi[] = array(
                                    'id_trans' => $id_trans2++,
                                    'id_pool' => $pool_mobil[0]['id_pool'],
                                    'jemput' => 0,
                                    'peminta' => session()->get('nama_pengguna'),
                                    'atas_nama' => $atas_nama,
                                    'jabatan' => $jabatan,
                                    'jumlah_mobil' => $jumlah_mobil[$a],
                                    'pembayaran' => $pembayaran,
                                    'jenis_kendaraan' => $jenis_kendaraan,
                                    'tenaga_angkut' => $tenaga_angkut,
                                    'dalkot_lukot' => $dalkot_lukot,
                                    'menginap' => $menginap,
                                    'kapasitas' => $_POST['kapasitas'][$a],
                                    'tujuan_mobil' => $tujuan_mobil,
                                    'siap_di' => $siap_di,
                                    'tanggal_mobil' => $tanggal_mobil[$a],
                                    'jam_siap' => $jam_siap[$a],
                                    'email_info' => $_POST['email_info'][$a],
                                    'email_eval' => $_POST['email_eval'][$a],
                                    'kirim_eval' => 0,
                                    'status_mobil' => 0,
                                    'keterangan_mobil' => $keterangan_mobil,
                                    'tgl_input' => date('Ymd'),
                                );
                            } else {
                                if(empty($_POST['nama'][$a])) {
                                    session()->setFlashdata('warning', ['Nama harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['jabatan'][$a])) {
                                    session()->setFlashdata('warning', ['Jabatan harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['pic'][$a])) {
                                    session()->setFlashdata('warning', ['PIC harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['email_eval'][$a])) {
                                    session()->setFlashdata('warning', ['Email Evaluasi harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if (empty($_POST['jumlah_mobil'][$a])) {
                                    session()->setFlashdata('warning', ['Jumlah Mobil harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['tujuan_mobil'][$a])) {
                                    session()->setFlashdata('warning', ['Tujuan harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['siap_di'][$a])) {
                                    session()->setFlashdata('warning', ['Siap Di harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['tanggal_mobil'][$a])) {
                                    session()->setFlashdata('warning', ['Tanggal harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['jam_siap'][$a])) {
                                    session()->setFlashdata('warning', ['Jam Siap harus diisi']);
                                    return redirect()->to('trans_add');
                                }
                            }
                        }
                    }

                    $this->m_trans->insertBatch($trans);
                    $this->m_transportasi->insertBatch($transportasi);
                    session()->setFlashdata('success', ('Data berhasil ditambahkan'));
                    return redirect()->to("trans");

                    // $this->m_id->updateBatch($record);
                } else if ($antar == 'tidak') {
                    //Trans
                    $pic = $_POST['pic'];

                    $id_trans = $this->m_trans->select('id_trans')->orderBy('id_trans', 'desc')->first();
                    $id_transportasi = $this->m_transportasi->select('id_transportasi')->orderBy('id_transportasi', 'desc')->first();
                    if (empty($id_trans)) {
                        $id_trans1 = 1;
                        $id_trans2 = 1;
                        $id_trans3 = 1;
                    } else {
                        $id_trans1 = (int)$id_trans['id_trans'] + 1;
                        $id_trans2 = (int)$id_trans['id_trans'] + 1;
                        $id_trans3 = (int)$id_trans['id_trans'] + 1;
                    }

                    if (empty($id_transportasi)) {
                        $id_transportasi1 = 1;
                    } else {
                        $id_transportasi1 = (int)$id_transportasi['id_transportasi'] + 1;
                    }

                    //Mobil Pulang
                    $nama = $_POST['nama'];
                    $email_info = $_POST['email_info'];
                    $email_eval = $_POST['email_eval'];
                    $jumlah_mobil_pulang = $_POST['jumlah_mobil_pulang'];
                    $tanggal_mobil_pulang = $_POST['tanggal_mobil_pulang'];
                    $jam_siap_pulang = $_POST['jam_siap_pulang'];
                    // strtotime($jam_siap);

                    $email_pengguna_info = $this->m_pengguna->whereIn('nama_pengguna', $email_info)->select('email_pengguna')->findAll();

                    // try {
                    //     //Server settings
                    //     // $mail->SMTPDebug = SMTP::DEBUG_SERVER;
                    //     $mail->isSMTP();
                    //     $mail->Host       = 'mail.konimex.com';
                    //     $mail->SMTPAuth   = true;
                    //     $mail->Username   = PDLN_EMAIL;
                    //     $mail->Password   = PDLN_PASS;
                    //     $mail->SMTPSecure = PHPMailer::ENCRYPTION_STARTTLS;
                    //     $mail->Port       = 587;
                    
                    //     //Recipients
                    //     $mail->setFrom('noreply@konimex.com');

                    //     foreach ($email_pengguna_info as $e => $ema) {
                    //         $mail->addAddress($ema['email_pengguna']);//Add a recipient
                    //     }
                    
                    //     //Content
                    //     // $link='https://konimex.com:447/pdln/listpb/pb/'.$id_transaksi;
                    //     $mail->Subject = 'Tes Program TABS (Bimo)';
                    //     $mail->Body    = nl2br("Tes kirim email harap diabaikan saja terima kasih.");
                    //     // $mail->Body    = nl2br("User bagian (").$niknmuser['niknm']."/".$nikuser['nik']."/".$nikuser['strorgnm'].(") telah selesai mengisi data PB, silahkan periksa data PB dengan cara klik link: $link");
                    
                    //     $mail->send();
                    //     // echo 'Message has been sent';
                    // } catch (Exception $e) {
                    //     echo "Message could not be sent. Mailer Error: {$mail->ErrorInfo}";
                    // }

                    if(!empty($nama)) {
                        for($a = 0; $a < count($nama); $a++) {
                            //Trans
                            $pic = $_POST['pic'][$a];
                            $pic = ucwords($pic);
                            
                            //Mobil Pulang
                            $nama_pool = $_POST['gs_mobil_pulang'];

                            $pool_mobil_pulang = $this->m_pool->where('nama_pool', $nama_pool[$a])->select('id_pool')->findAll();

                            $atas_nama = $_POST['nama'][$a];
                            $atas_nama = ucwords($atas_nama);

                            $jabatan = $_POST['jabatan'][$a];
                            $jabatan = ucwords($jabatan);

                            $tujuan_mobil_pulang = $_POST['tujuan_mobil_pulang'][$a];
                            $tujuan_mobil_pulang = ucwords($tujuan_mobil_pulang);

                            $siap_di_pulang = $_POST['siap_di_pulang'][$a];
                            $siap_di_pulang = ucwords($siap_di_pulang);

                            $pembayaran = $_POST['pembayaran'][$a];
                            if($pembayaran == 'Company Acc'){
                                $pembayaran = 'k';
                            } else if($pembayaran == 'Personal Acc'){
                                $pembayaran = 'p';
                            }

                            $jenis_kendaraan_pulang = $_POST['jenis_kendaraan_pulang'][$a];
                            if($jenis_kendaraan_pulang == 'Sedan'){
                                $jenis_kendaraan_pulang = 's';
                            } else if($jenis_kendaraan_pulang == 'Station'){
                                $jenis_kendaraan_pulang = 'a';
                            } else if($jenis_kendaraan_pulang == 'Pick Up'){
                                $jenis_kendaraan_pulang = 'p';
                            } else if($jenis_kendaraan_pulang == 'Box'){
                                $jenis_kendaraan_pulang = 'b';
                            } else if($jenis_kendaraan_pulang == 'Truck'){
                                $jenis_kendaraan_pulang = 't';
                            }

                            $tenaga_angkut_pulang = $_POST['tenaga_angkut_pulang'][$a];
                            if($tenaga_angkut_pulang == 'Iya'){
                                $tenaga_angkut_pulang = '1';
                            } else {
                                $tenaga_angkut_pulang = '0';
                            }
                            
                            $dalkot_lukot_pulang = $_POST['dalkot_lukot_pulang'][$a];

                            if($dalkot_lukot_pulang == 'Dalam Kota'){
                                $dalkot_lukot_pulang = 'd';
                                $menginap_pulang = 0;
                            } else {
                                $dalkot_lukot_pulang = 'l';
                                $menginap_pulang = $_POST['menginap_pulang'][$a];
                                if($menginap_pulang == 'Iya'){
                                    $menginap_pulang = '1';
                                } else {
                                    $menginap_pulang = '0';
                                }
                            }

                            $keterangan_mobil_pulang = $_POST['keterangan_mobil_pulang'][$a];
                            if(empty($keterangan_mobil_pulang)){
                                $keterangan_mobil_pulang = null;
                            }
                            
                            if(!empty($_POST['nama'][$a]) && !empty($_POST['jabatan'][$a]) && !empty($_POST['pic'][$a]) && !empty($_POST['email_eval'][$a]) && !empty($_POST['jumlah_mobil_pulang'][$a]) && !empty($_POST['tujuan_mobil_pulang'][$a]) && !empty($_POST['siap_di_pulang'][$a]) && !empty($_POST['tanggal_mobil_pulang'][$a]) && !empty($_POST['jam_siap_pulang'][$a])) {
                                $trans[] = array(
                                    'id_trans' => $id_trans1++,
                                    'id_detail_pengguna' => session()->get('id_detail_pengguna'),
                                    'id_bagian' => session()->get('id_bagian'),
                                    'pemesanan' => $this->request->getVar('pemesanan'),
                                    'tamu' => $_POST['tamu'][$a],
                                    'pic' => $pic,
                                    'tgl_input' => date('Ymd'),
                                );

                                $transportasi[] = array(
                                    'id_trans' => $id_trans2++,
                                    'id_pool' => $pool_mobil_pulang[0]['id_pool'],
                                    'jemput' => 1,
                                    'peminta' => null,
                                    'atas_nama' => null,
                                    'jabatan' => null,
                                    'jumlah_mobil' => null,
                                    'pembayaran' => null,
                                    'jenis_kendaraan' => null,
                                    'tenaga_angkut' => null,
                                    'dalkot_lukot' => null,
                                    'menginap' => null,
                                    'kapasitas' => null,
                                    'tujuan_mobil' => null,
                                    'siap_di' => null,
                                    'tanggal_mobil' => $tanggal_mobil_pulang[$a],
                                    'jam_siap' => $jam_siap_pulang[$a],
                                    'email_info' => null,
                                    'email_eval' => null,
                                    'kirim_eval' => null,
                                    'status_mobil' => 0,
                                    'keterangan_mobil' => null,
                                    'tgl_input' => date('Ymd'),
                                );

                                $transportasi_jemput[] = array(
                                    'id_transportasi' => $id_transportasi1++,
                                    'id_trans' => $id_trans3++,
                                    'id_pool' => $pool_mobil_pulang[0]['id_pool'],
                                    'jemput' => 1,
                                    'peminta' => session()->get('nama_pengguna'),
                                    'atas_nama' => $atas_nama,
                                    'jabatan' => $jabatan,
                                    'jumlah_mobil' => $jumlah_mobil_pulang[$a],
                                    'pembayaran' => $pembayaran,
                                    'jenis_kendaraan' => $jenis_kendaraan_pulang,
                                    'tenaga_angkut' => $tenaga_angkut_pulang,
                                    'dalkot_lukot' => $dalkot_lukot_pulang,
                                    'menginap' => $menginap_pulang,
                                    'kapasitas' => $_POST['kapasitas_pulang'][$a],
                                    'tujuan_mobil' => $tujuan_mobil_pulang,
                                    'siap_di' => $siap_di_pulang,
                                    'tanggal_mobil' => $tanggal_mobil_pulang[$a],
                                    'jam_siap' => $jam_siap_pulang[$a],
                                    'email_info' => $_POST['email_info'][$a],
                                    'email_eval' => $_POST['email_eval'][$a],
                                    'kirim_eval' => 0,
                                    'status_mobil' => 0,
                                    'keterangan_mobil' => $keterangan_mobil_pulang,
                                    'tgl_input' => date('Ymd'),
                                );
                            } else {
                                if(empty($_POST['nama'][$a])) {
                                    session()->setFlashdata('warning', ['Nama harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['jabatan'][$a])) {
                                    session()->setFlashdata('warning', ['Jabatan harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['pic'][$a])) {
                                    session()->setFlashdata('warning', ['PIC harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['email_eval'][$a])) {
                                    session()->setFlashdata('warning', ['Email Evaluasi harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if (empty($_POST['jumlah_mobil_pulang'][$a])) {
                                    session()->setFlashdata('warning', ['Jumlah Mobil harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['tujuan_mobil_pulang'][$a])) {
                                    session()->setFlashdata('warning', ['Tujuan harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['siap_di_pulang'][$a])) {
                                    session()->setFlashdata('warning', ['Siap Di harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['tanggal_mobil_pulang'][$a])) {
                                    session()->setFlashdata('warning', ['Tanggal harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['jam_siap_pulang'][$a])) {
                                    session()->setFlashdata('warning', ['Jam Siap harus diisi']);
                                    return redirect()->to('trans_add');
                                }
                            }
                        }
                    }
                    
                    $this->m_trans->insertBatch($trans);
                    $this->m_transportasi->insertBatch($transportasi);
                    $this->m_transportasi_jemput->insertBatch($transportasi_jemput);
                    session()->setFlashdata('success', ('Data berhasil ditambahkan'));
                    return redirect()->to("trans");

                    // $this->m_id->updateBatch($record);
                } else {
                    //Trans
                    $pic = $_POST['pic'];

                    $id_trans = $this->m_trans->select('id_trans')->orderBy('id_trans', 'desc')->first();
                    $id_transportasi = $this->m_transportasi->select('id_transportasi')->orderBy('id_transportasi', 'desc')->first();
                    if (empty($id_trans)) {
                        $id_trans1 = 1;
                        $id_trans2 = 1;
                        $id_trans3 = 1;
                    } else {
                        $id_trans1 = (int)$id_trans['id_trans'] + 1;
                        $id_trans2 = (int)$id_trans['id_trans'] + 1;
                        $id_trans3 = (int)$id_trans['id_trans'] + 1;
                    }

                    if (empty($id_transportasi)) {
                        $id_transportasi1 = 1;
                    } else {
                        $id_transportasi1 = (int)$id_transportasi['id_transportasi'] + 1;
                    }

                    //Mobil
                    $nama = $_POST['nama'];
                    $email_info = $_POST['email_info'];
                    $email_eval = $_POST['email_eval'];
                    $jumlah_mobil = $_POST['jumlah_mobil'];
                    $tanggal_mobil = $_POST['tanggal_mobil'];
                    $jam_siap = $_POST['jam_siap'];
                    // strtotime($jam_siap);

                    $email_pengguna_info = $this->m_pengguna->whereIn('nama_pengguna', $email_info)->select('email_pengguna')->findAll();

                    // try {
                    //     //Server settings
                    //     // $mail->SMTPDebug = SMTP::DEBUG_SERVER;
                    //     $mail->isSMTP();
                    //     $mail->Host       = 'mail.konimex.com';
                    //     $mail->SMTPAuth   = true;
                    //     $mail->Username   = PDLN_EMAIL;
                    //     $mail->Password   = PDLN_PASS;
                    //     $mail->SMTPSecure = PHPMailer::ENCRYPTION_STARTTLS;
                    //     $mail->Port       = 587;
                    
                    //     //Recipients
                    //     $mail->setFrom('noreply@konimex.com');

                    //     foreach ($email_pengguna_info as $e => $ema) {
                    //         $mail->addAddress($ema['email_pengguna']);//Add a recipient
                    //     }
                    
                    //     //Content
                    //     // $link='https://konimex.com:447/pdln/listpb/pb/'.$id_transaksi;
                    //     $mail->Subject = 'Tes Program TABS (Bimo)';
                    //     $mail->Body    = nl2br("Tes kirim email harap diabaikan saja terima kasih.");
                    //     // $mail->Body    = nl2br("User bagian (").$niknmuser['niknm']."/".$nikuser['nik']."/".$nikuser['strorgnm'].(") telah selesai mengisi data PB, silahkan periksa data PB dengan cara klik link: $link");
                    
                    //     $mail->send();
                    //     // echo 'Message has been sent';
                    // } catch (Exception $e) {
                    //     echo "Message could not be sent. Mailer Error: {$mail->ErrorInfo}";
                    // }

                    //Mobil Pulang
                    $nama = $_POST['nama'];
                    $email_info = $_POST['email_info'];
                    $email_eval = $_POST['email_eval'];
                    $jumlah_mobil_pulang = $_POST['jumlah_mobil_pulang'];
                    $tanggal_mobil_pulang = $_POST['tanggal_mobil_pulang'];
                    $jam_siap_pulang = $_POST['jam_siap_pulang'];
                    // strtotime($jam_siap);

                    $email_pengguna_info = $this->m_pengguna->whereIn('nama_pengguna', $email_info)->select('email_pengguna')->findAll();

                    // try {
                    //     //Server settings
                    //     // $mail->SMTPDebug = SMTP::DEBUG_SERVER;
                    //     $mail->isSMTP();
                    //     $mail->Host       = 'mail.konimex.com';
                    //     $mail->SMTPAuth   = true;
                    //     $mail->Username   = PDLN_EMAIL;
                    //     $mail->Password   = PDLN_PASS;
                    //     $mail->SMTPSecure = PHPMailer::ENCRYPTION_STARTTLS;
                    //     $mail->Port       = 587;
                    
                    //     //Recipients
                    //     $mail->setFrom('noreply@konimex.com');

                    //     foreach ($email_pengguna_info as $e => $ema) {
                    //         $mail->addAddress($ema['email_pengguna']);//Add a recipient
                    //     }
                    
                    //     //Content
                    //     // $link='https://konimex.com:447/pdln/listpb/pb/'.$id_transaksi;
                    //     $mail->Subject = 'Tes Program TABS (Bimo)';
                    //     $mail->Body    = nl2br("Tes kirim email harap diabaikan saja terima kasih.");
                    //     // $mail->Body    = nl2br("User bagian (").$niknmuser['niknm']."/".$nikuser['nik']."/".$nikuser['strorgnm'].(") telah selesai mengisi data PB, silahkan periksa data PB dengan cara klik link: $link");
                    
                    //     $mail->send();
                    //     // echo 'Message has been sent';
                    // } catch (Exception $e) {
                    //     echo "Message could not be sent. Mailer Error: {$mail->ErrorInfo}";
                    // }

                    if(!empty($nama)) {
                        for($a = 0; $a < count($nama); $a++) {
                            //Trans
                            $pic = $_POST['pic'][$a];
                            $pic = ucwords($pic);
                            
                            //Mobil
                            $nama_pool = $_POST['gs_mobil'];

                            $pool_mobil = $this->m_pool->where('nama_pool', $nama_pool[$a])->select('id_pool')->findAll();

                            $atas_nama = $_POST['nama'][$a];
                            $atas_nama = ucwords($atas_nama);

                            $jabatan = $_POST['jabatan'][$a];
                            $jabatan = ucwords($jabatan);

                            $tujuan_mobil = $_POST['tujuan_mobil'][$a];
                            $tujuan_mobil = ucwords($tujuan_mobil);

                            $siap_di = $_POST['siap_di'][$a];
                            $siap_di = ucwords($siap_di);

                            $pembayaran = $_POST['pembayaran'][$a];
                            if($pembayaran == 'Company Acc'){
                                $pembayaran = 'k';
                            } else if($pembayaran == 'Personal Acc'){
                                $pembayaran = 'p';
                            }

                            $jenis_kendaraan = $_POST['jenis_kendaraan'][$a];
                            if($jenis_kendaraan == 'Sedan'){
                                $jenis_kendaraan = 's';
                            } else if($jenis_kendaraan == 'Station'){
                                $jenis_kendaraan = 'a';
                            } else if($jenis_kendaraan == 'Pick Up'){
                                $jenis_kendaraan = 'p';
                            } else if($jenis_kendaraan == 'Box'){
                                $jenis_kendaraan = 'b';
                            } else if($jenis_kendaraan == 'Truck'){
                                $jenis_kendaraan = 't';
                            }

                            $tenaga_angkut = $_POST['tenaga_angkut'][$a];
                            if($tenaga_angkut == 'Iya'){
                                $tenaga_angkut = '1';
                            } else {
                                $tenaga_angkut = '0';
                            }
                            
                            $dalkot_lukot = $_POST['dalkot_lukot'][$a];

                            if($dalkot_lukot == 'Dalam Kota'){
                                $dalkot_lukot = 'd';
                                $menginap = 0;
                            } else {
                                $dalkot_lukot = 'l';
                                $menginap = $_POST['menginap'][$a];
                                if($menginap == 'Iya'){
                                    $menginap = '1';
                                } else {
                                    $menginap = '0';
                                }
                            }

                            $keterangan_mobil = $_POST['keterangan_mobil'][$a];
                            if(empty($keterangan_mobil)){
                                $keterangan_mobil = null;
                            }

                            //Mobil Pulang
                            $nama_pool = $_POST['gs_mobil_pulang'];

                            $pool_mobil_pulang = $this->m_pool->where('nama_pool', $nama_pool[$a])->select('id_pool')->findAll();

                            $atas_nama = $_POST['nama'][$a];
                            $atas_nama = ucwords($atas_nama);

                            $jabatan = $_POST['jabatan'][$a];
                            $jabatan = ucwords($jabatan);

                            $tujuan_mobil_pulang = $_POST['tujuan_mobil_pulang'][$a];
                            $tujuan_mobil_pulang = ucwords($tujuan_mobil_pulang);

                            $siap_di_pulang = $_POST['siap_di_pulang'][$a];
                            $siap_di_pulang = ucwords($siap_di_pulang);

                            $pembayaran = $_POST['pembayaran'][$a];
                            if($pembayaran == 'Company Acc'){
                                $pembayaran = 'k';
                            } else if($pembayaran == 'Personal Acc'){
                                $pembayaran = 'p';
                            }

                            $jenis_kendaraan_pulang = $_POST['jenis_kendaraan_pulang'][$a];
                            if($jenis_kendaraan_pulang == 'Sedan'){
                                $jenis_kendaraan_pulang = 's';
                            } else if($jenis_kendaraan_pulang == 'Station'){
                                $jenis_kendaraan_pulang = 'a';
                            } else if($jenis_kendaraan_pulang == 'Pick Up'){
                                $jenis_kendaraan_pulang = 'p';
                            } else if($jenis_kendaraan_pulang == 'Box'){
                                $jenis_kendaraan_pulang = 'b';
                            } else if($jenis_kendaraan_pulang == 'Truck'){
                                $jenis_kendaraan_pulang = 't';
                            }

                            $tenaga_angkut_pulang = $_POST['tenaga_angkut_pulang'][$a];
                            if($tenaga_angkut_pulang == 'Iya'){
                                $tenaga_angkut_pulang = '1';
                            } else {
                                $tenaga_angkut_pulang = '0';
                            }
                            
                            $dalkot_lukot_pulang = $_POST['dalkot_lukot_pulang'][$a];

                            if($dalkot_lukot_pulang == 'Dalam Kota'){
                                $dalkot_lukot_pulang = 'd';
                                $menginap_pulang = 0;
                            } else {
                                $dalkot_lukot_pulang = 'l';
                                $menginap_pulang = $_POST['menginap_pulang'][$a];
                                if($menginap_pulang == 'Iya'){
                                    $menginap_pulang = '1';
                                } else {
                                    $menginap_pulang = '0';
                                }
                            }

                            $keterangan_mobil_pulang = $_POST['keterangan_mobil_pulang'][$a];
                            if(empty($keterangan_mobil_pulang)){
                                $keterangan_mobil_pulang = null;
                            }
                            
                            if(!empty($_POST['nama'][$a]) && !empty($_POST['jabatan'][$a]) && !empty($_POST['pic'][$a]) && !empty($_POST['email_eval'][$a]) && !empty($_POST['jumlah_mobil'][$a]) && !empty($_POST['tujuan_mobil'][$a]) && !empty($_POST['siap_di'][$a]) && !empty($_POST['tanggal_mobil'][$a]) && !empty($_POST['jam_siap'][$a]) && !empty($_POST['jumlah_mobil_pulang'][$a]) && !empty($_POST['tujuan_mobil_pulang'][$a]) && !empty($_POST['siap_di_pulang'][$a]) && !empty($_POST['tanggal_mobil_pulang'][$a]) && !empty($_POST['jam_siap_pulang'][$a])) {
                                $trans[] = array(
                                    'id_trans' => $id_trans1++,
                                    'id_detail_pengguna' => session()->get('id_detail_pengguna'),
                                    'id_bagian' => session()->get('id_bagian'),
                                    'pemesanan' => $this->request->getVar('pemesanan'),
                                    'tamu' => $_POST['tamu'][$a],
                                    'pic' => $pic,
                                    'tgl_input' => date('Ymd'),
                                );

                                $transportasi[] = array(
                                    'id_trans' => $id_trans2++,
                                    'id_pool' => $pool_mobil[0]['id_pool'],
                                    'jemput' => 2,
                                    'peminta' => session()->get('nama_pengguna'),
                                    'atas_nama' => $atas_nama,
                                    'jabatan' => $jabatan,
                                    'jumlah_mobil' => $jumlah_mobil[$a],
                                    'pembayaran' => $pembayaran,
                                    'jenis_kendaraan' => $jenis_kendaraan,
                                    'tenaga_angkut' => $tenaga_angkut,
                                    'dalkot_lukot' => $dalkot_lukot,
                                    'menginap' => $menginap,
                                    'kapasitas' => $_POST['kapasitas'][$a],
                                    'tujuan_mobil' => $tujuan_mobil,
                                    'siap_di' => $siap_di,
                                    'tanggal_mobil' => $tanggal_mobil[$a],
                                    'jam_siap' => $jam_siap[$a],
                                    'email_info' => $_POST['email_info'][$a],
                                    'email_eval' => $_POST['email_eval'][$a],
                                    'kirim_eval' => 0,
                                    'status_mobil' => 0,
                                    'keterangan_mobil' => $keterangan_mobil,
                                    'tgl_input' => date('Ymd'),
                                );

                                $transportasi_jemput[] = array(
                                    'id_transportasi' => $id_transportasi1++,
                                    'id_trans' => $id_trans3++,
                                    'id_pool' => $pool_mobil_pulang[0]['id_pool'],
                                    'jemput' => 2,
                                    'peminta' => session()->get('nama_pengguna'),
                                    'atas_nama' => $atas_nama,
                                    'jabatan' => $jabatan,
                                    'jumlah_mobil' => $jumlah_mobil_pulang[$a],
                                    'pembayaran' => $pembayaran,
                                    'jenis_kendaraan' => $jenis_kendaraan_pulang,
                                    'tenaga_angkut' => $tenaga_angkut_pulang,
                                    'dalkot_lukot' => $dalkot_lukot_pulang,
                                    'menginap' => $menginap_pulang,
                                    'kapasitas' => $_POST['kapasitas_pulang'][$a],
                                    'tujuan_mobil' => $tujuan_mobil_pulang,
                                    'siap_di' => $siap_di_pulang,
                                    'tanggal_mobil' => $tanggal_mobil_pulang[$a],
                                    'jam_siap' => $jam_siap_pulang[$a],
                                    'email_info' => $_POST['email_info'][$a],
                                    'email_eval' => $_POST['email_eval'][$a],
                                    'kirim_eval' => 0,
                                    'status_mobil' => 0,
                                    'keterangan_mobil' => $keterangan_mobil_pulang,
                                    'tgl_input' => date('Ymd'),
                                );
                            } else {
                                if(empty($_POST['nama'][$a])) {
                                    session()->setFlashdata('warning', ['Nama harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['jabatan'][$a])) {
                                    session()->setFlashdata('warning', ['Jabatan harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['pic'][$a])) {
                                    session()->setFlashdata('warning', ['PIC harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['email_eval'][$a])) {
                                    session()->setFlashdata('warning', ['Email Evaluasi harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if (empty($_POST['jumlah_mobil'][$a])) {
                                    session()->setFlashdata('warning', ['Jumlah Mobil harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['tujuan_mobil'][$a])) {
                                    session()->setFlashdata('warning', ['Tujuan harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['siap_di'][$a])) {
                                    session()->setFlashdata('warning', ['Siap Di harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['tanggal_mobil'][$a])) {
                                    session()->setFlashdata('warning', ['Tanggal harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['jam_siap'][$a])) {
                                    session()->setFlashdata('warning', ['Jam Siap harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['jumlah_mobil_pulang'][$a])) {
                                    session()->setFlashdata('warning', ['Jumlah Mobil harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['tujuan_mobil_pulang'][$a])) {
                                    session()->setFlashdata('warning', ['Tujuan harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['siap_di_pulang'][$a])) {
                                    session()->setFlashdata('warning', ['Siap Di harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['tanggal_mobil_pulang'][$a])) {
                                    session()->setFlashdata('warning', ['Tanggal harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['jam_siap_pulang'][$a])) {
                                    session()->setFlashdata('warning', ['Jam Siap harus diisi']);
                                    return redirect()->to('trans_add');
                                }
                            }
                        }
                    }
                    
                    $this->m_trans->insertBatch($trans);
                    $this->m_transportasi->insertBatch($transportasi);
                    $this->m_transportasi_jemput->insertBatch($transportasi_jemput);
                    session()->setFlashdata('success', ('Data berhasil ditambahkan'));
                    return redirect()->to("trans");

                    // $this->m_id->updateBatch($record);
                }
            }
            //Tiket + Hotel
            else if ($pemesanan == '3') {
                //Trans
                $pic = $_POST['pic'];

                $id_trans = $this->m_trans->select('id_trans')->orderBy('id_trans', 'desc')->first();
                if (empty($id_trans)) {
                    $id_trans1 = 1;
                    $id_trans2 = 1;
                    $id_trans3 = 1;
                } else {
                    $id_trans1 = (int)$id_trans['id_trans'] + 1;
                    $id_trans2 = (int)$id_trans['id_trans'] + 1;
                    $id_trans3 = (int)$id_trans['id_trans'] + 1;
                }

                //Tiket
                $nama = $_POST['nama'];
                $jabatan = $_POST['jabatan'];
                $email_info = $_POST['email_info'];
                $email_eval = $_POST['email_eval'];
                $jumlah_tiket = $_POST['jumlah_tiket'];
                $tanggal_jam_tiket = $_POST['tanggal_jam_tiket'];

                $email_pengguna = $this->m_pengguna->whereIn('nama_pengguna', $email_info)->select('email_pengguna')->findAll();

                // try {
                //     //Server settings
                //     // $mail->SMTPDebug = SMTP::DEBUG_SERVER;
                //     $mail->isSMTP();
                //     $mail->Host       = 'mail.konimex.com';
                //     $mail->SMTPAuth   = true;
                //     $mail->Username   = PDLN_EMAIL;
                //     $mail->Password   = PDLN_PASS;
                //     $mail->SMTPSecure = PHPMailer::ENCRYPTION_STARTTLS;
                //     $mail->Port       = 587;
                
                //     //Recipients
                //     $mail->setFrom('noreply@konimex.com');

                //     foreach ($email_pengguna_info as $e => $ema) {
                //         $mail->addAddress($ema['email_pengguna']);//Add a recipient
                //     }
                
                //     //Content
                //     // $link='https://konimex.com:447/pdln/listpb/pb/'.$id_transaksi;
                //     $mail->Subject = 'Tes Program TABS (Bimo)';
                //     $mail->Body    = nl2br("Tes kirim email harap diabaikan saja terima kasih.");
                //     // $mail->Body    = nl2br("User bagian (").$niknmuser['niknm']."/".$nikuser['nik']."/".$nikuser['strorgnm'].(") telah selesai mengisi data PB, silahkan periksa data PB dengan cara klik link: $link");
                
                //     $mail->send();
                //     // echo 'Message has been sent';
                // } catch (Exception $e) {
                //     echo "Message could not be sent. Mailer Error: {$mail->ErrorInfo}";
                // }

                //Hotel
                $nama = $_POST['nama'];
                $email_info = $_POST['email_info'];
                $email_eval = $_POST['email_eval'];
                $jumlah_kamar = $_POST['jumlah_kamar'];
                $tanggal_jam_masuk = $_POST['tanggal_jam_masuk'];
                $tanggal_jam_keluar = $_POST['tanggal_jam_keluar'];

                $email_pengguna_info = $this->m_pengguna->whereIn('nama_pengguna', $email_info)->select('email_pengguna')->findAll();

                // try {
                //     //Server settings
                //     // $mail->SMTPDebug = SMTP::DEBUG_SERVER;
                //     $mail->isSMTP();
                //     $mail->Host       = 'mail.konimex.com';
                //     $mail->SMTPAuth   = true;
                //     $mail->Username   = PDLN_EMAIL;
                //     $mail->Password   = PDLN_PASS;
                //     $mail->SMTPSecure = PHPMailer::ENCRYPTION_STARTTLS;
                //     $mail->Port       = 587;
                
                //     //Recipients
                //     $mail->setFrom('noreply@konimex.com');

                //     foreach ($email_pengguna_info as $e => $ema) {
                //         $mail->addAddress($ema['email_pengguna']);//Add a recipient
                //     }
                
                //     //Content
                //     // $link='https://konimex.com:447/pdln/listpb/pb/'.$id_transaksi;
                //     $mail->Subject = 'Tes Program TABS (Bimo)';
                //     $mail->Body    = nl2br("Tes kirim email harap diabaikan saja terima kasih.");
                //     // $mail->Body    = nl2br("User bagian (").$niknmuser['niknm']."/".$nikuser['nik']."/".$nikuser['strorgnm'].(") telah selesai mengisi data PB, silahkan periksa data PB dengan cara klik link: $link");
                
                //     $mail->send();
                //     // echo 'Message has been sent';
                // } catch (Exception $e) {
                //     echo "Message could not be sent. Mailer Error: {$mail->ErrorInfo}";
                // }

                if(!empty($nama)) {
                    for($a = 0; $a < count($nama); $a++) {
                        //Trans
                        $pic = $_POST['pic'][$a];
                        $pic = ucwords($pic);
                        
                        //Tiket
                        $nama_tiket = $_POST['tiket'];
                        $nama_pool = $_POST['gs_tiket'];
                        $keberangkatan = $_POST['keberangkatan'];
                        $pemberhentian = $_POST['pemberhentian'];

                        if ($_POST['pilihan_tiket'][$a] == 0) {
                            session()->setFlashdata('warning', ['Pilih armada transportasi terlebih dahulu']);
                            return redirect()->to('trans_add');
                        } else if ($_POST['pilihan_tiket'][$a] == "Travel") {
                            $id_keberangkatan = null;
                            $id_pemberhentian = null;
                            $dari_tiket = $_POST['keberangkatan'][$a];
                            $tujuan_tiket = $_POST['pemberhentian'][$a];
                        } else {
                            $nama_keberangkatan = substr($keberangkatan[$a], 0, strpos($keberangkatan[$a], " - "));
                            $dari_tiket = substr($keberangkatan[$a], strpos($keberangkatan[$a], " - ")+3);
                            $id_berangkat = $this->m_pemberhentian->where('nama_pemberhentian', $nama_keberangkatan)->select('id_pemberhentian')->findAll();
                            $id_keberangkatan = $id_berangkat[0]['id_pemberhentian'];
                            
                            $nama_pemberhentian = substr($pemberhentian[$a], 0, strpos($pemberhentian[$a], " - "));
                            $tujuan_tiket = substr($pemberhentian[$a], strpos($pemberhentian[$a], " - ")+3);
                            $id_berhenti = $this->m_pemberhentian->where('nama_pemberhentian', $nama_pemberhentian)->select('id_pemberhentian')->findAll();
                            $id_pemberhentian = $id_berhenti[0]['id_pemberhentian'];
                        }

                        if ($_POST['keberangkatan'][$a] == $_POST['pemberhentian'][$a]) {
                            session()->setFlashdata('warning', ['Keberangkatan dan Pemberhentian Tiket tidak boleh sama']);
                            return redirect()->to('trans_add');
                        }
                        
                        $vendor = $this->m_vendor->where('nama_vendor', $nama_tiket[$a])->select('id_vendor')->findAll();
                        $pool_tiket = $this->m_pool->where('nama_pool', $nama_pool[$a])->select('id_pool')->findAll();

                        if ($_POST['tamu'][$a] == 'Tamu') {
                            $atas_nama = 'Tamu';
                            $jabatan = 'Tamu';
                        } else {
                            $atas_nama = $_POST['nama'][$a];
                            $atas_nama = ucwords($atas_nama);

                            $jabatan = $_POST['jabatan'][$a];
                            $jabatan = ucwords($jabatan);
                        }

                        $pembayaran = $_POST['pembayaran'][$a];
                        if($pembayaran == 'Company Acc'){
                            $pembayaran = 'k';
                        } else if($pembayaran == 'Personal Acc'){
                            $pembayaran = 'p';
                        }

                        $keterangan_tiket = $_POST['keterangan_tiket'][$a];
                        if(empty($keterangan_tiket)){
                            $keterangan_tiket = null;
                        }

                        //Hotel
                        $nama_pool = $_POST['gs_hotel'];
                        $nama_kota = $_POST['kota'];
                        $nama_akomodasi = $_POST['hotel'];

                        $nama_hotel = substr($nama_akomodasi[$a], 0, strpos($nama_akomodasi[$a], " - "));
                        $jenis_kamar = substr($nama_akomodasi[$a], strpos($nama_akomodasi[$a], ' - ') + 3);

                        $pool_hotel = $this->m_pool->where('nama_pool', $nama_pool[$a])->select('id_pool')->findAll();
                        $kota_hotel = $this->m_kota->where('nama_kota', $nama_kota[$a])->select('id_kota')->findAll();
                        $id_hotel = $this->m_hotel->where('nama_hotel', $nama_hotel)->select('id_hotel')->findAll();
                        if (empty($id_hotel)) {
                            session()->setFlashdata('warning', ['Tidak ada data Hotel']);
                            return redirect()->to("trans_add");
                        }
                        $id_detail_hotel = $this->m_detail_hotel->where('id_hotel', $id_hotel[0]['id_hotel'])->where('jenis_kamar', $jenis_kamar)->select('id_detail_hotel')->findAll();

                        if ($nama_hotel == "Mess Kx Jkt") {
                            $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                            $status_mess = 1;
                            
                            foreach ($mess as $m => $mes) {
                                if ($mes['terpakai'] == 18) {
                                    session()->setFlashdata('warning', ['Mess Kx Jkt sudah penuh']);
                                    return redirect()->to("trans_add");
                                } else {
                                    $terpakai = [
                                        'id_mess' => 8,
                                        'terpakai' => $mes['terpakai'] + $jumlah_kamar[$a],
                                        'edited_at' => $timestamp,
                                    ];
                                    $this->m_mess->save($terpakai);
                                }
                            }
                        } else {
                            $status_mess = 0;
                        }

                        if ($_POST['tamu'][$a] == 'Tamu') {
                            $atas_nama = 'Tamu';
                            $jabatan = 'Tamu';
                        } else {
                            $atas_nama = $_POST['nama'][$a];
                            $atas_nama = ucwords($atas_nama);

                            $jabatan = $_POST['jabatan'][$a];
                            $jabatan = ucwords($jabatan);
                        }

                        $pembayaran = $_POST['pembayaran'][$a];
                        if($pembayaran == 'Company Acc'){
                            $pembayaran = 'k';
                        } else if($pembayaran == 'Personal Acc'){
                            $pembayaran = 'p';
                        }

                        $keterangan_akomodasi = $_POST['keterangan_akomodasi'][$a];
                        if(empty($keterangan_akomodasi)){
                            $keterangan_akomodasi = null;
                        }

                        if(!empty($_POST['nama'][$a]) && !empty($_POST['jabatan'][$a]) && !empty($_POST['pic'][$a]) && !empty($_POST['email_eval'][$a]) && !empty($_POST['jumlah_tiket'][$a]) && !empty($_POST['tanggal_jam_tiket'][$a]) && !empty($_POST['jumlah_kamar'][$a]) && !empty($_POST['tanggal_jam_masuk'][$a]) && !empty($_POST['tanggal_jam_keluar'][$a])) {
                            $trans[] = array(
                                'id_trans' => $id_trans1++,
                                'id_detail_pengguna' => session()->get('id_detail_pengguna'),
                                'id_bagian' => session()->get('id_bagian'),
                                'pemesanan' => $this->request->getVar('pemesanan'),
                                'pic' => $pic,
                                'tamu' => $_POST['tamu'][$a],
                                'tgl_input' => date('Ymd'),
                            );

                            $tiket[] = array(
                                'id_trans' => $id_trans2++,
                                'id_vendor' => $vendor[0]['id_vendor'],
                                'id_keberangkatan' => $id_keberangkatan,
                                'id_pemberhentian' => $id_pemberhentian,
                                'id_pool' => $pool_tiket[0]['id_pool'],
                                'peminta' => session()->get('nama_pengguna'),
                                'atas_nama' => $atas_nama,
                                'jabatan' => $jabatan,
                                'jumlah_tiket' => $_POST['jumlah_tiket'][$a],
                                'pembayaran' => $pembayaran,
                                'harga_tiket' => null,
                                'tanggal_jam_tiket' => $_POST['tanggal_jam_tiket'][$a],
                                'dari_tiket' => $dari_tiket,
                                'tujuan_tiket' => $tujuan_tiket,
                                'email_info' => $_POST['email_info'][$a],
                                'email_eval' => $_POST['email_eval'][$a],
                                'kirim_eval' => 0,
                                'keterangan_tiket' => $keterangan_tiket,
                                'tgl_input' => date('Ymd'),
                            );

                            $akomodasi[] = array(
                                'id_trans' => $id_trans3++,
                                'id_hotel' => $id_hotel[0]['id_hotel'],
                                'id_detail_hotel' => $id_detail_hotel[0]['id_detail_hotel'],
                                'id_pool' => $pool_hotel[0]['id_pool'],
                                'id_kota' => $kota_hotel[0]['id_kota'],
                                'peminta' => session()->get('nama_pengguna'),
                                'atas_nama' => $atas_nama,
                                'jabatan' => $jabatan,
                                'type' => $_POST['type'][$a],
                                'jumlah_kamar' => $_POST['jumlah_kamar'][$a],
                                'pembayaran' => $pembayaran,
                                'harga_akomodasi' => null,
                                'email_info' => $_POST['email_info'][$a],
                                'email_eval' => $_POST['email_eval'][$a],
                                'tanggal_jam_masuk' => $tanggal_jam_masuk[$a],
                                'tanggal_jam_keluar' => $tanggal_jam_keluar[$a],
                                'kirim_eval' => 0,
                                'status_mess' => $status_mess,
                                'status_akomodasi' => 0,
                                'keterangan_akomodasi' => $keterangan_akomodasi,
                                'tgl_input' => date('Ymd'),
                            );
                        } else {
                            if(empty($_POST['nama'][$a])) {
                                if ($nama_hotel == "Mess Kx Jkt") {
                                    $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                    
                                    foreach ($mess as $m => $mes) {
                                        if ($mes['terpakai'] == 0) {
                                            
                                        } else {
                                            $terpakai = [
                                                'id_mess' => 8,
                                                'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                'edited_at' => $timestamp,
                                            ];
                                            $this->m_mess->save($terpakai);
                                        }
                                    }
                                }
                                session()->setFlashdata('warning', ['Nama harus diisi']);
                                return redirect()->to("trans_add");
                            } else if(empty($_POST['jabatan'][$a])) {
                                if ($nama_hotel == "Mess Kx Jkt") {
                                    $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                    
                                    foreach ($mess as $m => $mes) {
                                        if ($mes['terpakai'] == 0) {
                                            
                                        } else {
                                            $terpakai = [
                                                'id_mess' => 8,
                                                'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                'edited_at' => $timestamp,
                                            ];
                                            $this->m_mess->save($terpakai);
                                        }
                                    }
                                }
                                session()->setFlashdata('warning', ['Jabatan harus diisi']);
                                return redirect()->to("trans_add");
                            } else if(empty($_POST['pic'][$a])) {
                                if ($nama_hotel == "Mess Kx Jkt") {
                                    $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                    
                                    foreach ($mess as $m => $mes) {
                                        if ($mes['terpakai'] == 0) {
                                            
                                        } else {
                                            $terpakai = [
                                                'id_mess' => 8,
                                                'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                'edited_at' => $timestamp,
                                            ];
                                            $this->m_mess->save($terpakai);
                                        }
                                    }
                                }
                                session()->setFlashdata('warning', ['PIC harus diisi']);
                                return redirect()->to("trans_add");
                            } else if(empty($_POST['email_eval'][$a])) {
                                if ($nama_hotel == "Mess Kx Jkt") {
                                    $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                    
                                    foreach ($mess as $m => $mes) {
                                        if ($mes['terpakai'] == 0) {
                                            
                                        } else {
                                            $terpakai = [
                                                'id_mess' => 8,
                                                'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                'edited_at' => $timestamp,
                                            ];
                                            $this->m_mess->save($terpakai);
                                        }
                                    }
                                }
                                session()->setFlashdata('warning', ['Email Evaluasi harus diisi']);
                                return redirect()->to("trans_add");
                            } else if(empty($_POST['jumlah_tiket'][$a])) {
                                if ($nama_hotel == "Mess Kx Jkt") {
                                    $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                    
                                    foreach ($mess as $m => $mes) {
                                        if ($mes['terpakai'] == 0) {
                                            
                                        } else {
                                            $terpakai = [
                                                'id_mess' => 8,
                                                'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                'edited_at' => $timestamp,
                                            ];
                                            $this->m_mess->save($terpakai);
                                        }
                                    }
                                }
                                session()->setFlashdata('warning', ['Jumlah tiket harus diisi']);
                                return redirect()->to("trans_add");
                            } else if(empty($_POST['tanggal_jam_tiket'][$a])) {
                                if ($nama_hotel == "Mess Kx Jkt") {
                                    $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                    
                                    foreach ($mess as $m => $mes) {
                                        if ($mes['terpakai'] == 0) {
                                            
                                        } else {
                                            $terpakai = [
                                                'id_mess' => 8,
                                                'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                'edited_at' => $timestamp,
                                            ];
                                            $this->m_mess->save($terpakai);
                                        }
                                    }
                                }
                                session()->setFlashdata('warning', ['Tanggal dan Jam tiket harus diisi']);
                                return redirect()->to("trans_add");
                            } else if(empty($_POST['jumlah_kamar'][$a])) {
                                if ($nama_hotel == "Mess Kx Jkt") {
                                    $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                    
                                    foreach ($mess as $m => $mes) {
                                        if ($mes['terpakai'] == 0) {
                                            
                                        } else {
                                            $terpakai = [
                                                'id_mess' => 8,
                                                'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                'edited_at' => $timestamp,
                                            ];
                                            $this->m_mess->save($terpakai);
                                        }
                                    }
                                }
                                session()->setFlashdata('warning', ['Jumlah Kamar harus diisi']);
                                return redirect()->to("trans_add");
                            } else if(empty($_POST['tanggal_jam_masuk'][$a])) {
                                if ($nama_hotel == "Mess Kx Jkt") {
                                    $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                    
                                    foreach ($mess as $m => $mes) {
                                        if ($mes['terpakai'] == 0) {
                                            
                                        } else {
                                            $terpakai = [
                                                'id_mess' => 8,
                                                'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                'edited_at' => $timestamp,
                                            ];
                                            $this->m_mess->save($terpakai);
                                        }
                                    }
                                }
                                session()->setFlashdata('warning', ['Tanggal dan Jam Masuk harus diisi']);
                                return redirect()->to("trans_add");
                            } else if(empty($_POST['tanggal_jam_keluar'][$a])) {
                                if ($nama_hotel == "Mess Kx Jkt") {
                                    $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                    
                                    foreach ($mess as $m => $mes) {
                                        if ($mes['terpakai'] == 0) {
                                            
                                        } else {
                                            $terpakai = [
                                                'id_mess' => 8,
                                                'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                'edited_at' => $timestamp,
                                            ];
                                            $this->m_mess->save($terpakai);
                                        }
                                    }
                                }
                                session()->setFlashdata('warning', ['Tanggal dan Jam Keluar harus diisi']);
                                return redirect()->to("trans_add");
                            }
                        }
                    }
                }
                
                $this->m_trans->insertBatch($trans);
                $this->m_tiket->insertBatch($tiket);
                $this->m_akomodasi->insertBatch($akomodasi);
                session()->setFlashdata('success', ('Data berhasil ditambahkan'));
                return redirect()->to("trans");
                
                // $this->m_id->updateBatch($record);
            }
            //Tiket + Mobil
            else if ($pemesanan == '4') {
                $jemput = $_POST['jemput'];
                $antar = $_POST['antar'];

                if ($jemput == 'tidak') {
                    //Trans
                    $pic = $_POST['pic'];

                    $id_trans = $this->m_trans->select('id_trans')->orderBy('id_trans', 'desc')->first();
                    if (empty($id_trans)) {
                        $id_trans1 = 1;
                        $id_trans2 = 1;
                        $id_trans3 = 1;
                    } else {
                        $id_trans1 = (int)$id_trans['id_trans'] + 1;
                        $id_trans2 = (int)$id_trans['id_trans'] + 1;
                        $id_trans3 = (int)$id_trans['id_trans'] + 1;
                    }

                    //Tiket
                    $nama = $_POST['nama'];
                    $jabatan = $_POST['jabatan'];
                    $email_info = $_POST['email_info'];
                    $email_eval = $_POST['email_eval'];
                    $jumlah_tiket = $_POST['jumlah_tiket'];
                    $tanggal_jam_tiket = $_POST['tanggal_jam_tiket'];

                    $email_pengguna = $this->m_pengguna->whereIn('nama_pengguna', $email_info)->select('email_pengguna')->findAll();

                    // try {
                    //     //Server settings
                    //     // $mail->SMTPDebug = SMTP::DEBUG_SERVER;
                    //     $mail->isSMTP();
                    //     $mail->Host       = 'mail.konimex.com';
                    //     $mail->SMTPAuth   = true;
                    //     $mail->Username   = PDLN_EMAIL;
                    //     $mail->Password   = PDLN_PASS;
                    //     $mail->SMTPSecure = PHPMailer::ENCRYPTION_STARTTLS;
                    //     $mail->Port       = 587;
                    
                    //     //Recipients
                    //     $mail->setFrom('noreply@konimex.com');

                    //     foreach ($email_pengguna_info as $e => $ema) {
                    //         $mail->addAddress($ema['email_pengguna']);//Add a recipient
                    //     }
                    
                    //     //Content
                    //     // $link='https://konimex.com:447/pdln/listpb/pb/'.$id_transaksi;
                    //     $mail->Subject = 'Tes Program TABS (Bimo)';
                    //     $mail->Body    = nl2br("Tes kirim email harap diabaikan saja terima kasih.");
                    //     // $mail->Body    = nl2br("User bagian (").$niknmuser['niknm']."/".$nikuser['nik']."/".$nikuser['strorgnm'].(") telah selesai mengisi data PB, silahkan periksa data PB dengan cara klik link: $link");
                    
                    //     $mail->send();
                    //     // echo 'Message has been sent';
                    // } catch (Exception $e) {
                    //     echo "Message could not be sent. Mailer Error: {$mail->ErrorInfo}";
                    // }

                    //Mobil
                    $nama = $_POST['nama'];
                    $email_info = $_POST['email_info'];
                    $email_eval = $_POST['email_eval'];
                    $jumlah_mobil = $_POST['jumlah_mobil'];
                    $tanggal_mobil = $_POST['tanggal_mobil'];
                    $jam_siap = $_POST['jam_siap'];
                    // strtotime($jam_siap);

                    $email_pengguna_info = $this->m_pengguna->whereIn('nama_pengguna', $email_info)->select('email_pengguna')->findAll();

                    // try {
                    //     //Server settings
                    //     // $mail->SMTPDebug = SMTP::DEBUG_SERVER;
                    //     $mail->isSMTP();
                    //     $mail->Host       = 'mail.konimex.com';
                    //     $mail->SMTPAuth   = true;
                    //     $mail->Username   = PDLN_EMAIL;
                    //     $mail->Password   = PDLN_PASS;
                    //     $mail->SMTPSecure = PHPMailer::ENCRYPTION_STARTTLS;
                    //     $mail->Port       = 587;
                    
                    //     //Recipients
                    //     $mail->setFrom('noreply@konimex.com');

                    //     foreach ($email_pengguna_info as $e => $ema) {
                    //         $mail->addAddress($ema['email_pengguna']);//Add a recipient
                    //     }
                    
                    //     //Content
                    //     // $link='https://konimex.com:447/pdln/listpb/pb/'.$id_transaksi;
                    //     $mail->Subject = 'Tes Program TABS (Bimo)';
                    //     $mail->Body    = nl2br("Tes kirim email harap diabaikan saja terima kasih.");
                    //     // $mail->Body    = nl2br("User bagian (").$niknmuser['niknm']."/".$nikuser['nik']."/".$nikuser['strorgnm'].(") telah selesai mengisi data PB, silahkan periksa data PB dengan cara klik link: $link");
                    
                    //     $mail->send();
                    //     // echo 'Message has been sent';
                    // } catch (Exception $e) {
                    //     echo "Message could not be sent. Mailer Error: {$mail->ErrorInfo}";
                    // }

                    if(!empty($nama)) {
                        for($a = 0; $a < count($nama); $a++) {
                            //Trans
                            $pic = $_POST['pic'][$a];
                            $pic = ucwords($pic);
                            
                            //Tiket
                            $nama_tiket = $_POST['tiket'];
                            $nama_pool = $_POST['gs_tiket'];
                            $keberangkatan = $_POST['keberangkatan'];
                            $pemberhentian = $_POST['pemberhentian'];

                            if ($_POST['pilihan_tiket'][$a] == 0) {
                                session()->setFlashdata('warning', ['Pilih armada transportasi terlebih dahulu']);
                                return redirect()->to('trans_add');
                            } else if ($_POST['pilihan_tiket'][$a] == "Travel") {
                                $id_keberangkatan = null;
                                $id_pemberhentian = null;
                                $dari_tiket = $_POST['keberangkatan'][$a];
                                $tujuan_tiket = $_POST['pemberhentian'][$a];
                            } else {
                                $nama_keberangkatan = substr($keberangkatan[$a], 0, strpos($keberangkatan[$a], " - "));
                                $dari_tiket = substr($keberangkatan[$a], strpos($keberangkatan[$a], " - ")+3);
                                $id_berangkat = $this->m_pemberhentian->where('nama_pemberhentian', $nama_keberangkatan)->select('id_pemberhentian')->findAll();
                                $id_keberangkatan = $id_berangkat[0]['id_pemberhentian'];
                                
                                $nama_pemberhentian = substr($pemberhentian[$a], 0, strpos($pemberhentian[$a], " - "));
                                $tujuan_tiket = substr($pemberhentian[$a], strpos($pemberhentian[$a], " - ")+3);
                                $id_berhenti = $this->m_pemberhentian->where('nama_pemberhentian', $nama_pemberhentian)->select('id_pemberhentian')->findAll();
                                $id_pemberhentian = $id_berhenti[0]['id_pemberhentian'];
                            }

                            if ($_POST['keberangkatan'][$a] == $_POST['pemberhentian'][$a]) {
                                session()->setFlashdata('warning', ['Keberangkatan dan Pemberhentian Tiket tidak boleh sama']);
                                return redirect()->to('trans_add');
                            }
                            
                            $vendor = $this->m_vendor->where('nama_vendor', $nama_tiket[$a])->select('id_vendor')->findAll();
                            $pool_tiket = $this->m_pool->where('nama_pool', $nama_pool[$a])->select('id_pool')->findAll();

                            if ($_POST['tamu'][$a] == 'Tamu') {
                                $atas_nama = 'Tamu';
                                $jabatan = 'Tamu';
                            } else {
                                $atas_nama = $_POST['nama'][$a];
                                $atas_nama = ucwords($atas_nama);

                                $jabatan = $_POST['jabatan'][$a];
                                $jabatan = ucwords($jabatan);
                            }

                            $pembayaran = $_POST['pembayaran'][$a];
                            if($pembayaran == 'Company Acc'){
                                $pembayaran = 'k';
                            } else if($pembayaran == 'Personal Acc'){
                                $pembayaran = 'p';
                            }

                            $keterangan_tiket = $_POST['keterangan_tiket'][$a];
                            if(empty($keterangan_tiket)){
                                $keterangan_tiket = null;
                            }
                            
                            //Mobil
                            $nama_pool = $_POST['gs_mobil'];

                            $pool_mobil = $this->m_pool->where('nama_pool', $nama_pool[$a])->select('id_pool')->findAll();

                            if ($_POST['tamu'][$a] == 'Tamu') {
                                $atas_nama = 'Tamu';
                                $jabatan = 'Tamu';
                            } else {
                                $atas_nama = $_POST['nama'][$a];
                                $atas_nama = ucwords($atas_nama);
    
                                $jabatan = $_POST['jabatan'][$a];
                                $jabatan = ucwords($jabatan);
                            }

                            $tujuan_mobil = $_POST['tujuan_mobil'][$a];
                            $tujuan_mobil = ucwords($tujuan_mobil);

                            $siap_di = $_POST['siap_di'][$a];
                            $siap_di = ucwords($siap_di);

                            $pembayaran = $_POST['pembayaran'][$a];
                            if($pembayaran == 'Company Acc'){
                                $pembayaran = 'k';
                            } else if($pembayaran == 'Personal Acc'){
                                $pembayaran = 'p';
                            }

                            $jenis_kendaraan = $_POST['jenis_kendaraan'][$a];
                            if($jenis_kendaraan == 'Sedan'){
                                $jenis_kendaraan = 's';
                            } else if($jenis_kendaraan == 'Station'){
                                $jenis_kendaraan = 'a';
                            } else if($jenis_kendaraan == 'Pick Up'){
                                $jenis_kendaraan = 'p';
                            } else if($jenis_kendaraan == 'Box'){
                                $jenis_kendaraan = 'b';
                            } else if($jenis_kendaraan == 'Truck'){
                                $jenis_kendaraan = 't';
                            }

                            $tenaga_angkut = $_POST['tenaga_angkut'][$a];
                            if($tenaga_angkut == 'Iya'){
                                $tenaga_angkut = '1';
                            } else {
                                $tenaga_angkut = '0';
                            }
                            
                            $dalkot_lukot = $_POST['dalkot_lukot'][$a];

                            if($dalkot_lukot == 'Dalam Kota'){
                                $dalkot_lukot = 'd';
                                $menginap = 0;
                            } else {
                                $dalkot_lukot = 'l';
                                $menginap = $_POST['menginap'][$a];
                                if($menginap == 'Iya'){
                                    $menginap = '1';
                                } else {
                                    $menginap = '0';
                                }
                            }

                            $keterangan_mobil = $_POST['keterangan_mobil'][$a];
                            if(empty($keterangan_mobil)){
                                $keterangan_mobil = null;
                            }
                            
                            if(!empty($_POST['nama'][$a]) && !empty($_POST['jabatan'][$a]) && !empty($_POST['pic'][$a]) && !empty($_POST['email_eval'][$a]) && !empty($_POST['jumlah_tiket'][$a]) && !empty($_POST['tanggal_jam_tiket'][$a]) && !empty($_POST['jumlah_mobil'][$a]) && !empty($_POST['tujuan_mobil'][$a]) && !empty($_POST['siap_di'][$a]) && !empty($_POST['tanggal_mobil'][$a]) && !empty($_POST['jam_siap'][$a])) {
                                $trans[] = array(
                                    'id_trans' => $id_trans1++,
                                    'id_detail_pengguna' => session()->get('id_detail_pengguna'),
                                    'id_bagian' => session()->get('id_bagian'),
                                    'pemesanan' => $this->request->getVar('pemesanan'),
                                    'pic' => $pic,
                                    'tamu' => $_POST['tamu'][$a],
                                    'tgl_input' => date('Ymd'),
                                );
    
                                $tiket[] = array(
                                    'id_trans' => $id_trans2++,
                                    'id_vendor' => $vendor[0]['id_vendor'],
                                    'id_keberangkatan' => $id_keberangkatan,
                                    'id_pemberhentian' => $id_pemberhentian,
                                    'id_pool' => $pool_tiket[0]['id_pool'],
                                    'peminta' => session()->get('nama_pengguna'),
                                    'atas_nama' => $atas_nama,
                                    'jabatan' => $jabatan,
                                    'jumlah_tiket' => $_POST['jumlah_tiket'][$a],
                                    'pembayaran' => $pembayaran,
                                    'harga_tiket' => null,
                                    'tanggal_jam_tiket' => $_POST['tanggal_jam_tiket'][$a],
                                    'dari_tiket' => $dari_tiket,
                                    'tujuan_tiket' => $tujuan_tiket,
                                    'email_info' => $_POST['email_info'][$a],
                                    'email_eval' => $_POST['email_eval'][$a],
                                    'kirim_eval' => 0,
                                    'keterangan_tiket' => $keterangan_tiket,
                                    'tgl_input' => date('Ymd'),
                                );

                                $transportasi[] = array(
                                    'id_trans' => $id_trans3++,
                                    'id_pool' => $pool_mobil[0]['id_pool'],
                                    'jemput' => 0,
                                    'peminta' => session()->get('nama_pengguna'),
                                    'atas_nama' => $atas_nama,
                                    'jabatan' => $jabatan,
                                    'jumlah_mobil' => $jumlah_mobil[$a],
                                    'pembayaran' => $pembayaran,
                                    'jenis_kendaraan' => $jenis_kendaraan,
                                    'tenaga_angkut' => $tenaga_angkut,
                                    'dalkot_lukot' => $dalkot_lukot,
                                    'menginap' => $menginap,
                                    'kapasitas' => $_POST['kapasitas'][$a],
                                    'tujuan_mobil' => $tujuan_mobil,
                                    'siap_di' => $siap_di,
                                    'tanggal_mobil' => $tanggal_mobil[$a],
                                    'jam_siap' => $jam_siap[$a],
                                    'email_info' => $_POST['email_info'][$a],
                                    'email_eval' => $_POST['email_eval'][$a],
                                    'kirim_eval' => 0,
                                    'status_mobil' => 0,
                                    'keterangan_mobil' => $keterangan_mobil,
                                    'tgl_input' => date('Ymd'),
                                );
                            } else {
                                if(empty($_POST['nama'][$a])) {
                                    session()->setFlashdata('warning', ['Nama harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['jabatan'][$a])) {
                                    session()->setFlashdata('warning', ['Jabatan harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['pic'][$a])) {
                                    session()->setFlashdata('warning', ['PIC harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['email_eval'][$a])) {
                                    session()->setFlashdata('warning', ['Email Evaluasi harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['jumlah_tiket'][$a])) {
                                    session()->setFlashdata('warning', ['Jumlah tiket harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['tanggal_jam_tiket'][$a])) {
                                    session()->setFlashdata('warning', ['Tanggal dan Jam tiket harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if (empty($_POST['jumlah_mobil'][$a])) {
                                    session()->setFlashdata('warning', ['Jumlah Mobil harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['tujuan_mobil'][$a])) {
                                    session()->setFlashdata('warning', ['Tujuan harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['siap_di'][$a])) {
                                    session()->setFlashdata('warning', ['Siap Di harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['tanggal_mobil'][$a])) {
                                    session()->setFlashdata('warning', ['Tanggal harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['jam_siap'][$a])) {
                                    session()->setFlashdata('warning', ['Jam Siap harus diisi']);
                                    return redirect()->to('trans_add');
                                }
                            }
                        }
                    }
                    
                    $this->m_trans->insertBatch($trans);
                    $this->m_tiket->insertBatch($tiket);
                    $this->m_transportasi->insertBatch($transportasi);
                    session()->setFlashdata('success', ('Data berhasil ditambahkan'));
                    return redirect()->to("trans");

                    // $this->m_id->updateBatch($record);
                } else if ($antar == 'tidak') {
                    //Trans
                    $pic = $_POST['pic'];

                    $id_trans = $this->m_trans->select('id_trans')->orderBy('id_trans', 'desc')->first();
                    $id_transportasi = $this->m_transportasi->select('id_transportasi')->orderBy('id_transportasi', 'desc')->first();
                    if (empty($id_trans)) {
                        $id_trans1 = 1;
                        $id_trans2 = 1;
                        $id_trans3 = 1;
                        $id_trans4 = 1;
                    } else {
                        $id_trans1 = (int)$id_trans['id_trans'] + 1;
                        $id_trans2 = (int)$id_trans['id_trans'] + 1;
                        $id_trans3 = (int)$id_trans['id_trans'] + 1;
                        $id_trans4 = (int)$id_trans['id_trans'] + 1;
                    }

                    if (empty($id_transportasi)) {
                        $id_transportasi1 = 1;
                    } else {
                        $id_transportasi1 = (int)$id_transportasi['id_transportasi'] + 1;
                    }

                    //Tiket
                    $nama = $_POST['nama'];
                    $jabatan = $_POST['jabatan'];
                    $email_info = $_POST['email_info'];
                    $email_eval = $_POST['email_eval'];
                    $jumlah_tiket = $_POST['jumlah_tiket'];
                    $tanggal_jam_tiket = $_POST['tanggal_jam_tiket'];

                    $email_pengguna = $this->m_pengguna->whereIn('nama_pengguna', $email_info)->select('email_pengguna')->findAll();

                    // try {
                    //     //Server settings
                    //     // $mail->SMTPDebug = SMTP::DEBUG_SERVER;
                    //     $mail->isSMTP();
                    //     $mail->Host       = 'mail.konimex.com';
                    //     $mail->SMTPAuth   = true;
                    //     $mail->Username   = PDLN_EMAIL;
                    //     $mail->Password   = PDLN_PASS;
                    //     $mail->SMTPSecure = PHPMailer::ENCRYPTION_STARTTLS;
                    //     $mail->Port       = 587;
                    
                    //     //Recipients
                    //     $mail->setFrom('noreply@konimex.com');

                    //     foreach ($email_pengguna_info as $e => $ema) {
                    //         $mail->addAddress($ema['email_pengguna']);//Add a recipient
                    //     }
                    
                    //     //Content
                    //     // $link='https://konimex.com:447/pdln/listpb/pb/'.$id_transaksi;
                    //     $mail->Subject = 'Tes Program TABS (Bimo)';
                    //     $mail->Body    = nl2br("Tes kirim email harap diabaikan saja terima kasih.");
                    //     // $mail->Body    = nl2br("User bagian (").$niknmuser['niknm']."/".$nikuser['nik']."/".$nikuser['strorgnm'].(") telah selesai mengisi data PB, silahkan periksa data PB dengan cara klik link: $link");
                    
                    //     $mail->send();
                    //     // echo 'Message has been sent';
                    // } catch (Exception $e) {
                    //     echo "Message could not be sent. Mailer Error: {$mail->ErrorInfo}";
                    // }

                    //Mobil Pulang
                    $nama = $_POST['nama'];
                    $email_info = $_POST['email_info'];
                    $email_eval = $_POST['email_eval'];
                    $jumlah_mobil_pulang = $_POST['jumlah_mobil_pulang'];
                    $tanggal_mobil_pulang = $_POST['tanggal_mobil_pulang'];
                    $jam_siap_pulang = $_POST['jam_siap_pulang'];
                    // strtotime($jam_siap);

                    $email_pengguna_info = $this->m_pengguna->whereIn('nama_pengguna', $email_info)->select('email_pengguna')->findAll();

                    // try {
                    //     //Server settings
                    //     // $mail->SMTPDebug = SMTP::DEBUG_SERVER;
                    //     $mail->isSMTP();
                    //     $mail->Host       = 'mail.konimex.com';
                    //     $mail->SMTPAuth   = true;
                    //     $mail->Username   = PDLN_EMAIL;
                    //     $mail->Password   = PDLN_PASS;
                    //     $mail->SMTPSecure = PHPMailer::ENCRYPTION_STARTTLS;
                    //     $mail->Port       = 587;
                    
                    //     //Recipients
                    //     $mail->setFrom('noreply@konimex.com');

                    //     foreach ($email_pengguna_info as $e => $ema) {
                    //         $mail->addAddress($ema['email_pengguna']);//Add a recipient
                    //     }
                    
                    //     //Content
                    //     // $link='https://konimex.com:447/pdln/listpb/pb/'.$id_transaksi;
                    //     $mail->Subject = 'Tes Program TABS (Bimo)';
                    //     $mail->Body    = nl2br("Tes kirim email harap diabaikan saja terima kasih.");
                    //     // $mail->Body    = nl2br("User bagian (").$niknmuser['niknm']."/".$nikuser['nik']."/".$nikuser['strorgnm'].(") telah selesai mengisi data PB, silahkan periksa data PB dengan cara klik link: $link");
                    
                    //     $mail->send();
                    //     // echo 'Message has been sent';
                    // } catch (Exception $e) {
                    //     echo "Message could not be sent. Mailer Error: {$mail->ErrorInfo}";
                    // }

                    if(!empty($nama)) {
                        for($a = 0; $a < count($nama); $a++) {
                            //Trans
                            $pic = $_POST['pic'][$a];
                            $pic = ucwords($pic);
                            
                            //Tiket
                            $nama_tiket = $_POST['tiket'];
                            $nama_pool = $_POST['gs_tiket'];
                            $pemberhentian = $_POST['pemberhentian'];

                            $nama_pemberhentian = substr($pemberhentian[$a], 0, strpos($pemberhentian[$a], " - "));
                            $id_pemberhentian = $this->m_pemberhentian->where('nama_pemberhentian', $nama_pemberhentian)->select('id_pemberhentian')->findAll();

                            $vendor = $this->m_vendor->where('nama_vendor', $nama_tiket[$a])->select('id_vendor')->findAll();
                            $pool_tiket = $this->m_pool->where('nama_pool', $nama_pool[$a])->select('id_pool')->findAll();

                            $atas_nama = $_POST['nama'][$a];
                            $atas_nama = ucwords($atas_nama);

                            $jabatan = $_POST['jabatan'][$a];
                            $jabatan = ucwords($jabatan);

                            $pembayaran = $_POST['pembayaran'][$a];
                            if($pembayaran == 'Company Acc'){
                                $pembayaran = 'k';
                            } else if($pembayaran == 'Personal Acc'){
                                $pembayaran = 'p';
                            }

                            $dari_tiket = $_POST['dari_tiket'][$a];
                            $tujuan_tiket = $_POST['tujuan_tiket'][$a];

                            if ($dari_tiket == $tujuan_tiket) {
                                session()->setFlashdata('warning', ['Dari dan Tujuan Tiket tidak boleh sama']);
                                return redirect()->to('trans_add');
                            }

                            $keterangan_tiket = $_POST['keterangan_tiket'][$a];
                            if(empty($keterangan_tiket)){
                                $keterangan_tiket = null;
                            }
                            
                            //Mobil Pulang
                            $nama_pool = $_POST['gs_mobil_pulang'];

                            $pool_mobil_pulang = $this->m_pool->where('nama_pool', $nama_pool[$a])->select('id_pool')->findAll();

                            $atas_nama = $_POST['nama'][$a];
                            $atas_nama = ucwords($atas_nama);

                            $jabatan = $_POST['jabatan'][$a];
                            $jabatan = ucwords($jabatan);

                            $tujuan_mobil_pulang = $_POST['tujuan_mobil_pulang'][$a];
                            $tujuan_mobil_pulang = ucwords($tujuan_mobil_pulang);

                            $siap_di_pulang = $_POST['siap_di_pulang'][$a];
                            $siap_di_pulang = ucwords($siap_di_pulang);

                            $pembayaran = $_POST['pembayaran'][$a];
                            if($pembayaran == 'Company Acc'){
                                $pembayaran = 'k';
                            } else if($pembayaran == 'Personal Acc'){
                                $pembayaran = 'p';
                            }

                            $jenis_kendaraan_pulang = $_POST['jenis_kendaraan_pulang'][$a];
                            if($jenis_kendaraan_pulang == 'Sedan'){
                                $jenis_kendaraan_pulang = 's';
                            } else if($jenis_kendaraan_pulang == 'Station'){
                                $jenis_kendaraan_pulang = 'a';
                            } else if($jenis_kendaraan_pulang == 'Pick Up'){
                                $jenis_kendaraan_pulang = 'p';
                            } else if($jenis_kendaraan_pulang == 'Box'){
                                $jenis_kendaraan_pulang = 'b';
                            } else if($jenis_kendaraan_pulang == 'Truck'){
                                $jenis_kendaraan_pulang = 't';
                            }

                            $tenaga_angkut_pulang = $_POST['tenaga_angkut_pulang'][$a];
                            if($tenaga_angkut_pulang == 'Iya'){
                                $tenaga_angkut_pulang = '1';
                            } else {
                                $tenaga_angkut_pulang = '0';
                            }
                            
                            $dalkot_lukot_pulang = $_POST['dalkot_lukot_pulang'][$a];

                            if($dalkot_lukot_pulang == 'Dalam Kota'){
                                $dalkot_lukot_pulang = 'd';
                                $menginap_pulang = 0;
                            } else {
                                $dalkot_lukot_pulang = 'l';
                                $menginap_pulang = $_POST['menginap_pulang'][$a];
                                if($menginap_pulang == 'Iya'){
                                    $menginap_pulang = '1';
                                } else {
                                    $menginap_pulang = '0';
                                }
                            }

                            $keterangan_mobil_pulang = $_POST['keterangan_mobil_pulang'][$a];
                            if(empty($keterangan_mobil_pulang)){
                                $keterangan_mobil_pulang = null;
                            }
                            
                            if(!empty($_POST['nama'][$a]) && !empty($_POST['jabatan'][$a]) && !empty($_POST['pic'][$a]) && !empty($_POST['email_eval'][$a]) && !empty($_POST['jumlah_tiket'][$a]) && !empty($_POST['tanggal_jam_tiket'][$a]) && !empty($_POST['jumlah_mobil_pulang'][$a]) && !empty($_POST['tujuan_mobil_pulang'][$a]) && !empty($_POST['siap_di_pulang'][$a]) && !empty($_POST['tanggal_mobil_pulang'][$a]) && !empty($_POST['jam_siap_pulang'][$a])) {
                                $trans[] = array(
                                    'id_trans' => $id_trans1++,
                                    'id_detail_pengguna' => session()->get('id_detail_pengguna'),
                                    'id_bagian' => session()->get('id_bagian'),
                                    'pemesanan' => $this->request->getVar('pemesanan'),
                                    'pic' => $pic,
                                    'tamu' => $_POST['tamu'][$a],
                                    'tgl_input' => date('Ymd'),
                                );
    
                                $tiket[] = array(
                                    'id_trans' => $id_trans2++,
                                    'id_vendor' => $vendor[0]['id_vendor'],
                                    'id_pemberhentian' => $id_pemberhentian[0]['id_pemberhentian'],
                                    'id_pool' => $pool_tiket[0]['id_pool'],
                                    'peminta' => session()->get('nama_pengguna'),
                                    'atas_nama' => $atas_nama,
                                    'jabatan' => $jabatan,
                                    'jumlah_tiket' => $_POST['jumlah_tiket'][$a],
                                    'pembayaran' => $pembayaran,
                                    'harga_tiket' => null,
                                    'tanggal_jam_tiket' => $_POST['tanggal_jam_tiket'][$a],
                                    'dari_tiket' => $dari_tiket,
                                    'tujuan_tiket' => $tujuan_tiket,
                                    'email_info' => $_POST['email_info'][$a],
                                    'email_eval' => $_POST['email_eval'][$a],
                                    'kirim_eval' => 0,
                                    'keterangan_tiket' => $keterangan_tiket,
                                    'tgl_input' => date('Ymd'),
                                );

                                $transportasi[] = array(
                                    'id_trans' => $id_trans3++,
                                    'id_pool' => $pool_mobil_pulang[0]['id_pool'],
                                    'jemput' => 1,
                                    'peminta' => null,
                                    'atas_nama' => null,
                                    'jabatan' => null,
                                    'jumlah_mobil' => null,
                                    'pembayaran' => null,
                                    'jenis_kendaraan' => null,
                                    'tenaga_angkut' => null,
                                    'dalkot_lukot' => null,
                                    'menginap' => null,
                                    'kapasitas' => null,
                                    'tujuan_mobil' => null,
                                    'siap_di' => null,
                                    'tanggal_mobil' => $tanggal_mobil_pulang[$a],
                                    'jam_siap' => $jam_siap_pulang[$a],
                                    'email_info' => null,
                                    'email_eval' => null,
                                    'kirim_eval' => null,
                                    'status_mobil' => 0,
                                    'keterangan_mobil' => null,
                                    'tgl_input' => date('Ymd'),
                                );

                                $transportasi_jemput[] = array(
                                    'id_transportasi' => $id_transportasi1++,
                                    'id_trans' => $id_trans4++,
                                    'id_pool' => $pool_mobil_pulang[0]['id_pool'],
                                    'jemput' => 1,
                                    'peminta' => session()->get('nama_pengguna'),
                                    'atas_nama' => $atas_nama,
                                    'jabatan' => $jabatan,
                                    'jumlah_mobil' => $jumlah_mobil_pulang[$a],
                                    'pembayaran' => $pembayaran,
                                    'jenis_kendaraan' => $jenis_kendaraan_pulang,
                                    'tenaga_angkut' => $tenaga_angkut_pulang,
                                    'dalkot_lukot' => $dalkot_lukot_pulang,
                                    'menginap' => $menginap_pulang,
                                    'kapasitas' => $_POST['kapasitas_pulang'][$a],
                                    'tujuan_mobil' => $tujuan_mobil_pulang,
                                    'siap_di' => $siap_di_pulang,
                                    'tanggal_mobil' => $tanggal_mobil_pulang[$a],
                                    'jam_siap' => $jam_siap_pulang[$a],
                                    'email_info' => $_POST['email_info'][$a],
                                    'email_eval' => $_POST['email_eval'][$a],
                                    'kirim_eval' => 0,
                                    'status_mobil' => 0,
                                    'keterangan_mobil' => $keterangan_mobil_pulang,
                                    'tgl_input' => date('Ymd'),
                                );
                            } else {
                                if(empty($_POST['nama'][$a])) {
                                    session()->setFlashdata('warning', ['Nama harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['jabatan'][$a])) {
                                    session()->setFlashdata('warning', ['Jabatan harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['pic'][$a])) {
                                    session()->setFlashdata('warning', ['PIC harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['email_eval'][$a])) {
                                    session()->setFlashdata('warning', ['Email Evaluasi harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['jumlah_tiket'][$a])) {
                                    session()->setFlashdata('warning', ['Jumlah tiket harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['tanggal_jam_tiket'][$a])) {
                                    session()->setFlashdata('warning', ['Tanggal dan Jam tiket harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if (empty($_POST['jumlah_mobil_pulang'][$a])) {
                                    session()->setFlashdata('warning', ['Jumlah Mobil harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['tujuan_mobil_pulang'][$a])) {
                                    session()->setFlashdata('warning', ['Tujuan harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['siap_di_pulang'][$a])) {
                                    session()->setFlashdata('warning', ['Siap Di harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['tanggal_mobil_pulang'][$a])) {
                                    session()->setFlashdata('warning', ['Tanggal harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['jam_siap_pulang'][$a])) {
                                    session()->setFlashdata('warning', ['Jam Siap harus diisi']);
                                    return redirect()->to('trans_add');
                                }
                            }
                        }
                    }
                    
                    $this->m_trans->insertBatch($trans);
                    $this->m_tiket->insertBatch($tiket);
                    $this->m_transportasi->insertBatch($transportasi);
                    $this->m_transportasi_jemput->insertBatch($transportasi_jemput);
                    session()->setFlashdata('success', ('Data berhasil ditambahkan'));
                    return redirect()->to("trans");

                    // $this->m_id->updateBatch($record);
                } else {
                    //Trans
                    $pic = $_POST['pic'];

                    $id_trans = $this->m_trans->select('id_trans')->orderBy('id_trans', 'desc')->first();
                    $id_transportasi = $this->m_transportasi->select('id_transportasi')->orderBy('id_transportasi', 'desc')->first();
                    if (empty($id_trans)) {
                        $id_trans1 = 1;
                        $id_trans2 = 1;
                        $id_trans3 = 1;
                        $id_trans4 = 1;
                    } else {
                        $id_trans1 = (int)$id_trans['id_trans'] + 1;
                        $id_trans2 = (int)$id_trans['id_trans'] + 1;
                        $id_trans3 = (int)$id_trans['id_trans'] + 1;
                        $id_trans4 = (int)$id_trans['id_trans'] + 1;
                    }

                    if (empty($id_transportasi)) {
                        $id_transportasi1 = 1;
                    } else {
                        $id_transportasi1 = (int)$id_transportasi['id_transportasi'] + 1;
                    }

                    //Tiket
                    $nama = $_POST['nama'];
                    $jabatan = $_POST['jabatan'];
                    $email_info = $_POST['email_info'];
                    $email_eval = $_POST['email_eval'];
                    $jumlah_tiket = $_POST['jumlah_tiket'];
                    $tanggal_jam_tiket = $_POST['tanggal_jam_tiket'];

                    $email_pengguna = $this->m_pengguna->whereIn('nama_pengguna', $email_info)->select('email_pengguna')->findAll();

                    // try {
                    //     //Server settings
                    //     // $mail->SMTPDebug = SMTP::DEBUG_SERVER;
                    //     $mail->isSMTP();
                    //     $mail->Host       = 'mail.konimex.com';
                    //     $mail->SMTPAuth   = true;
                    //     $mail->Username   = PDLN_EMAIL;
                    //     $mail->Password   = PDLN_PASS;
                    //     $mail->SMTPSecure = PHPMailer::ENCRYPTION_STARTTLS;
                    //     $mail->Port       = 587;
                    
                    //     //Recipients
                    //     $mail->setFrom('noreply@konimex.com');

                    //     foreach ($email_pengguna_info as $e => $ema) {
                    //         $mail->addAddress($ema['email_pengguna']);//Add a recipient
                    //     }
                    
                    //     //Content
                    //     // $link='https://konimex.com:447/pdln/listpb/pb/'.$id_transaksi;
                    //     $mail->Subject = 'Tes Program TABS (Bimo)';
                    //     $mail->Body    = nl2br("Tes kirim email harap diabaikan saja terima kasih.");
                    //     // $mail->Body    = nl2br("User bagian (").$niknmuser['niknm']."/".$nikuser['nik']."/".$nikuser['strorgnm'].(") telah selesai mengisi data PB, silahkan periksa data PB dengan cara klik link: $link");
                    
                    //     $mail->send();
                    //     // echo 'Message has been sent';
                    // } catch (Exception $e) {
                    //     echo "Message could not be sent. Mailer Error: {$mail->ErrorInfo}";
                    // }

                    //Mobil
                    $nama = $_POST['nama'];
                    $email_info = $_POST['email_info'];
                    $email_eval = $_POST['email_eval'];
                    $jumlah_mobil = $_POST['jumlah_mobil'];
                    $tanggal_mobil = $_POST['tanggal_mobil'];
                    $jam_siap = $_POST['jam_siap'];
                    // strtotime($jam_siap);

                    $email_pengguna_info = $this->m_pengguna->whereIn('nama_pengguna', $email_info)->select('email_pengguna')->findAll();

                    // try {
                    //     //Server settings
                    //     // $mail->SMTPDebug = SMTP::DEBUG_SERVER;
                    //     $mail->isSMTP();
                    //     $mail->Host       = 'mail.konimex.com';
                    //     $mail->SMTPAuth   = true;
                    //     $mail->Username   = PDLN_EMAIL;
                    //     $mail->Password   = PDLN_PASS;
                    //     $mail->SMTPSecure = PHPMailer::ENCRYPTION_STARTTLS;
                    //     $mail->Port       = 587;
                    
                    //     //Recipients
                    //     $mail->setFrom('noreply@konimex.com');

                    //     foreach ($email_pengguna_info as $e => $ema) {
                    //         $mail->addAddress($ema['email_pengguna']);//Add a recipient
                    //     }
                    
                    //     //Content
                    //     // $link='https://konimex.com:447/pdln/listpb/pb/'.$id_transaksi;
                    //     $mail->Subject = 'Tes Program TABS (Bimo)';
                    //     $mail->Body    = nl2br("Tes kirim email harap diabaikan saja terima kasih.");
                    //     // $mail->Body    = nl2br("User bagian (").$niknmuser['niknm']."/".$nikuser['nik']."/".$nikuser['strorgnm'].(") telah selesai mengisi data PB, silahkan periksa data PB dengan cara klik link: $link");
                    
                    //     $mail->send();
                    //     // echo 'Message has been sent';
                    // } catch (Exception $e) {
                    //     echo "Message could not be sent. Mailer Error: {$mail->ErrorInfo}";
                    // }

                    //Mobil Pulang
                    $nama = $_POST['nama'];
                    $email_info = $_POST['email_info'];
                    $email_eval = $_POST['email_eval'];
                    $jumlah_mobil_pulang = $_POST['jumlah_mobil_pulang'];
                    $tanggal_mobil_pulang = $_POST['tanggal_mobil_pulang'];
                    $jam_siap_pulang = $_POST['jam_siap_pulang'];
                    // strtotime($jam_siap);

                    $email_pengguna_info = $this->m_pengguna->whereIn('nama_pengguna', $email_info)->select('email_pengguna')->findAll();

                    // try {
                    //     //Server settings
                    //     // $mail->SMTPDebug = SMTP::DEBUG_SERVER;
                    //     $mail->isSMTP();
                    //     $mail->Host       = 'mail.konimex.com';
                    //     $mail->SMTPAuth   = true;
                    //     $mail->Username   = PDLN_EMAIL;
                    //     $mail->Password   = PDLN_PASS;
                    //     $mail->SMTPSecure = PHPMailer::ENCRYPTION_STARTTLS;
                    //     $mail->Port       = 587;
                    
                    //     //Recipients
                    //     $mail->setFrom('noreply@konimex.com');

                    //     foreach ($email_pengguna_info as $e => $ema) {
                    //         $mail->addAddress($ema['email_pengguna']);//Add a recipient
                    //     }
                    
                    //     //Content
                    //     // $link='https://konimex.com:447/pdln/listpb/pb/'.$id_transaksi;
                    //     $mail->Subject = 'Tes Program TABS (Bimo)';
                    //     $mail->Body    = nl2br("Tes kirim email harap diabaikan saja terima kasih.");
                    //     // $mail->Body    = nl2br("User bagian (").$niknmuser['niknm']."/".$nikuser['nik']."/".$nikuser['strorgnm'].(") telah selesai mengisi data PB, silahkan periksa data PB dengan cara klik link: $link");
                    
                    //     $mail->send();
                    //     // echo 'Message has been sent';
                    // } catch (Exception $e) {
                    //     echo "Message could not be sent. Mailer Error: {$mail->ErrorInfo}";
                    // }

                    if(!empty($nama)) {
                        for($a = 0; $a < count($nama); $a++) {
                            //Trans
                            $pic = $_POST['pic'][$a];
                            $pic = ucwords($pic);
                            
                            //Tiket
                            $nama_tiket = $_POST['tiket'];
                            $nama_pool = $_POST['gs_tiket'];
                            $pemberhentian = $_POST['pemberhentian'];

                            $nama_pemberhentian = substr($pemberhentian[$a], 0, strpos($pemberhentian[$a], " - "));
                            $id_pemberhentian = $this->m_pemberhentian->where('nama_pemberhentian', $nama_pemberhentian)->select('id_pemberhentian')->findAll();

                            $vendor = $this->m_vendor->where('nama_vendor', $nama_tiket[$a])->select('id_vendor')->findAll();
                            $pool_tiket = $this->m_pool->where('nama_pool', $nama_pool[$a])->select('id_pool')->findAll();

                            $atas_nama = $_POST['nama'][$a];
                            $atas_nama = ucwords($atas_nama);

                            $jabatan = $_POST['jabatan'][$a];
                            $jabatan = ucwords($jabatan);

                            $pembayaran = $_POST['pembayaran'][$a];
                            if($pembayaran == 'Company Acc'){
                                $pembayaran = 'k';
                            } else if($pembayaran == 'Personal Acc'){
                                $pembayaran = 'p';
                            }

                            $dari_tiket = $_POST['dari_tiket'][$a];
                            $tujuan_tiket = $_POST['tujuan_tiket'][$a];

                            if ($dari_tiket == $tujuan_tiket) {
                                session()->setFlashdata('warning', ['Dari dan Tujuan Tiket tidak boleh sama']);
                                return redirect()->to('trans_add');
                            }

                            $keterangan_tiket = $_POST['keterangan_tiket'][$a];
                            if(empty($keterangan_tiket)){
                                $keterangan_tiket = null;
                            }

                            //Mobil
                            $nama_pool = $_POST['gs_mobil'];

                            $pool_mobil = $this->m_pool->where('nama_pool', $nama_pool[$a])->select('id_pool')->findAll();

                            $atas_nama = $_POST['nama'][$a];
                            $atas_nama = ucwords($atas_nama);

                            $jabatan = $_POST['jabatan'][$a];
                            $jabatan = ucwords($jabatan);

                            $tujuan_mobil = $_POST['tujuan_mobil'][$a];
                            $tujuan_mobil = ucwords($tujuan_mobil);

                            $siap_di = $_POST['siap_di'][$a];
                            $siap_di = ucwords($siap_di);

                            $pembayaran = $_POST['pembayaran'][$a];
                            if($pembayaran == 'Company Acc'){
                                $pembayaran = 'k';
                            } else if($pembayaran == 'Personal Acc'){
                                $pembayaran = 'p';
                            }

                            $jenis_kendaraan = $_POST['jenis_kendaraan'][$a];
                            if($jenis_kendaraan == 'Sedan'){
                                $jenis_kendaraan = 's';
                            } else if($jenis_kendaraan == 'Station'){
                                $jenis_kendaraan = 'a';
                            } else if($jenis_kendaraan == 'Pick Up'){
                                $jenis_kendaraan = 'p';
                            } else if($jenis_kendaraan == 'Box'){
                                $jenis_kendaraan = 'b';
                            } else if($jenis_kendaraan == 'Truck'){
                                $jenis_kendaraan = 't';
                            }

                            $tenaga_angkut = $_POST['tenaga_angkut'][$a];
                            if($tenaga_angkut == 'Iya'){
                                $tenaga_angkut = '1';
                            } else {
                                $tenaga_angkut = '0';
                            }
                            
                            $dalkot_lukot = $_POST['dalkot_lukot'][$a];

                            if($dalkot_lukot == 'Dalam Kota'){
                                $dalkot_lukot = 'd';
                                $menginap = 0;
                            } else {
                                $dalkot_lukot = 'l';
                                $menginap = $_POST['menginap'][$a];
                                if($menginap == 'Iya'){
                                    $menginap = '1';
                                } else {
                                    $menginap = '0';
                                }
                            }

                            $keterangan_mobil = $_POST['keterangan_mobil'][$a];
                            if(empty($keterangan_mobil)){
                                $keterangan_mobil = null;
                            }

                            //Mobil Pulang
                            $nama_pool = $_POST['gs_mobil_pulang'];

                            $pool_mobil_pulang = $this->m_pool->where('nama_pool', $nama_pool[$a])->select('id_pool')->findAll();

                            $atas_nama = $_POST['nama'][$a];
                            $atas_nama = ucwords($atas_nama);

                            $jabatan = $_POST['jabatan'][$a];
                            $jabatan = ucwords($jabatan);

                            $tujuan_mobil_pulang = $_POST['tujuan_mobil_pulang'][$a];
                            $tujuan_mobil_pulang = ucwords($tujuan_mobil_pulang);

                            $siap_di_pulang = $_POST['siap_di_pulang'][$a];
                            $siap_di_pulang = ucwords($siap_di_pulang);

                            $pembayaran = $_POST['pembayaran'][$a];
                            if($pembayaran == 'Company Acc'){
                                $pembayaran = 'k';
                            } else if($pembayaran == 'Personal Acc'){
                                $pembayaran = 'p';
                            }

                            $jenis_kendaraan_pulang = $_POST['jenis_kendaraan_pulang'][$a];
                            if($jenis_kendaraan_pulang == 'Sedan'){
                                $jenis_kendaraan_pulang = 's';
                            } else if($jenis_kendaraan_pulang == 'Station'){
                                $jenis_kendaraan_pulang = 'a';
                            } else if($jenis_kendaraan_pulang == 'Pick Up'){
                                $jenis_kendaraan_pulang = 'p';
                            } else if($jenis_kendaraan_pulang == 'Box'){
                                $jenis_kendaraan_pulang = 'b';
                            } else if($jenis_kendaraan_pulang == 'Truck'){
                                $jenis_kendaraan_pulang = 't';
                            }

                            $tenaga_angkut_pulang = $_POST['tenaga_angkut_pulang'][$a];
                            if($tenaga_angkut_pulang == 'Iya'){
                                $tenaga_angkut_pulang = '1';
                            } else {
                                $tenaga_angkut_pulang = '0';
                            }
                            
                            $dalkot_lukot_pulang = $_POST['dalkot_lukot_pulang'][$a];

                            if($dalkot_lukot_pulang == 'Dalam Kota'){
                                $dalkot_lukot_pulang = 'd';
                                $menginap_pulang = 0;
                            } else {
                                $dalkot_lukot_pulang = 'l';
                                $menginap_pulang = $_POST['menginap_pulang'][$a];
                                if($menginap_pulang == 'Iya'){
                                    $menginap_pulang = '1';
                                } else {
                                    $menginap_pulang = '0';
                                }
                            }

                            $keterangan_mobil_pulang = $_POST['keterangan_mobil_pulang'][$a];
                            if(empty($keterangan_mobil_pulang)){
                                $keterangan_mobil_pulang = null;
                            }
                            
                            if(!empty($_POST['nama'][$a]) && !empty($_POST['jabatan'][$a]) && !empty($_POST['pic'][$a]) && !empty($_POST['email_eval'][$a]) && !empty($_POST['jumlah_tiket'][$a]) && !empty($_POST['tanggal_jam_tiket'][$a]) && !empty($_POST['jumlah_mobil'][$a]) && !empty($_POST['tujuan_mobil'][$a]) && !empty($_POST['siap_di'][$a]) && !empty($_POST['tanggal_mobil'][$a]) && !empty($_POST['jam_siap'][$a]) && !empty($_POST['jumlah_mobil_pulang'][$a]) && !empty($_POST['tujuan_mobil_pulang'][$a]) && !empty($_POST['siap_di_pulang'][$a]) && !empty($_POST['tanggal_mobil_pulang'][$a]) && !empty($_POST['jam_siap_pulang'][$a])) {
                                $trans[] = array(
                                    'id_trans' => $id_trans1++,
                                    'id_detail_pengguna' => session()->get('id_detail_pengguna'),
                                    'id_bagian' => session()->get('id_bagian'),
                                    'pemesanan' => $this->request->getVar('pemesanan'),
                                    'pic' => $pic,
                                    'tamu' => $_POST['tamu'][$a],
                                    'tgl_input' => date('Ymd'),
                                );
    
                                $tiket[] = array(
                                    'id_trans' => $id_trans2++,
                                    'id_vendor' => $vendor[0]['id_vendor'],
                                    'id_pemberhentian' => $id_pemberhentian[0]['id_pemberhentian'],
                                    'id_pool' => $pool_tiket[0]['id_pool'],
                                    'peminta' => session()->get('nama_pengguna'),
                                    'atas_nama' => $atas_nama,
                                    'jabatan' => $jabatan,
                                    'jumlah_tiket' => $_POST['jumlah_tiket'][$a],
                                    'pembayaran' => $pembayaran,
                                    'harga_tiket' => null,
                                    'tanggal_jam_tiket' => $_POST['tanggal_jam_tiket'][$a],
                                    'dari_tiket' => $dari_tiket,
                                    'tujuan_tiket' => $tujuan_tiket,
                                    'email_info' => $_POST['email_info'][$a],
                                    'email_eval' => $_POST['email_eval'][$a],
                                    'kirim_eval' => 0,
                                    'keterangan_tiket' => $keterangan_tiket,
                                    'tgl_input' => date('Ymd'),
                                );

                                $transportasi[] = array(
                                    'id_trans' => $id_trans3++,
                                    'id_pool' => $pool_mobil[0]['id_pool'],
                                    'jemput' => 2,
                                    'peminta' => session()->get('nama_pengguna'),
                                    'atas_nama' => $atas_nama,
                                    'jabatan' => $jabatan,
                                    'jumlah_mobil' => $jumlah_mobil[$a],
                                    'pembayaran' => $pembayaran,
                                    'jenis_kendaraan' => $jenis_kendaraan,
                                    'tenaga_angkut' => $tenaga_angkut,
                                    'dalkot_lukot' => $dalkot_lukot,
                                    'menginap' => $menginap,
                                    'kapasitas' => $_POST['kapasitas'][$a],
                                    'tujuan_mobil' => $tujuan_mobil,
                                    'siap_di' => $siap_di,
                                    'tanggal_mobil' => $tanggal_mobil[$a],
                                    'jam_siap' => $jam_siap[$a],
                                    'email_info' => $_POST['email_info'][$a],
                                    'email_eval' => $_POST['email_eval'][$a],
                                    'kirim_eval' => 0,
                                    'status_mobil' => 0,
                                    'keterangan_mobil' => $keterangan_mobil,
                                    'tgl_input' => date('Ymd'),
                                );

                                $transportasi_jemput[] = array(
                                    'id_transportasi' => $id_transportasi1++,
                                    'id_trans' => $id_trans4++,
                                    'id_pool' => $pool_mobil_pulang[0]['id_pool'],
                                    'jemput' => 2,
                                    'peminta' => session()->get('nama_pengguna'),
                                    'atas_nama' => $atas_nama,
                                    'jabatan' => $jabatan,
                                    'jumlah_mobil' => $jumlah_mobil_pulang[$a],
                                    'pembayaran' => $pembayaran,
                                    'jenis_kendaraan' => $jenis_kendaraan_pulang,
                                    'tenaga_angkut' => $tenaga_angkut_pulang,
                                    'dalkot_lukot' => $dalkot_lukot_pulang,
                                    'menginap' => $menginap_pulang,
                                    'kapasitas' => $_POST['kapasitas_pulang'][$a],
                                    'tujuan_mobil' => $tujuan_mobil_pulang,
                                    'siap_di' => $siap_di_pulang,
                                    'tanggal_mobil' => $tanggal_mobil_pulang[$a],
                                    'jam_siap' => $jam_siap_pulang[$a],
                                    'email_info' => $_POST['email_info'][$a],
                                    'email_eval' => $_POST['email_eval'][$a],
                                    'kirim_eval' => 0,
                                    'status_mobil' => 0,
                                    'keterangan_mobil' => $keterangan_mobil_pulang,
                                    'tgl_input' => date('Ymd'),
                                );
                            } else {
                                if(empty($_POST['nama'][$a])) {
                                    session()->setFlashdata('warning', ['Nama harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['jabatan'][$a])) {
                                    session()->setFlashdata('warning', ['Jabatan harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['pic'][$a])) {
                                    session()->setFlashdata('warning', ['PIC harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['email_eval'][$a])) {
                                    session()->setFlashdata('warning', ['Email Evaluasi harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['jumlah_tiket'][$a])) {
                                    session()->setFlashdata('warning', ['Jumlah tiket harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['tanggal_jam_tiket'][$a])) {
                                    session()->setFlashdata('warning', ['Tanggal dan Jam tiket harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if (empty($_POST['jumlah_mobil'][$a])) {
                                    session()->setFlashdata('warning', ['Jumlah Mobil harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['tujuan_mobil'][$a])) {
                                    session()->setFlashdata('warning', ['Tujuan harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['siap_di'][$a])) {
                                    session()->setFlashdata('warning', ['Siap Di harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['tanggal_mobil'][$a])) {
                                    session()->setFlashdata('warning', ['Tanggal harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['jam_siap'][$a])) {
                                    session()->setFlashdata('warning', ['Jam Siap harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['jumlah_mobil_pulang'][$a])) {
                                    session()->setFlashdata('warning', ['Jumlah Mobil harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['tujuan_mobil_pulang'][$a])) {
                                    session()->setFlashdata('warning', ['Tujuan harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['siap_di_pulang'][$a])) {
                                    session()->setFlashdata('warning', ['Siap Di harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['tanggal_mobil_pulang'][$a])) {
                                    session()->setFlashdata('warning', ['Tanggal harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['jam_siap_pulang'][$a])) {
                                    session()->setFlashdata('warning', ['Jam Siap harus diisi']);
                                    return redirect()->to('trans_add');
                                }
                            }
                        }
                    }
                    
                    $this->m_trans->insertBatch($trans);
                    $this->m_tiket->insertBatch($tiket);
                    $this->m_transportasi->insertBatch($transportasi);
                    $this->m_transportasi_jemput->insertBatch($transportasi_jemput);
                    session()->setFlashdata('success', ('Data berhasil ditambahkan'));
                    return redirect()->to("trans");

                    // $this->m_id->updateBatch($record);
                }
            }
            //Hotel + Mobil
            else if ($pemesanan == '5') {
                $jemput = $_POST['jemput'];
                $antar = $_POST['antar'];

                if ($jemput == 'tidak') {
                    //Trans
                    $pic = $_POST['pic'];

                    $id_trans = $this->m_trans->select('id_trans')->orderBy('id_trans', 'desc')->first();
                    if (empty($id_trans)) {
                        $id_trans1 = 1;
                        $id_trans2 = 1;
                        $id_trans3 = 1;
                    } else {
                        $id_trans1 = (int)$id_trans['id_trans'] + 1;
                        $id_trans2 = (int)$id_trans['id_trans'] + 1;
                        $id_trans3 = (int)$id_trans['id_trans'] + 1;
                    }

                    //Hotel
                    $nama = $_POST['nama'];
                    $email_info = $_POST['email_info'];
                    $email_eval = $_POST['email_eval'];
                    $jumlah_kamar = $_POST['jumlah_kamar'];
                    $tanggal_jam_masuk = $_POST['tanggal_jam_masuk'];
                    $tanggal_jam_keluar = $_POST['tanggal_jam_keluar'];

                    $email_pengguna_info = $this->m_pengguna->whereIn('nama_pengguna', $email_info)->select('email_pengguna')->findAll();

                    // try {
                    //     //Server settings
                    //     // $mail->SMTPDebug = SMTP::DEBUG_SERVER;
                    //     $mail->isSMTP();
                    //     $mail->Host       = 'mail.konimex.com';
                    //     $mail->SMTPAuth   = true;
                    //     $mail->Username   = PDLN_EMAIL;
                    //     $mail->Password   = PDLN_PASS;
                    //     $mail->SMTPSecure = PHPMailer::ENCRYPTION_STARTTLS;
                    //     $mail->Port       = 587;
                    
                    //     //Recipients
                    //     $mail->setFrom('noreply@konimex.com');

                    //     foreach ($email_pengguna_info as $e => $ema) {
                    //         $mail->addAddress($ema['email_pengguna']);//Add a recipient
                    //     }
                    
                    //     //Content
                    //     // $link='https://konimex.com:447/pdln/listpb/pb/'.$id_transaksi;
                    //     $mail->Subject = 'Tes Program TABS (Bimo)';
                    //     $mail->Body    = nl2br("Tes kirim email harap diabaikan saja terima kasih.");
                    //     // $mail->Body    = nl2br("User bagian (").$niknmuser['niknm']."/".$nikuser['nik']."/".$nikuser['strorgnm'].(") telah selesai mengisi data PB, silahkan periksa data PB dengan cara klik link: $link");
                    
                    //     $mail->send();
                    //     // echo 'Message has been sent';
                    // } catch (Exception $e) {
                    //     echo "Message could not be sent. Mailer Error: {$mail->ErrorInfo}";
                    // }

                    //Mobil
                    $nama = $_POST['nama'];
                    $email_info = $_POST['email_info'];
                    $email_eval = $_POST['email_eval'];
                    $jumlah_mobil = $_POST['jumlah_mobil'];
                    $tanggal_mobil = $_POST['tanggal_mobil'];
                    $jam_siap = $_POST['jam_siap'];
                    // strtotime($jam_siap);

                    $email_pengguna_info = $this->m_pengguna->whereIn('nama_pengguna', $email_info)->select('email_pengguna')->findAll();

                    // try {
                    //     //Server settings
                    //     // $mail->SMTPDebug = SMTP::DEBUG_SERVER;
                    //     $mail->isSMTP();
                    //     $mail->Host       = 'mail.konimex.com';
                    //     $mail->SMTPAuth   = true;
                    //     $mail->Username   = PDLN_EMAIL;
                    //     $mail->Password   = PDLN_PASS;
                    //     $mail->SMTPSecure = PHPMailer::ENCRYPTION_STARTTLS;
                    //     $mail->Port       = 587;
                    
                    //     //Recipients
                    //     $mail->setFrom('noreply@konimex.com');

                    //     foreach ($email_pengguna_info as $e => $ema) {
                    //         $mail->addAddress($ema['email_pengguna']);//Add a recipient
                    //     }
                    
                    //     //Content
                    //     // $link='https://konimex.com:447/pdln/listpb/pb/'.$id_transaksi;
                    //     $mail->Subject = 'Tes Program TABS (Bimo)';
                    //     $mail->Body    = nl2br("Tes kirim email harap diabaikan saja terima kasih.");
                    //     // $mail->Body    = nl2br("User bagian (").$niknmuser['niknm']."/".$nikuser['nik']."/".$nikuser['strorgnm'].(") telah selesai mengisi data PB, silahkan periksa data PB dengan cara klik link: $link");
                    
                    //     $mail->send();
                    //     // echo 'Message has been sent';
                    // } catch (Exception $e) {
                    //     echo "Message could not be sent. Mailer Error: {$mail->ErrorInfo}";
                    // }

                    if(!empty($nama)) {
                        for($a = 0; $a < count($nama); $a++) {
                            //Trans
                            $pic = $_POST['pic'][$a];
                            $pic = ucwords($pic);
                            
                            //Hotel
                            $nama_pool = $_POST['gs_hotel'];
                            $nama_kota = $_POST['kota'];
                            $nama_akomodasi = $_POST['hotel'];

                            $nama_hotel = substr($nama_akomodasi[$a], 0, strpos($nama_akomodasi[$a], " - "));
                            $jenis_kamar = substr($nama_akomodasi[$a], strpos($nama_akomodasi[$a], ' - ') + 3);

                            $pool_hotel = $this->m_pool->where('nama_pool', $nama_pool[$a])->select('id_pool')->findAll();
                            $kota_hotel = $this->m_kota->where('nama_kota', $nama_kota[$a])->select('id_kota')->findAll();
                            $id_hotel = $this->m_hotel->where('nama_hotel', $nama_hotel)->select('id_hotel')->findAll();
                            if (empty($id_hotel)) {
                                session()->setFlashdata('warning', ['Tidak ada data Hotel']);
                                return redirect()->to("trans_add");
                            }
                            $id_detail_hotel = $this->m_detail_hotel->where('id_hotel', $id_hotel[0]['id_hotel'])->where('jenis_kamar', $jenis_kamar)->select('id_detail_hotel')->findAll();

                            if ($nama_hotel == "Mess Kx Jkt") {
                                $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                $status_mess = 1;
                                
                                foreach ($mess as $m => $mes) {
                                    if ($mes['terpakai'] == 18) {
                                        session()->setFlashdata('warning', ['Mess Kx Jkt sudah penuh']);
                                        return redirect()->to("trans_add");
                                    } else {
                                        $terpakai = [
                                            'id_mess' => 8,
                                            'terpakai' => $mes['terpakai'] + $jumlah_kamar[$a],
                                            'edited_at' => $timestamp,
                                        ];
                                        $this->m_mess->save($terpakai);
                                    }
                                }
                            } else {
                                $status_mess = 0;
                            }

                            if ($_POST['tamu'][$a] == 'Tamu') {
                                $atas_nama = 'Tamu';
                                $jabatan = 'Tamu';
                            } else {
                                $atas_nama = $_POST['nama'][$a];
                                $atas_nama = ucwords($atas_nama);
    
                                $jabatan = $_POST['jabatan'][$a];
                                $jabatan = ucwords($jabatan);
                            }

                            $pembayaran = $_POST['pembayaran'][$a];
                            if($pembayaran == 'Company Acc'){
                                $pembayaran = 'k';
                            } else if($pembayaran == 'Personal Acc'){
                                $pembayaran = 'p';
                            }

                            $keterangan_akomodasi = $_POST['keterangan_akomodasi'][$a];
                            if(empty($keterangan_akomodasi)){
                                $keterangan_akomodasi = null;
                            }
                            
                            //Mobil
                            $nama_pool = $_POST['gs_mobil'];

                            $pool_mobil = $this->m_pool->where('nama_pool', $nama_pool[$a])->select('id_pool')->findAll();

                            if ($_POST['tamu'][$a] == 'Tamu') {
                                $atas_nama = 'Tamu';
                                $jabatan = 'Tamu';
                            } else {
                                $atas_nama = $_POST['nama'][$a];
                                $atas_nama = ucwords($atas_nama);
    
                                $jabatan = $_POST['jabatan'][$a];
                                $jabatan = ucwords($jabatan);
                            }

                            $tujuan_mobil = $_POST['tujuan_mobil'][$a];
                            $tujuan_mobil = ucwords($tujuan_mobil);

                            $siap_di = $_POST['siap_di'][$a];
                            $siap_di = ucwords($siap_di);

                            $pembayaran = $_POST['pembayaran'][$a];
                            if($pembayaran == 'Company Acc'){
                                $pembayaran = 'k';
                            } else if($pembayaran == 'Personal Acc'){
                                $pembayaran = 'p';
                            }

                            $jenis_kendaraan = $_POST['jenis_kendaraan'][$a];
                            if($jenis_kendaraan == 'Sedan'){
                                $jenis_kendaraan = 's';
                            } else if($jenis_kendaraan == 'Station'){
                                $jenis_kendaraan = 'a';
                            } else if($jenis_kendaraan == 'Pick Up'){
                                $jenis_kendaraan = 'p';
                            } else if($jenis_kendaraan == 'Box'){
                                $jenis_kendaraan = 'b';
                            } else if($jenis_kendaraan == 'Truck'){
                                $jenis_kendaraan = 't';
                            }

                            $tenaga_angkut = $_POST['tenaga_angkut'][$a];
                            if($tenaga_angkut == 'Iya'){
                                $tenaga_angkut = '1';
                            } else {
                                $tenaga_angkut = '0';
                            }
                            
                            $dalkot_lukot = $_POST['dalkot_lukot'][$a];

                            if($dalkot_lukot == 'Dalam Kota'){
                                $dalkot_lukot = 'd';
                                $menginap = 0;
                            } else {
                                $dalkot_lukot = 'l';
                                $menginap = $_POST['menginap'][$a];
                                if($menginap == 'Iya'){
                                    $menginap = '1';
                                } else {
                                    $menginap = '0';
                                }
                            }

                            $keterangan_mobil = $_POST['keterangan_mobil'][$a];
                            if(empty($keterangan_mobil)){
                                $keterangan_mobil = null;
                            }
                            
                            if(!empty($_POST['nama'][$a]) && !empty($_POST['jabatan'][$a]) && !empty($_POST['pic'][$a]) && !empty($_POST['email_eval'][$a]) && !empty($_POST['jumlah_kamar'][$a]) && !empty($_POST['tanggal_jam_masuk'][$a]) && !empty($_POST['tanggal_jam_keluar'][$a]) && !empty($_POST['jumlah_mobil'][$a]) && !empty($_POST['tujuan_mobil'][$a]) && !empty($_POST['siap_di'][$a]) && !empty($_POST['tanggal_mobil'][$a]) && !empty($_POST['jam_siap'][$a])) {
                                $trans[] = array(
                                    'id_trans' => $id_trans1++,
                                    'id_detail_pengguna' => session()->get('id_detail_pengguna'),
                                    'id_bagian' => session()->get('id_bagian'),
                                    'pemesanan' => $this->request->getVar('pemesanan'),
                                    'tamu' => $_POST['tamu'][$a],
                                    'pic' => $pic,
                                    'tgl_input' => date('Ymd'),
                                );
    
                                $akomodasi[] = array(
                                    'id_trans' => $id_trans2++,
                                    'id_hotel' => $id_hotel[0]['id_hotel'],
                                    'id_detail_hotel' => $id_detail_hotel[0]['id_detail_hotel'],
                                    'id_pool' => $pool_hotel[0]['id_pool'],
                                    'id_kota' => $kota_hotel[0]['id_kota'],
                                    'peminta' => session()->get('nama_pengguna'),
                                    'atas_nama' => $atas_nama,
                                    'jabatan' => $jabatan,
                                    'type' => $_POST['type'][$a],
                                    'jumlah_kamar' => $_POST['jumlah_kamar'][$a],
                                    'pembayaran' => $pembayaran,
                                    'harga_akomodasi' => null,
                                    'email_info' => $_POST['email_info'][$a],
                                    'email_eval' => $_POST['email_eval'][$a],
                                    'tanggal_jam_masuk' => $tanggal_jam_masuk[$a],
                                    'tanggal_jam_keluar' => $tanggal_jam_keluar[$a],
                                    'kirim_eval' => 0,
                                    'status_mess' => $status_mess,
                                    'status_akomodasi' => 0,
                                    'keterangan_akomodasi' => $keterangan_akomodasi,
                                    'tgl_input' => date('Ymd'),
                                );

                                $transportasi[] = array(
                                    'id_trans' => $id_trans3++,
                                    'id_pool' => $pool_mobil[0]['id_pool'],
                                    'jemput' => 0,
                                    'peminta' => session()->get('nama_pengguna'),
                                    'atas_nama' => $atas_nama,
                                    'jabatan' => $jabatan,
                                    'jumlah_mobil' => $jumlah_mobil[$a],
                                    'pembayaran' => $pembayaran,
                                    'jenis_kendaraan' => $jenis_kendaraan,
                                    'tenaga_angkut' => $tenaga_angkut,
                                    'dalkot_lukot' => $dalkot_lukot,
                                    'menginap' => $menginap,
                                    'kapasitas' => $_POST['kapasitas'][$a],
                                    'tujuan_mobil' => $tujuan_mobil,
                                    'siap_di' => $siap_di,
                                    'tanggal_mobil' => $tanggal_mobil[$a],
                                    'jam_siap' => $jam_siap[$a],
                                    'email_info' => $_POST['email_info'][$a],
                                    'email_eval' => $_POST['email_eval'][$a],
                                    'kirim_eval' => 0,
                                    'status_mobil' => 0,
                                    'keterangan_mobil' => $keterangan_mobil,
                                    'tgl_input' => date('Ymd'),
                                );
                            } else {
                                if(empty($_POST['nama'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Nama harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['jabatan'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Jabatan harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['pic'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['PIC harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['email_eval'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Email Evaluasi harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['jumlah_kamar'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Jumlah Kamar harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['tanggal_jam_masuk'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Tanggal dan Jam Masuk harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['tanggal_jam_keluar'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Tanggal dan Jam Keluar harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if (empty($_POST['jumlah_mobil'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Jumlah Mobil harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['tujuan_mobil'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Tujuan harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['siap_di'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Siap Di harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['tanggal_mobil'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Tanggal harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['jam_siap'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Jam Siap harus diisi']);
                                    return redirect()->to('trans_add');
                                }
                            }
                        }
                    }

                    $this->m_trans->insertBatch($trans);
                    $this->m_akomodasi->insertBatch($akomodasi);
                    $this->m_transportasi->insertBatch($transportasi);
                    session()->setFlashdata('success', ('Data berhasil ditambahkan'));
                    return redirect()->to("trans");

                    // $this->m_id->updateBatch($record);
                } else if ($antar == 'tidak') {
                    //Trans
                    $pic = $_POST['pic'];

                    $id_trans = $this->m_trans->select('id_trans')->orderBy('id_trans', 'desc')->first();
                    $id_transportasi = $this->m_transportasi->select('id_transportasi')->orderBy('id_transportasi', 'desc')->first();
                    if (empty($id_trans)) {
                        $id_trans1 = 1;
                        $id_trans2 = 1;
                        $id_trans3 = 1;
                        $id_trans4 = 1;
                    } else {
                        $id_trans1 = (int)$id_trans['id_trans'] + 1;
                        $id_trans2 = (int)$id_trans['id_trans'] + 1;
                        $id_trans3 = (int)$id_trans['id_trans'] + 1;
                        $id_trans4 = (int)$id_trans['id_trans'] + 1;
                    }

                    if (empty($id_transportasi)) {
                        $id_transportasi1 = 1;
                    } else {
                        $id_transportasi1 = (int)$id_transportasi['id_transportasi'] + 1;
                    }

                    //Hotel
                    $nama = $_POST['nama'];
                    $email_info = $_POST['email_info'];
                    $email_eval = $_POST['email_eval'];
                    $jumlah_kamar = $_POST['jumlah_kamar'];
                    $tanggal_jam_masuk = $_POST['tanggal_jam_masuk'];
                    $tanggal_jam_keluar = $_POST['tanggal_jam_keluar'];

                    $email_pengguna_info = $this->m_pengguna->whereIn('nama_pengguna', $email_info)->select('email_pengguna')->findAll();

                    // try {
                    //     //Server settings
                    //     // $mail->SMTPDebug = SMTP::DEBUG_SERVER;
                    //     $mail->isSMTP();
                    //     $mail->Host       = 'mail.konimex.com';
                    //     $mail->SMTPAuth   = true;
                    //     $mail->Username   = PDLN_EMAIL;
                    //     $mail->Password   = PDLN_PASS;
                    //     $mail->SMTPSecure = PHPMailer::ENCRYPTION_STARTTLS;
                    //     $mail->Port       = 587;
                    
                    //     //Recipients
                    //     $mail->setFrom('noreply@konimex.com');

                    //     foreach ($email_pengguna_info as $e => $ema) {
                    //         $mail->addAddress($ema['email_pengguna']);//Add a recipient
                    //     }
                    
                    //     //Content
                    //     // $link='https://konimex.com:447/pdln/listpb/pb/'.$id_transaksi;
                    //     $mail->Subject = 'Tes Program TABS (Bimo)';
                    //     $mail->Body    = nl2br("Tes kirim email harap diabaikan saja terima kasih.");
                    //     // $mail->Body    = nl2br("User bagian (").$niknmuser['niknm']."/".$nikuser['nik']."/".$nikuser['strorgnm'].(") telah selesai mengisi data PB, silahkan periksa data PB dengan cara klik link: $link");
                    
                    //     $mail->send();
                    //     // echo 'Message has been sent';
                    // } catch (Exception $e) {
                    //     echo "Message could not be sent. Mailer Error: {$mail->ErrorInfo}";
                    // }

                    //Mobil Pulang
                    $nama = $_POST['nama'];
                    $email_info = $_POST['email_info'];
                    $email_eval = $_POST['email_eval'];
                    $jumlah_mobil_pulang = $_POST['jumlah_mobil_pulang'];
                    $tanggal_mobil_pulang = $_POST['tanggal_mobil_pulang'];
                    $jam_siap_pulang = $_POST['jam_siap_pulang'];
                    // strtotime($jam_siap);

                    $email_pengguna_info = $this->m_pengguna->whereIn('nama_pengguna', $email_info)->select('email_pengguna')->findAll();

                    // try {
                    //     //Server settings
                    //     // $mail->SMTPDebug = SMTP::DEBUG_SERVER;
                    //     $mail->isSMTP();
                    //     $mail->Host       = 'mail.konimex.com';
                    //     $mail->SMTPAuth   = true;
                    //     $mail->Username   = PDLN_EMAIL;
                    //     $mail->Password   = PDLN_PASS;
                    //     $mail->SMTPSecure = PHPMailer::ENCRYPTION_STARTTLS;
                    //     $mail->Port       = 587;
                    
                    //     //Recipients
                    //     $mail->setFrom('noreply@konimex.com');

                    //     foreach ($email_pengguna_info as $e => $ema) {
                    //         $mail->addAddress($ema['email_pengguna']);//Add a recipient
                    //     }
                    
                    //     //Content
                    //     // $link='https://konimex.com:447/pdln/listpb/pb/'.$id_transaksi;
                    //     $mail->Subject = 'Tes Program TABS (Bimo)';
                    //     $mail->Body    = nl2br("Tes kirim email harap diabaikan saja terima kasih.");
                    //     // $mail->Body    = nl2br("User bagian (").$niknmuser['niknm']."/".$nikuser['nik']."/".$nikuser['strorgnm'].(") telah selesai mengisi data PB, silahkan periksa data PB dengan cara klik link: $link");
                    
                    //     $mail->send();
                    //     // echo 'Message has been sent';
                    // } catch (Exception $e) {
                    //     echo "Message could not be sent. Mailer Error: {$mail->ErrorInfo}";
                    // }

                    if(!empty($nama)) {
                        for($a = 0; $a < count($nama); $a++) {
                            //Trans
                            $pic = $_POST['pic'][$a];
                            $pic = ucwords($pic);
                            
                            //Hotel
                            $nama_pool = $_POST['gs_hotel'];
                            $nama_kota = $_POST['kota'];
                            $nama_akomodasi = $_POST['hotel'];

                            $nama_hotel = substr($nama_akomodasi[$a], 0, strpos($nama_akomodasi[$a], " - "));
                            $jenis_kamar = substr($nama_akomodasi[$a], strpos($nama_akomodasi[$a], ' - ') + 3);

                            $pool_hotel = $this->m_pool->where('nama_pool', $nama_pool[$a])->select('id_pool')->findAll();
                            $kota_hotel = $this->m_kota->where('nama_kota', $nama_kota[$a])->select('id_kota')->findAll();
                            $id_hotel = $this->m_hotel->where('nama_hotel', $nama_hotel)->select('id_hotel')->findAll();
                            $id_detail_hotel = $this->m_detail_hotel->where('id_hotel', $id_hotel[0]['id_hotel'])->where('jenis_kamar', $jenis_kamar)->select('id_detail_hotel')->findAll();

                            if ($nama_hotel == "Mess Kx Jkt") {
                                $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                $status_mess = 1;
                                
                                foreach ($mess as $m => $mes) {
                                    if ($mes['terpakai'] == 18) {
                                        session()->setFlashdata('warning', ['Mess Kx Jkt sudah penuh']);
                                        return redirect()->to("trans_add");
                                    } else {
                                        $terpakai = [
                                            'id_mess' => 8,
                                            'terpakai' => $mes['terpakai'] + $jumlah_kamar[$a],
                                            'edited_at' => $timestamp,
                                        ];
                                        $this->m_mess->save($terpakai);
                                    }
                                }
                            } else {
                                $status_mess = 0;
                            }

                            $atas_nama = $_POST['nama'][$a];
                            $atas_nama = ucwords($atas_nama);

                            $jabatan = $_POST['jabatan'][$a];
                            $jabatan = ucwords($jabatan);

                            $pembayaran = $_POST['pembayaran'][$a];
                            if($pembayaran == 'Company Acc'){
                                $pembayaran = 'k';
                            } else if($pembayaran == 'Personal Acc'){
                                $pembayaran = 'p';
                            }

                            $keterangan_akomodasi = $_POST['keterangan_akomodasi'][$a];
                            if(empty($keterangan_akomodasi)){
                                $keterangan_akomodasi = null;
                            }
                            
                            //Mobil Pulang
                            $nama_pool = $_POST['gs_mobil_pulang'];

                            $pool_mobil_pulang = $this->m_pool->where('nama_pool', $nama_pool[$a])->select('id_pool')->findAll();

                            $atas_nama = $_POST['nama'][$a];
                            $atas_nama = ucwords($atas_nama);

                            $jabatan = $_POST['jabatan'][$a];
                            $jabatan = ucwords($jabatan);

                            $tujuan_mobil_pulang = $_POST['tujuan_mobil_pulang'][$a];
                            $tujuan_mobil_pulang = ucwords($tujuan_mobil_pulang);

                            $siap_di_pulang = $_POST['siap_di_pulang'][$a];
                            $siap_di_pulang = ucwords($siap_di_pulang);

                            $pembayaran = $_POST['pembayaran'][$a];
                            if($pembayaran == 'Company Acc'){
                                $pembayaran = 'k';
                            } else if($pembayaran == 'Personal Acc'){
                                $pembayaran = 'p';
                            }

                            $jenis_kendaraan_pulang = $_POST['jenis_kendaraan_pulang'][$a];
                            if($jenis_kendaraan_pulang == 'Sedan'){
                                $jenis_kendaraan_pulang = 's';
                            } else if($jenis_kendaraan_pulang == 'Station'){
                                $jenis_kendaraan_pulang = 'a';
                            } else if($jenis_kendaraan_pulang == 'Pick Up'){
                                $jenis_kendaraan_pulang = 'p';
                            } else if($jenis_kendaraan_pulang == 'Box'){
                                $jenis_kendaraan_pulang = 'b';
                            } else if($jenis_kendaraan_pulang == 'Truck'){
                                $jenis_kendaraan_pulang = 't';
                            }

                            $tenaga_angkut_pulang = $_POST['tenaga_angkut_pulang'][$a];
                            if($tenaga_angkut_pulang == 'Iya'){
                                $tenaga_angkut_pulang = '1';
                            } else {
                                $tenaga_angkut_pulang = '0';
                            }
                            
                            $dalkot_lukot_pulang = $_POST['dalkot_lukot_pulang'][$a];

                            if($dalkot_lukot_pulang == 'Dalam Kota'){
                                $dalkot_lukot_pulang = 'd';
                                $menginap_pulang = 0;
                            } else {
                                $dalkot_lukot_pulang = 'l';
                                $menginap_pulang = $_POST['menginap_pulang'][$a];
                                if($menginap_pulang == 'Iya'){
                                    $menginap_pulang = '1';
                                } else {
                                    $menginap_pulang = '0';
                                }
                            }

                            $keterangan_mobil_pulang = $_POST['keterangan_mobil_pulang'][$a];
                            if(empty($keterangan_mobil_pulang)){
                                $keterangan_mobil_pulang = null;
                            }
                            
                            if(!empty($_POST['nama'][$a]) && !empty($_POST['jabatan'][$a]) && !empty($_POST['pic'][$a]) && !empty($_POST['email_eval'][$a]) && !empty($_POST['jumlah_kamar'][$a]) && !empty($_POST['tanggal_jam_masuk'][$a]) && !empty($_POST['tanggal_jam_keluar'][$a]) && !empty($_POST['jumlah_mobil_pulang'][$a]) && !empty($_POST['tujuan_mobil_pulang'][$a]) && !empty($_POST['siap_di_pulang'][$a]) && !empty($_POST['tanggal_mobil_pulang'][$a]) && !empty($_POST['jam_siap_pulang'][$a])) {
                                $trans[] = array(
                                    'id_trans' => $id_trans1++,
                                    'id_detail_pengguna' => session()->get('id_detail_pengguna'),
                                    'id_bagian' => session()->get('id_bagian'),
                                    'pemesanan' => $this->request->getVar('pemesanan'),
                                    'tamu' => $_POST['tamu'][$a],
                                    'pic' => $pic,
                                    'tgl_input' => date('Ymd'),
                                );
    
                                $akomodasi[] = array(
                                    'id_trans' => $id_trans2++,
                                    'id_hotel' => $id_hotel[0]['id_hotel'],
                                    'id_detail_hotel' => $id_detail_hotel[0]['id_detail_hotel'],
                                    'id_pool' => $pool_hotel[0]['id_pool'],
                                    'id_kota' => $kota_hotel[0]['id_kota'],
                                    'peminta' => session()->get('nama_pengguna'),
                                    'atas_nama' => $atas_nama,
                                    'jabatan' => $jabatan,
                                    'type' => $_POST['type'][$a],
                                    'jumlah_kamar' => $_POST['jumlah_kamar'][$a],
                                    'pembayaran' => $pembayaran,
                                    'harga_akomodasi' => null,
                                    'email_info' => $_POST['email_info'][$a],
                                    'email_eval' => $_POST['email_eval'][$a],
                                    'tanggal_jam_masuk' => $tanggal_jam_masuk[$a],
                                    'tanggal_jam_keluar' => $tanggal_jam_keluar[$a],
                                    'kirim_eval' => 0,
                                    'status_mess' => $status_mess,
                                    'status_akomodasi' => 0,
                                    'keterangan_akomodasi' => $keterangan_akomodasi,
                                    'tgl_input' => date('Ymd'),
                                );

                                $transportasi[] = array(
                                    'id_trans' => $id_trans3++,
                                    'id_pool' => $pool_mobil_pulang[0]['id_pool'],
                                    'jemput' => 1,
                                    'peminta' => null,
                                    'atas_nama' => null,
                                    'jabatan' => null,
                                    'jumlah_mobil' => null,
                                    'pembayaran' => null,
                                    'jenis_kendaraan' => null,
                                    'tenaga_angkut' => null,
                                    'dalkot_lukot' => null,
                                    'menginap' => null,
                                    'kapasitas' => null,
                                    'tujuan_mobil' => null,
                                    'siap_di' => null,
                                    'tanggal_mobil' => $tanggal_mobil_pulang[$a],
                                    'jam_siap' => $jam_siap_pulang[$a],
                                    'email_info' => null,
                                    'email_eval' => null,
                                    'kirim_eval' => null,
                                    'status_mobil' => 0,
                                    'keterangan_mobil' => null,
                                    'tgl_input' => date('Ymd'),
                                );

                                $transportasi_jemput[] = array(
                                    'id_transportasi' => $id_transportasi1++,
                                    'id_trans' => $id_trans4++,
                                    'id_pool' => $pool_mobil_pulang[0]['id_pool'],
                                    'jemput' => 1,
                                    'peminta' => session()->get('nama_pengguna'),
                                    'atas_nama' => $atas_nama,
                                    'jabatan' => $jabatan,
                                    'jumlah_mobil' => $jumlah_mobil_pulang[$a],
                                    'pembayaran' => $pembayaran,
                                    'jenis_kendaraan' => $jenis_kendaraan_pulang,
                                    'tenaga_angkut' => $tenaga_angkut_pulang,
                                    'dalkot_lukot' => $dalkot_lukot_pulang,
                                    'menginap' => $menginap_pulang,
                                    'kapasitas' => $_POST['kapasitas_pulang'][$a],
                                    'tujuan_mobil' => $tujuan_mobil_pulang,
                                    'siap_di' => $siap_di_pulang,
                                    'tanggal_mobil' => $tanggal_mobil_pulang[$a],
                                    'jam_siap' => $jam_siap_pulang[$a],
                                    'email_info' => $_POST['email_info'][$a],
                                    'email_eval' => $_POST['email_eval'][$a],
                                    'kirim_eval' => 0,
                                    'status_mobil' => 0,
                                    'keterangan_mobil' => $keterangan_mobil_pulang,
                                    'tgl_input' => date('Ymd'),
                                );
                            } else {
                                if(empty($_POST['nama'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Nama harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['jabatan'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Jabatan harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['pic'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['PIC harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['email_eval'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Email Evaluasi harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['jumlah_kamar'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Jumlah Kamar harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['tanggal_jam_masuk'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Tanggal dan Jam Masuk harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['tanggal_jam_keluar'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Tanggal dan Jam Keluar harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if (empty($_POST['jumlah_mobil_pulang'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Jumlah Mobil harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['tujuan_mobil_pulang'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Tujuan harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['siap_di_pulang'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Siap Di harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['tanggal_mobil_pulang'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Tanggal harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['jam_siap_pulang'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Jam Siap harus diisi']);
                                    return redirect()->to('trans_add');
                                }
                            }
                        }
                    }

                    $this->m_trans->insertBatch($trans);
                    $this->m_akomodasi->insertBatch($akomodasi);
                    $this->m_transportasi->insertBatch($transportasi);
                    $this->m_transportasi_jemput->insertBatch($transportasi_jemput);
                    session()->setFlashdata('success', ('Data berhasil ditambahkan'));
                    return redirect()->to("trans");

                    // $this->m_id->updateBatch($record);
                } else {
                    //Trans
                    $pic = $_POST['pic'];

                    $id_trans = $this->m_trans->select('id_trans')->orderBy('id_trans', 'desc')->first();
                    $id_transportasi = $this->m_transportasi->select('id_transportasi')->orderBy('id_transportasi', 'desc')->first();
                    if (empty($id_trans)) {
                        $id_trans1 = 1;
                        $id_trans2 = 1;
                        $id_trans3 = 1;
                        $id_trans4 = 1;
                    } else {
                        $id_trans1 = (int)$id_trans['id_trans'] + 1;
                        $id_trans2 = (int)$id_trans['id_trans'] + 1;
                        $id_trans3 = (int)$id_trans['id_trans'] + 1;
                        $id_trans4 = (int)$id_trans['id_trans'] + 1;
                    }

                    if (empty($id_transportasi)) {
                        $id_transportasi1 = 1;
                    } else {
                        $id_transportasi1 = (int)$id_transportasi['id_transportasi'] + 1;
                    }

                    //Hotel
                    $nama = $_POST['nama'];
                    $email_info = $_POST['email_info'];
                    $email_eval = $_POST['email_eval'];
                    $jumlah_kamar = $_POST['jumlah_kamar'];
                    $tanggal_jam_masuk = $_POST['tanggal_jam_masuk'];
                    $tanggal_jam_keluar = $_POST['tanggal_jam_keluar'];

                    $email_pengguna_info = $this->m_pengguna->whereIn('nama_pengguna', $email_info)->select('email_pengguna')->findAll();

                    // try {
                    //     //Server settings
                    //     // $mail->SMTPDebug = SMTP::DEBUG_SERVER;
                    //     $mail->isSMTP();
                    //     $mail->Host       = 'mail.konimex.com';
                    //     $mail->SMTPAuth   = true;
                    //     $mail->Username   = PDLN_EMAIL;
                    //     $mail->Password   = PDLN_PASS;
                    //     $mail->SMTPSecure = PHPMailer::ENCRYPTION_STARTTLS;
                    //     $mail->Port       = 587;
                    
                    //     //Recipients
                    //     $mail->setFrom('noreply@konimex.com');

                    //     foreach ($email_pengguna_info as $e => $ema) {
                    //         $mail->addAddress($ema['email_pengguna']);//Add a recipient
                    //     }
                    
                    //     //Content
                    //     // $link='https://konimex.com:447/pdln/listpb/pb/'.$id_transaksi;
                    //     $mail->Subject = 'Tes Program TABS (Bimo)';
                    //     $mail->Body    = nl2br("Tes kirim email harap diabaikan saja terima kasih.");
                    //     // $mail->Body    = nl2br("User bagian (").$niknmuser['niknm']."/".$nikuser['nik']."/".$nikuser['strorgnm'].(") telah selesai mengisi data PB, silahkan periksa data PB dengan cara klik link: $link");
                    
                    //     $mail->send();
                    //     // echo 'Message has been sent';
                    // } catch (Exception $e) {
                    //     echo "Message could not be sent. Mailer Error: {$mail->ErrorInfo}";
                    // }

                    //Mobil
                    $nama = $_POST['nama'];
                    $email_info = $_POST['email_info'];
                    $email_eval = $_POST['email_eval'];
                    $jumlah_mobil = $_POST['jumlah_mobil'];
                    $tanggal_mobil = $_POST['tanggal_mobil'];
                    $jam_siap = $_POST['jam_siap'];
                    // strtotime($jam_siap);

                    $email_pengguna_info = $this->m_pengguna->whereIn('nama_pengguna', $email_info)->select('email_pengguna')->findAll();

                    // try {
                    //     //Server settings
                    //     // $mail->SMTPDebug = SMTP::DEBUG_SERVER;
                    //     $mail->isSMTP();
                    //     $mail->Host       = 'mail.konimex.com';
                    //     $mail->SMTPAuth   = true;
                    //     $mail->Username   = PDLN_EMAIL;
                    //     $mail->Password   = PDLN_PASS;
                    //     $mail->SMTPSecure = PHPMailer::ENCRYPTION_STARTTLS;
                    //     $mail->Port       = 587;
                    
                    //     //Recipients
                    //     $mail->setFrom('noreply@konimex.com');

                    //     foreach ($email_pengguna_info as $e => $ema) {
                    //         $mail->addAddress($ema['email_pengguna']);//Add a recipient
                    //     }
                    
                    //     //Content
                    //     // $link='https://konimex.com:447/pdln/listpb/pb/'.$id_transaksi;
                    //     $mail->Subject = 'Tes Program TABS (Bimo)';
                    //     $mail->Body    = nl2br("Tes kirim email harap diabaikan saja terima kasih.");
                    //     // $mail->Body    = nl2br("User bagian (").$niknmuser['niknm']."/".$nikuser['nik']."/".$nikuser['strorgnm'].(") telah selesai mengisi data PB, silahkan periksa data PB dengan cara klik link: $link");
                    
                    //     $mail->send();
                    //     // echo 'Message has been sent';
                    // } catch (Exception $e) {
                    //     echo "Message could not be sent. Mailer Error: {$mail->ErrorInfo}";
                    // }

                    //Mobil Pulang
                    $nama = $_POST['nama'];
                    $email_info = $_POST['email_info'];
                    $email_eval = $_POST['email_eval'];
                    $jumlah_mobil_pulang = $_POST['jumlah_mobil_pulang'];
                    $tanggal_mobil_pulang = $_POST['tanggal_mobil_pulang'];
                    $jam_siap_pulang = $_POST['jam_siap_pulang'];
                    // strtotime($jam_siap);

                    $email_pengguna_info = $this->m_pengguna->whereIn('nama_pengguna', $email_info)->select('email_pengguna')->findAll();

                    // try {
                    //     //Server settings
                    //     // $mail->SMTPDebug = SMTP::DEBUG_SERVER;
                    //     $mail->isSMTP();
                    //     $mail->Host       = 'mail.konimex.com';
                    //     $mail->SMTPAuth   = true;
                    //     $mail->Username   = PDLN_EMAIL;
                    //     $mail->Password   = PDLN_PASS;
                    //     $mail->SMTPSecure = PHPMailer::ENCRYPTION_STARTTLS;
                    //     $mail->Port       = 587;
                    
                    //     //Recipients
                    //     $mail->setFrom('noreply@konimex.com');

                    //     foreach ($email_pengguna_info as $e => $ema) {
                    //         $mail->addAddress($ema['email_pengguna']);//Add a recipient
                    //     }
                    
                    //     //Content
                    //     // $link='https://konimex.com:447/pdln/listpb/pb/'.$id_transaksi;
                    //     $mail->Subject = 'Tes Program TABS (Bimo)';
                    //     $mail->Body    = nl2br("Tes kirim email harap diabaikan saja terima kasih.");
                    //     // $mail->Body    = nl2br("User bagian (").$niknmuser['niknm']."/".$nikuser['nik']."/".$nikuser['strorgnm'].(") telah selesai mengisi data PB, silahkan periksa data PB dengan cara klik link: $link");
                    
                    //     $mail->send();
                    //     // echo 'Message has been sent';
                    // } catch (Exception $e) {
                    //     echo "Message could not be sent. Mailer Error: {$mail->ErrorInfo}";
                    // }

                    if(!empty($nama)) {
                        for($a = 0; $a < count($nama); $a++) {
                            //Trans
                            $pic = $_POST['pic'][$a];
                            $pic = ucwords($pic);
                            
                            //Hotel
                            $nama_pool = $_POST['gs_hotel'];
                            $nama_kota = $_POST['kota'];
                            $nama_akomodasi = $_POST['hotel'];

                            $nama_hotel = substr($nama_akomodasi[$a], 0, strpos($nama_akomodasi[$a], " - "));
                            $jenis_kamar = substr($nama_akomodasi[$a], strpos($nama_akomodasi[$a], ' - ') + 3);

                            $pool_hotel = $this->m_pool->where('nama_pool', $nama_pool[$a])->select('id_pool')->findAll();
                            $kota_hotel = $this->m_kota->where('nama_kota', $nama_kota[$a])->select('id_kota')->findAll();
                            $id_hotel = $this->m_hotel->where('nama_hotel', $nama_hotel)->select('id_hotel')->findAll();
                            $id_detail_hotel = $this->m_detail_hotel->where('id_hotel', $id_hotel[0]['id_hotel'])->where('jenis_kamar', $jenis_kamar)->select('id_detail_hotel')->findAll();

                            if ($nama_hotel == "Mess Kx Jkt") {
                                $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                $status_mess = 1;
                                
                                foreach ($mess as $m => $mes) {
                                    if ($mes['terpakai'] == 18) {
                                        session()->setFlashdata('warning', ['Mess Kx Jkt sudah penuh']);
                                        return redirect()->to("trans_add");
                                    } else {
                                        $terpakai = [
                                            'id_mess' => 8,
                                            'terpakai' => $mes['terpakai'] + $jumlah_kamar[$a],
                                            'edited_at' => $timestamp,
                                        ];
                                        $this->m_mess->save($terpakai);
                                    }
                                }
                            } else {
                                $status_mess = 0;
                            }

                            $atas_nama = $_POST['nama'][$a];
                            $atas_nama = ucwords($atas_nama);

                            $jabatan = $_POST['jabatan'][$a];
                            $jabatan = ucwords($jabatan);

                            $pembayaran = $_POST['pembayaran'][$a];
                            if($pembayaran == 'Company Acc'){
                                $pembayaran = 'k';
                            } else if($pembayaran == 'Personal Acc'){
                                $pembayaran = 'p';
                            }

                            $keterangan_akomodasi = $_POST['keterangan_akomodasi'][$a];
                            if(empty($keterangan_akomodasi)){
                                $keterangan_akomodasi = null;
                            }
                            
                            //Mobil
                            $nama_pool = $_POST['gs_mobil'];

                            $pool_mobil = $this->m_pool->where('nama_pool', $nama_pool[$a])->select('id_pool')->findAll();

                            $atas_nama = $_POST['nama'][$a];
                            $atas_nama = ucwords($atas_nama);

                            $jabatan = $_POST['jabatan'][$a];
                            $jabatan = ucwords($jabatan);

                            $tujuan_mobil = $_POST['tujuan_mobil'][$a];
                            $tujuan_mobil = ucwords($tujuan_mobil);

                            $siap_di = $_POST['siap_di'][$a];
                            $siap_di = ucwords($siap_di);

                            $pembayaran = $_POST['pembayaran'][$a];
                            if($pembayaran == 'Company Acc'){
                                $pembayaran = 'k';
                            } else if($pembayaran == 'Personal Acc'){
                                $pembayaran = 'p';
                            }

                            $jenis_kendaraan = $_POST['jenis_kendaraan'][$a];
                            if($jenis_kendaraan == 'Sedan'){
                                $jenis_kendaraan = 's';
                            } else if($jenis_kendaraan == 'Station'){
                                $jenis_kendaraan = 'a';
                            } else if($jenis_kendaraan == 'Pick Up'){
                                $jenis_kendaraan = 'p';
                            } else if($jenis_kendaraan == 'Box'){
                                $jenis_kendaraan = 'b';
                            } else if($jenis_kendaraan == 'Truck'){
                                $jenis_kendaraan = 't';
                            }

                            $tenaga_angkut = $_POST['tenaga_angkut'][$a];
                            if($tenaga_angkut == 'Iya'){
                                $tenaga_angkut = '1';
                            } else {
                                $tenaga_angkut = '0';
                            }
                            
                            $dalkot_lukot = $_POST['dalkot_lukot'][$a];

                            if($dalkot_lukot == 'Dalam Kota'){
                                $dalkot_lukot = 'd';
                                $menginap = 0;
                            } else {
                                $dalkot_lukot = 'l';
                                $menginap = $_POST['menginap'][$a];
                                if($menginap == 'Iya'){
                                    $menginap = '1';
                                } else {
                                    $menginap = '0';
                                }
                            }

                            $keterangan_mobil = $_POST['keterangan_mobil'][$a];
                            if(empty($keterangan_mobil)){
                                $keterangan_mobil = null;
                            }

                            //Mobil Pulang
                            $nama_pool = $_POST['gs_mobil_pulang'];

                            $pool_mobil_pulang = $this->m_pool->where('nama_pool', $nama_pool[$a])->select('id_pool')->findAll();

                            $atas_nama = $_POST['nama'][$a];
                            $atas_nama = ucwords($atas_nama);

                            $jabatan = $_POST['jabatan'][$a];
                            $jabatan = ucwords($jabatan);

                            $tujuan_mobil_pulang = $_POST['tujuan_mobil_pulang'][$a];
                            $tujuan_mobil_pulang = ucwords($tujuan_mobil_pulang);

                            $siap_di_pulang = $_POST['siap_di_pulang'][$a];
                            $siap_di_pulang = ucwords($siap_di_pulang);

                            $pembayaran = $_POST['pembayaran'][$a];
                            if($pembayaran == 'Company Acc'){
                                $pembayaran = 'k';
                            } else if($pembayaran == 'Personal Acc'){
                                $pembayaran = 'p';
                            }

                            $jenis_kendaraan_pulang = $_POST['jenis_kendaraan_pulang'][$a];
                            if($jenis_kendaraan_pulang == 'Sedan'){
                                $jenis_kendaraan_pulang = 's';
                            } else if($jenis_kendaraan_pulang == 'Station'){
                                $jenis_kendaraan_pulang = 'a';
                            } else if($jenis_kendaraan_pulang == 'Pick Up'){
                                $jenis_kendaraan_pulang = 'p';
                            } else if($jenis_kendaraan_pulang == 'Box'){
                                $jenis_kendaraan_pulang = 'b';
                            } else if($jenis_kendaraan_pulang == 'Truck'){
                                $jenis_kendaraan_pulang = 't';
                            }

                            $tenaga_angkut_pulang = $_POST['tenaga_angkut_pulang'][$a];
                            if($tenaga_angkut_pulang == 'Iya'){
                                $tenaga_angkut_pulang = '1';
                            } else {
                                $tenaga_angkut_pulang = '0';
                            }
                            
                            $dalkot_lukot_pulang = $_POST['dalkot_lukot_pulang'][$a];

                            if($dalkot_lukot_pulang == 'Dalam Kota'){
                                $dalkot_lukot_pulang = 'd';
                                $menginap_pulang = 0;
                            } else {
                                $dalkot_lukot_pulang = 'l';
                                $menginap_pulang = $_POST['menginap_pulang'][$a];
                                if($menginap_pulang == 'Iya'){
                                    $menginap_pulang = '1';
                                } else {
                                    $menginap_pulang = '0';
                                }
                            }

                            $keterangan_mobil_pulang = $_POST['keterangan_mobil_pulang'][$a];
                            if(empty($keterangan_mobil_pulang)){
                                $keterangan_mobil_pulang = null;
                            }
                            
                            if(!empty($_POST['nama'][$a]) && !empty($_POST['jabatan'][$a]) && !empty($_POST['pic'][$a]) && !empty($_POST['email_eval'][$a]) && !empty($_POST['jumlah_kamar'][$a]) && !empty($_POST['tanggal_jam_masuk'][$a]) && !empty($_POST['tanggal_jam_keluar'][$a]) && !empty($_POST['jumlah_mobil'][$a]) && !empty($_POST['tujuan_mobil'][$a]) && !empty($_POST['siap_di'][$a]) && !empty($_POST['tanggal_mobil'][$a]) && !empty($_POST['jam_siap'][$a]) && !empty($_POST['jumlah_mobil_pulang'][$a]) && !empty($_POST['tujuan_mobil_pulang'][$a]) && !empty($_POST['siap_di_pulang'][$a]) && !empty($_POST['tanggal_mobil_pulang'][$a]) && !empty($_POST['jam_siap_pulang'][$a])) {
                                $trans[] = array(
                                    'id_trans' => $id_trans1++,
                                    'id_detail_pengguna' => session()->get('id_detail_pengguna'),
                                    'id_bagian' => session()->get('id_bagian'),
                                    'pemesanan' => $this->request->getVar('pemesanan'),
                                    'tamu' => $_POST['tamu'][$a],
                                    'pic' => $pic,
                                    'tgl_input' => date('Ymd'),
                                );
    
                                $akomodasi[] = array(
                                    'id_trans' => $id_trans2++,
                                    'id_hotel' => $id_hotel[0]['id_hotel'],
                                    'id_detail_hotel' => $id_detail_hotel[0]['id_detail_hotel'],
                                    'id_pool' => $pool_hotel[0]['id_pool'],
                                    'id_kota' => $kota_hotel[0]['id_kota'],
                                    'peminta' => session()->get('nama_pengguna'),
                                    'atas_nama' => $atas_nama,
                                    'jabatan' => $jabatan,
                                    'type' => $_POST['type'][$a],
                                    'jumlah_kamar' => $_POST['jumlah_kamar'][$a],
                                    'pembayaran' => $pembayaran,
                                    'harga_akomodasi' => null,
                                    'email_info' => $_POST['email_info'][$a],
                                    'email_eval' => $_POST['email_eval'][$a],
                                    'tanggal_jam_masuk' => $tanggal_jam_masuk[$a],
                                    'tanggal_jam_keluar' => $tanggal_jam_keluar[$a],
                                    'kirim_eval' => 0,
                                    'status_mess' => $status_mess,
                                    'status_akomodasi' => 0,
                                    'keterangan_akomodasi' => $keterangan_akomodasi,
                                    'tgl_input' => date('Ymd'),
                                );

                                $transportasi[] = array(
                                    'id_trans' => $id_trans3++,
                                    'id_pool' => $pool_mobil[0]['id_pool'],
                                    'jemput' => 2,
                                    'peminta' => session()->get('nama_pengguna'),
                                    'atas_nama' => $atas_nama,
                                    'jabatan' => $jabatan,
                                    'jumlah_mobil' => $jumlah_mobil[$a],
                                    'pembayaran' => $pembayaran,
                                    'jenis_kendaraan' => $jenis_kendaraan,
                                    'tenaga_angkut' => $tenaga_angkut,
                                    'dalkot_lukot' => $dalkot_lukot,
                                    'menginap' => $menginap,
                                    'kapasitas' => $_POST['kapasitas'][$a],
                                    'tujuan_mobil' => $tujuan_mobil,
                                    'siap_di' => $siap_di,
                                    'tanggal_mobil' => $tanggal_mobil[$a],
                                    'jam_siap' => $jam_siap[$a],
                                    'email_info' => $_POST['email_info'][$a],
                                    'email_eval' => $_POST['email_eval'][$a],
                                    'kirim_eval' => 0,
                                    'status_mobil' => 0,
                                    'keterangan_mobil' => $keterangan_mobil,
                                    'tgl_input' => date('Ymd'),
                                );

                                $transportasi_jemput[] = array(
                                    'id_transportasi' => $id_transportasi1++,
                                    'id_trans' => $id_trans4++,
                                    'id_pool' => $pool_mobil_pulang[0]['id_pool'],
                                    'jemput' => 2,
                                    'peminta' => session()->get('nama_pengguna'),
                                    'atas_nama' => $atas_nama,
                                    'jabatan' => $jabatan,
                                    'jumlah_mobil' => $jumlah_mobil_pulang[$a],
                                    'pembayaran' => $pembayaran,
                                    'jenis_kendaraan' => $jenis_kendaraan_pulang,
                                    'tenaga_angkut' => $tenaga_angkut_pulang,
                                    'dalkot_lukot' => $dalkot_lukot_pulang,
                                    'menginap' => $menginap_pulang,
                                    'kapasitas' => $_POST['kapasitas_pulang'][$a],
                                    'tujuan_mobil' => $tujuan_mobil_pulang,
                                    'siap_di' => $siap_di_pulang,
                                    'tanggal_mobil' => $tanggal_mobil_pulang[$a],
                                    'jam_siap' => $jam_siap_pulang[$a],
                                    'email_info' => $_POST['email_info'][$a],
                                    'email_eval' => $_POST['email_eval'][$a],
                                    'kirim_eval' => 0,
                                    'status_mobil' => 0,
                                    'keterangan_mobil' => $keterangan_mobil_pulang,
                                    'tgl_input' => date('Ymd'),
                                );
                            } else {
                                if(empty($_POST['nama'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Nama harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['jabatan'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Jabatan harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['pic'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['PIC harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['email_eval'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Email Evaluasi harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['jumlah_kamar'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Jumlah Kamar harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['tanggal_jam_masuk'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Tanggal dan Jam Masuk harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['tanggal_jam_keluar'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Tanggal dan Jam Keluar harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if (empty($_POST['jumlah_mobil'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Jumlah Mobil harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['tujuan_mobil'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Tujuan harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['siap_di'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Siap Di harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['tanggal_mobil'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Tanggal harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['jam_siap'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Jam Siap harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['jumlah_mobil_pulang'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Jumlah Mobil harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['tujuan_mobil_pulang'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Tujuan harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['siap_di_pulang'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Siap Di harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['tanggal_mobil_pulang'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Tanggal harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['jam_siap_pulang'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Jam Siap harus diisi']);
                                    return redirect()->to('trans_add');
                                }
                            }
                        }
                    }

                    $this->m_trans->insertBatch($trans);
                    $this->m_akomodasi->insertBatch($akomodasi);
                    $this->m_transportasi->insertBatch($transportasi);
                    $this->m_transportasi_jemput->insertBatch($transportasi_jemput);
                    session()->setFlashdata('success', ('Data berhasil ditambahkan'));
                    return redirect()->to("trans");

                    // $this->m_id->updateBatch($record);
                }
            }
            //Tiket + Hotel + Mobil
            else if ($pemesanan == '6') {
                $jemput = $_POST['jemput'];
                $antar = $_POST['antar'];

                if ($jemput == 'tidak') {
                    //Trans
                    $pic = $_POST['pic'];

                    $id_trans = $this->m_trans->select('id_trans')->orderBy('id_trans', 'desc')->first();
                    if (empty($id_trans)) {
                        $id_trans1 = 1;
                        $id_trans2 = 1;
                        $id_trans3 = 1;
                        $id_trans4 = 1;
                    } else {
                        $id_trans1 = (int)$id_trans['id_trans'] + 1;
                        $id_trans2 = (int)$id_trans['id_trans'] + 1;
                        $id_trans3 = (int)$id_trans['id_trans'] + 1;
                        $id_trans4 = (int)$id_trans['id_trans'] + 1;
                    }

                    //Tiket
                    $nama = $_POST['nama'];
                    $jabatan = $_POST['jabatan'];
                    $email_info = $_POST['email_info'];
                    $email_eval = $_POST['email_eval'];
                    $jumlah_tiket = $_POST['jumlah_tiket'];
                    $tanggal_jam_tiket = $_POST['tanggal_jam_tiket'];

                    $email_pengguna = $this->m_pengguna->whereIn('nama_pengguna', $email_info)->select('email_pengguna')->findAll();

                    // try {
                    //     //Server settings
                    //     // $mail->SMTPDebug = SMTP::DEBUG_SERVER;
                    //     $mail->isSMTP();
                    //     $mail->Host       = 'mail.konimex.com';
                    //     $mail->SMTPAuth   = true;
                    //     $mail->Username   = PDLN_EMAIL;
                    //     $mail->Password   = PDLN_PASS;
                    //     $mail->SMTPSecure = PHPMailer::ENCRYPTION_STARTTLS;
                    //     $mail->Port       = 587;
                    
                    //     //Recipients
                    //     $mail->setFrom('noreply@konimex.com');

                    //     foreach ($email_pengguna_info as $e => $ema) {
                    //         $mail->addAddress($ema['email_pengguna']);//Add a recipient
                    //     }
                    
                    //     //Content
                    //     // $link='https://konimex.com:447/pdln/listpb/pb/'.$id_transaksi;
                    //     $mail->Subject = 'Tes Program TABS (Bimo)';
                    //     $mail->Body    = nl2br("Tes kirim email harap diabaikan saja terima kasih.");
                    //     // $mail->Body    = nl2br("User bagian (").$niknmuser['niknm']."/".$nikuser['nik']."/".$nikuser['strorgnm'].(") telah selesai mengisi data PB, silahkan periksa data PB dengan cara klik link: $link");
                    
                    //     $mail->send();
                    //     // echo 'Message has been sent';
                    // } catch (Exception $e) {
                    //     echo "Message could not be sent. Mailer Error: {$mail->ErrorInfo}";
                    // }

                    //Hotel
                    $nama = $_POST['nama'];
                    $email_info = $_POST['email_info'];
                    $email_eval = $_POST['email_eval'];
                    $jumlah_kamar = $_POST['jumlah_kamar'];
                    $tanggal_jam_masuk = $_POST['tanggal_jam_masuk'];
                    $tanggal_jam_keluar = $_POST['tanggal_jam_keluar'];

                    $email_pengguna_info = $this->m_pengguna->whereIn('nama_pengguna', $email_info)->select('email_pengguna')->findAll();

                    // try {
                    //     //Server settings
                    //     // $mail->SMTPDebug = SMTP::DEBUG_SERVER;
                    //     $mail->isSMTP();
                    //     $mail->Host       = 'mail.konimex.com';
                    //     $mail->SMTPAuth   = true;
                    //     $mail->Username   = PDLN_EMAIL;
                    //     $mail->Password   = PDLN_PASS;
                    //     $mail->SMTPSecure = PHPMailer::ENCRYPTION_STARTTLS;
                    //     $mail->Port       = 587;
                    
                    //     //Recipients
                    //     $mail->setFrom('noreply@konimex.com');

                    //     foreach ($email_pengguna_info as $e => $ema) {
                    //         $mail->addAddress($ema['email_pengguna']);//Add a recipient
                    //     }
                    
                    //     //Content
                    //     // $link='https://konimex.com:447/pdln/listpb/pb/'.$id_transaksi;
                    //     $mail->Subject = 'Tes Program TABS (Bimo)';
                    //     $mail->Body    = nl2br("Tes kirim email harap diabaikan saja terima kasih.");
                    //     // $mail->Body    = nl2br("User bagian (").$niknmuser['niknm']."/".$nikuser['nik']."/".$nikuser['strorgnm'].(") telah selesai mengisi data PB, silahkan periksa data PB dengan cara klik link: $link");
                    
                    //     $mail->send();
                    //     // echo 'Message has been sent';
                    // } catch (Exception $e) {
                    //     echo "Message could not be sent. Mailer Error: {$mail->ErrorInfo}";
                    // }

                    //Mobil
                    $nama = $_POST['nama'];
                    $email_info = $_POST['email_info'];
                    $email_eval = $_POST['email_eval'];
                    $jumlah_mobil = $_POST['jumlah_mobil'];
                    $tanggal_mobil = $_POST['tanggal_mobil'];
                    $jam_siap = $_POST['jam_siap'];
                    // strtotime($jam_siap);

                    $email_pengguna_info = $this->m_pengguna->whereIn('nama_pengguna', $email_info)->select('email_pengguna')->findAll();

                    // try {
                    //     //Server settings
                    //     // $mail->SMTPDebug = SMTP::DEBUG_SERVER;
                    //     $mail->isSMTP();
                    //     $mail->Host       = 'mail.konimex.com';
                    //     $mail->SMTPAuth   = true;
                    //     $mail->Username   = PDLN_EMAIL;
                    //     $mail->Password   = PDLN_PASS;
                    //     $mail->SMTPSecure = PHPMailer::ENCRYPTION_STARTTLS;
                    //     $mail->Port       = 587;
                    
                    //     //Recipients
                    //     $mail->setFrom('noreply@konimex.com');

                    //     foreach ($email_pengguna_info as $e => $ema) {
                    //         $mail->addAddress($ema['email_pengguna']);//Add a recipient
                    //     }
                    
                    //     //Content
                    //     // $link='https://konimex.com:447/pdln/listpb/pb/'.$id_transaksi;
                    //     $mail->Subject = 'Tes Program TABS (Bimo)';
                    //     $mail->Body    = nl2br("Tes kirim email harap diabaikan saja terima kasih.");
                    //     // $mail->Body    = nl2br("User bagian (").$niknmuser['niknm']."/".$nikuser['nik']."/".$nikuser['strorgnm'].(") telah selesai mengisi data PB, silahkan periksa data PB dengan cara klik link: $link");
                    
                    //     $mail->send();
                    //     // echo 'Message has been sent';
                    // } catch (Exception $e) {
                    //     echo "Message could not be sent. Mailer Error: {$mail->ErrorInfo}";
                    // }

                    if(!empty($nama)) {
                        for($a = 0; $a < count($nama); $a++) {
                            //Trans
                            $pic = $_POST['pic'][$a];
                            $pic = ucwords($pic);
                            
                            //Tiket
                            $nama_tiket = $_POST['tiket'];
                            $nama_pool = $_POST['gs_tiket'];
                            $keberangkatan = $_POST['keberangkatan'];
                            $pemberhentian = $_POST['pemberhentian'];

                            if ($_POST['pilihan_tiket'][$a] == 0) {
                                session()->setFlashdata('warning', ['Pilih armada transportasi terlebih dahulu']);
                                return redirect()->to('trans_add');
                            } else if ($_POST['pilihan_tiket'][$a] == "Travel") {
                                $id_keberangkatan = null;
                                $id_pemberhentian = null;
                                $dari_tiket = $_POST['keberangkatan'][$a];
                                $tujuan_tiket = $_POST['pemberhentian'][$a];
                            } else {
                                $nama_keberangkatan = substr($keberangkatan[$a], 0, strpos($keberangkatan[$a], " - "));
                                $dari_tiket = substr($keberangkatan[$a], strpos($keberangkatan[$a], " - ")+3);
                                $id_berangkat = $this->m_pemberhentian->where('nama_pemberhentian', $nama_keberangkatan)->select('id_pemberhentian')->findAll();
                                $id_keberangkatan = $id_berangkat[0]['id_pemberhentian'];
                                
                                $nama_pemberhentian = substr($pemberhentian[$a], 0, strpos($pemberhentian[$a], " - "));
                                $tujuan_tiket = substr($pemberhentian[$a], strpos($pemberhentian[$a], " - ")+3);
                                $id_berhenti = $this->m_pemberhentian->where('nama_pemberhentian', $nama_pemberhentian)->select('id_pemberhentian')->findAll();
                                $id_pemberhentian = $id_berhenti[0]['id_pemberhentian'];
                            }

                            if ($_POST['keberangkatan'][$a] == $_POST['pemberhentian'][$a]) {
                                session()->setFlashdata('warning', ['Keberangkatan dan Pemberhentian Tiket tidak boleh sama']);
                                return redirect()->to('trans_add');
                            }
                            
                            $vendor = $this->m_vendor->where('nama_vendor', $nama_tiket[$a])->select('id_vendor')->findAll();
                            $pool_tiket = $this->m_pool->where('nama_pool', $nama_pool[$a])->select('id_pool')->findAll();

                            if ($_POST['tamu'][$a] == 'Tamu') {
                                $atas_nama = 'Tamu';
                                $jabatan = 'Tamu';
                            } else {
                                $atas_nama = $_POST['nama'][$a];
                                $atas_nama = ucwords($atas_nama);

                                $jabatan = $_POST['jabatan'][$a];
                                $jabatan = ucwords($jabatan);
                            }

                            $pembayaran = $_POST['pembayaran'][$a];
                            if($pembayaran == 'Company Acc'){
                                $pembayaran = 'k';
                            } else if($pembayaran == 'Personal Acc'){
                                $pembayaran = 'p';
                            }

                            $keterangan_tiket = $_POST['keterangan_tiket'][$a];
                            if(empty($keterangan_tiket)){
                                $keterangan_tiket = null;
                            }

                            //Hotel
                            $nama_pool = $_POST['gs_hotel'];
                            $nama_kota = $_POST['kota'];
                            $nama_akomodasi = $_POST['hotel'];

                            $nama_hotel = substr($nama_akomodasi[$a], 0, strpos($nama_akomodasi[$a], " - "));
                            $jenis_kamar = substr($nama_akomodasi[$a], strpos($nama_akomodasi[$a], ' - ') + 3);

                            $pool_hotel = $this->m_pool->where('nama_pool', $nama_pool[$a])->select('id_pool')->findAll();
                            $kota_hotel = $this->m_kota->where('nama_kota', $nama_kota[$a])->select('id_kota')->findAll();
                            $id_hotel = $this->m_hotel->where('nama_hotel', $nama_hotel)->select('id_hotel')->findAll();
                            if (empty($id_hotel)) {
                                session()->setFlashdata('warning', ['Tidak ada data Hotel']);
                                return redirect()->to("trans_add");
                            }
                            $id_detail_hotel = $this->m_detail_hotel->where('id_hotel', $id_hotel[0]['id_hotel'])->where('jenis_kamar', $jenis_kamar)->select('id_detail_hotel')->findAll();

                            if ($nama_hotel == "Mess Kx Jkt") {
                                $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                $status_mess = 1;
                                
                                foreach ($mess as $m => $mes) {
                                    if ($mes['terpakai'] == 18) {
                                        session()->setFlashdata('warning', ['Mess Kx Jkt sudah penuh']);
                                        return redirect()->to("trans_add");
                                    } else {
                                        $terpakai = [
                                            'id_mess' => 8,
                                            'terpakai' => $mes['terpakai'] + $jumlah_kamar[$a],
                                            'edited_at' => $timestamp,
                                        ];
                                        $this->m_mess->save($terpakai);
                                    }
                                }
                            } else {
                                $status_mess = 0;
                            }

                            if ($_POST['tamu'][$a] == 'Tamu') {
                                $atas_nama = 'Tamu';
                                $jabatan = 'Tamu';
                            } else {
                                $atas_nama = $_POST['nama'][$a];
                                $atas_nama = ucwords($atas_nama);
    
                                $jabatan = $_POST['jabatan'][$a];
                                $jabatan = ucwords($jabatan);
                            }

                            $pembayaran = $_POST['pembayaran'][$a];
                            if($pembayaran == 'Company Acc'){
                                $pembayaran = 'k';
                            } else if($pembayaran == 'Personal Acc'){
                                $pembayaran = 'p';
                            }

                            $keterangan_akomodasi = $_POST['keterangan_akomodasi'][$a];
                            if(empty($keterangan_akomodasi)){
                                $keterangan_akomodasi = null;
                            }
                            
                            //Mobil
                            $nama_pool = $_POST['gs_mobil'];

                            $pool_mobil = $this->m_pool->where('nama_pool', $nama_pool[$a])->select('id_pool')->findAll();

                            if ($_POST['tamu'][$a] == 'Tamu') {
                                $atas_nama = 'Tamu';
                                $jabatan = 'Tamu';
                            } else {
                                $atas_nama = $_POST['nama'][$a];
                                $atas_nama = ucwords($atas_nama);
    
                                $jabatan = $_POST['jabatan'][$a];
                                $jabatan = ucwords($jabatan);
                            }

                            $tujuan_mobil = $_POST['tujuan_mobil'][$a];
                            $tujuan_mobil = ucwords($tujuan_mobil);

                            $siap_di = $_POST['siap_di'][$a];
                            $siap_di = ucwords($siap_di);

                            $pembayaran = $_POST['pembayaran'][$a];
                            if($pembayaran == 'Company Acc'){
                                $pembayaran = 'k';
                            } else if($pembayaran == 'Personal Acc'){
                                $pembayaran = 'p';
                            }

                            $jenis_kendaraan = $_POST['jenis_kendaraan'][$a];
                            if($jenis_kendaraan == 'Sedan'){
                                $jenis_kendaraan = 's';
                            } else if($jenis_kendaraan == 'Station'){
                                $jenis_kendaraan = 'a';
                            } else if($jenis_kendaraan == 'Pick Up'){
                                $jenis_kendaraan = 'p';
                            } else if($jenis_kendaraan == 'Box'){
                                $jenis_kendaraan = 'b';
                            } else if($jenis_kendaraan == 'Truck'){
                                $jenis_kendaraan = 't';
                            }

                            $tenaga_angkut = $_POST['tenaga_angkut'][$a];
                            if($tenaga_angkut == 'Iya'){
                                $tenaga_angkut = '1';
                            } else {
                                $tenaga_angkut = '0';
                            }
                            
                            $dalkot_lukot = $_POST['dalkot_lukot'][$a];

                            if($dalkot_lukot == 'Dalam Kota'){
                                $dalkot_lukot = 'd';
                                $menginap = 0;
                            } else {
                                $dalkot_lukot = 'l';
                                $menginap = $_POST['menginap'][$a];
                                if($menginap == 'Iya'){
                                    $menginap = '1';
                                } else {
                                    $menginap = '0';
                                }
                            }

                            $keterangan_mobil = $_POST['keterangan_mobil'][$a];
                            if(empty($keterangan_mobil)){
                                $keterangan_mobil = null;
                            }
                            
                            if(!empty($_POST['nama'][$a]) && !empty($_POST['jabatan'][$a]) && !empty($_POST['pic'][$a]) && !empty($_POST['email_eval'][$a]) && !empty($_POST['jumlah_tiket'][$a]) && !empty($_POST['tanggal_jam_tiket'][$a]) && !empty($_POST['jumlah_kamar'][$a]) && !empty($_POST['tanggal_jam_masuk'][$a]) && !empty($_POST['tanggal_jam_keluar'][$a]) && !empty($_POST['jumlah_mobil'][$a]) && !empty($_POST['tujuan_mobil'][$a]) && !empty($_POST['siap_di'][$a]) && !empty($_POST['tanggal_mobil'][$a]) && !empty($_POST['jam_siap'][$a])) {
                                $trans[] = array(
                                    'id_trans' => $id_trans1++,
                                    'id_detail_pengguna' => session()->get('id_detail_pengguna'),
                                    'id_bagian' => session()->get('id_bagian'),
                                    'pemesanan' => $this->request->getVar('pemesanan'),
                                    'pic' => $pic,
                                    'tamu' => $_POST['tamu'][$a],
                                    'tgl_input' => date('Ymd'),
                                );
    
                                $tiket[] = array(
                                    'id_trans' => $id_trans2++,
                                    'id_vendor' => $vendor[0]['id_vendor'],
                                    'id_keberangkatan' => $id_keberangkatan,
                                    'id_pemberhentian' => $id_pemberhentian,
                                    'id_pool' => $pool_tiket[0]['id_pool'],
                                    'peminta' => session()->get('nama_pengguna'),
                                    'atas_nama' => $atas_nama,
                                    'jabatan' => $jabatan,
                                    'jumlah_tiket' => $_POST['jumlah_tiket'][$a],
                                    'pembayaran' => $pembayaran,
                                    'harga_tiket' => null,
                                    'tanggal_jam_tiket' => $_POST['tanggal_jam_tiket'][$a],
                                    'dari_tiket' => $dari_tiket,
                                    'tujuan_tiket' => $tujuan_tiket,
                                    'email_info' => $_POST['email_info'][$a],
                                    'email_eval' => $_POST['email_eval'][$a],
                                    'kirim_eval' => 0,
                                    'keterangan_tiket' => $keterangan_tiket,
                                    'tgl_input' => date('Ymd'),
                                );

                                $akomodasi[] = array(
                                    'id_trans' => $id_trans3++,
                                    'id_hotel' => $id_hotel[0]['id_hotel'],
                                    'id_detail_hotel' => $id_detail_hotel[0]['id_detail_hotel'],
                                    'id_pool' => $pool_hotel[0]['id_pool'],
                                    'id_kota' => $kota_hotel[0]['id_kota'],
                                    'peminta' => session()->get('nama_pengguna'),
                                    'atas_nama' => $atas_nama,
                                    'jabatan' => $jabatan,
                                    'type' => $_POST['type'][$a],
                                    'jumlah_kamar' => $_POST['jumlah_kamar'][$a],
                                    'pembayaran' => $pembayaran,
                                    'harga_akomodasi' => null,
                                    'email_info' => $_POST['email_info'][$a],
                                    'email_eval' => $_POST['email_eval'][$a],
                                    'tanggal_jam_masuk' => $tanggal_jam_masuk[$a],
                                    'tanggal_jam_keluar' => $tanggal_jam_keluar[$a],
                                    'kirim_eval' => 0,
                                    'status_mess' => $status_mess,
                                    'status_akomodasi' => 0,
                                    'keterangan_akomodasi' => $keterangan_akomodasi,
                                    'tgl_input' => date('Ymd'),
                                );

                                $transportasi[] = array(
                                    'id_trans' => $id_trans4++,
                                    'id_pool' => $pool_mobil[0]['id_pool'],
                                    'jemput' => 0,
                                    'peminta' => session()->get('nama_pengguna'),
                                    'atas_nama' => $atas_nama,
                                    'jabatan' => $jabatan,
                                    'jumlah_mobil' => $jumlah_mobil[$a],
                                    'pembayaran' => $pembayaran,
                                    'jenis_kendaraan' => $jenis_kendaraan,
                                    'tenaga_angkut' => $tenaga_angkut,
                                    'dalkot_lukot' => $dalkot_lukot,
                                    'menginap' => $menginap,
                                    'kapasitas' => $_POST['kapasitas'][$a],
                                    'tujuan_mobil' => $tujuan_mobil,
                                    'siap_di' => $siap_di,
                                    'tanggal_mobil' => $tanggal_mobil[$a],
                                    'jam_siap' => $jam_siap[$a],
                                    'email_info' => $_POST['email_info'][$a],
                                    'email_eval' => $_POST['email_eval'][$a],
                                    'kirim_eval' => 0,
                                    'status_mobil' => 0,
                                    'keterangan_mobil' => $keterangan_mobil,
                                    'tgl_input' => date('Ymd'),
                                );
                            } else {
                                if(empty($_POST['nama'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Nama harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['jabatan'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Jabatan harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['pic'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['PIC harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['email_eval'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Email Evaluasi harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['jumlah_tiket'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Jumlah tiket harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['tanggal_jam_tiket'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Tanggal dan Jam tiket harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['jumlah_kamar'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Jumlah Kamar harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['tanggal_jam_masuk'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Tanggal dan Jam Masuk harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['tanggal_jam_keluar'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Tanggal dan Jam Keluar harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if (empty($_POST['jumlah_mobil'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Jumlah Mobil harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['tujuan_mobil'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Tujuan harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['siap_di'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Siap Di harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['tanggal_mobil'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Tanggal harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['jam_siap'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Jam Siap harus diisi']);
                                    return redirect()->to('trans_add');
                                }
                            }
                        }
                    }
                    
                    $this->m_trans->insertBatch($trans);
                    $this->m_tiket->insertBatch($tiket);
                    $this->m_akomodasi->insertBatch($akomodasi);
                    $this->m_transportasi->insertBatch($transportasi);
                    session()->setFlashdata('success', ('Data berhasil ditambahkan'));
                    return redirect()->to("trans");

                    // $this->m_id->updateBatch($record);
                } else if ($antar == 'tidak') {
                    //Trans
                    $pic = $_POST['pic'];

                    $id_trans = $this->m_trans->select('id_trans')->orderBy('id_trans', 'desc')->first();
                    $id_transportasi = $this->m_transportasi->select('id_transportasi')->orderBy('id_transportasi', 'desc')->first();
                    if (empty($id_trans)) {
                        $id_trans1 = 1;
                        $id_trans2 = 1;
                        $id_trans3 = 1;
                        $id_trans4 = 1;
                        $id_trans5 = 1;
                    } else {
                        $id_trans1 = (int)$id_trans['id_trans'] + 1;
                        $id_trans2 = (int)$id_trans['id_trans'] + 1;
                        $id_trans3 = (int)$id_trans['id_trans'] + 1;
                        $id_trans4 = (int)$id_trans['id_trans'] + 1;
                        $id_trans5 = (int)$id_trans['id_trans'] + 1;
                    }

                    if (empty($id_transportasi)) {
                        $id_transportasi1 = 1;
                    } else {
                        $id_transportasi1 = (int)$id_transportasi['id_transportasi'] + 1;
                    }

                    //Tiket
                    $nama = $_POST['nama'];
                    $jabatan = $_POST['jabatan'];
                    $email_info = $_POST['email_info'];
                    $email_eval = $_POST['email_eval'];
                    $jumlah_tiket = $_POST['jumlah_tiket'];
                    $tanggal_jam_tiket = $_POST['tanggal_jam_tiket'];

                    $email_pengguna = $this->m_pengguna->whereIn('nama_pengguna', $email_info)->select('email_pengguna')->findAll();

                    // try {
                    //     //Server settings
                    //     // $mail->SMTPDebug = SMTP::DEBUG_SERVER;
                    //     $mail->isSMTP();
                    //     $mail->Host       = 'mail.konimex.com';
                    //     $mail->SMTPAuth   = true;
                    //     $mail->Username   = PDLN_EMAIL;
                    //     $mail->Password   = PDLN_PASS;
                    //     $mail->SMTPSecure = PHPMailer::ENCRYPTION_STARTTLS;
                    //     $mail->Port       = 587;
                    
                    //     //Recipients
                    //     $mail->setFrom('noreply@konimex.com');

                    //     foreach ($email_pengguna_info as $e => $ema) {
                    //         $mail->addAddress($ema['email_pengguna']);//Add a recipient
                    //     }
                    
                    //     //Content
                    //     // $link='https://konimex.com:447/pdln/listpb/pb/'.$id_transaksi;
                    //     $mail->Subject = 'Tes Program TABS (Bimo)';
                    //     $mail->Body    = nl2br("Tes kirim email harap diabaikan saja terima kasih.");
                    //     // $mail->Body    = nl2br("User bagian (").$niknmuser['niknm']."/".$nikuser['nik']."/".$nikuser['strorgnm'].(") telah selesai mengisi data PB, silahkan periksa data PB dengan cara klik link: $link");
                    
                    //     $mail->send();
                    //     // echo 'Message has been sent';
                    // } catch (Exception $e) {
                    //     echo "Message could not be sent. Mailer Error: {$mail->ErrorInfo}";
                    // }

                    //Hotel
                    $nama = $_POST['nama'];
                    $email_info = $_POST['email_info'];
                    $email_eval = $_POST['email_eval'];
                    $jumlah_kamar = $_POST['jumlah_kamar'];
                    $tanggal_jam_masuk = $_POST['tanggal_jam_masuk'];
                    $tanggal_jam_keluar = $_POST['tanggal_jam_keluar'];

                    $email_pengguna_info = $this->m_pengguna->whereIn('nama_pengguna', $email_info)->select('email_pengguna')->findAll();

                    // try {
                    //     //Server settings
                    //     // $mail->SMTPDebug = SMTP::DEBUG_SERVER;
                    //     $mail->isSMTP();
                    //     $mail->Host       = 'mail.konimex.com';
                    //     $mail->SMTPAuth   = true;
                    //     $mail->Username   = PDLN_EMAIL;
                    //     $mail->Password   = PDLN_PASS;
                    //     $mail->SMTPSecure = PHPMailer::ENCRYPTION_STARTTLS;
                    //     $mail->Port       = 587;
                    
                    //     //Recipients
                    //     $mail->setFrom('noreply@konimex.com');

                    //     foreach ($email_pengguna_info as $e => $ema) {
                    //         $mail->addAddress($ema['email_pengguna']);//Add a recipient
                    //     }
                    
                    //     //Content
                    //     // $link='https://konimex.com:447/pdln/listpb/pb/'.$id_transaksi;
                    //     $mail->Subject = 'Tes Program TABS (Bimo)';
                    //     $mail->Body    = nl2br("Tes kirim email harap diabaikan saja terima kasih.");
                    //     // $mail->Body    = nl2br("User bagian (").$niknmuser['niknm']."/".$nikuser['nik']."/".$nikuser['strorgnm'].(") telah selesai mengisi data PB, silahkan periksa data PB dengan cara klik link: $link");
                    
                    //     $mail->send();
                    //     // echo 'Message has been sent';
                    // } catch (Exception $e) {
                    //     echo "Message could not be sent. Mailer Error: {$mail->ErrorInfo}";
                    // }

                    //Mobil Pulang
                    $nama = $_POST['nama'];
                    $email_info = $_POST['email_info'];
                    $email_eval = $_POST['email_eval'];
                    $jumlah_mobil_pulang = $_POST['jumlah_mobil_pulang'];
                    $tanggal_mobil_pulang = $_POST['tanggal_mobil_pulang'];
                    $jam_siap_pulang = $_POST['jam_siap_pulang'];
                    // strtotime($jam_siap);

                    $email_pengguna_info = $this->m_pengguna->whereIn('nama_pengguna', $email_info)->select('email_pengguna')->findAll();

                    // try {
                    //     //Server settings
                    //     // $mail->SMTPDebug = SMTP::DEBUG_SERVER;
                    //     $mail->isSMTP();
                    //     $mail->Host       = 'mail.konimex.com';
                    //     $mail->SMTPAuth   = true;
                    //     $mail->Username   = PDLN_EMAIL;
                    //     $mail->Password   = PDLN_PASS;
                    //     $mail->SMTPSecure = PHPMailer::ENCRYPTION_STARTTLS;
                    //     $mail->Port       = 587;
                    
                    //     //Recipients
                    //     $mail->setFrom('noreply@konimex.com');

                    //     foreach ($email_pengguna_info as $e => $ema) {
                    //         $mail->addAddress($ema['email_pengguna']);//Add a recipient
                    //     }
                    
                    //     //Content
                    //     // $link='https://konimex.com:447/pdln/listpb/pb/'.$id_transaksi;
                    //     $mail->Subject = 'Tes Program TABS (Bimo)';
                    //     $mail->Body    = nl2br("Tes kirim email harap diabaikan saja terima kasih.");
                    //     // $mail->Body    = nl2br("User bagian (").$niknmuser['niknm']."/".$nikuser['nik']."/".$nikuser['strorgnm'].(") telah selesai mengisi data PB, silahkan periksa data PB dengan cara klik link: $link");
                    
                    //     $mail->send();
                    //     // echo 'Message has been sent';
                    // } catch (Exception $e) {
                    //     echo "Message could not be sent. Mailer Error: {$mail->ErrorInfo}";
                    // }

                    if(!empty($nama)) {
                        for($a = 0; $a < count($nama); $a++) {
                            //Trans
                            $pic = $_POST['pic'][$a];
                            $pic = ucwords($pic);
                            
                            //Tiket
                            $nama_tiket = $_POST['tiket'];
                            $nama_pool = $_POST['gs_tiket'];
                            $pemberhentian = $_POST['pemberhentian'];

                            $nama_pemberhentian = substr($pemberhentian[$a], 0, strpos($pemberhentian[$a], " - "));
                            $id_pemberhentian = $this->m_pemberhentian->where('nama_pemberhentian', $nama_pemberhentian)->select('id_pemberhentian')->findAll();

                            $vendor = $this->m_vendor->where('nama_vendor', $nama_tiket[$a])->select('id_vendor')->findAll();
                            $pool_tiket = $this->m_pool->where('nama_pool', $nama_pool[$a])->select('id_pool')->findAll();

                            $atas_nama = $_POST['nama'][$a];
                            $atas_nama = ucwords($atas_nama);

                            $jabatan = $_POST['jabatan'][$a];
                            $jabatan = ucwords($jabatan);

                            $pembayaran = $_POST['pembayaran'][$a];
                            if($pembayaran == 'Company Acc'){
                                $pembayaran = 'k';
                            } else if($pembayaran == 'Personal Acc'){
                                $pembayaran = 'p';
                            }

                            $dari_tiket = $_POST['dari_tiket'][$a];
                            $tujuan_tiket = $_POST['tujuan_tiket'][$a];

                            if ($dari_tiket == $tujuan_tiket) {
                                session()->setFlashdata('warning', ['Dari dan Tujuan Tiket tidak boleh sama']);
                                return redirect()->to('trans_add');
                            }

                            $keterangan_tiket = $_POST['keterangan_tiket'][$a];
                            if(empty($keterangan_tiket)){
                                $keterangan_tiket = null;
                            }

                            //Hotel
                            $nama_pool = $_POST['gs_hotel'];
                            $nama_kota = $_POST['kota'];
                            $nama_akomodasi = $_POST['hotel'];

                            $nama_hotel = substr($nama_akomodasi[$a], 0, strpos($nama_akomodasi[$a], " - "));
                            $jenis_kamar = substr($nama_akomodasi[$a], strpos($nama_akomodasi[$a], ' - ') + 3);

                            $pool_hotel = $this->m_pool->where('nama_pool', $nama_pool[$a])->select('id_pool')->findAll();
                            $kota_hotel = $this->m_kota->where('nama_kota', $nama_kota[$a])->select('id_kota')->findAll();
                            $id_hotel = $this->m_hotel->where('nama_hotel', $nama_hotel)->select('id_hotel')->findAll();
                            $id_detail_hotel = $this->m_detail_hotel->where('id_hotel', $id_hotel[0]['id_hotel'])->where('jenis_kamar', $jenis_kamar)->select('id_detail_hotel')->findAll();

                            if ($nama_hotel == "Mess Kx Jkt") {
                                $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                $status_mess = 1;
                                
                                foreach ($mess as $m => $mes) {
                                    if ($mes['terpakai'] == 18) {
                                        session()->setFlashdata('warning', ['Mess Kx Jkt sudah penuh']);
                                        return redirect()->to("trans_add");
                                    } else {
                                        $terpakai = [
                                            'id_mess' => 8,
                                            'terpakai' => $mes['terpakai'] + $jumlah_kamar[$a],
                                            'edited_at' => $timestamp,
                                        ];
                                        $this->m_mess->save($terpakai);
                                    }
                                }
                            } else {
                                $status_mess = 0;
                            }

                            $atas_nama = $_POST['nama'][$a];
                            $atas_nama = ucwords($atas_nama);

                            $jabatan = $_POST['jabatan'][$a];
                            $jabatan = ucwords($jabatan);

                            $pembayaran = $_POST['pembayaran'][$a];
                            if($pembayaran == 'Company Acc'){
                                $pembayaran = 'k';
                            } else if($pembayaran == 'Personal Acc'){
                                $pembayaran = 'p';
                            }

                            $keterangan_akomodasi = $_POST['keterangan_akomodasi'][$a];
                            if(empty($keterangan_akomodasi)){
                                $keterangan_akomodasi = null;
                            }
                            
                            //Mobil Pulang
                            $nama_pool = $_POST['gs_mobil_pulang'];

                            $pool_mobil_pulang = $this->m_pool->where('nama_pool', $nama_pool[$a])->select('id_pool')->findAll();

                            $atas_nama = $_POST['nama'][$a];
                            $atas_nama = ucwords($atas_nama);

                            $jabatan = $_POST['jabatan'][$a];
                            $jabatan = ucwords($jabatan);

                            $tujuan_mobil_pulang = $_POST['tujuan_mobil_pulang'][$a];
                            $tujuan_mobil_pulang = ucwords($tujuan_mobil_pulang);

                            $siap_di_pulang = $_POST['siap_di_pulang'][$a];
                            $siap_di_pulang = ucwords($siap_di_pulang);

                            $pembayaran = $_POST['pembayaran'][$a];
                            if($pembayaran == 'Company Acc'){
                                $pembayaran = 'k';
                            } else if($pembayaran == 'Personal Acc'){
                                $pembayaran = 'p';
                            }

                            $jenis_kendaraan_pulang = $_POST['jenis_kendaraan_pulang'][$a];
                            if($jenis_kendaraan_pulang == 'Sedan'){
                                $jenis_kendaraan_pulang = 's';
                            } else if($jenis_kendaraan_pulang == 'Station'){
                                $jenis_kendaraan_pulang = 'a';
                            } else if($jenis_kendaraan_pulang == 'Pick Up'){
                                $jenis_kendaraan_pulang = 'p';
                            } else if($jenis_kendaraan_pulang == 'Box'){
                                $jenis_kendaraan_pulang = 'b';
                            } else if($jenis_kendaraan_pulang == 'Truck'){
                                $jenis_kendaraan_pulang = 't';
                            }

                            $tenaga_angkut_pulang = $_POST['tenaga_angkut_pulang'][$a];
                            if($tenaga_angkut_pulang == 'Iya'){
                                $tenaga_angkut_pulang = '1';
                            } else {
                                $tenaga_angkut_pulang = '0';
                            }
                            
                            $dalkot_lukot_pulang = $_POST['dalkot_lukot_pulang'][$a];

                            if($dalkot_lukot_pulang == 'Dalam Kota'){
                                $dalkot_lukot_pulang = 'd';
                                $menginap_pulang = 0;
                            } else {
                                $dalkot_lukot_pulang = 'l';
                                $menginap_pulang = $_POST['menginap_pulang'][$a];
                                if($menginap_pulang == 'Iya'){
                                    $menginap_pulang = '1';
                                } else {
                                    $menginap_pulang = '0';
                                }
                            }

                            $keterangan_mobil_pulang = $_POST['keterangan_mobil_pulang'][$a];
                            if(empty($keterangan_mobil_pulang)){
                                $keterangan_mobil_pulang = null;
                            }
                            
                            if(!empty($_POST['nama'][$a]) && !empty($_POST['jabatan'][$a]) && !empty($_POST['pic'][$a]) && !empty($_POST['email_eval'][$a]) && !empty($_POST['jumlah_tiket'][$a]) && !empty($_POST['tanggal_jam_tiket'][$a]) && !empty($_POST['jumlah_kamar'][$a]) && !empty($_POST['tanggal_jam_masuk'][$a]) && !empty($_POST['tanggal_jam_keluar'][$a]) && !empty($_POST['jumlah_mobil_pulang'][$a]) && !empty($_POST['tujuan_mobil_pulang'][$a]) && !empty($_POST['siap_di_pulang'][$a]) && !empty($_POST['tanggal_mobil_pulang'][$a]) && !empty($_POST['jam_siap_pulang'][$a])) {
                                $trans[] = array(
                                    'id_trans' => $id_trans1++,
                                    'id_detail_pengguna' => session()->get('id_detail_pengguna'),
                                    'id_bagian' => session()->get('id_bagian'),
                                    'pemesanan' => $this->request->getVar('pemesanan'),
                                    'pic' => $pic,
                                    'tamu' => $_POST['tamu'][$a],
                                    'tgl_input' => date('Ymd'),
                                );
    
                                $tiket[] = array(
                                    'id_trans' => $id_trans2++,
                                    'id_vendor' => $vendor[0]['id_vendor'],
                                    'id_pemberhentian' => $id_pemberhentian[0]['id_pemberhentian'],
                                    'id_pool' => $pool_tiket[0]['id_pool'],
                                    'peminta' => session()->get('nama_pengguna'),
                                    'atas_nama' => $atas_nama,
                                    'jabatan' => $jabatan,
                                    'jumlah_tiket' => $_POST['jumlah_tiket'][$a],
                                    'pembayaran' => $pembayaran,
                                    'harga_tiket' => null,
                                    'tanggal_jam_tiket' => $_POST['tanggal_jam_tiket'][$a],
                                    'dari_tiket' => $dari_tiket,
                                    'tujuan_tiket' => $tujuan_tiket,
                                    'email_info' => $_POST['email_info'][$a],
                                    'email_eval' => $_POST['email_eval'][$a],
                                    'kirim_eval' => 0,
                                    'keterangan_tiket' => $keterangan_tiket,
                                    'tgl_input' => date('Ymd'),
                                );

                                $akomodasi[] = array(
                                    'id_trans' => $id_trans3++,
                                    'id_hotel' => $id_hotel[0]['id_hotel'],
                                    'id_detail_hotel' => $id_detail_hotel[0]['id_detail_hotel'],
                                    'id_pool' => $pool_hotel[0]['id_pool'],
                                    'id_kota' => $kota_hotel[0]['id_kota'],
                                    'peminta' => session()->get('nama_pengguna'),
                                    'atas_nama' => $atas_nama,
                                    'jabatan' => $jabatan,
                                    'type' => $_POST['type'][$a],
                                    'jumlah_kamar' => $_POST['jumlah_kamar'][$a],
                                    'pembayaran' => $pembayaran,
                                    'harga_akomodasi' => null,
                                    'email_info' => $_POST['email_info'][$a],
                                    'email_eval' => $_POST['email_eval'][$a],
                                    'tanggal_jam_masuk' => $tanggal_jam_masuk[$a],
                                    'tanggal_jam_keluar' => $tanggal_jam_keluar[$a],
                                    'kirim_eval' => 0,
                                    'status_mess' => $status_mess,
                                    'status_akomodasi' => 0,
                                    'keterangan_akomodasi' => $keterangan_akomodasi,
                                    'tgl_input' => date('Ymd'),
                                );

                                $transportasi[] = array(
                                    'id_trans' => $id_trans4++,
                                    'id_pool' => $pool_mobil_pulang[0]['id_pool'],
                                    'jemput' => 1,
                                    'peminta' => null,
                                    'atas_nama' => null,
                                    'jabatan' => null,
                                    'jumlah_mobil' => null,
                                    'pembayaran' => null,
                                    'jenis_kendaraan' => null,
                                    'tenaga_angkut' => null,
                                    'dalkot_lukot' => null,
                                    'menginap' => null,
                                    'kapasitas' => null,
                                    'tujuan_mobil' => null,
                                    'siap_di' => null,
                                    'tanggal_mobil' => $tanggal_mobil_pulang[$a],
                                    'jam_siap' => $jam_siap_pulang[$a],
                                    'email_info' => null,
                                    'email_eval' => null,
                                    'kirim_eval' => null,
                                    'status_mobil' => 0,
                                    'keterangan_mobil' => null,
                                    'tgl_input' => date('Ymd'),
                                );

                                $transportasi_jemput[] = array(
                                    'id_transportasi' => $id_transportasi1++,
                                    'id_trans' => $id_trans5++,
                                    'id_pool' => $pool_mobil_pulang[0]['id_pool'],
                                    'jemput' => 1,
                                    'peminta' => session()->get('nama_pengguna'),
                                    'atas_nama' => $atas_nama,
                                    'jabatan' => $jabatan,
                                    'jumlah_mobil' => $jumlah_mobil_pulang[$a],
                                    'pembayaran' => $pembayaran,
                                    'jenis_kendaraan' => $jenis_kendaraan_pulang,
                                    'tenaga_angkut' => $tenaga_angkut_pulang,
                                    'dalkot_lukot' => $dalkot_lukot_pulang,
                                    'menginap' => $menginap_pulang,
                                    'kapasitas' => $_POST['kapasitas_pulang'][$a],
                                    'tujuan_mobil' => $tujuan_mobil_pulang,
                                    'siap_di' => $siap_di_pulang,
                                    'tanggal_mobil' => $tanggal_mobil_pulang[$a],
                                    'jam_siap' => $jam_siap_pulang[$a],
                                    'email_info' => $_POST['email_info'][$a],
                                    'email_eval' => $_POST['email_eval'][$a],
                                    'kirim_eval' => 0,
                                    'status_mobil' => 0,
                                    'keterangan_mobil' => $keterangan_mobil_pulang,
                                    'tgl_input' => date('Ymd'),
                                );
                            } else {
                                if(empty($_POST['nama'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Nama harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['jabatan'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Jabatan harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['pic'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['PIC harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['email_eval'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Email Evaluasi harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['jumlah_tiket'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Jumlah tiket harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['tanggal_jam_tiket'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Tanggal dan Jam tiket harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['jumlah_kamar'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Jumlah Kamar harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['tanggal_jam_masuk'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Tanggal dan Jam Masuk harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['tanggal_jam_keluar'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Tanggal dan Jam Keluar harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if (empty($_POST['jumlah_mobil_pulang'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Jumlah Mobil harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['tujuan_mobil_pulang'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Tujuan harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['siap_di_pulang'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Siap Di harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['tanggal_mobil_pulang'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Tanggal harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['jam_siap_pulang'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Jam Siap harus diisi']);
                                    return redirect()->to('trans_add');
                                }
                            }
                        }
                    }
                    
                    $this->m_trans->insertBatch($trans);
                    $this->m_tiket->insertBatch($tiket);
                    $this->m_akomodasi->insertBatch($akomodasi);
                    $this->m_transportasi->insertBatch($transportasi);
                    $this->m_transportasi_jemput->insertBatch($transportasi_jemput);
                    session()->setFlashdata('success', ('Data berhasil ditambahkan'));
                    return redirect()->to("trans");

                    // $this->m_id->updateBatch($record);
                } else {
                    //Trans
                    $pic = $_POST['pic'];

                    $id_trans = $this->m_trans->select('id_trans')->orderBy('id_trans', 'desc')->first();
                    $id_transportasi = $this->m_transportasi->select('id_transportasi')->orderBy('id_transportasi', 'desc')->first();
                    if (empty($id_trans)) {
                        $id_trans1 = 1;
                        $id_trans2 = 1;
                        $id_trans3 = 1;
                        $id_trans4 = 1;
                        $id_trans5 = 1;
                    } else {
                        $id_trans1 = (int)$id_trans['id_trans'] + 1;
                        $id_trans2 = (int)$id_trans['id_trans'] + 1;
                        $id_trans3 = (int)$id_trans['id_trans'] + 1;
                        $id_trans4 = (int)$id_trans['id_trans'] + 1;
                        $id_trans5 = (int)$id_trans['id_trans'] + 1;
                    }

                    if (empty($id_transportasi)) {
                        $id_transportasi1 = 1;
                    } else {
                        $id_transportasi1 = (int)$id_transportasi['id_transportasi'] + 1;
                    }

                    //Tiket
                    $nama = $_POST['nama'];
                    $jabatan = $_POST['jabatan'];
                    $email_info = $_POST['email_info'];
                    $email_eval = $_POST['email_eval'];
                    $jumlah_tiket = $_POST['jumlah_tiket'];
                    $tanggal_jam_tiket = $_POST['tanggal_jam_tiket'];

                    $email_pengguna = $this->m_pengguna->whereIn('nama_pengguna', $email_info)->select('email_pengguna')->findAll();

                    // try {
                    //     //Server settings
                    //     // $mail->SMTPDebug = SMTP::DEBUG_SERVER;
                    //     $mail->isSMTP();
                    //     $mail->Host       = 'mail.konimex.com';
                    //     $mail->SMTPAuth   = true;
                    //     $mail->Username   = PDLN_EMAIL;
                    //     $mail->Password   = PDLN_PASS;
                    //     $mail->SMTPSecure = PHPMailer::ENCRYPTION_STARTTLS;
                    //     $mail->Port       = 587;
                    
                    //     //Recipients
                    //     $mail->setFrom('noreply@konimex.com');

                    //     foreach ($email_pengguna_info as $e => $ema) {
                    //         $mail->addAddress($ema['email_pengguna']);//Add a recipient
                    //     }
                    
                    //     //Content
                    //     // $link='https://konimex.com:447/pdln/listpb/pb/'.$id_transaksi;
                    //     $mail->Subject = 'Tes Program TABS (Bimo)';
                    //     $mail->Body    = nl2br("Tes kirim email harap diabaikan saja terima kasih.");
                    //     // $mail->Body    = nl2br("User bagian (").$niknmuser['niknm']."/".$nikuser['nik']."/".$nikuser['strorgnm'].(") telah selesai mengisi data PB, silahkan periksa data PB dengan cara klik link: $link");
                    
                    //     $mail->send();
                    //     // echo 'Message has been sent';
                    // } catch (Exception $e) {
                    //     echo "Message could not be sent. Mailer Error: {$mail->ErrorInfo}";
                    // }

                    //Hotel
                    $nama = $_POST['nama'];
                    $email_info = $_POST['email_info'];
                    $email_eval = $_POST['email_eval'];
                    $jumlah_kamar = $_POST['jumlah_kamar'];
                    $tanggal_jam_masuk = $_POST['tanggal_jam_masuk'];
                    $tanggal_jam_keluar = $_POST['tanggal_jam_keluar'];

                    $email_pengguna_info = $this->m_pengguna->whereIn('nama_pengguna', $email_info)->select('email_pengguna')->findAll();

                    // try {
                    //     //Server settings
                    //     // $mail->SMTPDebug = SMTP::DEBUG_SERVER;
                    //     $mail->isSMTP();
                    //     $mail->Host       = 'mail.konimex.com';
                    //     $mail->SMTPAuth   = true;
                    //     $mail->Username   = PDLN_EMAIL;
                    //     $mail->Password   = PDLN_PASS;
                    //     $mail->SMTPSecure = PHPMailer::ENCRYPTION_STARTTLS;
                    //     $mail->Port       = 587;
                    
                    //     //Recipients
                    //     $mail->setFrom('noreply@konimex.com');

                    //     foreach ($email_pengguna_info as $e => $ema) {
                    //         $mail->addAddress($ema['email_pengguna']);//Add a recipient
                    //     }
                    
                    //     //Content
                    //     // $link='https://konimex.com:447/pdln/listpb/pb/'.$id_transaksi;
                    //     $mail->Subject = 'Tes Program TABS (Bimo)';
                    //     $mail->Body    = nl2br("Tes kirim email harap diabaikan saja terima kasih.");
                    //     // $mail->Body    = nl2br("User bagian (").$niknmuser['niknm']."/".$nikuser['nik']."/".$nikuser['strorgnm'].(") telah selesai mengisi data PB, silahkan periksa data PB dengan cara klik link: $link");
                    
                    //     $mail->send();
                    //     // echo 'Message has been sent';
                    // } catch (Exception $e) {
                    //     echo "Message could not be sent. Mailer Error: {$mail->ErrorInfo}";
                    // }

                    //Mobil
                    $nama = $_POST['nama'];
                    $email_info = $_POST['email_info'];
                    $email_eval = $_POST['email_eval'];
                    $jumlah_mobil = $_POST['jumlah_mobil'];
                    $tanggal_mobil = $_POST['tanggal_mobil'];
                    $jam_siap = $_POST['jam_siap'];
                    // strtotime($jam_siap);

                    $email_pengguna_info = $this->m_pengguna->whereIn('nama_pengguna', $email_info)->select('email_pengguna')->findAll();

                    // try {
                    //     //Server settings
                    //     // $mail->SMTPDebug = SMTP::DEBUG_SERVER;
                    //     $mail->isSMTP();
                    //     $mail->Host       = 'mail.konimex.com';
                    //     $mail->SMTPAuth   = true;
                    //     $mail->Username   = PDLN_EMAIL;
                    //     $mail->Password   = PDLN_PASS;
                    //     $mail->SMTPSecure = PHPMailer::ENCRYPTION_STARTTLS;
                    //     $mail->Port       = 587;
                    
                    //     //Recipients
                    //     $mail->setFrom('noreply@konimex.com');

                    //     foreach ($email_pengguna_info as $e => $ema) {
                    //         $mail->addAddress($ema['email_pengguna']);//Add a recipient
                    //     }
                    
                    //     //Content
                    //     // $link='https://konimex.com:447/pdln/listpb/pb/'.$id_transaksi;
                    //     $mail->Subject = 'Tes Program TABS (Bimo)';
                    //     $mail->Body    = nl2br("Tes kirim email harap diabaikan saja terima kasih.");
                    //     // $mail->Body    = nl2br("User bagian (").$niknmuser['niknm']."/".$nikuser['nik']."/".$nikuser['strorgnm'].(") telah selesai mengisi data PB, silahkan periksa data PB dengan cara klik link: $link");
                    
                    //     $mail->send();
                    //     // echo 'Message has been sent';
                    // } catch (Exception $e) {
                    //     echo "Message could not be sent. Mailer Error: {$mail->ErrorInfo}";
                    // }

                    //Mobil Pulang
                    $nama = $_POST['nama'];
                    $email_info = $_POST['email_info'];
                    $email_eval = $_POST['email_eval'];
                    $jumlah_mobil_pulang = $_POST['jumlah_mobil_pulang'];
                    $tanggal_mobil_pulang = $_POST['tanggal_mobil_pulang'];
                    $jam_siap_pulang = $_POST['jam_siap_pulang'];
                    // strtotime($jam_siap);

                    $email_pengguna_info = $this->m_pengguna->whereIn('nama_pengguna', $email_info)->select('email_pengguna')->findAll();

                    // try {
                    //     //Server settings
                    //     // $mail->SMTPDebug = SMTP::DEBUG_SERVER;
                    //     $mail->isSMTP();
                    //     $mail->Host       = 'mail.konimex.com';
                    //     $mail->SMTPAuth   = true;
                    //     $mail->Username   = PDLN_EMAIL;
                    //     $mail->Password   = PDLN_PASS;
                    //     $mail->SMTPSecure = PHPMailer::ENCRYPTION_STARTTLS;
                    //     $mail->Port       = 587;
                    
                    //     //Recipients
                    //     $mail->setFrom('noreply@konimex.com');

                    //     foreach ($email_pengguna_info as $e => $ema) {
                    //         $mail->addAddress($ema['email_pengguna']);//Add a recipient
                    //     }
                    
                    //     //Content
                    //     // $link='https://konimex.com:447/pdln/listpb/pb/'.$id_transaksi;
                    //     $mail->Subject = 'Tes Program TABS (Bimo)';
                    //     $mail->Body    = nl2br("Tes kirim email harap diabaikan saja terima kasih.");
                    //     // $mail->Body    = nl2br("User bagian (").$niknmuser['niknm']."/".$nikuser['nik']."/".$nikuser['strorgnm'].(") telah selesai mengisi data PB, silahkan periksa data PB dengan cara klik link: $link");
                    
                    //     $mail->send();
                    //     // echo 'Message has been sent';
                    // } catch (Exception $e) {
                    //     echo "Message could not be sent. Mailer Error: {$mail->ErrorInfo}";
                    // }

                    if(!empty($nama)) {
                        for($a = 0; $a < count($nama); $a++) {
                            //Trans
                            $pic = $_POST['pic'][$a];
                            $pic = ucwords($pic);
                            
                            //Tiket
                            $nama_tiket = $_POST['tiket'];
                            $nama_pool = $_POST['gs_tiket'];
                            $pemberhentian = $_POST['pemberhentian'];

                            $nama_pemberhentian = substr($pemberhentian[$a], 0, strpos($pemberhentian[$a], " - "));
                            $id_pemberhentian = $this->m_pemberhentian->where('nama_pemberhentian', $nama_pemberhentian)->select('id_pemberhentian')->findAll();

                            $vendor = $this->m_vendor->where('nama_vendor', $nama_tiket[$a])->select('id_vendor')->findAll();
                            $pool_tiket = $this->m_pool->where('nama_pool', $nama_pool[$a])->select('id_pool')->findAll();

                            $atas_nama = $_POST['nama'][$a];
                            $atas_nama = ucwords($atas_nama);

                            $jabatan = $_POST['jabatan'][$a];
                            $jabatan = ucwords($jabatan);

                            $pembayaran = $_POST['pembayaran'][$a];
                            if($pembayaran == 'Company Acc'){
                                $pembayaran = 'k';
                            } else if($pembayaran == 'Personal Acc'){
                                $pembayaran = 'p';
                            }

                            $dari_tiket = $_POST['dari_tiket'][$a];
                            $tujuan_tiket = $_POST['tujuan_tiket'][$a];

                            if ($dari_tiket == $tujuan_tiket) {
                                session()->setFlashdata('warning', ['Dari dan Tujuan Tiket tidak boleh sama']);
                                return redirect()->to('trans_add');
                            }

                            $keterangan_tiket = $_POST['keterangan_tiket'][$a];
                            if(empty($keterangan_tiket)){
                                $keterangan_tiket = null;
                            }
                            
                            //Hotel
                            $nama_pool = $_POST['gs_hotel'];
                            $nama_kota = $_POST['kota'];
                            $nama_akomodasi = $_POST['hotel'];

                            $nama_hotel = substr($nama_akomodasi[$a], 0, strpos($nama_akomodasi[$a], " - "));
                            $jenis_kamar = substr($nama_akomodasi[$a], strpos($nama_akomodasi[$a], ' - ') + 3);

                            $pool_hotel = $this->m_pool->where('nama_pool', $nama_pool[$a])->select('id_pool')->findAll();
                            $kota_hotel = $this->m_kota->where('nama_kota', $nama_kota[$a])->select('id_kota')->findAll();
                            $id_hotel = $this->m_hotel->where('nama_hotel', $nama_hotel)->select('id_hotel')->findAll();
                            $id_detail_hotel = $this->m_detail_hotel->where('id_hotel', $id_hotel[0]['id_hotel'])->where('jenis_kamar', $jenis_kamar)->select('id_detail_hotel')->findAll();

                            if ($nama_hotel == "Mess Kx Jkt") {
                                $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                $status_mess = 1;
                                
                                foreach ($mess as $m => $mes) {
                                    if ($mes['terpakai'] == 18) {
                                        session()->setFlashdata('warning', ['Mess Kx Jkt sudah penuh']);
                                        return redirect()->to("trans_add");
                                    } else {
                                        $terpakai = [
                                            'id_mess' => 8,
                                            'terpakai' => $mes['terpakai'] + $jumlah_kamar[$a],
                                            'edited_at' => $timestamp,
                                        ];
                                        $this->m_mess->save($terpakai);
                                    }
                                }
                            } else {
                                $status_mess = 0;
                            }

                            $atas_nama = $_POST['nama'][$a];
                            $atas_nama = ucwords($atas_nama);

                            $jabatan = $_POST['jabatan'][$a];
                            $jabatan = ucwords($jabatan);

                            $pembayaran = $_POST['pembayaran'][$a];
                            if($pembayaran == 'Company Acc'){
                                $pembayaran = 'k';
                            } else if($pembayaran == 'Personal Acc'){
                                $pembayaran = 'p';
                            }

                            $keterangan_akomodasi = $_POST['keterangan_akomodasi'][$a];
                            if(empty($keterangan_akomodasi)){
                                $keterangan_akomodasi = null;
                            }
                            
                            //Mobil
                            $nama_pool = $_POST['gs_mobil'];

                            $pool_mobil = $this->m_pool->where('nama_pool', $nama_pool[$a])->select('id_pool')->findAll();

                            $atas_nama = $_POST['nama'][$a];
                            $atas_nama = ucwords($atas_nama);

                            $jabatan = $_POST['jabatan'][$a];
                            $jabatan = ucwords($jabatan);

                            $tujuan_mobil = $_POST['tujuan_mobil'][$a];
                            $tujuan_mobil = ucwords($tujuan_mobil);

                            $siap_di = $_POST['siap_di'][$a];
                            $siap_di = ucwords($siap_di);

                            $pembayaran = $_POST['pembayaran'][$a];
                            if($pembayaran == 'Company Acc'){
                                $pembayaran = 'k';
                            } else if($pembayaran == 'Personal Acc'){
                                $pembayaran = 'p';
                            }

                            $jenis_kendaraan = $_POST['jenis_kendaraan'][$a];
                            if($jenis_kendaraan == 'Sedan'){
                                $jenis_kendaraan = 's';
                            } else if($jenis_kendaraan == 'Station'){
                                $jenis_kendaraan = 'a';
                            } else if($jenis_kendaraan == 'Pick Up'){
                                $jenis_kendaraan = 'p';
                            } else if($jenis_kendaraan == 'Box'){
                                $jenis_kendaraan = 'b';
                            } else if($jenis_kendaraan == 'Truck'){
                                $jenis_kendaraan = 't';
                            }

                            $tenaga_angkut = $_POST['tenaga_angkut'][$a];
                            if($tenaga_angkut == 'Iya'){
                                $tenaga_angkut = '1';
                            } else {
                                $tenaga_angkut = '0';
                            }
                            
                            $dalkot_lukot = $_POST['dalkot_lukot'][$a];

                            if($dalkot_lukot == 'Dalam Kota'){
                                $dalkot_lukot = 'd';
                                $menginap = 0;
                            } else {
                                $dalkot_lukot = 'l';
                                $menginap = $_POST['menginap'][$a];
                                if($menginap == 'Iya'){
                                    $menginap = '1';
                                } else {
                                    $menginap = '0';
                                }
                            }

                            $keterangan_mobil = $_POST['keterangan_mobil'][$a];
                            if(empty($keterangan_mobil)){
                                $keterangan_mobil = null;
                            }

                            //Mobil Pulang
                            $nama_pool = $_POST['gs_mobil_pulang'];

                            $pool_mobil_pulang = $this->m_pool->where('nama_pool', $nama_pool[$a])->select('id_pool')->findAll();

                            $atas_nama = $_POST['nama'][$a];
                            $atas_nama = ucwords($atas_nama);

                            $jabatan = $_POST['jabatan'][$a];
                            $jabatan = ucwords($jabatan);

                            $tujuan_mobil_pulang = $_POST['tujuan_mobil_pulang'][$a];
                            $tujuan_mobil_pulang = ucwords($tujuan_mobil_pulang);

                            $siap_di_pulang = $_POST['siap_di_pulang'][$a];
                            $siap_di_pulang = ucwords($siap_di_pulang);

                            $pembayaran = $_POST['pembayaran'][$a];
                            if($pembayaran == 'Company Acc'){
                                $pembayaran = 'k';
                            } else if($pembayaran == 'Personal Acc'){
                                $pembayaran = 'p';
                            }

                            $jenis_kendaraan_pulang = $_POST['jenis_kendaraan_pulang'][$a];
                            if($jenis_kendaraan_pulang == 'Sedan'){
                                $jenis_kendaraan_pulang = 's';
                            } else if($jenis_kendaraan_pulang == 'Station'){
                                $jenis_kendaraan_pulang = 'a';
                            } else if($jenis_kendaraan_pulang == 'Pick Up'){
                                $jenis_kendaraan_pulang = 'p';
                            } else if($jenis_kendaraan_pulang == 'Box'){
                                $jenis_kendaraan_pulang = 'b';
                            } else if($jenis_kendaraan_pulang == 'Truck'){
                                $jenis_kendaraan_pulang = 't';
                            }

                            $tenaga_angkut_pulang = $_POST['tenaga_angkut_pulang'][$a];
                            if($tenaga_angkut_pulang == 'Iya'){
                                $tenaga_angkut_pulang = '1';
                            } else {
                                $tenaga_angkut_pulang = '0';
                            }
                            
                            $dalkot_lukot_pulang = $_POST['dalkot_lukot_pulang'][$a];

                            if($dalkot_lukot_pulang == 'Dalam Kota'){
                                $dalkot_lukot_pulang = 'd';
                                $menginap_pulang = 0;
                            } else {
                                $dalkot_lukot_pulang = 'l';
                                $menginap_pulang = $_POST['menginap_pulang'][$a];
                                if($menginap_pulang == 'Iya'){
                                    $menginap_pulang = '1';
                                } else {
                                    $menginap_pulang = '0';
                                }
                            }

                            $keterangan_mobil_pulang = $_POST['keterangan_mobil_pulang'][$a];
                            if(empty($keterangan_mobil_pulang)){
                                $keterangan_mobil_pulang = null;
                            }
                            
                            if(!empty($_POST['nama'][$a]) && !empty($_POST['jabatan'][$a]) && !empty($_POST['pic'][$a]) && !empty($_POST['email_eval'][$a]) && !empty($_POST['jumlah_tiket'][$a]) && !empty($_POST['tanggal_jam_tiket'][$a]) && !empty($_POST['jumlah_kamar'][$a]) && !empty($_POST['tanggal_jam_masuk'][$a]) && !empty($_POST['tanggal_jam_keluar'][$a]) && !empty($_POST['jumlah_mobil'][$a]) && !empty($_POST['tujuan_mobil'][$a]) && !empty($_POST['siap_di'][$a]) && !empty($_POST['tanggal_mobil'][$a]) && !empty($_POST['jam_siap'][$a]) && !empty($_POST['jumlah_mobil_pulang'][$a]) && !empty($_POST['tujuan_mobil_pulang'][$a]) && !empty($_POST['siap_di_pulang'][$a]) && !empty($_POST['tanggal_mobil_pulang'][$a]) && !empty($_POST['jam_siap_pulang'][$a])) {
                                $trans[] = array(
                                    'id_trans' => $id_trans1++,
                                    'id_detail_pengguna' => session()->get('id_detail_pengguna'),
                                    'id_bagian' => session()->get('id_bagian'),
                                    'pemesanan' => $this->request->getVar('pemesanan'),
                                    'pic' => $pic,
                                    'tamu' => $_POST['tamu'][$a],
                                    'tgl_input' => date('Ymd'),
                                );
    
                                $tiket[] = array(
                                    'id_trans' => $id_trans2++,
                                    'id_vendor' => $vendor[0]['id_vendor'],
                                    'id_pemberhentian' => $id_pemberhentian[0]['id_pemberhentian'],
                                    'id_pool' => $pool_tiket[0]['id_pool'],
                                    'peminta' => session()->get('nama_pengguna'),
                                    'atas_nama' => $atas_nama,
                                    'jabatan' => $jabatan,
                                    'jumlah_tiket' => $_POST['jumlah_tiket'][$a],
                                    'pembayaran' => $pembayaran,
                                    'harga_tiket' => null,
                                    'tanggal_jam_tiket' => $_POST['tanggal_jam_tiket'][$a],
                                    'dari_tiket' => $dari_tiket,
                                    'tujuan_tiket' => $tujuan_tiket,
                                    'email_info' => $_POST['email_info'][$a],
                                    'email_eval' => $_POST['email_eval'][$a],
                                    'kirim_eval' => 0,
                                    'keterangan_tiket' => $keterangan_tiket,
                                    'tgl_input' => date('Ymd'),
                                );

                                $akomodasi[] = array(
                                    'id_trans' => $id_trans3++,
                                    'id_hotel' => $id_hotel[0]['id_hotel'],
                                    'id_detail_hotel' => $id_detail_hotel[0]['id_detail_hotel'],
                                    'id_pool' => $pool_hotel[0]['id_pool'],
                                    'id_kota' => $kota_hotel[0]['id_kota'],
                                    'peminta' => session()->get('nama_pengguna'),
                                    'atas_nama' => $atas_nama,
                                    'jabatan' => $jabatan,
                                    'type' => $_POST['type'][$a],
                                    'jumlah_kamar' => $_POST['jumlah_kamar'][$a],
                                    'pembayaran' => $pembayaran,
                                    'harga_akomodasi' => null,
                                    'email_info' => $_POST['email_info'][$a],
                                    'email_eval' => $_POST['email_eval'][$a],
                                    'tanggal_jam_masuk' => $tanggal_jam_masuk[$a],
                                    'tanggal_jam_keluar' => $tanggal_jam_keluar[$a],
                                    'kirim_eval' => 0,
                                    'status_mess' => $status_mess,
                                    'status_akomodasi' => 0,
                                    'keterangan_akomodasi' => $keterangan_akomodasi,
                                    'tgl_input' => date('Ymd'),
                                );

                                $transportasi[] = array(
                                    'id_trans' => $id_trans4++,
                                    'id_pool' => $pool_mobil[0]['id_pool'],
                                    'jemput' => 2,
                                    'peminta' => session()->get('nama_pengguna'),
                                    'atas_nama' => $atas_nama,
                                    'jabatan' => $jabatan,
                                    'jumlah_mobil' => $jumlah_mobil[$a],
                                    'pembayaran' => $pembayaran,
                                    'jenis_kendaraan' => $jenis_kendaraan,
                                    'tenaga_angkut' => $tenaga_angkut,
                                    'dalkot_lukot' => $dalkot_lukot,
                                    'menginap' => $menginap,
                                    'kapasitas' => $_POST['kapasitas'][$a],
                                    'tujuan_mobil' => $tujuan_mobil,
                                    'siap_di' => $siap_di,
                                    'tanggal_mobil' => $tanggal_mobil[$a],
                                    'jam_siap' => $jam_siap[$a],
                                    'email_info' => $_POST['email_info'][$a],
                                    'email_eval' => $_POST['email_eval'][$a],
                                    'kirim_eval' => 0,
                                    'status_mobil' => 0,
                                    'keterangan_mobil' => $keterangan_mobil,
                                    'tgl_input' => date('Ymd'),
                                );

                                $transportasi_jemput[] = array(
                                    'id_transportasi' => $id_transportasi1++,
                                    'id_trans' => $id_trans5++,
                                    'id_pool' => $pool_mobil_pulang[0]['id_pool'],
                                    'jemput' => 2,
                                    'peminta' => session()->get('nama_pengguna'),
                                    'atas_nama' => $atas_nama,
                                    'jabatan' => $jabatan,
                                    'jumlah_mobil' => $jumlah_mobil_pulang[$a],
                                    'pembayaran' => $pembayaran,
                                    'jenis_kendaraan' => $jenis_kendaraan_pulang,
                                    'tenaga_angkut' => $tenaga_angkut_pulang,
                                    'dalkot_lukot' => $dalkot_lukot_pulang,
                                    'menginap' => $menginap_pulang,
                                    'kapasitas' => $_POST['kapasitas_pulang'][$a],
                                    'tujuan_mobil' => $tujuan_mobil_pulang,
                                    'siap_di' => $siap_di_pulang,
                                    'tanggal_mobil' => $tanggal_mobil_pulang[$a],
                                    'jam_siap' => $jam_siap_pulang[$a],
                                    'email_info' => $_POST['email_info'][$a],
                                    'email_eval' => $_POST['email_eval'][$a],
                                    'kirim_eval' => 0,
                                    'status_mobil' => 0,
                                    'keterangan_mobil' => $keterangan_mobil_pulang,
                                    'tgl_input' => date('Ymd'),
                                );
                            } else {
                                if(empty($_POST['nama'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Nama harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['jabatan'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Jabatan harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['pic'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['PIC harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['email_eval'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Email Evaluasi harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['jumlah_tiket'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Jumlah tiket harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['tanggal_jam_tiket'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Tanggal dan Jam tiket harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['jumlah_kamar'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Jumlah Kamar harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['tanggal_jam_masuk'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Tanggal dan Jam Masuk harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['tanggal_jam_keluar'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Tanggal dan Jam Keluar harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if (empty($_POST['jumlah_mobil'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Jumlah Mobil harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['tujuan_mobil'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Tujuan harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['siap_di'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Siap Di harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['tanggal_mobil'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Tanggal harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['jam_siap'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Jam Siap harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['jumlah_mobil_pulang'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Jumlah Mobil harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['tujuan_mobil_pulang'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Tujuan harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['siap_di_pulang'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Siap Di harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['tanggal_mobil_pulang'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Tanggal harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['jam_siap_pulang'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Jam Siap harus diisi']);
                                    return redirect()->to('trans_add');
                                }
                            }
                        }
                    }

                    $this->m_trans->insertBatch($trans);
                    $this->m_tiket->insertBatch($tiket);
                    $this->m_akomodasi->insertBatch($akomodasi);
                    $this->m_transportasi->insertBatch($transportasi);
                    $this->m_transportasi_jemput->insertBatch($transportasi_jemput);
                    session()->setFlashdata('success', ('Data berhasil ditambahkan'));
                    return redirect()->to("trans");

                    // $this->m_id->updateBatch($record);
                }
            }

            if($this->request->getMethod() == 'post') {
                $data = $this->request->getVar(); //setiap yang diinputkan akan dikembalikan ke view

                //Trans
                $id_trans = $this->m_trans->select('id_trans')->orderBy('id_trans', 'desc')->first();
                if (empty($id_trans)) {
                    $id_trans1 = 1;
                    $id_trans2 = 1;
                    $id_trans3 = 1;
                    $id_trans4 = 1;
                } else {
                    $id_trans1 = (int)$id_trans['id_trans'] + 1;
                    $id_trans2 = (int)$id_trans['id_trans'] + 1;
                    $id_trans3 = (int)$id_trans['id_trans'] + 1;
                    $id_trans4 = (int)$id_trans['id_trans'] + 1;
                }

                if(!empty($_POST['pemesanan'])) {
                    for($a = 0; $a < count($_POST['pemesanan']); $a++) {
                        if($_POST['pemesanan'][$a] == 'pilih') {
                            session()->setFlashdata('warning', ['Silahkan pilih kategori pemesanan terlebih dahulu']);
                            return redirect()->to('trans_add');
                        }
                        //Tiket
                        else if ($_POST['pemesanan'][$a] == '0') {
                            //Trans
                            // if ($_POST['tamu'][$a] == 'Karyawan Konimex') {
                            //     if ($_POST['pilih_nama'][$a] == 0) {
                            //         $pic = $_POST['pic_select'][$a];
                            //     } else if ($_POST['pilih_nama'][$a] == 1) {
                            //         $pic = $_POST['pic_inputan'][$a];
                            //     } else {
                            //         session()->setFlashdata('warning', ['Silahkan lengkapi data personil terlebih dahulu']);
                            //         return redirect()->to('trans_add');
                            //     }
                            //     $pic = $_POST['pic_select'][$a];
                            // } else {
                            //     $pic = $_POST['pic_inputan'][$a];
                            // }
                            // $pic = ucwords($pic);
                            
                            //Tiket
                            $nama_tiket = $_POST['tiket'];
                            $nama_pool = $_POST['gs_tiket'];
                            $keberangkatan = $_POST['keberangkatan'];
                            $pemberhentian = $_POST['pemberhentian'];

                            if ($_POST['pilihan_tiket'][$a] == 0) {
                                session()->setFlashdata('warning', ['Pilih armada transportasi terlebih dahulu']);
                                return redirect()->to('trans_add');
                            } else if ($_POST['pilihan_tiket'][$a] == "Travel") {
                                $id_keberangkatan = null;
                                $id_pemberhentian = null;
                                $dari_tiket = $_POST['keberangkatan'][$a];
                                $tujuan_tiket = $_POST['pemberhentian'][$a];
                            } else {
                                $nama_keberangkatan = substr($keberangkatan[$a], 0, strpos($keberangkatan[$a], " - "));
                                $dari_tiket = substr($keberangkatan[$a], strpos($keberangkatan[$a], " - ")+3);
                                $id_berangkat = $this->m_pemberhentian->where('nama_pemberhentian', $nama_keberangkatan)->select('id_pemberhentian')->findAll();
                                $id_keberangkatan = $id_berangkat[0]['id_pemberhentian'];
                                
                                $nama_pemberhentian = substr($pemberhentian[$a], 0, strpos($pemberhentian[$a], " - "));
                                $tujuan_tiket = substr($pemberhentian[$a], strpos($pemberhentian[$a], " - ")+3);
                                $id_berhenti = $this->m_pemberhentian->where('nama_pemberhentian', $nama_pemberhentian)->select('id_pemberhentian')->findAll();
                                $id_pemberhentian = $id_berhenti[0]['id_pemberhentian'];
                            }

                            if ($_POST['keberangkatan'][$a] == $_POST['pemberhentian'][$a]) {
                                session()->setFlashdata('warning', ['Keberangkatan dan Pemberhentian Tiket tidak boleh sama']);
                                return redirect()->to('trans_add');
                            }

                            if ($_POST['jumlah_tiket'][$a] == 0) {
                                session()->setFlashdata('warning', ['Jumlah tiket tidak boleh 0']);
                                return redirect()->to("trans_add");
                            }

                            $biaya = $_POST['harga_tiket'][$a];
                            $comma = ',';
                            $number = preg_replace('/[^0-9\\-]+/','', $biaya);
                            if ($number == null) {
                                $string = 0;
                            } else {
                                if( strpos($biaya, $comma) !== false ) {
                                    $string = $number/100;
                                } else {
                                    $string = $number;
                                }
                            }
                            
                            $vendor = $this->m_vendor->where('nama_vendor', $nama_tiket[$a])->select('id_vendor')->findAll();
                            if (empty($vendor)) {
                                session()->setFlashdata('warning', ['Tidak ada data Tiket']);
                                return redirect()->to("trans_add");
                            }
                            $pool_tiket = $this->m_pool->where('nama_pool', $nama_pool[$a])->select('id_pool')->findAll();

                            if ($_POST['tamu'][$a] == 'Karyawan Konimex') {
                                // if ($_POST['pilih_nama'][$a] == 0) {
                                //     $atas_nama = $_POST['nama_select'][$a];
                                //     $jabatan = $_POST['jabatan_select'][$a];
                                // } else if ($_POST['pilih_nama'][$a] == 1) {
                                //     $atas_nama = $_POST['nama_inputan'][$a];
                                //     $jabatan = $_POST['jabatan_inputan'][$a];
                                // } else {
                                //     session()->setFlashdata('warning', ['Silahkan lengkapi data personil terlebih dahulu']);
                                //     return redirect()->to('trans_add');
                                // }
                                $nama_select = $_POST["nama_select".$a];

                                $atas_nama = implode(", ", $nama_select);
                                $jabatan = $_POST['jabatan_select'][$a];
                                $pic = $atas_nama;
                                $email_info = $atas_nama;
                                $email_eval = $atas_nama;
                                // $pic = $_POST['nama_select'][$a];
                                // $email_info = $_POST['nama_select'][$a];
                                // $email_eval = $_POST['nama_select'][$a];
                            } else {
                                $atas_nama = $_POST['nama_inputan'][$a];
                                $jabatan = $_POST['jabatan_inputan'][$a];
                                $pic = $_POST['nama_inputan'][$a];
                                $email_info = $_POST['nama_inputan'][$a];
                                $email_eval = $_POST['nama_inputan'][$a];
                            }
                            if (empty($atas_nama)) {
                                session()->setFlashdata('warning', ['Nama harus diisi']);
                                return redirect()->to('trans_add');
                            }
                            if (empty($jabatan)) {
                                session()->setFlashdata('warning', ['Jabatan harus diisi']);
                                return redirect()->to('trans_add');
                            }
                            $atas_nama = ucwords($atas_nama);
                            $jabatan = ucwords($jabatan);

                            $pembayaran = $_POST['pembayaran'][$a];
                            if($pembayaran == 'Company Acc'){
                                $pembayaran = 'k';
                            } else if($pembayaran == 'Personal Acc'){
                                $pembayaran = 'p';
                            }

                            $keterangan_tiket = $_POST['keterangan_tiket'][$a];
                            if(empty($keterangan_tiket)){
                                $keterangan_tiket = null;
                            }

                            if(!empty($atas_nama) && !empty($jabatan) && !empty($pic) && !empty($email_eval) && !empty($_POST['jumlah_tiket'][$a]) && !empty($_POST['tanggal_jam_tiket'][$a])) {
                                $trans_tik[] = array(
                                    'id_trans' => $id_trans1++,
                                    'id_detail_pengguna' => session()->get('id_detail_pengguna'),
                                    'id_bagian' => session()->get('id_bagian'),
                                    'pemesanan' => $_POST['pemesanan'][$a],
                                    'pic' => $pic,
                                    'tamu' => $_POST['tamu'][$a],
                                    'tgl_input' => date('Ymd'),
                                );

                                $tiket[] = array(
                                    'id_trans' => $id_trans2++,
                                    'id_vendor' => $vendor[0]['id_vendor'],
                                    'id_keberangkatan' => $id_keberangkatan,
                                    'id_pemberhentian' => $id_pemberhentian,
                                    'id_pool' => $pool_tiket[0]['id_pool'],
                                    'peminta' => session()->get('nama_pengguna'),
                                    'atas_nama' => $atas_nama,
                                    'jabatan' => $jabatan,
                                    'jumlah_tiket' => $_POST['jumlah_tiket'][$a],
                                    'pembayaran' => $pembayaran,
                                    'harga_tiket' => $string,
                                    'tanggal_jam_tiket' => $_POST['tanggal_jam_tiket'][$a],
                                    'dari_tiket' => $dari_tiket,
                                    'tujuan_tiket' => $tujuan_tiket,
                                    'email_info' => $email_info,
                                    'email_eval' => $email_eval,
                                    'kirim_eval' => 0,
                                    'keterangan_tiket' => $keterangan_tiket,
                                    'tgl_input' => date('Ymd'),
                                );
                                $id_trans_dummy3 = $id_trans3++;
                                $id_trans_dummy4 = $id_trans4++;
                            } else {
                                if(empty($atas_nama)) {
                                    session()->setFlashdata('warning', ['Nama harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($jabatan)) {
                                    session()->setFlashdata('warning', ['Jabatan harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($pic)) {
                                    session()->setFlashdata('warning', ['PIC harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($email_eval)) {
                                    session()->setFlashdata('warning', ['Email Evaluasi harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['jumlah_tiket'][$a])) {
                                    session()->setFlashdata('warning', ['Jumlah tiket harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['tanggal_jam_tiket'][$a])) {
                                    session()->setFlashdata('warning', ['Tanggal dan Jam tiket harus diisi']);
                                    return redirect()->to("trans_add");
                                }
                            }
                        }
                        //Hotel
                        else if ($_POST['pemesanan'][$a] == '1') {
                            //Trans
                            if ($_POST['tamu'][$a] == 'Non Tamu') {
                                if ($_POST['pilih_nama'][$a] == 0) {
                                    $pic = $_POST['pic_select'][$a];
                                } else if ($_POST['pilih_nama'][$a] == 1) {
                                    $pic = $_POST['pic_inputan'][$a];
                                } else {
                                    session()->setFlashdata('warning', ['Silahkan lengkapi data personil terlebih dahulu']);
                                    return redirect()->to('trans_add');
                                }
                            } else {
                                $pic = $_POST['pic_inputan'][$a];
                            }
                            $pic = ucwords($pic);

                            //Hotel
                            $jumlah_kamar = $_POST['jumlah_kamar'];
                            $nama_pool = $_POST['gs_hotel'];

                            if ($nama_pool[$a] == '2. Pool Jakarta') {
                                $nama_kota = $_POST['kota_jkt'];
                                $nama_akomodasi = $_POST['hotel_jkt'];
                            } else {
                                $nama_kota = $_POST['kota'];
                                $nama_akomodasi = $_POST['hotel'];
                            }

                            $nama_hotel = substr($nama_akomodasi[$a], 0, strpos($nama_akomodasi[$a], " - "));
                            $jenis_kamar = substr($nama_akomodasi[$a], strpos($nama_akomodasi[$a], ' - ') + 3);

                            $pool_hotel = $this->m_pool->where('nama_pool', $nama_pool[$a])->select('id_pool')->findAll();
                            $kota_hotel = $this->m_kota->where('nama_kota', $nama_kota[$a])->select('id_kota')->findAll();
                            $id_hotel = $this->m_hotel->where('nama_hotel', $nama_hotel)->select('id_hotel')->findAll();
                            if (empty($id_hotel)) {
                                session()->setFlashdata('warning', ['Tidak ada data Hotel']);
                                return redirect()->to("trans_add");
                            }
                            $id_detail_hotel = $this->m_detail_hotel->where('id_hotel', $id_hotel[0]['id_hotel'])->where('jenis_kamar', $jenis_kamar)->select('id_detail_hotel')->findAll();

                            $biaya = $_POST['harga_hotel'][$a];
                            $comma = ',';
                            $number = preg_replace('/[^0-9\\-]+/','', $biaya);
                            if ($number == null) {
                                $string = 0;
                            } else {
                                if( strpos($biaya, $comma) !== false ) {
                                    $string = $number/100;
                                } else {
                                    $string = $number;
                                }
                            }

                            if ($_POST['tamu'][$a] == 'Non Tamu') {
                                if ($_POST['pilih_nama'][$a] == 0) {
                                    $atas_nama = $_POST['nama_select'][$a];
                                    $jabatan = $_POST['jabatan_select'][$a];
                                } else if ($_POST['pilih_nama'][$a] == 1) {
                                    $atas_nama = $_POST['nama_inputan'][$a];
                                    $jabatan = $_POST['jabatan_inputan'][$a];
                                } else {
                                    session()->setFlashdata('warning', ['Silahkan lengkapi data personil terlebih dahulu']);
                                    return redirect()->to('trans_add');
                                }
                            } else {
                                $atas_nama = $_POST['nama_inputan'][$a];
                                $jabatan = $_POST['jabatan_inputan'][$a];
                            }
                            if (empty($atas_nama)) {
                                session()->setFlashdata('warning', ['Nama harus diisi']);
                                return redirect()->to('trans_add');
                            }
                            if (empty($jabatan)) {
                                session()->setFlashdata('warning', ['Jabatan harus diisi']);
                                return redirect()->to('trans_add');
                            }
                            $atas_nama = ucwords($atas_nama);
                            $jabatan = ucwords($jabatan);

                            $pembayaran = $_POST['pembayaran'][$a];
                            if($pembayaran == 'Company Acc'){
                                $pembayaran = 'k';
                            } else if($pembayaran == 'Personal Acc'){
                                $pembayaran = 'p';
                            }

                            $keterangan_akomodasi = $_POST['keterangan_akomodasi'][$a];
                            if(empty($keterangan_akomodasi)){
                                $keterangan_akomodasi = null;
                            }

                            if ($nama_hotel == "Mess Kx Jkt") {
                                $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                $status_mess = 1;
                                
                                foreach ($mess as $m => $mes) {
                                    if ($mes['terpakai'] == 18) {
                                        session()->setFlashdata('warning', ['Mess Kx Jkt sudah penuh']);
                                        return redirect()->to("trans_add");
                                    } else {
                                        $terpakai = [
                                            'id_mess' => 8,
                                            'terpakai' => $mes['terpakai'] + $jumlah_kamar[$a],
                                            'edited_at' => $timestamp,
                                        ];
                                        // $this->m_mess->save($terpakai);
                                    }
                                }
                            } else {
                                $status_mess = 0;
                            }

                            if(!empty($atas_nama) && !empty($jabatan) && !empty($pic) && !empty($_POST['email_eval'][$a]) && !empty($_POST['jumlah_kamar'][$a]) && !empty($_POST['tanggal_jam_masuk'][$a]) && !empty($_POST['tanggal_jam_keluar'][$a])) {
                                $trans_ako[] = array(
                                    'id_trans' => $id_trans1++,
                                    'id_detail_pengguna' => session()->get('id_detail_pengguna'),
                                    'id_bagian' => session()->get('id_bagian'),
                                    'pemesanan' => $_POST['pemesanan'][$a],
                                    'pic' => $pic,
                                    'tamu' => $_POST['tamu'][$a],
                                    'tgl_input' => date('Ymd'),
                                );

                                $akomodasi[] = array(
                                    'id_trans' => $id_trans2++,
                                    'id_hotel' => $id_hotel[0]['id_hotel'],
                                    'id_detail_hotel' => $id_detail_hotel[0]['id_detail_hotel'],
                                    'id_pool' => $pool_hotel[0]['id_pool'],
                                    'id_kota' => $kota_hotel[0]['id_kota'],
                                    'peminta' => session()->get('nama_pengguna'),
                                    'atas_nama' => $atas_nama,
                                    'jabatan' => $jabatan,
                                    'type' => $_POST['type'][$a],
                                    'jumlah_kamar' => $_POST['jumlah_kamar'][$a],
                                    'pembayaran' => $pembayaran,
                                    'harga_akomodasi' => $string,
                                    'email_info' => $_POST['email_info'][$a],
                                    'email_eval' => $_POST['email_eval'][$a],
                                    'tanggal_jam_masuk' => $_POST['tanggal_jam_masuk'][$a],
                                    'tanggal_jam_keluar' => $_POST['tanggal_jam_keluar'][$a],
                                    'kirim_eval' => 0,
                                    'status_mess' => $status_mess,
                                    'status_akomodasi' => 0,
                                    'keterangan_akomodasi' => $keterangan_akomodasi,
                                    'tgl_input' => date('Ymd'),
                                );
                                $id_trans_dummy3 = $id_trans3++;
                                $id_trans_dummy4 = $id_trans4++;
                            } else {
                                if(empty($atas_nama)) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Nama harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($jabatan)) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Jabatan harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($pic)) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['PIC harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['email_eval'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Email Evaluasi harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['jumlah_kamar'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Jumlah Kamar harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['tanggal_jam_masuk'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Tanggal dan Jam Masuk harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['tanggal_jam_keluar'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Tanggal dan Jam Keluar harus diisi']);
                                    return redirect()->to("trans_add");
                                }
                            }
                        }
                        //Mobil
                        else if ($_POST['pemesanan'][$a] == '2') {
                            //Trans
                            if ($_POST['tamu'][$a] == 'Non Tamu') {
                                if ($_POST['pilih_nama'][$a] == 0) {
                                    $pic = $_POST['pic_select'][$a];
                                } else if ($_POST['pilih_nama'][$a] == 1) {
                                    $pic = $_POST['pic_inputan'][$a];
                                } else {
                                    session()->setFlashdata('warning', ['Silahkan lengkapi data personil terlebih dahulu']);
                                    return redirect()->to('trans_add');
                                }
                            } else {
                                $pic = $_POST['pic_inputan'][$a];
                            }
                            $pic = ucwords($pic);

                            //Mobil
                            $nama_pool = $_POST['gs_mobil'];
                            $pool_mobil = $this->m_pool->where('nama_pool', $nama_pool[$a])->select('id_pool')->findAll();

                            if ($_POST['tamu'][$a] == 'Non Tamu') {
                                if ($_POST['pilih_nama'][$a] == 0) {
                                    $atas_nama = $_POST['nama_select'][$a];
                                    $jabatan = $_POST['jabatan_select'][$a];
                                } else if ($_POST['pilih_nama'][$a] == 1) {
                                    $atas_nama = $_POST['nama_inputan'][$a];
                                    $jabatan = $_POST['jabatan_inputan'][$a];
                                } else {
                                    session()->setFlashdata('warning', ['Silahkan lengkapi data personil terlebih dahulu']);
                                    return redirect()->to('trans_add');
                                }
                            } else {
                                $atas_nama = $_POST['nama_inputan'][$a];
                                $jabatan = $_POST['jabatan_inputan'][$a];
                            }
                            if (empty($atas_nama)) {
                                session()->setFlashdata('warning', ['Nama harus diisi']);
                                return redirect()->to('trans_add');
                            }
                            if (empty($jabatan)) {
                                session()->setFlashdata('warning', ['Jabatan harus diisi']);
                                return redirect()->to('trans_add');
                            }
                            $atas_nama = ucwords($atas_nama);
                            $jabatan = ucwords($jabatan);

                            $tujuan_mobil = $_POST['tujuan_mobil'][$a];
                            $tujuan_mobil = ucwords($tujuan_mobil);

                            $siap_di = $_POST['siap_di'][$a];
                            $siap_di = ucwords($siap_di);

                            $pembayaran = $_POST['pembayaran'][$a];
                            if($pembayaran == 'Company Acc'){
                                $pembayaran = 'k';
                            } else if($pembayaran == 'Personal Acc'){
                                $pembayaran = 'p';
                            }

                            $jenis_kendaraan = $_POST['jenis_kendaraan'][$a];
                            if($jenis_kendaraan == 'Sedan'){
                                $jenis_kendaraan = 's';
                            } else if($jenis_kendaraan == 'Station'){
                                $jenis_kendaraan = 'a';
                            } else if($jenis_kendaraan == 'Pick Up'){
                                $jenis_kendaraan = 'p';
                            } else if($jenis_kendaraan == 'Box'){
                                $jenis_kendaraan = 'b';
                            } else if($jenis_kendaraan == 'Truck'){
                                $jenis_kendaraan = 't';
                            }
                            
                            $dalkot_lukot = $_POST['dalkot_lukot'][$a];

                            if($dalkot_lukot == 'Dalam Kota'){
                                $dalkot_lukot = 'd';
                                $menginap = 0;
                            } else {
                                $dalkot_lukot = 'l';
                                $menginap = $_POST['menginap'][$a];
                                if($menginap == 'Iya'){
                                    $menginap = '1';
                                } else {
                                    $menginap = '0';
                                }
                            }

                            $keterangan_mobil = $_POST['keterangan_mobil'][$a];
                            if(empty($keterangan_mobil)){
                                $keterangan_mobil = null;
                            }
                            
                            if(!empty($atas_nama) && !empty($jabatan) && !empty($pic) && !empty($_POST['email_eval'][$a]) && !empty($_POST['jumlah_mobil'][$a]) && !empty($_POST['tujuan_mobil'][$a]) && !empty($_POST['siap_di'][$a]) && !empty($_POST['tanggal_mobil'][$a]) && !empty($_POST['jam_siap'][$a])) {
                                $trans_tra[] = array(
                                    'id_trans' => $id_trans1++,
                                    'id_detail_pengguna' => session()->get('id_detail_pengguna'),
                                    'id_bagian' => session()->get('id_bagian'),
                                    'pemesanan' => $_POST['pemesanan'][$a],
                                    'pic' => $pic,
                                    'tamu' => $_POST['tamu'][$a],
                                    'tgl_input' => date('Ymd'),
                                );

                                $transportasi[] = array(
                                    'id_trans' => $id_trans2++,
                                    'id_pool' => $pool_mobil[0]['id_pool'],
                                    'peminta' => session()->get('nama_pengguna'),
                                    'atas_nama' => $atas_nama,
                                    'jabatan' => $jabatan,
                                    'jumlah_mobil' => $_POST['jumlah_mobil'][$a],
                                    'pembayaran' => $pembayaran,
                                    'jenis_kendaraan' => $jenis_kendaraan,
                                    'dalkot_lukot' => $dalkot_lukot,
                                    'menginap' => $menginap,
                                    'kapasitas' => $_POST['kapasitas'][$a],
                                    'tujuan_mobil' => $tujuan_mobil,
                                    'siap_di' => $siap_di,
                                    'tanggal_mobil' => $_POST['tanggal_mobil'][$a],
                                    'jam_siap' => $_POST['jam_siap'][$a],
                                    'email_info' => $_POST['email_info'][$a],
                                    'email_eval' => $_POST['email_eval'][$a],
                                    'kirim_eval' => 0,
                                    'status_mobil' => 0,
                                    'keterangan_mobil' => $keterangan_mobil,
                                    'tgl_input' => date('Ymd'),
                                );
                                $id_trans_dummy3 = $id_trans3++;
                                $id_trans_dummy4 = $id_trans4++;
                            } else {
                                if(empty($atas_nama)) {
                                    session()->setFlashdata('warning', ['Nama harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($jabatan)) {
                                    session()->setFlashdata('warning', ['Jabatan harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($pic)) {
                                    session()->setFlashdata('warning', ['PIC harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['email_eval'][$a])) {
                                    session()->setFlashdata('warning', ['Email Evaluasi harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if (empty($_POST['jumlah_mobil'][$a])) {
                                    session()->setFlashdata('warning', ['Jumlah Mobil harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['tujuan_mobil'][$a])) {
                                    session()->setFlashdata('warning', ['Tujuan harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['siap_di'][$a])) {
                                    session()->setFlashdata('warning', ['Siap Di harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['tanggal_mobil'][$a])) {
                                    session()->setFlashdata('warning', ['Tanggal harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['jam_siap'][$a])) {
                                    session()->setFlashdata('warning', ['Jam Siap harus diisi']);
                                    return redirect()->to('trans_add');
                                }
                            }
                        }
                        //Tiket + Hotel
                        else if ($_POST['pemesanan'][$a] == '3') {
                            //Trans
                            if ($_POST['tamu'][$a] == 'Non Tamu') {
                                if ($_POST['pilih_nama'][$a] == 0) {
                                    $pic = $_POST['pic_select'][$a];
                                } else if ($_POST['pilih_nama'][$a] == 1) {
                                    $pic = $_POST['pic_inputan'][$a];
                                } else {
                                    session()->setFlashdata('warning', ['Silahkan lengkapi data personil terlebih dahulu']);
                                    return redirect()->to('trans_add');
                                }
                            } else {
                                $pic = $_POST['pic_inputan'][$a];
                            }
                            $pic = ucwords($pic);
                            
                            //Tiket
                            $nama_tiket = $_POST['tiket'];
                            $nama_pool = $_POST['gs_tiket'];
                            $keberangkatan = $_POST['keberangkatan'];
                            $pemberhentian = $_POST['pemberhentian'];

                            if ($_POST['pilihan_tiket'][$a] == 0) {
                                session()->setFlashdata('warning', ['Pilih armada transportasi terlebih dahulu']);
                                return redirect()->to('trans_add');
                            } else if ($_POST['pilihan_tiket'][$a] == "Travel") {
                                $id_keberangkatan = null;
                                $id_pemberhentian = null;
                                $dari_tiket = $_POST['keberangkatan'][$a];
                                $tujuan_tiket = $_POST['pemberhentian'][$a];
                            } else {
                                $nama_keberangkatan = substr($keberangkatan[$a], 0, strpos($keberangkatan[$a], " - "));
                                $dari_tiket = substr($keberangkatan[$a], strpos($keberangkatan[$a], " - ")+3);
                                $id_berangkat = $this->m_pemberhentian->where('nama_pemberhentian', $nama_keberangkatan)->select('id_pemberhentian')->findAll();
                                $id_keberangkatan = $id_berangkat[0]['id_pemberhentian'];
                                
                                $nama_pemberhentian = substr($pemberhentian[$a], 0, strpos($pemberhentian[$a], " - "));
                                $tujuan_tiket = substr($pemberhentian[$a], strpos($pemberhentian[$a], " - ")+3);
                                $id_berhenti = $this->m_pemberhentian->where('nama_pemberhentian', $nama_pemberhentian)->select('id_pemberhentian')->findAll();
                                $id_pemberhentian = $id_berhenti[0]['id_pemberhentian'];
                            }

                            if ($_POST['keberangkatan'][$a] == $_POST['pemberhentian'][$a]) {
                                session()->setFlashdata('warning', ['Keberangkatan dan Pemberhentian Tiket tidak boleh sama']);
                                return redirect()->to('trans_add');
                            }

                            if ($_POST['jumlah_tiket'][$a] == 0) {
                                session()->setFlashdata('warning', ['Jumlah tiket tidak boleh 0']);
                                return redirect()->to("trans_add");
                            }

                            $biaya = $_POST['harga_tiket'][$a];
                            $comma = ',';
                            $number = preg_replace('/[^0-9\\-]+/','', $biaya);
                            if ($number == null) {
                                $string = 0;
                            } else {
                                if( strpos($biaya, $comma) !== false ) {
                                    $string = $number/100;
                                } else {
                                    $string = $number;
                                }
                            }
                            
                            $vendor = $this->m_vendor->where('nama_vendor', $nama_tiket[$a])->select('id_vendor')->findAll();
                            if (empty($vendor)) {
                                session()->setFlashdata('warning', ['Tidak ada data Tiket']);
                                return redirect()->to("trans_add");
                            }
                            $pool_tiket = $this->m_pool->where('nama_pool', $nama_pool[$a])->select('id_pool')->findAll();

                            if ($_POST['tamu'][$a] == 'Non Tamu') {
                                if ($_POST['pilih_nama'][$a] == 0) {
                                    $atas_nama = $_POST['nama_select'][$a];
                                    $jabatan = $_POST['jabatan_select'][$a];
                                } else if ($_POST['pilih_nama'][$a] == 1) {
                                    $atas_nama = $_POST['nama_inputan'][$a];
                                    $jabatan = $_POST['jabatan_inputan'][$a];
                                } else {
                                    session()->setFlashdata('warning', ['Silahkan lengkapi data personil terlebih dahulu']);
                                    return redirect()->to('trans_add');
                                }
                            } else {
                                $atas_nama = $_POST['nama_inputan'][$a];
                                $jabatan = $_POST['jabatan_inputan'][$a];
                            }
                            if (empty($atas_nama)) {
                                session()->setFlashdata('warning', ['Nama harus diisi']);
                                return redirect()->to('trans_add');
                            }
                            if (empty($jabatan)) {
                                session()->setFlashdata('warning', ['Jabatan harus diisi']);
                                return redirect()->to('trans_add');
                            }
                            $atas_nama = ucwords($atas_nama);
                            $jabatan = ucwords($jabatan);

                            $pembayaran = $_POST['pembayaran'][$a];
                            if($pembayaran == 'Company Acc'){
                                $pembayaran = 'k';
                            } else if($pembayaran == 'Personal Acc'){
                                $pembayaran = 'p';
                            }

                            $keterangan_tiket = $_POST['keterangan_tiket'][$a];
                            if(empty($keterangan_tiket)){
                                $keterangan_tiket = null;
                            }

                            //Hotel
                            $jumlah_kamar = $_POST['jumlah_kamar'];
                            $nama_pool = $_POST['gs_hotel'];

                            if ($nama_pool[$a] == '2. Pool Jakarta') {
                                $nama_kota = $_POST['kota_jkt'];
                                $nama_akomodasi = $_POST['hotel_jkt'];
                            } else {
                                $nama_kota = $_POST['kota'];
                                $nama_akomodasi = $_POST['hotel'];
                            }

                            $nama_hotel = substr($nama_akomodasi[$a], 0, strpos($nama_akomodasi[$a], " - "));
                            $jenis_kamar = substr($nama_akomodasi[$a], strpos($nama_akomodasi[$a], ' - ') + 3);

                            $pool_hotel = $this->m_pool->where('nama_pool', $nama_pool[$a])->select('id_pool')->findAll();
                            $kota_hotel = $this->m_kota->where('nama_kota', $nama_kota[$a])->select('id_kota')->findAll();
                            $id_hotel = $this->m_hotel->where('nama_hotel', $nama_hotel)->select('id_hotel')->findAll();
                            if (empty($id_hotel)) {
                                session()->setFlashdata('warning', ['Tidak ada data Hotel']);
                                return redirect()->to("trans_add");
                            }
                            $id_detail_hotel = $this->m_detail_hotel->where('id_hotel', $id_hotel[0]['id_hotel'])->where('jenis_kamar', $jenis_kamar)->select('id_detail_hotel')->findAll();

                            $biaya = $_POST['harga_hotel'][$a];
                            $comma = ',';
                            $number = preg_replace('/[^0-9\\-]+/','', $biaya);
                            if ($number == null) {
                                $string = 0;
                            } else {
                                if( strpos($biaya, $comma) !== false ) {
                                    $string = $number/100;
                                } else {
                                    $string = $number;
                                }
                            }

                            if ($_POST['tamu'][$a] == 'Non Tamu') {
                                if ($_POST['pilih_nama'][$a] == 0) {
                                    $atas_nama = $_POST['nama_select'][$a];
                                    $jabatan = $_POST['jabatan_select'][$a];
                                } else if ($_POST['pilih_nama'][$a] == 1) {
                                    $atas_nama = $_POST['nama_inputan'][$a];
                                    $jabatan = $_POST['jabatan_inputan'][$a];
                                } else {
                                    session()->setFlashdata('warning', ['Silahkan lengkapi data personil terlebih dahulu']);
                                    return redirect()->to('trans_add');
                                }
                            } else {
                                $atas_nama = $_POST['nama_inputan'][$a];
                                $jabatan = $_POST['jabatan_inputan'][$a];
                            }
                            if (empty($atas_nama)) {
                                session()->setFlashdata('warning', ['Nama harus diisi']);
                                return redirect()->to('trans_add');
                            }
                            if (empty($jabatan)) {
                                session()->setFlashdata('warning', ['Jabatan harus diisi']);
                                return redirect()->to('trans_add');
                            }
                            $atas_nama = ucwords($atas_nama);
                            $jabatan = ucwords($jabatan);

                            $pembayaran = $_POST['pembayaran'][$a];
                            if($pembayaran == 'Company Acc'){
                                $pembayaran = 'k';
                            } else if($pembayaran == 'Personal Acc'){
                                $pembayaran = 'p';
                            }

                            $keterangan_akomodasi = $_POST['keterangan_akomodasi'][$a];
                            if(empty($keterangan_akomodasi)){
                                $keterangan_akomodasi = null;
                            }

                            if ($nama_hotel == "Mess Kx Jkt") {
                                $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                $status_mess = 1;
                                
                                foreach ($mess as $m => $mes) {
                                    if ($mes['terpakai'] == 18) {
                                        session()->setFlashdata('warning', ['Mess Kx Jkt sudah penuh']);
                                        return redirect()->to("trans_add");
                                    } else {
                                        $terpakai = [
                                            'id_mess' => 8,
                                            'terpakai' => $mes['terpakai'] + $jumlah_kamar[$a],
                                            'edited_at' => $timestamp,
                                        ];
                                        // $this->m_mess->save($terpakai);
                                    }
                                }
                            } else {
                                $status_mess = 0;
                            }

                            if(!empty($atas_nama) && !empty($jabatan) && !empty($pic) && !empty($_POST['email_eval'][$a]) && !empty($_POST['jumlah_tiket'][$a]) && !empty($_POST['tanggal_jam_tiket'][$a]) && !empty($_POST['jumlah_kamar'][$a]) && !empty($_POST['tanggal_jam_masuk'][$a]) && !empty($_POST['tanggal_jam_keluar'][$a])) {
                                $trans_ta[] = array(
                                    'id_trans' => $id_trans1++,
                                    'id_detail_pengguna' => session()->get('id_detail_pengguna'),
                                    'id_bagian' => session()->get('id_bagian'),
                                    'pemesanan' => $_POST['pemesanan'][$a],
                                    'pic' => $pic,
                                    'tamu' => $_POST['tamu'][$a],
                                    'tgl_input' => date('Ymd'),
                                );

                                $tiket_akomodasi_ta[] = array(
                                    'id_trans' => $id_trans2++,
                                    'id_vendor' => $vendor[0]['id_vendor'],
                                    'id_keberangkatan' => $id_keberangkatan,
                                    'id_pemberhentian' => $id_pemberhentian,
                                    'id_pool' => $pool_tiket[0]['id_pool'],
                                    'peminta' => session()->get('nama_pengguna'),
                                    'atas_nama' => $atas_nama,
                                    'jabatan' => $jabatan,
                                    'jumlah_tiket' => $_POST['jumlah_tiket'][$a],
                                    'pembayaran' => $pembayaran,
                                    'harga_tiket' => $string,
                                    'tanggal_jam_tiket' => $_POST['tanggal_jam_tiket'][$a],
                                    'dari_tiket' => $dari_tiket,
                                    'tujuan_tiket' => $tujuan_tiket,
                                    'email_info' => $_POST['email_info'][$a],
                                    'email_eval' => $_POST['email_eval'][$a],
                                    'kirim_eval' => 0,
                                    'keterangan_tiket' => $keterangan_tiket,
                                    'tgl_input' => date('Ymd'),
                                );

                                $akomodasi_tiket_ta[] = array(
                                    'id_trans' => $id_trans3++,
                                    'id_hotel' => $id_hotel[0]['id_hotel'],
                                    'id_detail_hotel' => $id_detail_hotel[0]['id_detail_hotel'],
                                    'id_pool' => $pool_hotel[0]['id_pool'],
                                    'id_kota' => $kota_hotel[0]['id_kota'],
                                    'peminta' => session()->get('nama_pengguna'),
                                    'atas_nama' => $atas_nama,
                                    'jabatan' => $jabatan,
                                    'type' => $_POST['type'][$a],
                                    'jumlah_kamar' => $_POST['jumlah_kamar'][$a],
                                    'pembayaran' => $pembayaran,
                                    'harga_akomodasi' => $string,
                                    'email_info' => $_POST['email_info'][$a],
                                    'email_eval' => $_POST['email_eval'][$a],
                                    'tanggal_jam_masuk' => $_POST['tanggal_jam_masuk'][$a],
                                    'tanggal_jam_keluar' => $_POST['tanggal_jam_keluar'][$a],
                                    'kirim_eval' => 0,
                                    'status_mess' => $status_mess,
                                    'status_akomodasi' => 0,
                                    'keterangan_akomodasi' => $keterangan_akomodasi,
                                    'tgl_input' => date('Ymd'),
                                );
                                $id_trans_dummy4 = $id_trans4++;
                            } else {
                                if(empty($atas_nama)) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Nama harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($jabatan)) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Jabatan harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($pic)) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['PIC harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['email_eval'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Email Evaluasi harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['jumlah_tiket'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Jumlah tiket harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['tanggal_jam_tiket'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Tanggal dan Jam tiket harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['jumlah_kamar'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Jumlah Kamar harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['tanggal_jam_masuk'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Tanggal dan Jam Masuk harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['tanggal_jam_keluar'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Tanggal dan Jam Keluar harus diisi']);
                                    return redirect()->to("trans_add");
                                }
                            }
                        }
                        //Tiket + Mobil
                        else if ($_POST['pemesanan'][$a] == '4') {
                            //Trans
                            if ($_POST['tamu'][$a] == 'Non Tamu') {
                                if ($_POST['pilih_nama'][$a] == 0) {
                                    $pic = $_POST['pic_select'][$a];
                                } else if ($_POST['pilih_nama'][$a] == 1) {
                                    $pic = $_POST['pic_inputan'][$a];
                                } else {
                                    session()->setFlashdata('warning', ['Silahkan lengkapi data personil terlebih dahulu']);
                                    return redirect()->to('trans_add');
                                }
                            } else {
                                $pic = $_POST['pic_inputan'][$a];
                            }
                            $pic = ucwords($pic);
                            
                            //Tiket
                            $nama_tiket = $_POST['tiket'];
                            $nama_pool = $_POST['gs_tiket'];
                            $keberangkatan = $_POST['keberangkatan'];
                            $pemberhentian = $_POST['pemberhentian'];

                            if ($_POST['pilihan_tiket'][$a] == 0) {
                                session()->setFlashdata('warning', ['Pilih armada transportasi terlebih dahulu']);
                                return redirect()->to('trans_add');
                            } else if ($_POST['pilihan_tiket'][$a] == "Travel") {
                                $id_keberangkatan = null;
                                $id_pemberhentian = null;
                                $dari_tiket = $_POST['keberangkatan'][$a];
                                $tujuan_tiket = $_POST['pemberhentian'][$a];
                            } else {
                                $nama_keberangkatan = substr($keberangkatan[$a], 0, strpos($keberangkatan[$a], " - "));
                                $dari_tiket = substr($keberangkatan[$a], strpos($keberangkatan[$a], " - ")+3);
                                $id_berangkat = $this->m_pemberhentian->where('nama_pemberhentian', $nama_keberangkatan)->select('id_pemberhentian')->findAll();
                                $id_keberangkatan = $id_berangkat[0]['id_pemberhentian'];
                                
                                $nama_pemberhentian = substr($pemberhentian[$a], 0, strpos($pemberhentian[$a], " - "));
                                $tujuan_tiket = substr($pemberhentian[$a], strpos($pemberhentian[$a], " - ")+3);
                                $id_berhenti = $this->m_pemberhentian->where('nama_pemberhentian', $nama_pemberhentian)->select('id_pemberhentian')->findAll();
                                $id_pemberhentian = $id_berhenti[0]['id_pemberhentian'];
                            }

                            if ($_POST['keberangkatan'][$a] == $_POST['pemberhentian'][$a]) {
                                session()->setFlashdata('warning', ['Keberangkatan dan Pemberhentian Tiket tidak boleh sama']);
                                return redirect()->to('trans_add');
                            }

                            if ($_POST['jumlah_tiket'][$a] == 0) {
                                session()->setFlashdata('warning', ['Jumlah tiket tidak boleh 0']);
                                return redirect()->to("trans_add");
                            }

                            $biaya = $_POST['harga_tiket'][$a];
                            $comma = ',';
                            $number = preg_replace('/[^0-9\\-]+/','', $biaya);
                            if ($number == null) {
                                $string = 0;
                            } else {
                                if( strpos($biaya, $comma) !== false ) {
                                    $string = $number/100;
                                } else {
                                    $string = $number;
                                }
                            }
                            
                            $vendor = $this->m_vendor->where('nama_vendor', $nama_tiket[$a])->select('id_vendor')->findAll();
                            if (empty($vendor)) {
                                session()->setFlashdata('warning', ['Tidak ada data Tiket']);
                                return redirect()->to("trans_add");
                            }
                            $pool_tiket = $this->m_pool->where('nama_pool', $nama_pool[$a])->select('id_pool')->findAll();

                            if ($_POST['tamu'][$a] == 'Non Tamu') {
                                if ($_POST['pilih_nama'][$a] == 0) {
                                    $atas_nama = $_POST['nama_select'][$a];
                                    $jabatan = $_POST['jabatan_select'][$a];
                                } else if ($_POST['pilih_nama'][$a] == 1) {
                                    $atas_nama = $_POST['nama_inputan'][$a];
                                    $jabatan = $_POST['jabatan_inputan'][$a];
                                } else {
                                    session()->setFlashdata('warning', ['Silahkan lengkapi data personil terlebih dahulu']);
                                    return redirect()->to('trans_add');
                                }
                            } else {
                                $atas_nama = $_POST['nama_inputan'][$a];
                                $jabatan = $_POST['jabatan_inputan'][$a];
                            }
                            if (empty($atas_nama)) {
                                session()->setFlashdata('warning', ['Nama harus diisi']);
                                return redirect()->to('trans_add');
                            }
                            if (empty($jabatan)) {
                                session()->setFlashdata('warning', ['Jabatan harus diisi']);
                                return redirect()->to('trans_add');
                            }
                            $atas_nama = ucwords($atas_nama);
                            $jabatan = ucwords($jabatan);

                            $pembayaran = $_POST['pembayaran'][$a];
                            if($pembayaran == 'Company Acc'){
                                $pembayaran = 'k';
                            } else if($pembayaran == 'Personal Acc'){
                                $pembayaran = 'p';
                            }

                            $keterangan_tiket = $_POST['keterangan_tiket'][$a];
                            if(empty($keterangan_tiket)){
                                $keterangan_tiket = null;
                            }

                            //Mobil
                            $nama_pool = $_POST['gs_mobil'];
                            $pool_mobil = $this->m_pool->where('nama_pool', $nama_pool[$a])->select('id_pool')->findAll();

                            if ($_POST['tamu'][$a] == 'Non Tamu') {
                                if ($_POST['pilih_nama'][$a] == 0) {
                                    $atas_nama = $_POST['nama_select'][$a];
                                    $jabatan = $_POST['jabatan_select'][$a];
                                } else if ($_POST['pilih_nama'][$a] == 1) {
                                    $atas_nama = $_POST['nama_inputan'][$a];
                                    $jabatan = $_POST['jabatan_inputan'][$a];
                                } else {
                                    session()->setFlashdata('warning', ['Silahkan lengkapi data personil terlebih dahulu']);
                                    return redirect()->to('trans_add');
                                }
                            } else {
                                $atas_nama = $_POST['nama_inputan'][$a];
                                $jabatan = $_POST['jabatan_inputan'][$a];
                            }
                            if (empty($atas_nama)) {
                                session()->setFlashdata('warning', ['Nama harus diisi']);
                                return redirect()->to('trans_add');
                            }
                            if (empty($jabatan)) {
                                session()->setFlashdata('warning', ['Jabatan harus diisi']);
                                return redirect()->to('trans_add');
                            }
                            $atas_nama = ucwords($atas_nama);
                            $jabatan = ucwords($jabatan);

                            $tujuan_mobil = $_POST['tujuan_mobil'][$a];
                            $tujuan_mobil = ucwords($tujuan_mobil);

                            $siap_di = $_POST['siap_di'][$a];
                            $siap_di = ucwords($siap_di);

                            $pembayaran = $_POST['pembayaran'][$a];
                            if($pembayaran == 'Company Acc'){
                                $pembayaran = 'k';
                            } else if($pembayaran == 'Personal Acc'){
                                $pembayaran = 'p';
                            }

                            $jenis_kendaraan = $_POST['jenis_kendaraan'][$a];
                            if($jenis_kendaraan == 'Sedan'){
                                $jenis_kendaraan = 's';
                            } else if($jenis_kendaraan == 'Station'){
                                $jenis_kendaraan = 'a';
                            } else if($jenis_kendaraan == 'Pick Up'){
                                $jenis_kendaraan = 'p';
                            } else if($jenis_kendaraan == 'Box'){
                                $jenis_kendaraan = 'b';
                            } else if($jenis_kendaraan == 'Truck'){
                                $jenis_kendaraan = 't';
                            }
                            
                            $dalkot_lukot = $_POST['dalkot_lukot'][$a];

                            if($dalkot_lukot == 'Dalam Kota'){
                                $dalkot_lukot = 'd';
                                $menginap = 0;
                            } else {
                                $dalkot_lukot = 'l';
                                $menginap = $_POST['menginap'][$a];
                                if($menginap == 'Iya'){
                                    $menginap = '1';
                                } else {
                                    $menginap = '0';
                                }
                            }

                            $keterangan_mobil = $_POST['keterangan_mobil'][$a];
                            if(empty($keterangan_mobil)){
                                $keterangan_mobil = null;
                            }

                            if(!empty($atas_nama) && !empty($jabatan) && !empty($pic) && !empty($_POST['email_eval'][$a]) && !empty($_POST['jumlah_tiket'][$a]) && !empty($_POST['tanggal_jam_tiket'][$a]) && !empty($_POST['jumlah_mobil'][$a]) && !empty($_POST['tujuan_mobil'][$a]) && !empty($_POST['siap_di'][$a]) && !empty($_POST['tanggal_mobil'][$a]) && !empty($_POST['jam_siap'][$a])) {
                                $trans_tt[] = array(
                                    'id_trans' => $id_trans1++,
                                    'id_detail_pengguna' => session()->get('id_detail_pengguna'),
                                    'id_bagian' => session()->get('id_bagian'),
                                    'pemesanan' => $_POST['pemesanan'][$a],
                                    'pic' => $pic,
                                    'tamu' => $_POST['tamu'][$a],
                                    'tgl_input' => date('Ymd'),
                                );

                                $tiket_transportasi_tt[] = array(
                                    'id_trans' => $id_trans2++,
                                    'id_vendor' => $vendor[0]['id_vendor'],
                                    'id_keberangkatan' => $id_keberangkatan,
                                    'id_pemberhentian' => $id_pemberhentian,
                                    'id_pool' => $pool_tiket[0]['id_pool'],
                                    'peminta' => session()->get('nama_pengguna'),
                                    'atas_nama' => $atas_nama,
                                    'jabatan' => $jabatan,
                                    'jumlah_tiket' => $_POST['jumlah_tiket'][$a],
                                    'pembayaran' => $pembayaran,
                                    'harga_tiket' => $string,
                                    'tanggal_jam_tiket' => $_POST['tanggal_jam_tiket'][$a],
                                    'dari_tiket' => $dari_tiket,
                                    'tujuan_tiket' => $tujuan_tiket,
                                    'email_info' => $_POST['email_info'][$a],
                                    'email_eval' => $_POST['email_eval'][$a],
                                    'kirim_eval' => 0,
                                    'keterangan_tiket' => $keterangan_tiket,
                                    'tgl_input' => date('Ymd'),
                                );

                                $transportasi_tiket_tt[] = array(
                                    'id_trans' => $id_trans3++,
                                    'id_pool' => $pool_mobil[0]['id_pool'],
                                    'peminta' => session()->get('nama_pengguna'),
                                    'atas_nama' => $atas_nama,
                                    'jabatan' => $jabatan,
                                    'jumlah_mobil' => $_POST['jumlah_mobil'][$a],
                                    'pembayaran' => $pembayaran,
                                    'jenis_kendaraan' => $jenis_kendaraan,
                                    'dalkot_lukot' => $dalkot_lukot,
                                    'menginap' => $menginap,
                                    'kapasitas' => $_POST['kapasitas'][$a],
                                    'tujuan_mobil' => $tujuan_mobil,
                                    'siap_di' => $siap_di,
                                    'tanggal_mobil' => $_POST['tanggal_mobil'][$a],
                                    'jam_siap' => $_POST['jam_siap'][$a],
                                    'email_info' => $_POST['email_info'][$a],
                                    'email_eval' => $_POST['email_eval'][$a],
                                    'kirim_eval' => 0,
                                    'status_mobil' => 0,
                                    'keterangan_mobil' => $keterangan_mobil,
                                    'tgl_input' => date('Ymd'),
                                );
                                $id_trans_dummy4 = $id_trans4++;
                            } else {
                                if(empty($atas_nama)) {
                                    session()->setFlashdata('warning', ['Nama harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($jabatan)) {
                                    session()->setFlashdata('warning', ['Jabatan harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($pic)) {
                                    session()->setFlashdata('warning', ['PIC harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['email_eval'][$a])) {
                                    session()->setFlashdata('warning', ['Email Evaluasi harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['jumlah_tiket'][$a])) {
                                    session()->setFlashdata('warning', ['Jumlah tiket harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['tanggal_jam_tiket'][$a])) {
                                    session()->setFlashdata('warning', ['Tanggal dan Jam tiket harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if (empty($_POST['jumlah_mobil'][$a])) {
                                    session()->setFlashdata('warning', ['Jumlah Mobil harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['tujuan_mobil'][$a])) {
                                    session()->setFlashdata('warning', ['Tujuan harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['siap_di'][$a])) {
                                    session()->setFlashdata('warning', ['Siap Di harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['tanggal_mobil'][$a])) {
                                    session()->setFlashdata('warning', ['Tanggal harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['jam_siap'][$a])) {
                                    session()->setFlashdata('warning', ['Jam Siap harus diisi']);
                                    return redirect()->to('trans_add');
                                }
                            }
                        }
                        //Hotel + Mobil
                        else if ($_POST['pemesanan'][$a] == '5') {
                            //Trans
                            if ($_POST['tamu'][$a] == 'Non Tamu') {
                                if ($_POST['pilih_nama'][$a] == 0) {
                                    $pic = $_POST['pic_select'][$a];
                                } else if ($_POST['pilih_nama'][$a] == 1) {
                                    $pic = $_POST['pic_inputan'][$a];
                                } else {
                                    session()->setFlashdata('warning', ['Silahkan lengkapi data personil terlebih dahulu']);
                                    return redirect()->to('trans_add');
                                }
                            } else {
                                $pic = $_POST['pic_inputan'][$a];
                            }
                            $pic = ucwords($pic);

                            //Hotel
                            $jumlah_kamar = $_POST['jumlah_kamar'];
                            $nama_pool = $_POST['gs_hotel'];

                            if ($nama_pool[$a] == '2. Pool Jakarta') {
                                $nama_kota = $_POST['kota_jkt'];
                                $nama_akomodasi = $_POST['hotel_jkt'];
                            } else {
                                $nama_kota = $_POST['kota'];
                                $nama_akomodasi = $_POST['hotel'];
                            }

                            $nama_hotel = substr($nama_akomodasi[$a], 0, strpos($nama_akomodasi[$a], " - "));
                            $jenis_kamar = substr($nama_akomodasi[$a], strpos($nama_akomodasi[$a], ' - ') + 3);

                            $pool_hotel = $this->m_pool->where('nama_pool', $nama_pool[$a])->select('id_pool')->findAll();
                            $kota_hotel = $this->m_kota->where('nama_kota', $nama_kota[$a])->select('id_kota')->findAll();
                            $id_hotel = $this->m_hotel->where('nama_hotel', $nama_hotel)->select('id_hotel')->findAll();
                            if (empty($id_hotel)) {
                                session()->setFlashdata('warning', ['Tidak ada data Hotel']);
                                return redirect()->to("trans_add");
                            }
                            $id_detail_hotel = $this->m_detail_hotel->where('id_hotel', $id_hotel[0]['id_hotel'])->where('jenis_kamar', $jenis_kamar)->select('id_detail_hotel')->findAll();

                            $biaya = $_POST['harga_hotel'][$a];
                            $comma = ',';
                            $number = preg_replace('/[^0-9\\-]+/','', $biaya);
                            if ($number == null) {
                                $string = 0;
                            } else {
                                if( strpos($biaya, $comma) !== false ) {
                                    $string = $number/100;
                                } else {
                                    $string = $number;
                                }
                            }

                            if ($_POST['tamu'][$a] == 'Non Tamu') {
                                if ($_POST['pilih_nama'][$a] == 0) {
                                    $atas_nama = $_POST['nama_select'][$a];
                                    $jabatan = $_POST['jabatan_select'][$a];
                                } else if ($_POST['pilih_nama'][$a] == 1) {
                                    $atas_nama = $_POST['nama_inputan'][$a];
                                    $jabatan = $_POST['jabatan_inputan'][$a];
                                } else {
                                    session()->setFlashdata('warning', ['Silahkan lengkapi data personil terlebih dahulu']);
                                    return redirect()->to('trans_add');
                                }
                            } else {
                                $atas_nama = $_POST['nama_inputan'][$a];
                                $jabatan = $_POST['jabatan_inputan'][$a];
                            }
                            if (empty($atas_nama)) {
                                session()->setFlashdata('warning', ['Nama harus diisi']);
                                return redirect()->to('trans_add');
                            }
                            if (empty($jabatan)) {
                                session()->setFlashdata('warning', ['Jabatan harus diisi']);
                                return redirect()->to('trans_add');
                            }
                            $atas_nama = ucwords($atas_nama);
                            $jabatan = ucwords($jabatan);

                            $pembayaran = $_POST['pembayaran'][$a];
                            if($pembayaran == 'Company Acc'){
                                $pembayaran = 'k';
                            } else if($pembayaran == 'Personal Acc'){
                                $pembayaran = 'p';
                            }

                            $keterangan_akomodasi = $_POST['keterangan_akomodasi'][$a];
                            if(empty($keterangan_akomodasi)){
                                $keterangan_akomodasi = null;
                            }

                            //Mobil
                            $nama_pool = $_POST['gs_mobil'];
                            $pool_mobil = $this->m_pool->where('nama_pool', $nama_pool[$a])->select('id_pool')->findAll();

                            if ($_POST['tamu'][$a] == 'Non Tamu') {
                                if ($_POST['pilih_nama'][$a] == 0) {
                                    $atas_nama = $_POST['nama_select'][$a];
                                    $jabatan = $_POST['jabatan_select'][$a];
                                } else if ($_POST['pilih_nama'][$a] == 1) {
                                    $atas_nama = $_POST['nama_inputan'][$a];
                                    $jabatan = $_POST['jabatan_inputan'][$a];
                                } else {
                                    session()->setFlashdata('warning', ['Silahkan lengkapi data personil terlebih dahulu']);
                                    return redirect()->to('trans_add');
                                }
                            } else {
                                $atas_nama = $_POST['nama_inputan'][$a];
                                $jabatan = $_POST['jabatan_inputan'][$a];
                            }
                            if (empty($atas_nama)) {
                                session()->setFlashdata('warning', ['Nama harus diisi']);
                                return redirect()->to('trans_add');
                            }
                            if (empty($jabatan)) {
                                session()->setFlashdata('warning', ['Jabatan harus diisi']);
                                return redirect()->to('trans_add');
                            }
                            $atas_nama = ucwords($atas_nama);
                            $jabatan = ucwords($jabatan);

                            $tujuan_mobil = $_POST['tujuan_mobil'][$a];
                            $tujuan_mobil = ucwords($tujuan_mobil);

                            $siap_di = $_POST['siap_di'][$a];
                            $siap_di = ucwords($siap_di);

                            $pembayaran = $_POST['pembayaran'][$a];
                            if($pembayaran == 'Company Acc'){
                                $pembayaran = 'k';
                            } else if($pembayaran == 'Personal Acc'){
                                $pembayaran = 'p';
                            }

                            $jenis_kendaraan = $_POST['jenis_kendaraan'][$a];
                            if($jenis_kendaraan == 'Sedan'){
                                $jenis_kendaraan = 's';
                            } else if($jenis_kendaraan == 'Station'){
                                $jenis_kendaraan = 'a';
                            } else if($jenis_kendaraan == 'Pick Up'){
                                $jenis_kendaraan = 'p';
                            } else if($jenis_kendaraan == 'Box'){
                                $jenis_kendaraan = 'b';
                            } else if($jenis_kendaraan == 'Truck'){
                                $jenis_kendaraan = 't';
                            }
                            
                            $dalkot_lukot = $_POST['dalkot_lukot'][$a];

                            if($dalkot_lukot == 'Dalam Kota'){
                                $dalkot_lukot = 'd';
                                $menginap = 0;
                            } else {
                                $dalkot_lukot = 'l';
                                $menginap = $_POST['menginap'][$a];
                                if($menginap == 'Iya'){
                                    $menginap = '1';
                                } else {
                                    $menginap = '0';
                                }
                            }

                            $keterangan_mobil = $_POST['keterangan_mobil'][$a];
                            if(empty($keterangan_mobil)){
                                $keterangan_mobil = null;
                            }

                            if ($nama_hotel == "Mess Kx Jkt") {
                                $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                $status_mess = 1;
                                
                                foreach ($mess as $m => $mes) {
                                    if ($mes['terpakai'] == 18) {
                                        session()->setFlashdata('warning', ['Mess Kx Jkt sudah penuh']);
                                        return redirect()->to("trans_add");
                                    } else {
                                        $terpakai = [
                                            'id_mess' => 8,
                                            'terpakai' => $mes['terpakai'] + $jumlah_kamar[$a],
                                            'edited_at' => $timestamp,
                                        ];
                                        // $this->m_mess->save($terpakai);
                                    }
                                }
                            } else {
                                $status_mess = 0;
                            }

                            if(!empty($atas_nama) && !empty($jabatan) && !empty($pic) && !empty($_POST['email_eval'][$a]) && !empty($_POST['jumlah_kamar'][$a]) && !empty($_POST['tanggal_jam_masuk'][$a]) && !empty($_POST['tanggal_jam_keluar'][$a]) && !empty($_POST['jumlah_mobil'][$a]) && !empty($_POST['tujuan_mobil'][$a]) && !empty($_POST['siap_di'][$a]) && !empty($_POST['tanggal_mobil'][$a]) && !empty($_POST['jam_siap'][$a])) {
                                $trans_at[] = array(
                                    'id_trans' => $id_trans1++,
                                    'id_detail_pengguna' => session()->get('id_detail_pengguna'),
                                    'id_bagian' => session()->get('id_bagian'),
                                    'pemesanan' => $_POST['pemesanan'][$a],
                                    'pic' => $pic,
                                    'tamu' => $_POST['tamu'][$a],
                                    'tgl_input' => date('Ymd'),
                                );

                                $akomodasi_transportasi_at[] = array(
                                    'id_trans' => $id_trans2++,
                                    'id_hotel' => $id_hotel[0]['id_hotel'],
                                    'id_detail_hotel' => $id_detail_hotel[0]['id_detail_hotel'],
                                    'id_pool' => $pool_hotel[0]['id_pool'],
                                    'id_kota' => $kota_hotel[0]['id_kota'],
                                    'peminta' => session()->get('nama_pengguna'),
                                    'atas_nama' => $atas_nama,
                                    'jabatan' => $jabatan,
                                    'type' => $_POST['type'][$a],
                                    'jumlah_kamar' => $_POST['jumlah_kamar'][$a],
                                    'pembayaran' => $pembayaran,
                                    'harga_akomodasi' => $string,
                                    'email_info' => $_POST['email_info'][$a],
                                    'email_eval' => $_POST['email_eval'][$a],
                                    'tanggal_jam_masuk' => $_POST['tanggal_jam_masuk'][$a],
                                    'tanggal_jam_keluar' => $_POST['tanggal_jam_keluar'][$a],
                                    'kirim_eval' => 0,
                                    'status_mess' => $status_mess,
                                    'status_akomodasi' => 0,
                                    'keterangan_akomodasi' => $keterangan_akomodasi,
                                    'tgl_input' => date('Ymd'),
                                );

                                $transportasi_akomodasi_at[] = array(
                                    'id_trans' => $id_trans3++,
                                    'id_pool' => $pool_mobil[0]['id_pool'],
                                    'peminta' => session()->get('nama_pengguna'),
                                    'atas_nama' => $atas_nama,
                                    'jabatan' => $jabatan,
                                    'jumlah_mobil' => $_POST['jumlah_mobil'][$a],
                                    'pembayaran' => $pembayaran,
                                    'jenis_kendaraan' => $jenis_kendaraan,
                                    'dalkot_lukot' => $dalkot_lukot,
                                    'menginap' => $menginap,
                                    'kapasitas' => $_POST['kapasitas'][$a],
                                    'tujuan_mobil' => $tujuan_mobil,
                                    'siap_di' => $siap_di,
                                    'tanggal_mobil' => $_POST['tanggal_mobil'][$a],
                                    'jam_siap' => $_POST['jam_siap'][$a],
                                    'email_info' => $_POST['email_info'][$a],
                                    'email_eval' => $_POST['email_eval'][$a],
                                    'kirim_eval' => 0,
                                    'status_mobil' => 0,
                                    'keterangan_mobil' => $keterangan_mobil,
                                    'tgl_input' => date('Ymd'),
                                );
                                $id_trans_dummy4 = $id_trans4++;
                            } else {
                                if(empty($atas_nama)) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Nama harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($jabatan)) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Jabatan harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($pic)) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['PIC harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['email_eval'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Email Evaluasi harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['jumlah_kamar'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Jumlah Kamar harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['tanggal_jam_masuk'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Tanggal dan Jam Masuk harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['tanggal_jam_keluar'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Tanggal dan Jam Keluar harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if (empty($_POST['jumlah_mobil'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Jumlah Mobil harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['tujuan_mobil'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Tujuan harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['siap_di'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Siap Di harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['tanggal_mobil'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Tanggal harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['jam_siap'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Jam Siap harus diisi']);
                                    return redirect()->to('trans_add');
                                }
                            }
                        }
                        //Tiket + Hotel + Mobil
                        else if ($_POST['pemesanan'][$a] == '6') {
                            //Trans
                            if ($_POST['tamu'][$a] == 'Non Tamu') {
                                if ($_POST['pilih_nama'][$a] == 0) {
                                    $pic = $_POST['pic_select'][$a];
                                } else if ($_POST['pilih_nama'][$a] == 1) {
                                    $pic = $_POST['pic_inputan'][$a];
                                } else {
                                    session()->setFlashdata('warning', ['Silahkan lengkapi data personil terlebih dahulu']);
                                    return redirect()->to('trans_add');
                                }
                            } else {
                                $pic = $_POST['pic_inputan'][$a];
                            }
                            $pic = ucwords($pic);
                            
                            //Tiket
                            $nama_tiket = $_POST['tiket'];
                            $nama_pool = $_POST['gs_tiket'];
                            $keberangkatan = $_POST['keberangkatan'];
                            $pemberhentian = $_POST['pemberhentian'];

                            if ($_POST['pilihan_tiket'][$a] == 0) {
                                session()->setFlashdata('warning', ['Pilih armada transportasi terlebih dahulu']);
                                return redirect()->to('trans_add');
                            } else if ($_POST['pilihan_tiket'][$a] == "Travel") {
                                $id_keberangkatan = null;
                                $id_pemberhentian = null;
                                $dari_tiket = $_POST['keberangkatan'][$a];
                                $tujuan_tiket = $_POST['pemberhentian'][$a];
                            } else {
                                $nama_keberangkatan = substr($keberangkatan[$a], 0, strpos($keberangkatan[$a], " - "));
                                $dari_tiket = substr($keberangkatan[$a], strpos($keberangkatan[$a], " - ")+3);
                                $id_berangkat = $this->m_pemberhentian->where('nama_pemberhentian', $nama_keberangkatan)->select('id_pemberhentian')->findAll();
                                $id_keberangkatan = $id_berangkat[0]['id_pemberhentian'];
                                
                                $nama_pemberhentian = substr($pemberhentian[$a], 0, strpos($pemberhentian[$a], " - "));
                                $tujuan_tiket = substr($pemberhentian[$a], strpos($pemberhentian[$a], " - ")+3);
                                $id_berhenti = $this->m_pemberhentian->where('nama_pemberhentian', $nama_pemberhentian)->select('id_pemberhentian')->findAll();
                                $id_pemberhentian = $id_berhenti[0]['id_pemberhentian'];
                            }

                            if ($_POST['keberangkatan'][$a] == $_POST['pemberhentian'][$a]) {
                                session()->setFlashdata('warning', ['Keberangkatan dan Pemberhentian Tiket tidak boleh sama']);
                                return redirect()->to('trans_add');
                            }

                            if ($_POST['jumlah_tiket'][$a] == 0) {
                                session()->setFlashdata('warning', ['Jumlah tiket tidak boleh 0']);
                                return redirect()->to("trans_add");
                            }

                            $biaya = $_POST['harga_tiket'][$a];
                            $comma = ',';
                            $number = preg_replace('/[^0-9\\-]+/','', $biaya);
                            if ($number == null) {
                                $string = 0;
                            } else {
                                if( strpos($biaya, $comma) !== false ) {
                                    $string = $number/100;
                                } else {
                                    $string = $number;
                                }
                            }
                            
                            $vendor = $this->m_vendor->where('nama_vendor', $nama_tiket[$a])->select('id_vendor')->findAll();
                            if (empty($vendor)) {
                                session()->setFlashdata('warning', ['Tidak ada data Tiket']);
                                return redirect()->to("trans_add");
                            }
                            $pool_tiket = $this->m_pool->where('nama_pool', $nama_pool[$a])->select('id_pool')->findAll();

                            if ($_POST['tamu'][$a] == 'Non Tamu') {
                                if ($_POST['pilih_nama'][$a] == 0) {
                                    $atas_nama = $_POST['nama_select'][$a];
                                    $jabatan = $_POST['jabatan_select'][$a];
                                } else if ($_POST['pilih_nama'][$a] == 1) {
                                    $atas_nama = $_POST['nama_inputan'][$a];
                                    $jabatan = $_POST['jabatan_inputan'][$a];
                                } else {
                                    session()->setFlashdata('warning', ['Silahkan lengkapi data personil terlebih dahulu']);
                                    return redirect()->to('trans_add');
                                }
                            } else {
                                $atas_nama = $_POST['nama_inputan'][$a];
                                $jabatan = $_POST['jabatan_inputan'][$a];
                            }
                            if (empty($atas_nama)) {
                                session()->setFlashdata('warning', ['Nama harus diisi']);
                                return redirect()->to('trans_add');
                            }
                            if (empty($jabatan)) {
                                session()->setFlashdata('warning', ['Jabatan harus diisi']);
                                return redirect()->to('trans_add');
                            }
                            $atas_nama = ucwords($atas_nama);
                            $jabatan = ucwords($jabatan);

                            $pembayaran = $_POST['pembayaran'][$a];
                            if($pembayaran == 'Company Acc'){
                                $pembayaran = 'k';
                            } else if($pembayaran == 'Personal Acc'){
                                $pembayaran = 'p';
                            }

                            $keterangan_tiket = $_POST['keterangan_tiket'][$a];
                            if(empty($keterangan_tiket)){
                                $keterangan_tiket = null;
                            }

                            //Hotel
                            $jumlah_kamar = $_POST['jumlah_kamar'];
                            $nama_pool = $_POST['gs_hotel'];

                            if ($nama_pool[$a] == '2. Pool Jakarta') {
                                $nama_kota = $_POST['kota_jkt'];
                                $nama_akomodasi = $_POST['hotel_jkt'];
                            } else {
                                $nama_kota = $_POST['kota'];
                                $nama_akomodasi = $_POST['hotel'];
                            }

                            $nama_hotel = substr($nama_akomodasi[$a], 0, strpos($nama_akomodasi[$a], " - "));
                            $jenis_kamar = substr($nama_akomodasi[$a], strpos($nama_akomodasi[$a], ' - ') + 3);

                            $pool_hotel = $this->m_pool->where('nama_pool', $nama_pool[$a])->select('id_pool')->findAll();
                            $kota_hotel = $this->m_kota->where('nama_kota', $nama_kota[$a])->select('id_kota')->findAll();
                            $id_hotel = $this->m_hotel->where('nama_hotel', $nama_hotel)->select('id_hotel')->findAll();
                            if (empty($id_hotel)) {
                                session()->setFlashdata('warning', ['Tidak ada data Hotel']);
                                return redirect()->to("trans_add");
                            }
                            $id_detail_hotel = $this->m_detail_hotel->where('id_hotel', $id_hotel[0]['id_hotel'])->where('jenis_kamar', $jenis_kamar)->select('id_detail_hotel')->findAll();

                            $biaya = $_POST['harga_hotel'][$a];
                            $comma = ',';
                            $number = preg_replace('/[^0-9\\-]+/','', $biaya);
                            if ($number == null) {
                                $string = 0;
                            } else {
                                if( strpos($biaya, $comma) !== false ) {
                                    $string = $number/100;
                                } else {
                                    $string = $number;
                                }
                            }

                            if ($_POST['tamu'][$a] == 'Non Tamu') {
                                if ($_POST['pilih_nama'][$a] == 0) {
                                    $atas_nama = $_POST['nama_select'][$a];
                                    $jabatan = $_POST['jabatan_select'][$a];
                                } else if ($_POST['pilih_nama'][$a] == 1) {
                                    $atas_nama = $_POST['nama_inputan'][$a];
                                    $jabatan = $_POST['jabatan_inputan'][$a];
                                } else {
                                    session()->setFlashdata('warning', ['Silahkan lengkapi data personil terlebih dahulu']);
                                    return redirect()->to('trans_add');
                                }
                            } else {
                                $atas_nama = $_POST['nama_inputan'][$a];
                                $jabatan = $_POST['jabatan_inputan'][$a];
                            }
                            if (empty($atas_nama)) {
                                session()->setFlashdata('warning', ['Nama harus diisi']);
                                return redirect()->to('trans_add');
                            }
                            if (empty($jabatan)) {
                                session()->setFlashdata('warning', ['Jabatan harus diisi']);
                                return redirect()->to('trans_add');
                            }
                            $atas_nama = ucwords($atas_nama);
                            $jabatan = ucwords($jabatan);

                            $pembayaran = $_POST['pembayaran'][$a];
                            if($pembayaran == 'Company Acc'){
                                $pembayaran = 'k';
                            } else if($pembayaran == 'Personal Acc'){
                                $pembayaran = 'p';
                            }

                            $keterangan_akomodasi = $_POST['keterangan_akomodasi'][$a];
                            if(empty($keterangan_akomodasi)){
                                $keterangan_akomodasi = null;
                            }

                            //Mobil
                            $nama_pool = $_POST['gs_mobil'];
                            $pool_mobil = $this->m_pool->where('nama_pool', $nama_pool[$a])->select('id_pool')->findAll();

                            if ($_POST['tamu'][$a] == 'Non Tamu') {
                                if ($_POST['pilih_nama'][$a] == 0) {
                                    $atas_nama = $_POST['nama_select'][$a];
                                    $jabatan = $_POST['jabatan_select'][$a];
                                } else if ($_POST['pilih_nama'][$a] == 1) {
                                    $atas_nama = $_POST['nama_inputan'][$a];
                                    $jabatan = $_POST['jabatan_inputan'][$a];
                                } else {
                                    session()->setFlashdata('warning', ['Silahkan lengkapi data personil terlebih dahulu']);
                                    return redirect()->to('trans_add');
                                }
                            } else {
                                $atas_nama = $_POST['nama_inputan'][$a];
                                $jabatan = $_POST['jabatan_inputan'][$a];
                            }
                            if (empty($atas_nama)) {
                                session()->setFlashdata('warning', ['Nama harus diisi']);
                                return redirect()->to('trans_add');
                            }
                            if (empty($jabatan)) {
                                session()->setFlashdata('warning', ['Jabatan harus diisi']);
                                return redirect()->to('trans_add');
                            }
                            $atas_nama = ucwords($atas_nama);
                            $jabatan = ucwords($jabatan);

                            $tujuan_mobil = $_POST['tujuan_mobil'][$a];
                            $tujuan_mobil = ucwords($tujuan_mobil);

                            $siap_di = $_POST['siap_di'][$a];
                            $siap_di = ucwords($siap_di);

                            $pembayaran = $_POST['pembayaran'][$a];
                            if($pembayaran == 'Company Acc'){
                                $pembayaran = 'k';
                            } else if($pembayaran == 'Personal Acc'){
                                $pembayaran = 'p';
                            }

                            $jenis_kendaraan = $_POST['jenis_kendaraan'][$a];
                            if($jenis_kendaraan == 'Sedan'){
                                $jenis_kendaraan = 's';
                            } else if($jenis_kendaraan == 'Station'){
                                $jenis_kendaraan = 'a';
                            } else if($jenis_kendaraan == 'Pick Up'){
                                $jenis_kendaraan = 'p';
                            } else if($jenis_kendaraan == 'Box'){
                                $jenis_kendaraan = 'b';
                            } else if($jenis_kendaraan == 'Truck'){
                                $jenis_kendaraan = 't';
                            }
                            
                            $dalkot_lukot = $_POST['dalkot_lukot'][$a];

                            if($dalkot_lukot == 'Dalam Kota'){
                                $dalkot_lukot = 'd';
                                $menginap = 0;
                            } else {
                                $dalkot_lukot = 'l';
                                $menginap = $_POST['menginap'][$a];
                                if($menginap == 'Iya'){
                                    $menginap = '1';
                                } else {
                                    $menginap = '0';
                                }
                            }

                            $keterangan_mobil = $_POST['keterangan_mobil'][$a];
                            if(empty($keterangan_mobil)){
                                $keterangan_mobil = null;
                            }

                            if ($nama_hotel == "Mess Kx Jkt") {
                                $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                $status_mess = 1;
                                
                                foreach ($mess as $m => $mes) {
                                    if ($mes['terpakai'] == 18) {
                                        session()->setFlashdata('warning', ['Mess Kx Jkt sudah penuh']);
                                        return redirect()->to("trans_add");
                                    } else {
                                        $terpakai = [
                                            'id_mess' => 8,
                                            'terpakai' => $mes['terpakai'] + $jumlah_kamar[$a],
                                            'edited_at' => $timestamp,
                                        ];
                                        // $this->m_mess->save($terpakai);
                                    }
                                }
                            } else {
                                $status_mess = 0;
                            }

                            if(!empty($atas_nama) && !empty($jabatan) && !empty($pic) && !empty($_POST['email_eval'][$a]) && !empty($_POST['jumlah_tiket'][$a]) && !empty($_POST['tanggal_jam_tiket'][$a]) && !empty($_POST['jumlah_kamar'][$a]) && !empty($_POST['tanggal_jam_masuk'][$a]) && !empty($_POST['tanggal_jam_keluar'][$a]) && !empty($_POST['jumlah_mobil'][$a]) && !empty($_POST['tujuan_mobil'][$a]) && !empty($_POST['siap_di'][$a]) && !empty($_POST['tanggal_mobil'][$a]) && !empty($_POST['jam_siap'][$a])) {
                                $trans_tat[] = array(
                                    'id_trans' => $id_trans1++,
                                    'id_detail_pengguna' => session()->get('id_detail_pengguna'),
                                    'id_bagian' => session()->get('id_bagian'),
                                    'pemesanan' => $_POST['pemesanan'][$a],
                                    'pic' => $pic,
                                    'tamu' => $_POST['tamu'][$a],
                                    'tgl_input' => date('Ymd'),
                                );

                                $tiket_akomodasi_transportasi[] = array(
                                    'id_trans' => $id_trans2++,
                                    'id_vendor' => $vendor[0]['id_vendor'],
                                    'id_keberangkatan' => $id_keberangkatan,
                                    'id_pemberhentian' => $id_pemberhentian,
                                    'id_pool' => $pool_tiket[0]['id_pool'],
                                    'peminta' => session()->get('nama_pengguna'),
                                    'atas_nama' => $atas_nama,
                                    'jabatan' => $jabatan,
                                    'jumlah_tiket' => $_POST['jumlah_tiket'][$a],
                                    'pembayaran' => $pembayaran,
                                    'harga_tiket' => $string,
                                    'tanggal_jam_tiket' => $_POST['tanggal_jam_tiket'][$a],
                                    'dari_tiket' => $dari_tiket,
                                    'tujuan_tiket' => $tujuan_tiket,
                                    'email_info' => $_POST['email_info'][$a],
                                    'email_eval' => $_POST['email_eval'][$a],
                                    'kirim_eval' => 0,
                                    'keterangan_tiket' => $keterangan_tiket,
                                    'tgl_input' => date('Ymd'),
                                );

                                $akomodasi_tiket_transportasi[] = array(
                                    'id_trans' => $id_trans3++,
                                    'id_hotel' => $id_hotel[0]['id_hotel'],
                                    'id_detail_hotel' => $id_detail_hotel[0]['id_detail_hotel'],
                                    'id_pool' => $pool_hotel[0]['id_pool'],
                                    'id_kota' => $kota_hotel[0]['id_kota'],
                                    'peminta' => session()->get('nama_pengguna'),
                                    'atas_nama' => $atas_nama,
                                    'jabatan' => $jabatan,
                                    'type' => $_POST['type'][$a],
                                    'jumlah_kamar' => $_POST['jumlah_kamar'][$a],
                                    'pembayaran' => $pembayaran,
                                    'harga_akomodasi' => $string,
                                    'email_info' => $_POST['email_info'][$a],
                                    'email_eval' => $_POST['email_eval'][$a],
                                    'tanggal_jam_masuk' => $_POST['tanggal_jam_masuk'][$a],
                                    'tanggal_jam_keluar' => $_POST['tanggal_jam_keluar'][$a],
                                    'kirim_eval' => 0,
                                    'status_mess' => $status_mess,
                                    'status_akomodasi' => 0,
                                    'keterangan_akomodasi' => $keterangan_akomodasi,
                                    'tgl_input' => date('Ymd'),
                                );

                                $transportasi_tiket_akomodasi[] = array(
                                    'id_trans' => $id_trans4++,
                                    'id_pool' => $pool_mobil[0]['id_pool'],
                                    'peminta' => session()->get('nama_pengguna'),
                                    'atas_nama' => $atas_nama,
                                    'jabatan' => $jabatan,
                                    'jumlah_mobil' => $_POST['jumlah_mobil'][$a],
                                    'pembayaran' => $pembayaran,
                                    'jenis_kendaraan' => $jenis_kendaraan,
                                    'dalkot_lukot' => $dalkot_lukot,
                                    'menginap' => $menginap,
                                    'kapasitas' => $_POST['kapasitas'][$a],
                                    'tujuan_mobil' => $tujuan_mobil,
                                    'siap_di' => $siap_di,
                                    'tanggal_mobil' => $_POST['tanggal_mobil'][$a],
                                    'jam_siap' => $_POST['jam_siap'][$a],
                                    'email_info' => $_POST['email_info'][$a],
                                    'email_eval' => $_POST['email_eval'][$a],
                                    'kirim_eval' => 0,
                                    'status_mobil' => 0,
                                    'keterangan_mobil' => $keterangan_mobil,
                                    'tgl_input' => date('Ymd'),
                                );
                            } else {
                                if(empty($atas_nama)) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Nama harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($jabatan)) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Jabatan harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($pic)) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['PIC harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['email_eval'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Email Evaluasi harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['jumlah_tiket'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Jumlah tiket harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['tanggal_jam_tiket'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Tanggal dan Jam tiket harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['jumlah_kamar'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Jumlah Kamar harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['tanggal_jam_masuk'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Tanggal dan Jam Masuk harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if(empty($_POST['tanggal_jam_keluar'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Tanggal dan Jam Keluar harus diisi']);
                                    return redirect()->to("trans_add");
                                } else if (empty($_POST['jumlah_mobil'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Jumlah Mobil harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['tujuan_mobil'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Tujuan harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['siap_di'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Siap Di harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['tanggal_mobil'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Tanggal harus diisi']);
                                    return redirect()->to('trans_add');
                                } else if (empty($_POST['jam_siap'][$a])) {
                                    if ($nama_hotel == "Mess Kx Jkt") {
                                        $mess = $this->m_mess->where('nama_kamar', 'mess')->select('kapasitas_kamar, terpakai')->findAll();
                                        
                                        foreach ($mess as $m => $mes) {
                                            if ($mes['terpakai'] == 0) {
                                                
                                            } else {
                                                $terpakai = [
                                                    'id_mess' => 8,
                                                    'terpakai' => $mes['terpakai'] - $jumlah_kamar[$a],
                                                    'edited_at' => $timestamp,
                                                ];
                                                $this->m_mess->save($terpakai);
                                            }
                                        }
                                    }
                                    session()->setFlashdata('warning', ['Jam Siap harus diisi']);
                                    return redirect()->to('trans_add');
                                }
                            }
                        }
                    }

                    //Tiket
                    if (empty($trans_tik) && empty($tiket)) {
                        
                    } else {
                        // $this->m_trans->insertBatch($trans_tik);
                        // $this->m_tiket->insertBatch($tiket);
                        d($trans_tik);
                        d($tiket);
                        // $email_info = $_POST['email_info'];
                        // $email_pengguna_info = $this->m_pengguna->whereIn('nama_pengguna', $email_info)->select('email_pengguna')->findAll();

                        // try {
                        //     //Server settings
                        //     // $mail->SMTPDebug = SMTP::DEBUG_SERVER;
                        //     $mail->isSMTP();
                        //     $mail->Host       = 'mail.konimex.com';
                        //     $mail->SMTPAuth   = true;
                        //     $mail->Username   = PDLN_EMAIL;
                        //     $mail->Password   = PDLN_PASS;
                        //     $mail->SMTPSecure = PHPMailer::ENCRYPTION_STARTTLS;
                        //     $mail->Port       = 587;
                        
                        //     //Recipients
                        //     $mail->setFrom('noreply@konimex.com');

                        //     foreach ($email_pengguna_info as $e => $ema) {
                        //         $mail->addAddress($ema['email_pengguna']);//Add a recipient
                        //     }
                        
                        //     //Content
                        //     // $link='https://konimex.com:447/pdln/listpb/pb/'.$id_transaksi;
                        //     $mail->Subject = 'Tes Program TABS (Bimo)';
                        //     $mail->Body    = nl2br("Tes kirim email harap diabaikan saja terima kasih.");
                        //     // $mail->Body    = nl2br("User bagian (").$niknmuser['niknm']."/".$nikuser['nik']."/".$nikuser['strorgnm'].(") telah selesai mengisi data PB, silahkan periksa data PB dengan cara klik link: $link");
                        
                        //     $mail->send();
                        //     // echo 'Message has been sent';
                        // } catch (Exception $e) {
                        //     echo "Message could not be sent. Mailer Error: {$mail->ErrorInfo}";
                        // }
                    }
                    
                    //Hotel
                    if (empty($trans_ako) && empty($akomodasi)) {
                        
                    } else {
                        $this->m_trans->insertBatch($trans_ako);
                        $this->m_akomodasi->insertBatch($akomodasi);
                        // d($trans_ako);
                        // d($akomodasi);
                        // $email_info = $_POST['email_info'];
                        // $email_pengguna_info = $this->m_pengguna->whereIn('nama_pengguna', $email_info)->select('email_pengguna')->findAll();

                        // try {
                        //     //Server settings
                        //     // $mail->SMTPDebug = SMTP::DEBUG_SERVER;
                        //     $mail->isSMTP();
                        //     $mail->Host       = 'mail.konimex.com';
                        //     $mail->SMTPAuth   = true;
                        //     $mail->Username   = PDLN_EMAIL;
                        //     $mail->Password   = PDLN_PASS;
                        //     $mail->SMTPSecure = PHPMailer::ENCRYPTION_STARTTLS;
                        //     $mail->Port       = 587;
                        
                        //     //Recipients
                        //     $mail->setFrom('noreply@konimex.com');

                        //     foreach ($email_pengguna_info as $e => $ema) {
                        //         $mail->addAddress($ema['email_pengguna']);//Add a recipient
                        //     }
                        
                        //     //Content
                        //     // $link='https://konimex.com:447/pdln/listpb/pb/'.$id_transaksi;
                        //     $mail->Subject = 'Tes Program TABS (Bimo)';
                        //     $mail->Body    = nl2br("Tes kirim email harap diabaikan saja terima kasih.");
                        //     // $mail->Body    = nl2br("User bagian (").$niknmuser['niknm']."/".$nikuser['nik']."/".$nikuser['strorgnm'].(") telah selesai mengisi data PB, silahkan periksa data PB dengan cara klik link: $link");
                        
                        //     $mail->send();
                        //     // echo 'Message has been sent';
                        // } catch (Exception $e) {
                        //     echo "Message could not be sent. Mailer Error: {$mail->ErrorInfo}";
                        // }
                    }

                    //Mobil
                    if (empty($trans_tra) && empty($transportasi)) {
                        
                    } else {
                        $this->m_trans->insertBatch($trans_tra);
                        $this->m_transportasi->insertBatch($transportasi);
                        // d($trans_tra);
                        // d($transportasi);
                        // $email_info = $_POST['email_info'];
                        // $email_pengguna_info = $this->m_pengguna->whereIn('nama_pengguna', $email_info)->select('email_pengguna')->findAll();

                        // try {
                        //     //Server settings
                        //     // $mail->SMTPDebug = SMTP::DEBUG_SERVER;
                        //     $mail->isSMTP();
                        //     $mail->Host       = 'mail.konimex.com';
                        //     $mail->SMTPAuth   = true;
                        //     $mail->Username   = PDLN_EMAIL;
                        //     $mail->Password   = PDLN_PASS;
                        //     $mail->SMTPSecure = PHPMailer::ENCRYPTION_STARTTLS;
                        //     $mail->Port       = 587;
                        
                        //     //Recipients
                        //     $mail->setFrom('noreply@konimex.com');

                        //     foreach ($email_pengguna_info as $e => $ema) {
                        //         $mail->addAddress($ema['email_pengguna']);//Add a recipient
                        //     }
                        
                        //     //Content
                        //     // $link='https://konimex.com:447/pdln/listpb/pb/'.$id_transaksi;
                        //     $mail->Subject = 'Tes Program TABS (Bimo)';
                        //     $mail->Body    = nl2br("Tes kirim email harap diabaikan saja terima kasih.");
                        //     // $mail->Body    = nl2br("User bagian (").$niknmuser['niknm']."/".$nikuser['nik']."/".$nikuser['strorgnm'].(") telah selesai mengisi data PB, silahkan periksa data PB dengan cara klik link: $link");
                        
                        //     $mail->send();
                        //     // echo 'Message has been sent';
                        // } catch (Exception $e) {
                        //     echo "Message could not be sent. Mailer Error: {$mail->ErrorInfo}";
                        // }
                    }

                    //Tiket + Hotel
                    if (empty($trans_ta) && empty($tiket_akomodasi_ta) && empty($akomodasi_tiket_ta)) {
                        
                    } else {
                        $this->m_trans->insertBatch($trans_ta);
                        $this->m_tiket->insertBatch($tiket_akomodasi_ta);
                        $this->m_akomodasi->insertBatch($akomodasi_tiket_ta);
                        // d($trans_ta);
                        // d($tiket_akomodasi_ta);
                        // d($akomodasi_tiket_ta);
                        // $email_info = $_POST['email_info'];
                        // $email_pengguna_info = $this->m_pengguna->whereIn('nama_pengguna', $email_info)->select('email_pengguna')->findAll();

                        // try {
                        //     //Server settings
                        //     // $mail->SMTPDebug = SMTP::DEBUG_SERVER;
                        //     $mail->isSMTP();
                        //     $mail->Host       = 'mail.konimex.com';
                        //     $mail->SMTPAuth   = true;
                        //     $mail->Username   = PDLN_EMAIL;
                        //     $mail->Password   = PDLN_PASS;
                        //     $mail->SMTPSecure = PHPMailer::ENCRYPTION_STARTTLS;
                        //     $mail->Port       = 587;
                        
                        //     //Recipients
                        //     $mail->setFrom('noreply@konimex.com');

                        //     foreach ($email_pengguna_info as $e => $ema) {
                        //         $mail->addAddress($ema['email_pengguna']);//Add a recipient
                        //     }
                        
                        //     //Content
                        //     // $link='https://konimex.com:447/pdln/listpb/pb/'.$id_transaksi;
                        //     $mail->Subject = 'Tes Program TABS (Bimo)';
                        //     $mail->Body    = nl2br("Tes kirim email harap diabaikan saja terima kasih.");
                        //     // $mail->Body    = nl2br("User bagian (").$niknmuser['niknm']."/".$nikuser['nik']."/".$nikuser['strorgnm'].(") telah selesai mengisi data PB, silahkan periksa data PB dengan cara klik link: $link");
                        
                        //     $mail->send();
                        //     // echo 'Message has been sent';
                        // } catch (Exception $e) {
                        //     echo "Message could not be sent. Mailer Error: {$mail->ErrorInfo}";
                        // }
                    }

                    //Tiket + Mobil
                    if (empty($trans_tt) && empty($tiket_transportasi_tt) && empty($transportasi_tiket_tt)) {
                        
                    } else {
                        $this->m_trans->insertBatch($trans_tt);
                        $this->m_tiket->insertBatch($tiket_transportasi_tt);
                        $this->m_transportasi->insertBatch($transportasi_tiket_tt);
                        // d($trans_tt);
                        // d($tiket_transportasi_tt);
                        // d($transportasi_tiket_tt);
                        // $email_info = $_POST['email_info'];
                        // $email_pengguna_info = $this->m_pengguna->whereIn('nama_pengguna', $email_info)->select('email_pengguna')->findAll();

                        // try {
                        //     //Server settings
                        //     // $mail->SMTPDebug = SMTP::DEBUG_SERVER;
                        //     $mail->isSMTP();
                        //     $mail->Host       = 'mail.konimex.com';
                        //     $mail->SMTPAuth   = true;
                        //     $mail->Username   = PDLN_EMAIL;
                        //     $mail->Password   = PDLN_PASS;
                        //     $mail->SMTPSecure = PHPMailer::ENCRYPTION_STARTTLS;
                        //     $mail->Port       = 587;
                        
                        //     //Recipients
                        //     $mail->setFrom('noreply@konimex.com');

                        //     foreach ($email_pengguna_info as $e => $ema) {
                        //         $mail->addAddress($ema['email_pengguna']);//Add a recipient
                        //     }
                        
                        //     //Content
                        //     // $link='https://konimex.com:447/pdln/listpb/pb/'.$id_transaksi;
                        //     $mail->Subject = 'Tes Program TABS (Bimo)';
                        //     $mail->Body    = nl2br("Tes kirim email harap diabaikan saja terima kasih.");
                        //     // $mail->Body    = nl2br("User bagian (").$niknmuser['niknm']."/".$nikuser['nik']."/".$nikuser['strorgnm'].(") telah selesai mengisi data PB, silahkan periksa data PB dengan cara klik link: $link");
                        
                        //     $mail->send();
                        //     // echo 'Message has been sent';
                        // } catch (Exception $e) {
                        //     echo "Message could not be sent. Mailer Error: {$mail->ErrorInfo}";
                        // }
                    }

                    //Hotel + Mobil
                    if (empty($trans_at) && empty($akomodasi_transportasi_at) && empty($transportasi_akomodasi_at)) {
                        
                    } else {
                        $this->m_trans->insertBatch($trans_at);
                        $this->m_akomodasi->insertBatch($akomodasi_transportasi_at);
                        $this->m_transportasi->insertBatch($transportasi_akomodasi_at);
                        // d($trans_at);
                        // d($akomodasi_transportasi_at);
                        // d($transportasi_akomodasi_at);
                        // $email_info = $_POST['email_info'];
                        // $email_pengguna_info = $this->m_pengguna->whereIn('nama_pengguna', $email_info)->select('email_pengguna')->findAll();

                        // try {
                        //     //Server settings
                        //     // $mail->SMTPDebug = SMTP::DEBUG_SERVER;
                        //     $mail->isSMTP();
                        //     $mail->Host       = 'mail.konimex.com';
                        //     $mail->SMTPAuth   = true;
                        //     $mail->Username   = PDLN_EMAIL;
                        //     $mail->Password   = PDLN_PASS;
                        //     $mail->SMTPSecure = PHPMailer::ENCRYPTION_STARTTLS;
                        //     $mail->Port       = 587;
                        
                        //     //Recipients
                        //     $mail->setFrom('noreply@konimex.com');

                        //     foreach ($email_pengguna_info as $e => $ema) {
                        //         $mail->addAddress($ema['email_pengguna']);//Add a recipient
                        //     }
                        
                        //     //Content
                        //     // $link='https://konimex.com:447/pdln/listpb/pb/'.$id_transaksi;
                        //     $mail->Subject = 'Tes Program TABS (Bimo)';
                        //     $mail->Body    = nl2br("Tes kirim email harap diabaikan saja terima kasih.");
                        //     // $mail->Body    = nl2br("User bagian (").$niknmuser['niknm']."/".$nikuser['nik']."/".$nikuser['strorgnm'].(") telah selesai mengisi data PB, silahkan periksa data PB dengan cara klik link: $link");
                        
                        //     $mail->send();
                        //     // echo 'Message has been sent';
                        // } catch (Exception $e) {
                        //     echo "Message could not be sent. Mailer Error: {$mail->ErrorInfo}";
                        // }
                    }
                    
                    //Tiket + Hotel + Mobil
                    if (empty($trans_tat) && empty($tiket_akomodasi_transportasi) && empty($akomodasi_tiket_transportasi) && empty($transportasi_tiket_akomodasi)) {
                        
                    } else {
                        $this->m_trans->insertBatch($trans_tat);
                        $this->m_tiket->insertBatch($tiket_akomodasi_transportasi);
                        $this->m_akomodasi->insertBatch($akomodasi_tiket_transportasi);
                        $this->m_transportasi->insertBatch($transportasi_tiket_akomodasi);
                        // d($trans_tat);
                        // d($tiket_akomodasi_transportasi);
                        // d($akomodasi_tiket_transportasi);
                        // d($transportasi_tiket_akomodasi);
                        // $email_info = $_POST['email_info'];
                        // $email_pengguna_info = $this->m_pengguna->whereIn('nama_pengguna', $email_info)->select('email_pengguna')->findAll();

                        // try {
                        //     //Server settings
                        //     // $mail->SMTPDebug = SMTP::DEBUG_SERVER;
                        //     $mail->isSMTP();
                        //     $mail->Host       = 'mail.konimex.com';
                        //     $mail->SMTPAuth   = true;
                        //     $mail->Username   = PDLN_EMAIL;
                        //     $mail->Password   = PDLN_PASS;
                        //     $mail->SMTPSecure = PHPMailer::ENCRYPTION_STARTTLS;
                        //     $mail->Port       = 587;
                        
                        //     //Recipients
                        //     $mail->setFrom('noreply@konimex.com');

                        //     foreach ($email_pengguna_info as $e => $ema) {
                        //         $mail->addAddress($ema['email_pengguna']);//Add a recipient
                        //     }
                        
                        //     //Content
                        //     // $link='https://konimex.com:447/pdln/listpb/pb/'.$id_transaksi;
                        //     $mail->Subject = 'Tes Program TABS (Bimo)';
                        //     $mail->Body    = nl2br("Tes kirim email harap diabaikan saja terima kasih.");
                        //     // $mail->Body    = nl2br("User bagian (").$niknmuser['niknm']."/".$nikuser['nik']."/".$nikuser['strorgnm'].(") telah selesai mengisi data PB, silahkan periksa data PB dengan cara klik link: $link");
                        
                        //     $mail->send();
                        //     // echo 'Message has been sent';
                        // } catch (Exception $e) {
                        //     echo "Message could not be sent. Mailer Error: {$mail->ErrorInfo}";
                        // }
                    }
                    
                    // session()->setFlashdata('success', ('Data berhasil ditambahkan'));
                    // return redirect()->to("trans");
                } else {
                    session()->setFlashdata('warning', ['Silahkan lengkapi data terlebih dahulu']);
                    return redirect()->to('trans_add');
                }
            }